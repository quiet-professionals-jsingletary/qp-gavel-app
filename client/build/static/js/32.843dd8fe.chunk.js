(this["webpackJsonpqp-ampd-app"]=this["webpackJsonpqp-ampd-app"]||[]).push([[32,9,22,50,127],{677:function(e,t,r){"use strict";r.r(t);var n=r(31),a=r(16),i=r(2),s=r(3),u=r(4),l=r(5),o=r(0),c=(r(13),r(10)),f=(r(12),r(14),r(1)),d=r(34),h=r(28),p=r(6),y=r(26),v=(r(9),r(19),r(20),r(23)),_=r(36),g=r(182),b=r(86),m=r(206),O=r(294),j=new d.a({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null}),S=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e){var n;return Object(i.a)(this,r),(n=t.call(this,e)).displayFieldName=null,n.exceededTransferLimit=!1,n.features=[],n.fields=null,n.geometryType=null,n.hasM=!1,n.hasZ=!1,n.queryGeometry=null,n.spatialReference=null,n}return Object(s.a)(r,[{key:"readFeatures",value:function(e,t){for(var r=_.a.fromJSON(t.spatialReference),n=[],a=0;a<e.length;a++){var i=e[a],s=m.a.fromJSON(i),u=i.geometry&&i.geometry.spatialReference;Object(c.g)(s.geometry)&&!u&&(s.geometry.spatialReference=r),n.push(s)}return n}},{key:"writeGeometryType",value:function(e,t,r,n){if(e)j.write(e,t,r,n);else{var i=this.features;if(i){var s,u=Object(a.a)(i);try{for(u.s();!(s=u.n()).done;){var l=s.value;if(l&&Object(c.g)(l.geometry))return void j.write(l.geometry.type,t,r,n)}}catch(o){u.e(o)}finally{u.f()}}}}},{key:"readQueryGeometry",value:function(e,t){if(!e)return null;var r=!!e.spatialReference,n=Object(g.a)(e);return!r&&t.spatialReference&&(n.spatialReference=_.a.fromJSON(t.spatialReference)),n}},{key:"writeSpatialReference",value:function(e,t){if(e)t.spatialReference=e.toJSON();else{var r=this.features;if(r){var n,i=Object(a.a)(r);try{for(i.s();!(n=i.n()).done;){var s=n.value;s&&Object(c.g)(s.geometry)&&s.geometry.spatialReference&&(t.spatialReference=s.geometry.spatialReference.toJSON())}}catch(u){i.e(u)}finally{i.f()}}}}},{key:"toJSON",value:function(e){var t=this.write(null);if(t.features&&Array.isArray(e)&&e.length>0)for(var r=0;r<t.features.length;r++){var n=t.features[r];if(n.geometry){var a=e&&e[r];n.geometry=a&&a.toJSON()||n.geometry}}return t}},{key:"quantize",value:function(e){for(var t=Object(n.a)(e.scale,2),r=t[0],a=t[1],i=Object(n.a)(e.translate,2),s=i[0],u=i[1],l=this.features,o=this._getQuantizationFunction(this.geometryType,(function(e){return Math.round((e-s)/r)}),(function(e){return Math.round((u-e)/a)})),f=0,d=l.length;f<d;f++)o(Object(c.m)(l[f].geometry))||(l.splice(f,1),f--,d--);return this.transform=e,this}},{key:"unquantize",value:function(){var e=this.geometryType,t=this.features,r=this.transform;if(!r)return this;var i,s=Object(n.a)(r.translate,2),u=s[0],l=s[1],o=Object(n.a)(r.scale,2),f=o[0],d=o[1],h=this._getHydrationFunction(e,(function(e){return e*f+u}),(function(e){return l-e*d})),p=Object(a.a)(t);try{for(p.s();!(i=p.n()).done;){var y=i.value.geometry;Object(c.g)(y)&&h(y)}}catch(v){p.e(v)}finally{p.f()}return this.transform=null,this}},{key:"_quantizePoints",value:function(e,t,r){for(var n,a,i=[],s=0,u=e.length;s<u;s++){var l=e[s];if(s>0){var o=t(l[0]),c=r(l[1]);o===n&&c===a||(i.push([o-n,c-a]),n=o,a=c)}else n=t(l[0]),a=r(l[1]),i.push([n,a])}return i.length>0?i:null}},{key:"_getQuantizationFunction",value:function(e,t,r){var n=this;return"point"===e?function(e){return e.x=t(e.x),e.y=r(e.y),e}:"polyline"===e||"polygon"===e?function(e){for(var a=Object(g.g)(e)?e.rings:e.paths,i=[],s=0,u=a.length;s<u;s++){var l=a[s],o=n._quantizePoints(l,t,r);o&&i.push(o)}return i.length>0?(Object(g.g)(e)?e.rings=i:e.paths=i,e):null}:"multipoint"===e?function(e){var a;return(a=n._quantizePoints(e.points,t,r)).length>0?(e.points=a,e):null}:"extent"===e?function(e){return e}:null}},{key:"_getHydrationFunction",value:function(e,t,r){return"point"===e?function(e){e.x=t(e.x),e.y=r(e.y)}:"polyline"===e||"polygon"===e?function(e){for(var n,a,i=Object(g.g)(e)?e.rings:e.paths,s=0,u=i.length;s<u;s++)for(var l=i[s],o=0,c=l.length;o<c;o++){var f=l[o];o>0?(n+=f[0],a+=f[1]):(n=f[0],a=f[1]),f[0]=t(n),f[1]=r(a)}}:"extent"===e?function(e){e.xmin=t(e.xmin),e.ymin=r(e.ymin),e.xmax=t(e.xmax),e.ymax=r(e.ymax)}:"multipoint"===e?function(e){for(var n,a,i=e.points,s=0,u=i.length;s<u;s++){var l=i[s];s>0?(n+=l[0],a+=l[1]):(n=l[0],a=l[1]),l[0]=t(n),l[1]=r(a)}}:void 0}}]),r}(v.a);Object(o.a)([Object(f.b)({type:String,json:{write:!0}})],S.prototype,"displayFieldName",void 0),Object(o.a)([Object(f.b)({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],S.prototype,"exceededTransferLimit",void 0),Object(o.a)([Object(f.b)({type:[m.a],json:{write:!0}})],S.prototype,"features",void 0),Object(o.a)([Object(h.a)("features")],S.prototype,"readFeatures",null),Object(o.a)([Object(f.b)({type:[O.a],json:{write:!0}})],S.prototype,"fields",void 0),Object(o.a)([Object(f.b)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:j.read}}})],S.prototype,"geometryType",void 0),Object(o.a)([Object(y.a)("geometryType")],S.prototype,"writeGeometryType",null),Object(o.a)([Object(f.b)({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],S.prototype,"hasM",void 0),Object(o.a)([Object(f.b)({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],S.prototype,"hasZ",void 0),Object(o.a)([Object(f.b)({types:b.b,json:{write:!0}})],S.prototype,"queryGeometry",void 0),Object(o.a)([Object(h.a)("queryGeometry")],S.prototype,"readQueryGeometry",null),Object(o.a)([Object(f.b)({type:_.a,json:{write:!0}})],S.prototype,"spatialReference",void 0),Object(o.a)([Object(y.a)("spatialReference")],S.prototype,"writeSpatialReference",null),Object(o.a)([Object(f.b)({json:{write:!0}})],S.prototype,"transform",void 0),(S=Object(o.a)([Object(p.a)("esri.tasks.support.FeatureSet")],S)).prototype.toJSON.isDefaultToJSON=!0,S||(S={});var w=S;t.default=w},759:function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return o}));var n=r(16),a=r(10),i=r(40),s=r(78);function u(e,t,r){if(Object(a.f)(t)||Object(a.f)(r)||r.vcsWkid||Object(i.c)(t,r))return null;var u=Object(s.c)(t)/Object(s.c)(r);if(1===u)return null;switch(e){case"point":case"esriGeometryPoint":return function(e){return r=u,void((t=e)&&null!=t.z&&(t.z*=r));var t,r};case"polyline":case"esriGeometryPolyline":return function(e){return function(e,t){if(e){var r,a=Object(n.a)(e.paths);try{for(a.s();!(r=a.n()).done;){var i,s=r.value,u=Object(n.a)(s);try{for(u.s();!(i=u.n()).done;){var l=i.value;l.length>2&&(l[2]*=t)}}catch(o){u.e(o)}finally{u.f()}}}catch(o){a.e(o)}finally{a.f()}}}(e,u)};case"polygon":case"esriGeometryPolygon":return function(e){return function(e,t){if(e){var r,a=Object(n.a)(e.rings);try{for(a.s();!(r=a.n()).done;){var i,s=r.value,u=Object(n.a)(s);try{for(u.s();!(i=u.n()).done;){var l=i.value;l.length>2&&(l[2]*=t)}}catch(o){u.e(o)}finally{u.f()}}}catch(o){a.e(o)}finally{a.f()}}}(e,u)};case"multipoint":case"esriGeometryMultipoint":return function(e){return function(e,t){if(e){var r,a=Object(n.a)(e.points);try{for(a.s();!(r=a.n()).done;){var i=r.value;i.length>2&&(i[2]*=t)}}catch(s){a.e(s)}finally{a.f()}}}(e,u)};default:return null}}function l(e,t,r){if(null==e.hasM||e.hasZ){var a,i=Object(n.a)(t);try{for(i.s();!(a=i.n()).done;){var s,u=a.value,l=Object(n.a)(u);try{for(l.s();!(s=l.n()).done;){var o=s.value;o.length>2&&(o[2]*=r)}}catch(c){l.e(c)}finally{l.f()}}}catch(c){i.e(c)}finally{i.f()}}}function o(e,t,r){if((e||t)&&r){var n=Object(s.c)(r);c(e,r,n),c(t,r,n)}}function c(e,t,r){if(e){var a,i=Object(n.a)(e);try{for(i.s();!(a=i.n()).done;){f(a.value.geometry,t,r)}}catch(s){i.e(s)}finally{i.f()}}}function f(e,t,r){if(e&&e.spatialReference&&!Object(i.c)(e.spatialReference,t)){var a=Object(s.c)(e.spatialReference)/r;if(1!==a)if("x"in e)null!=e.z&&(e.z*=a);else if("rings"in e)l(e,e.rings,a);else if("paths"in e)l(e,e.paths,a);else if("points"in e&&(null==e.hasM||e.hasZ)){var u,o=Object(n.a)(e.points);try{for(o.s();!(u=o.n()).done;){var c=u.value;c.length>2&&(c[2]*=a)}}catch(f){o.e(f)}finally{o.f()}}}}},760:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(2),a=function e(t,r,a,i){Object(n.a)(this,e),this._candidates=null,this._known=null,this._lastFetchedIndex=0,this._ordered=!1,this.pagesDefinition=null,this._candidates=t,this._known=r,this._ordered=a,this.pagesDefinition=i}},762:function(e,t,r){"use strict";var n=r(16),a=r(2),i=r(3),s=r(15),u=r(36),l=r(757),o=r(776),c=function(){function e(t,r){Object(a.a)(this,e),this._lastId=-1,this._progress=r,this._parent=t}return Object(i.a)(e,[{key:"reset",value:function(){this._lastId=-1}},{key:"nextBatch",value:function(e){var t=this;if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then((function(r){return t.nextBatch(e)}),(function(r){return t.nextBatch(e)}));var r={returnpromise:null,hasset:!1},n=[];return r.returnpromise=Object(s.c)((function(a,i){t._parent._getSet(t._progress).then((function(s){var u=s._known.length-1;if("GETPAGES"===s._known[s._known.length-1]&&(u-=1),t._lastId+e>u&&s._known.length>0&&"GETPAGES"===s._known[s._known.length-1])t._parent._expandPagedSet(s,t._parent._maxQueryRate(),0,0,t._progress).then((function(n){r.hasset=!0,t._parent._mainSetInUse=null,t.nextBatch(e).then(a,i)}),(function(e){r.hasset=!0,t._parent._mainSetInUse=null,i(e)}));else{if(u>=t._lastId+e||0===s._candidates.length){for(var l=0;l<e;l++){var o=l+t._lastId+1;if(o>=s._known.length)break;n[l]=s._known[o]}return t._lastId+=n.length,0===n.length&&(r.hasset=!0,t._parent._mainSetInUse=null,a([])),void t._parent._getFeatureBatch(n,t._progress).then((function(e){r.hasset=!0,t._parent._mainSetInUse=null,a(e)}),(function(e){r.hasset=!0,t._parent._mainSetInUse=null,i(e)}))}t._parent._refineSetBlock(s,t._parent._maxProcessingRate(),t._progress).then((function(){r.hasset=!0,t._parent._mainSetInUse=null,t.nextBatch(e).then(a,i)}),(function(e){r.hasset=!0,t._parent._mainSetInUse=null,i(e)}))}}),(function(e){r.hasset=!0,t._parent._mainSetInUse=null,i(e)}))})),!1===r.hasset&&(this._parent._mainSetInUse=r.returnpromise,r.hasset=!0),r.returnpromise}},{key:"next",value:function(){var e=this;if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then((function(t){return e.next()}),(function(t){return e.next()}));var t={returnpromise:null,hasset:!1};return t.returnpromise=Object(s.c)((function(r,n){e._parent._getSet(e._progress).then((function(a){e._lastId<a._known.length-1?"GETPAGES"===a._known[e._lastId+1]?e._parent._expandPagedSet(a,e._parent._maxQueryRate(),0,0,e._progress).then((function(r){return t.hasset=!0,e._parent._mainSetInUse=null,e.next()})).then(r,n):(e._lastId+=1,e._parent._getFeature(a,a._known[e._lastId],e._progress).then((function(n){t.hasset=!0,e._parent._mainSetInUse=null,r(n)}),(function(r){t.hasset=!0,e._parent._mainSetInUse=null,n(r)}))):a._candidates.length>0?e._parent._refineSetBlock(a,e._parent._maxProcessingRate(),e._progress).then((function(){t.hasset=!0,e._parent._mainSetInUse=null,e.next().then(r,n)}),(function(r){t.hasset=!0,e._parent._mainSetInUse=null,n(r)})):(t.hasset=!0,e._parent._mainSetInUse=null,r(null))}),(function(r){t.hasset=!0,e._parent._mainSetInUse=null,n(r)}))})),!1===t.hasset&&(this._parent._mainSetInUse=t.returnpromise,t.hasset=!0),t.returnpromise}},{key:"count",value:function(){var e=this;return-1!==this._parent._totalCount?Object(s.s)(this._parent._totalCount):this._parent._getSet(this._progress).then((function(t){return e._refineAllSets(t)})).then((function(t){return e._parent._totalCount=t._known.length,Object(s.s)(e._parent._totalCount)}))}},{key:"_refineAllSets",value:function(e){var t=this;return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]?this._parent._expandPagedSet(e,this._parent._maxQueryRate(),0,1,this._progress).then((function(r){return t._refineAllSets(e)})).then((function(e){return Object(s.s)(e)})):e._candidates.length>0?"GETPAGES"===e._known[e._candidates.length-1]?this._parent._expandPagedSet(e,this._parent._maxQueryRate(),0,2,this._progress).then((function(r){return t._refineAllSets(e)})).then((function(e){return Object(s.s)(e)})):this._parent._refineSetBlock(e,this._parent._maxProcessingRate(),this._progress).then((function(e){return e._candidates.length>0?t._refineAllSets(e):Object(s.s)(e)})):Object(s.s)(e)}}]),e}(),f=r(760),d=r(800),h=r(678),p=r(782),y=r(392),v=function(){function e(t){Object(a.a)(this,e),this.recentlyUsedQueries=null,this._idstates=[],this._parent=null,this._wset=null,this._mainSetInUse=null,this._maxProcessing=200,this._maxQuery=500,this._totalCount=-1,this._databaseType=l.a.NotEvaluated,this._databaseTypeProbed=null,this.declaredRootClass="esri.arcade.featureset.support.FeatureSet",this._featureCache=[],this.types=null,this.fields=null,this.geometryType="",this.objectIdField="",this.globalIdField="",this.spatialReference=null,this.hasM=!1,this.hasZ=!1,this._transparent=!1,this.loaded=!1,this._loadPromise=null,this._fieldsIndex=null,t&&t.lrucache&&(this.recentlyUsedQueries=t.lrucache)}return Object(i.a)(e,[{key:"optimisePagingFeatureQueries",value:function(e){this._parent&&this._parent.optimisePagingFeatureQueries(e)}},{key:"_hasMemorySource",value:function(){return!0}},{key:"prop",value:function(e,t){return void 0===t?this[e]:(void 0!==this[e]&&(this[e]=t),this)}},{key:"end",value:function(){return null!==this._parent&&!0===this._parent._transparent?this._parent.end():this._parent}},{key:"_ensureLoaded",value:function(){return this.load()}},{key:"load",value:function(){var e=this;return null===this._loadPromise&&(this._loadPromise=Object(s.c)((function(t,r){if(!0===e._parent.loaded)return e._initialiseFeatureSet(),void t(e);e._parent.load().then((function(){try{e._initialiseFeatureSet(),t(e)}catch(t){r(t)}}),r)}))),this._loadPromise}},{key:"_initialiseFeatureSet",value:function(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new u.a({wkid:4326}),this.geometryType=l.m.point)}},{key:"getField",value:function(e,t){var r;return(t=t||this.fields)&&(e=e.toLowerCase(),t.some((function(t){return t&&t.name.toLowerCase()===e&&(r=t),!!r}))),r}},{key:"getFieldsIndex",value:function(){return null===this._fieldsIndex&&(this._fieldsIndex=new y.a(this.fields)),this._fieldsIndex}},{key:"_maxProcessingRate",value:function(){return null!==this._parent?Math.min(this._maxProcessing,this._parent._maxProcessingRate()):Math.min(this._maxProcessing,this._maxQueryRate())}},{key:"_maxQueryRate",value:function(){return null!==this._parent?Math.max(this._maxQuery,this._parent._maxQueryRate()):this._maxQuery}},{key:"_checkCancelled",value:function(e){if(null!==e&&e.aborted)throw new Error("Operation has been cancelled.")}},{key:"nativeCapabilities",value:function(){return this._parent.nativeCapabilities()}},{key:"_canDoAggregates",value:function(e,t,r,n,a){return null===this._parent?Object(s.s)(!1):this._parent._canDoAggregates(e,t,r,n,a)}},{key:"_getAggregatePagesDataSourceDefinition",value:function(e,t,r,n,a,i,u){return null===this._parent?Object(s.r)(new Error("Should never be called")):this._parent._getAggregatePagesDataSourceDefinition(e,t,r,n,a,i,u)}},{key:"_getAgregagtePhysicalPage",value:function(e,t,r){return null===this._parent?Object(s.r)(new Error("Should never be called")):this._parent._getAgregagtePhysicalPage(e,t,r)}},{key:"databaseType",value:function(){var e=this;if(this._databaseType===l.a.NotEvaluated){if(null!==d.a.applicationCache){var t=d.a.applicationCache.getDatabaseType(this._cacheableFeatureSetSourceKey());if(null!==t)return t}if(null!==this._databaseTypeProbed)return this._databaseTypeProbed;var r=[{thetype:l.a.SqlServer,testwhere:"(CAST( '2015-01-01' as DATETIME) = CAST( '2015-01-01' as DATETIME)) AND OBJECTID<0"},{thetype:l.a.Oracle,testwhere:"(TO_DATE('2003-11-18','YYYY-MM-DD') = TO_DATE('2003-11-18','YYYY-MM-DD')) AND OBJECTID<0"},{thetype:l.a.StandardisedNoInterval,testwhere:"(date '2015-01-01 10:10:10' = date '2015-01-01 10:10:10') AND OBJECTID<0"}],n=Object(s.c)((function(t,n){e._getDatabaseTypeImpl(r,0).then((function(r){e._databaseType=r,t(e._databaseType)}),(function(e){n(e)}))}));return null!==d.a.applicationCache&&(d.a.applicationCache.setDatabaseType(this._cacheableFeatureSetSourceKey(),n),n=n.catch((function(t){throw d.a.applicationCache.clearDatabaseType(e._cacheableFeatureSetSourceKey()),t}))),this._databaseTypeProbed=n,this._databaseTypeProbed}return Object(s.s)(this._databaseType)}},{key:"_cacheableFeatureSetSourceKey",value:function(){return"MUSTBESET"}},{key:"_getDatabaseTypeImpl",value:function(e,t){var r=this;return t>=e.length?Object(s.s)(l.a.StandardisedNoInterval):this._runDatabaseProbe(e[t].testwhere).then((function(n){return!0===n?e[t].thetype:r._getDatabaseTypeImpl(e,t+1)}))}},{key:"_runDatabaseProbe",value:function(e){return null!==this._parent?this._parent._runDatabaseProbe(e):Object(s.r)(new Error("Not Implemented"))}},{key:"isTable",value:function(){return this._parent.isTable()}},{key:"_featureFromCache",value:function(e){if(void 0!==this._featureCache[e])return this._featureCache[e]}},{key:"_isInFeatureSet",value:function(e){return l.b.Unknown}},{key:"_getSet",value:function(e){throw new Error("Not implemented in abstract class")}},{key:"_getFeature",value:function(e,t,r){var n=this;try{return this._checkCancelled(r),void 0!==this._featureFromCache(t)?Object(s.s)(this._featureFromCache(t)):this._getFeatures(e,t,this._maxProcessingRate(),r).then((function(){return n._checkCancelled(r),void 0!==n._featureFromCache(t)?n._featureFromCache(t):Object(s.r)(new Error("Feature Not Found"))}))}catch(e){return Object(s.r)(e)}}},{key:"_getFeatureBatch",value:function(e,t){var r=this;try{this._checkCancelled(t);var a=new f.a([],e,!1,null),i=[];return this._getFeatures(a,-1,e.length,t).then((function(){r._checkCancelled(t);var a,s=Object(n.a)(e);try{for(s.s();!(a=s.n()).done;){var u=a.value;void 0!==r._featureFromCache(u)&&i.push(r._featureFromCache(u))}}catch(l){s.e(l)}finally{s.f()}return i}))}catch(e){return Object(s.r)(e)}}},{key:"_getFeatures",value:function(e,t,r,n){return Object(s.s)("success")}},{key:"_getFilteredSet",value:function(e,t,r,n,a){throw new Error("Not implemented in abstract class")}},{key:"_refineSetBlock",value:function(e,t,r){var n=this;try{if(!0===this._checkIfNeedToExpandCandidatePage(e,this._maxQueryRate()))return this._expandPagedSet(e,this._maxQueryRate(),0,0,r).then((function(){return n._refineSetBlock(e,t,r)}));this._checkCancelled(r);var a=e._candidates.length;this._refineKnowns(e,t);var i=a-e._candidates.length;return 0===e._candidates.length||i>=t?Object(s.s)(e):this._refineIfParentKnown(e,t-i,r).then((function(){if(n._checkCancelled(r),n._refineKnowns(e,t-i),(i=a-e._candidates.length)<t&&e._candidates.length>0){var s=t-i,u=n._prepareFetchAndRefineSet(e._candidates);return n._fetchAndRefineFeatures(u,u.length>s?s:e._candidates.length,r).then((function(){return n._checkCancelled(r),n._refineKnowns(e,t-i),e}))}return e}))}catch(e){return Object(s.r)(e)}}},{key:"_fetchAndRefineFeatures",value:function(e,t,r){return null}},{key:"_prepareFetchAndRefineSet",value:function(e){for(var t=[],r=0;r<e.length;r++)this._isPhysicalFeature(e[r])&&t.push(e[r]);return t}},{key:"_isPhysicalFeature",value:function(e){return null===this._parent||this._parent._isPhysicalFeature(e)}},{key:"_refineKnowns",value:function(e,t){var r=0,n=null,a=[];t=this._maxQueryRate();for(var i=0;i<e._candidates.length&&"GETPAGES"!==e._candidates[i];i++){var s=!1,u=this._candidateIdTransform(e._candidates[i]);u!==e._candidates[i]&&(s=!0);var o=this._isInFeatureSet(u);if(o===l.b.InFeatureSet)!0===s?e._known.indexOf(u)<0&&(e._known.push(u),r+=1):(e._known.push(e._candidates[i]),r+=1),null===n?n={start:i,end:i}:n.end===i-1?n.end=i:(a.push(n),n={start:i,end:i});else if(o===l.b.NotInFeatureSet)null===n?n={start:i,end:i}:n.end===i-1?n.end=i:(a.push(n),n={start:i,end:i}),r+=1;else if(o===l.b.Unknown&&(r+=1,!0===e._ordered))break;if(r>=t)break}null!==n&&a.push(n);for(var c=a.length-1;c>=0;c--)e._candidates.splice(a[c].start,a[c].end-a[c].start+1)}},{key:"_refineIfParentKnown",value:function(e,t,r){var n=new f.a([],[],e._ordered,null);return n._candidates=e._candidates.slice(0),this._parent._refineSetBlock(n,t,r)}},{key:"_candidateIdTransform",value:function(e){return this._parent._candidateIdTransform(e)}},{key:"_checkIfNeedToExpandKnownPage",value:function(e,t){if(null===e.pagesDefinition)return!1;for(var r=0,n=e._lastFetchedIndex;n<e._known.length;n++){if("GETPAGES"===e._known[n])return!0;if(void 0===this._featureCache[e._known[n]]&&(r+=1)>=t)break}return!1}},{key:"_checkIfNeedToExpandCandidatePage",value:function(e,t){if(null===e.pagesDefinition)return!1;for(var r=0,n=0;n<e._candidates.length;n++){if("GETPAGES"===e._candidates[n])return!0;if((r+=1)>=t)break}return!1}},{key:"_expandPagedSet",value:function(e,t,r,n,a){return null===this._parent?Object(s.r)(new Error("Parent Paging not implemented")):this._parent._expandPagedSet(e,t,r,n,a)}},{key:"_expandPagedSetFeatureSet",value:function(e,t,r,n,a){var i=this;return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]&&(n=1),0===n&&e._candidates.length>0&&"GETPAGES"===e._candidates[e._candidates.length-1]&&(n=2),0===n?Object(s.s)("finished"):this._getPage(e,n,a).then((function(n){return r+n<t?i._expandPagedSet(e,t,r+n,0,a):"success"}))}},{key:"_getPage",value:function(e,t,r){var n=this,a=1===t?e._known:e._candidates;if(e.pagesDefinition.internal.set.length>e.pagesDefinition.resultOffset||!0===e.pagesDefinition.internal.fullyResolved){a.length=a.length-1;for(var i=0,u=0;u<e.pagesDefinition.resultRecordCount&&!(e.pagesDefinition.resultOffset+u>=e.pagesDefinition.internal.set.length);u++)a[a.length]=e.pagesDefinition.internal.set[e.pagesDefinition.resultOffset+u],i++;e.pagesDefinition.resultOffset+=i;var l=!1;return!0===e.pagesDefinition.internal.fullyResolved&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset&&(l=!0),!1===l&&a.push("GETPAGES"),Object(s.s)(i)}return this._getPhysicalPage(e,t,r).then((function(){return n._getPage(e,t,r)}))}},{key:"_getPhysicalPage",value:function(e,t,r){return null}},{key:"_clonePageDefinition",value:function(e){return null===this._parent?null:this._parent._clonePageDefinition(e)}},{key:"_first",value:function(e){return this.iterator(e).next()}},{key:"first",value:function(e){return this._first(e)}},{key:"calculateStatistic",value:function(e,t,r,n){var a=this;return this._ensureLoaded().then((function(){return a._stat(e,t,"",null,null,r,n).then((function(i){return!1===i.calculated?a._manualStat(e,t,r,n).then((function(e){return e.result})):i.result}))}))}},{key:"_manualStat",value:function(e,t,r,n){switch(e.toLowerCase()){case"count":return Object(p.b)(this,n).then((function(e){return{calculated:!0,result:e}}));case"distinct":return Object(p.d)(this,t,r).then((function(e){return{calculated:!0,result:e}}));case"avg":case"mean":return Object(p.f)(this,t,n).then((function(e){return{calculated:!0,result:e}}));case"stdev":return Object(p.h)(this,t,n).then((function(e){return{calculated:!0,result:e}}));case"variance":return Object(p.j)(this,t,n).then((function(e){return{calculated:!0,result:e}}));case"sum":return Object(p.i)(this,t,n).then((function(e){return{calculated:!0,result:e}}));case"min":return Object(p.g)(this,t,n).then((function(e){return{calculated:!0,result:e}}));case"max":return Object(p.e)(this,t,n).then((function(e){return{calculated:!0,result:e}}));default:return Object(s.s)({calculated:!0,result:0})}}},{key:"_stat",value:function(e,t,r,n,a,i,s){var u=this;return this._parent._stat(e,t,r,n,a,i,s).then((function(l){return!1===l.calculated?null===a&&""===r&&null===n?u._manualStat(e,t,i,s):{calculated:!1}:l}))}},{key:"_unionAllGeomSelf",value:function(e){var t=this,r=this.iterator(this._defaultTracker(e)),n=[];return Object(s.c)((function(e,a){t._unionShapeInBatches(n,r,e,a)}))}},{key:"_unionAllGeom",value:function(e){var t=this;return Object(s.c)((function(r,n){var a=t.iterator(t._defaultTracker(e));t._unionShapeInBatches([],a,r,n)}))}},{key:"_unionShapeInBatches",value:function(e,t,r,n){var a=this;t.next().then((function(i){try{null!==i&&null!==i.geometry&&e.push(i.geometry),e.length>30||null===i&&e.length>1?Object(o.B)(e).then((function(s){try{null===i?r(s):(e=[s],a._unionShapeInBatches(e,t,r,n))}catch(e){n(e)}}),n):null===i?1===e.length?r(e[0]):r(null):a._unionShapeInBatches(e,t,r,n)}catch(e){n(e)}}),n)}},{key:"iterator",value:function(e){return new c(this,e)}},{key:"intersection",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e._featuresetFunctions.intersection.bind(this)(t,r)}},{key:"difference",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e._featuresetFunctions.difference.bind(this)(t,r,n)}},{key:"symmetricDifference",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e._featuresetFunctions.symmetricDifference.bind(this)(t,r,n)}},{key:"morphShape",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unknown",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return e._featuresetFunctions.morphShape.bind(this)(t,r,n,a)}},{key:"morphShapeAndAttributes",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unknown";return e._featuresetFunctions.morphShapeAndAttributes.bind(this)(t,r,n)}},{key:"union",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e._featuresetFunctions.union.bind(this)(t,r)}},{key:"intersects",value:function(t){return e._featuresetFunctions.intersects.bind(this)(t)}},{key:"envelopeIntersects",value:function(t){return e._featuresetFunctions.envelopeIntersects.bind(this)(t)}},{key:"contains",value:function(t){return e._featuresetFunctions.contains.bind(this)(t)}},{key:"overlaps",value:function(t){return e._featuresetFunctions.overlaps.bind(this)(t)}},{key:"relate",value:function(t,r){return e._featuresetFunctions.relate.bind(this)(t,r)}},{key:"within",value:function(t){return e._featuresetFunctions.within.bind(this)(t)}},{key:"touches",value:function(t){return e._featuresetFunctions.touches.bind(this)(t)}},{key:"top",value:function(t){return e._featuresetFunctions.top.bind(this)(t)}},{key:"crosses",value:function(t){return e._featuresetFunctions.crosses.bind(this)(t)}},{key:"buffer",value:function(t,r,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return e._featuresetFunctions.buffer.bind(this)(t,r,n,a)}},{key:"filter",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e._featuresetFunctions.filter.bind(this)(t,r)}},{key:"orderBy",value:function(t){return e._featuresetFunctions.orderBy.bind(this)(t)}},{key:"dissolve",value:function(t,r){return e._featuresetFunctions.dissolve.bind(this)(t,r)}},{key:"groupby",value:function(t,r){return e._featuresetFunctions.groupby.bind(this)(t,r)}},{key:"reduce",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;return Object(s.c)((function(a,i){t._reduceImpl(t.iterator(t._defaultTracker(n)),e,r,0,a,i,0)}))}},{key:"_reduceImpl",value:function(e,t,r,n,a,i,u){var l=this;try{if(++u>1e3)return void setTimeout((function(){u=0,l._reduceImpl(e,t,r,n,a,i,u)}));e.next().then((function(o){try{if(null===o)a(r);else{var c=t(r,o,n,l);Object(s.n)(c)?c.then((function(r){l._reduceImpl(e,t,r,n+1,a,i,u)}),i):l._reduceImpl(e,t,c,n+1,a,i,u)}}catch(e){i(e)}}),i)}catch(e){i(e)}}},{key:"removeField",value:function(t){return e._featuresetFunctions.removeField.bind(this)(t)}},{key:"addField",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e._featuresetFunctions.addField.bind(this)(t,r,n)}},{key:"sumArea",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,n=Object(l.e)(e);return this.reduce((function(e,r){return null===r.geometry?0:t?Object(o.l)(r.geometry,n).then((function(t){return e+t})):Object(o.u)(r.geometry,n).then((function(t){return e+t}))}),0,r)}},{key:"sumLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,n=Object(l.d)(e);return this.reduce((function(e,r){return null===r.geometry?0:t?Object(o.o)(r.geometry,n).then((function(t){return e+t})):Object(o.v)(r.geometry,n).then((function(t){return e+t}))}),0,r)}},{key:"_substituteVars",value:function(e,t){if(null!==t){var r={};for(var n in t)r[n.toLowerCase()]=t[n];e.parameters=r}}},{key:"distinct",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3?arguments[3]:void 0;return this.load().then((function(){var i=h.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(i,n),t.calculateStatistic("distinct",i,r,t._defaultTracker(a))}))}},{key:"min",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;return this.load().then((function(){var a=h.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(a,r),t.calculateStatistic("min",a,-1,t._defaultTracker(n))}))}},{key:"max",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;return this.load().then((function(){var a=h.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(a,r),t.calculateStatistic("max",a,-1,t._defaultTracker(n))}))}},{key:"avg",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;return this.load().then((function(){var a=h.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(a,r),t.calculateStatistic("avg",a,-1,t._defaultTracker(n))}))}},{key:"sum",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;return this.load().then((function(){var a=h.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(a,r),t.calculateStatistic("sum",a,-1,t._defaultTracker(n))}))}},{key:"stdev",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;return this.load().then((function(){var a=h.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(a,r),t.calculateStatistic("stdev",a,-1,t._defaultTracker(n))}))}},{key:"variance",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;return this.load().then((function(){var a=h.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(a,r),t.calculateStatistic("variance",a,-1,t._defaultTracker(n))}))}},{key:"count",value:function(e){var t=this;return this.load().then((function(){return t.calculateStatistic("count",h.WhereClause.create("1",t.getFieldsIndex()),-1,t._defaultTracker(e))}))}},{key:"_defaultTracker",value:function(e){return e||{aborted:!1}}},{key:"forEach",value:function(e,t){var r=this;return Object(s.c)((function(n,a){r._forEachImpl(r.iterator(r._defaultTracker(t)),e,r,n,a,0)}))}},{key:"_forEachImpl",value:function(e,t,r,n,a,i){var u=this;try{if(++i>1e3)return void setTimeout((function(){i=0,u._forEachImpl(e,t,r,n,a,i)}),0);e.next().then((function(l){try{if(null===l)n(r);else{var o=t(l);null==o?u._forEachImpl(e,t,r,n,a,i):Object(s.n)(o)?o.then((function(){try{u._forEachImpl(e,t,r,n,a,i)}catch(e){a(e)}}),a):u._forEachImpl(e,t,r,n,a,i)}}catch(e){a(e)}}),a)}catch(e){a(e)}}},{key:"convertToJSON",value:function(e){for(var t={layerDefinition:{geometryType:this.geometryType,fields:[]},featureSet:{features:[],geometryType:this.geometryType}},r=0;r<this.fields.length;r++)t.layerDefinition.fields.push(Object(l.h)(this.fields[r]));return this.reduce((function(e,r){var n={geometry:r.geometry&&r.geometry.toJSON(),attributes:{}};for(var a in r.attributes)n.attributes[a]=r.attributes[a];return t.featureSet.features.push(n),1}),0,e).then((function(){return t}))}},{key:"castToText",value:function(){return"object, FeatureSet"}},{key:"queryAttachments",value:function(e,t,r,n){return this._parent.queryAttachments(e,t,r,n)}},{key:"serviceUrl",value:function(){return this._parent.serviceUrl()}},{key:"subtypes",value:function(){return this.typeIdField?{subtypeField:this.typeIdField,subtypes:this.types?this.types.map((function(e){return{name:e.name,code:e.id}})):[]}:null}},{key:"relationshipMetaData",value:function(){return this._parent.relationshipMetaData()}},{key:"schema",value:function(){var e,t=[],r=Object(n.a)(this.fields);try{for(r.s();!(e=r.n()).done;){var a=e.value;t.push(Object(l.h)(a))}}catch(i){r.e(i)}finally{r.f()}return{objectIdField:this.objectIdField,globalIdField:this.globalIdField,geometryType:void 0===l.n[this.geometryType]?"":l.n[this.geometryType],fields:t}}},{key:"convertToText",value:function(e,t){var r=this;return"schema"===e?this._ensureLoaded().then((function(){return JSON.stringify(r.schema())})):"featureset"===e?this._ensureLoaded().then((function(){var e=[];return r.reduce((function(t,r){var n={geometry:r.geometry?r.geometry.toJSON():null,attributes:r.attributes};return null!==n.geometry&&n.geometry.spatialReference&&delete n.geometry.spatialReference,e.push(n),1}),0,t).then((function(){var t=r.schema();return t.features=e,t.spatialReference=r.spatialReference.toJSON(),JSON.stringify(t)}))})):Object(s.s)(this.castToText())}},{key:"getFeatureByObjectId",value:function(e,t){return this._parent.getFeatureByObjectId(e,t)}},{key:"getOwningSystemUrl",value:function(){return this._parent.getOwningSystemUrl()}},{key:"getIdentityUser",value:function(){return this._parent.getIdentityUser()}},{key:"gdbVersion",get:function(){return this._parent?this._parent.gdbVersion:""}}]),e}();v._featuresetFunctions={};t.a=v},764:function(e,t,r){"use strict";r.d(t,"a",(function(){return P}));var n=r(8),a=r.n(n),i=(r(31),r(22)),s=r(16),u=r(68),l=r(10),o=r(12),c=r(21),f=r(15),d=r(40),h=r(36),p=r(65),y=r(122),v=r(121),_=r(11),g=r(9),b=r(182),m=(r(86),r(58));function O(e,t,r,n){return j.apply(this,arguments)}function j(){return(j=Object(i.a)(a.a.mark((function e(t,r,n,i){var s,u,l,o,c,f,d,h;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s="string"==typeof t?Object(g.I)(t):t,u=r[0].spatialReference,l=Object(_.a)(Object(_.a)({},i),{},{query:Object(_.a)(Object(_.a)({},s.query),{},{f:"json",sr:JSON.stringify(u),target:JSON.stringify({geometryType:Object(b.c)(r[0]),geometries:r}),cutter:JSON.stringify(n)})}),e.next=5,Object(m.default)(s.path+"/cut",l);case 5:return o=e.sent,c=o.data,f=c.cutIndexes,d=c.geometries,h=void 0===d?[]:d,e.abrupt("return",{cutIndexes:f,geometries:h.map((function(e){var t=Object(b.a)(e);return t.spatialReference=u,t}))});case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,t,r){return w.apply(this,arguments)}function w(){return(w=Object(i.a)(a.a.mark((function e(t,r,n){var i,s,u,l;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="string"==typeof t?Object(g.I)(t):t,s=r[0].spatialReference,u=Object(b.c)(r[0]),l=Object(_.a)(Object(_.a)({},n),{},{query:Object(_.a)(Object(_.a)({},i.query),{},{f:"json",sr:s.wkid?s.wkid:JSON.stringify(s),geometries:JSON.stringify(k(r))})}),e.t0=function(e,t,r){var n=Object(b.b)(t);return e.map((function(e){var t=n.fromJSON(e);return t.spatialReference=r,t}))},e.next=4,Object(m.default)(i.path+"/simplify",l);case 4:return e.t1=e.sent.data,e.t2=u,e.t3=s,e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t3));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return{geometryType:Object(b.c)(e[0]),geometries:e.map((function(e){return e.toJSON()}))}}var F=o.a.getLogger("esri.geometry.support.normalizeUtils"),I={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new v.a({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:h.a.WebMercator}),minus180Line:new v.a({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:h.a.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new v.a({paths:[[[180,-180],[180,180]]],spatialReference:h.a.WGS84}),minus180Line:new v.a({paths:[[[-180,-180],[-180,180]]],spatialReference:h.a.WGS84})}};function x(e){return"polygon"===e.type}function C(e){return"polyline"===e[0].type}function T(e){return x(e)?e.rings:e.paths}function R(e,t){return Math.ceil((e-t)/(2*t))}function D(e,t){var r,n=T(e),a=Object(s.a)(n);try{for(a.s();!(r=a.n()).done;){var i,u=r.value,l=Object(s.a)(u);try{for(l.s();!(i=l.n()).done;){i.value[0]+=t}}catch(o){l.e(o)}finally{l.f()}}}catch(o){a.e(o)}finally{a.f()}return e}function E(e,t,r){if(t){var n=function(e,t){if(!(e instanceof v.a||e instanceof y.a)){var r="straightLineDensify: the input geometry is neither polyline nor polygon";throw F.error(r),new c.a(r)}var n,a=T(e),i=[],u=Object(s.a)(a);try{for(u.s();!(n=u.n()).done;){var l=n.value,o=[];i.push(o),o.push([l[0][0],l[0][1]]);for(var f=0;f<l.length-1;f++){var d=l[f][0],h=l[f][1],p=l[f+1][0],_=l[f+1][1],g=Math.sqrt((p-d)*(p-d)+(_-h)*(_-h)),b=(_-h)/g,m=(p-d)/g,O=g/t;if(O>1){for(var j=1;j<=O-1;j++){var S=j*t,w=m*S+d,k=b*S+h;o.push([w,k])}var I=(g+Math.floor(O-1)*t)/2,C=m*I+d,R=b*I+h;o.push([C,R])}o.push([p,_])}}}catch(D){u.e(D)}finally{u.f()}return x(e)?new y.a({rings:i,spatialReference:e.spatialReference}):new v.a({paths:i,spatialReference:e.spatialReference})}(e,1e6);e=Object(p.e)(n,!0)}return r&&(e=D(e,r)),e}function N(e,t,r){if(Array.isArray(e)){var n=e[0];if(n>t){var a=R(n,t);e[0]=n+a*(-2*t)}else if(n<r){var i=R(n,r);e[0]=n+i*(-2*r)}}else{var s=e.x;if(s>t){var u=R(s,t);e=e.clone().offset(u*(-2*t),0)}else if(s<r){var l=R(s,r);e=e.clone().offset(l*(-2*r),0)}}return e}function P(e,t,r){return A.apply(this,arguments)}function A(){return(A=Object(i.a)(a.a.mark((function e(t,r,n){var i,o,c,h,_,g,b,m,j,w,k,F,x,A,L,G,q,B,U,M,W,V,Q,J,Y,z,K,H,Z,X,$,ee,te,re,ne,ae,ie,se,ue,le;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)){e.next=2;break}return e.abrupt("return",P([t],r));case 2:i=r?r.url:u.a.geometryServiceUrl,w=0,k=[],F=[],x=Object(s.a)(t);try{for(x.s();!(A=x.n()).done;)L=A.value,Object(l.f)(L)?F.push(L):(o||(o=L.spatialReference,c=Object(d.d)(o),h=o.isWebMercator,_=I[b=h?102100:4326].maxX,g=I[b].minX,m=I[b].plus180Line,j=I[b].minus180Line),c?"mesh"===L.type?F.push(L):"point"===L.type?F.push(N(L.clone(),_,g)):"multipoint"===L.type?((G=L.clone()).points=G.points.map((function(e){return N(e,_,g)})),F.push(G)):"extent"===L.type?(q=L.clone()._normalize(!1,!1,c),F.push(q.rings?new y.a(q):q)):L.extent?(B=L.extent,U=R(B.xmin,g)*(2*_),M=0===U?L.clone():D(L.clone(),U),B.offset(U,0),B.intersects(m)&&B.xmax!==_?(w=B.xmax>w?B.xmax:w,M=E(M,h),k.push(M),F.push("cut")):B.intersects(j)&&B.xmin!==g?(w=B.xmax*(2*_)>w?B.xmax*(2*_):w,M=E(M,h,360),k.push(M),F.push("cut")):F.push(M)):F.push(L.clone()):F.push(L))}catch(a){x.e(a)}finally{x.f()}for(W=R(w,_),V=-90,Q=W,J=new v.a;W>0;)Y=360*W-180,J.addPath([[Y,V],[Y,-1*V]]),V*=-1,W--;if(!(k.length>0&&Q>0)){e.next=28;break}return e.t0=function(e,t){for(var r=-1,n=function(n){for(var i=t.cutIndexes[n],u=t.geometries[n],l=T(u),o=function(e){var t=l[e];t.some((function(r){if(r[0]<180)return!0;for(var n=0,a=0;a<t.length;a++){var i=t[a][0];n=i>n?i:n}for(var s=-360*R(n=Number(n.toFixed(9)),180),l=0;l<t.length;l++){var o=u.getPoint(e,l);u.setPoint(e,l,o.clone().offset(s,0))}return!0}))},c=0;c<l.length;c++)o(c);if(i===r){if("polygon"===e[0].type){var f,d=Object(s.a)(T(u));try{for(d.s();!(f=d.n()).done;){var h=f.value;e[i]=e[i].addRing(h)}}catch(a){d.e(a)}finally{d.f()}}else if(C(e)){var p,y=Object(s.a)(T(u));try{for(y.s();!(p=y.n()).done;){var v=p.value;e[i]=e[i].addPath(v)}}catch(a){y.e(a)}finally{y.f()}}}else r=i,e[i]=u},i=0;i<t.cutIndexes.length;i++)n(i);return e},e.t1=k,e.next=15,O(i,k,J,n);case 15:for(e.t2=e.sent,z=(0,e.t0)(e.t1,e.t2),K=[],H=[],Z=0;Z<F.length;Z++)"cut"!==(X=F[Z])?H.push(X):($=z.shift(),ee=t[Z],Object(l.g)(ee)&&"polygon"===ee.type&&ee.rings&&ee.rings.length>1&&$.rings.length>=ee.rings.length?(K.push($),H.push("simplify")):H.push(h?Object(p.b)($):$));if(K.length){e.next=22;break}return e.abrupt("return",H);case 22:return e.next=24,S(i,K,n);case 24:for(te=e.sent,re=[],ne=0;ne<H.length;ne++)"simplify"!==(ae=H[ne])?re.push(ae):re.push(h?Object(p.b)(te.shift()):te.shift());return e.abrupt("return",re);case 28:for(ie=[],se=0;se<F.length;se++)"cut"!==(ue=F[se])?ie.push(ue):(le=k.shift(),ie.push(!0===h?Object(p.b)(le):le));return e.abrupt("return",Object(f.s)(ie));case 31:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},766:function(e,t,r){"use strict";var n=r(11),a=r(2),i=r(3),s=r(4),u=r(5),l=r(0),o=(r(13),r(12),r(14),r(1)),c=r(6),f=r(9),d=(r(19),r(20),function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(){var e;Object(a.a)(this,r);for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return(e=t.call.apply(t,[this].concat(i))).requestOptions=null,e.url=null,e}return Object(i.a)(r,[{key:"normalizeCtorArgs",value:function(e,t){return"string"!=typeof e?e:Object(n.a)({url:e},t)}},{key:"_parseUrl",value:function(e){return e?Object(f.I)(e):null}},{key:"_encode",value:function(e,t,r){var n={};for(var a in e)if("declaredClass"!==a){var i=e[a];if(null!=i&&"function"!=typeof i)if(Array.isArray(i)){n[a]=[];for(var s=0;s<i.length;s++)n[a][s]=this._encode(i[s])}else if("object"==typeof i)if(i.toJSON){var u=i.toJSON(r&&r[a]);n[a]=t?u:JSON.stringify(u)}else n[a]=t?i:JSON.stringify(i);else n[a]=i}return n}},{key:"parsedUrl",get:function(){return this._parseUrl(this.url)}}]),r}(r(43).a));Object(l.a)([Object(o.b)({readOnly:!0,dependsOn:["url"]})],d.prototype,"parsedUrl",null),Object(l.a)([Object(o.b)()],d.prototype,"requestOptions",void 0),Object(l.a)([Object(o.b)({type:String})],d.prototype,"url",void 0);var h=d=Object(l.a)([Object(c.a)("esri.tasks.Task")],d);t.a=h},767:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return j})),r.d(t,"c",(function(){return m})),r.d(t,"d",(function(){return h})),r.d(t,"e",(function(){return p})),r.d(t,"f",(function(){return y})),r.d(t,"g",(function(){return o})),r.d(t,"h",(function(){return b})),r.d(t,"i",(function(){return u})),r.d(t,"j",(function(){return l})),r.d(t,"k",(function(){return d}));var n=r(16),a=r(758),i=r(757),s=r(678);function u(e,t){return f(e.parseTree,t,e.parameters)}function l(e,t,r){return f(e,t,r)}function o(e,t,r,n){return s.WhereClause.create(f(e.parseTree,i.a.Standardised,e.parameters,t,r),n)}function c(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"AND";return s.WhereClause.create("(("+u(e,i.a.Standardised)+")"+r+"("+u(t,i.a.Standardised)+"))",e.fieldsIndex)}function f(e,t,r){var a,i,s,u,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;switch(e.type){case"interval":return j(f(e.value,t,r,l,o),e.qualifier,e.op);case"case_expression":var c=" CASE ";"simple"===e.format&&(c+=f(e.operand,t,r,l,o));for(var y=0;y<e.clauses.length;y++)c+=" WHEN "+f(e.clauses[y].operand,t,r,l,o)+" THEN "+f(e.clauses[y].value,t,r,l,o);return null!==e.else&&(c+=" ELSE "+f(e.else,t,r,l,o)),c+=" END ";case"param":var v=r[e.value.toLowerCase()];if("string"==typeof v)return"'"+r[e.value.toLowerCase()].toString().replace(/'/g,"''")+"'";if(v instanceof Date)return h(v,t);if(v instanceof Array){for(var _=[],g=0;g<v.length;g++)"string"==typeof v[g]?_.push("'"+v[g].toString().replace(/'/g,"''")+"'"):v[g]instanceof Date?_.push(h(v[g],t)):_.push(v[g].toString());return _}return v.toString();case"expr_list":i=[];var b,m=Object(n.a)(e.value);try{for(m.s();!(b=m.n()).done;){var O=b.value;i.push(f(O,t,r,l,o))}}catch(w){m.e(w)}finally{m.f()}return i;case"unary_expr":return" ( NOT "+f(e.expr,t,r,l,o)+" ) ";case"binary_expr":switch(e.operator){case"AND":return" ("+f(e.left,t,r,l,o)+" AND "+f(e.right,t,r,l,o)+") ";case"OR":return" ("+f(e.left,t,r,l,o)+" OR "+f(e.right,t,r,l,o)+") ";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+f(e.left,t,r,l,o)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+f(e.left,t,r,l,o)+" IS NOT NULL )";case"IN":return a=[],"expr_list"===e.right.type?(a=f(e.right,t,r,l,o)," ("+f(e.left,t,r,l,o)+" IN ("+a.join(",")+")) "):(u=f(e.right,t,r,l,o))instanceof Array?" ("+f(e.left,t,r,l,o)+" IN ("+u.join(",")+")) ":" ("+f(e.left,t,r,l,o)+" IN ("+u+")) ";case"NOT IN":return a=[],"expr_list"===e.right.type?(a=f(e.right,t,r,l,o)," ("+f(e.left,t,r,l,o)+" NOT IN ("+a.join(",")+")) "):(u=f(e.right,t,r,l,o))instanceof Array?" ("+f(e.left,t,r,l,o)+" NOT IN ("+u.join(",")+")) ":" ("+f(e.left,t,r,l,o)+" NOT IN ("+u+")) ";case"BETWEEN":return s=f(e.right,t,r,l,o)," ("+f(e.left,t,r,l,o)+" BETWEEN "+s[0]+" AND "+s[1]+" ) ";case"NOTBETWEEN":return s=f(e.right,t,r,l,o)," ("+f(e.left,t,r,l,o)+" NOT BETWEEN "+s[0]+" AND "+s[1]+" ) ";case"LIKE":return""!==e.escape?" ("+f(e.left,t,r,l,o)+" LIKE "+f(e.right,t,r,l,o)+" ESCAPE '"+e.escape+"') ":" ("+f(e.left,t,r,l,o)+" LIKE "+f(e.right,t,r,l,o)+") ";case"NOT LIKE":return""!==e.escape?" ("+f(e.left,t,r,l,o)+" NOT LIKE "+f(e.right,t,r,l,o)+" ESCAPE '"+e.escape+"') ":" ("+f(e.left,t,r,l,o)+" NOT LIKE "+f(e.right,t,r,l,o)+") ";case"<>":case"<":case">":case">=":case"<=":case"=":case"*":case"-":case"+":case"/":return" ("+f(e.left,t,r,l,o)+" "+e.operator+" "+f(e.right,t,r,l,o)+") "}throw new Error("Not Supported Operator "+e.operator);case"null":return"null";case"bool":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replace(/'/g,"''")+"'";case"timestamp":case"date":return h(e.value,t);case"number":return e.value.toString();case"current_time":return p("date"===e.mode,t);case"column_ref":return l&&l.toLowerCase()===e.column.toLowerCase()?"("+o+")":e.column;case"function":var S=f(e.args,t,r,l,o);return d(e.name,S,t)}throw new Error("Unsupported sql syntax "+e.type)}function d(e,t,r){switch(e.toLowerCase().trim()){case"abs":if(1!==t.length)throw new Error("Invalid Parameter for call to ABS");return"abs("+t[0]+")";case"ceiling":case"ceil":if(1!==t.length)throw new Error("Invalid Parameter for call to CEILING");switch(r){case i.a.Standardised:case i.a.StandardisedNoInterval:default:return"CEILING("+t[0]+")"}case"floor":if(1!==t.length)throw new Error("Invalid Parameter for call to Floor");return"FLOOR("+t[0]+")";case"log":if(1!==t.length)throw new Error("Invalid Parameter for call to LOG");return"LOG("+t[0]+")";case"log10":if(1!==t.length)throw new Error("Invalid Parameter for call to LOG10");return"LOG10("+t[0]+")";case"power":if(2!==t.length)throw new Error("Invalid Parameter for call to POWER");return"POWER("+t[0]+","+t[1]+")";case"round":if(2===t.length)return"ROUND("+t[0]+","+t[1]+")";if(1===t.length)return"ROUND("+t[0]+")";throw new Error("Invalid Parameter for call to ROUND");case"truncate":if(t.length<1||t.length>2)throw new Error("Invalid Parameter for TRUNCATE function");switch(r){case i.a.SqlServer:return"ROUND("+t[0]+(1===t.length?"0":","+t[1])+",1)";default:return"TRUNCATE("+t[0]+(1===t.length?")":","+t[1]+")")}case"char_length":case"len":if(1!==t.length)throw new Error("Invalid Parameter for CHAR_LENGTH function");switch(r){case i.a.SqlServer:return"LEN("+t[0]+")";case i.a.Oracle:return"LENGTH("+t[0]+")";default:return"CHAR_LENGTH("+t[0]+")"}case"concat":if(t.length<1)throw new Error("Invalid Parameter for CONCAT function");for(var n="CONCAT(",a=0;a<t.length;a++)0!==a&&(n+=","),n+=t[a];return n+=")";case"lower":case"lcase":if(1!==t.length)throw new Error("Invalid Parameter for Lower function");return"LOWER("+t[0]+")";case"upper":case"ucase":if(1!==t.length)throw new Error("Invalid Parameter for Upper function");return"UPPER("+t[0]+")";case"substring":var s="";switch(r){case i.a.Oracle:return s="SUBSTR("+t[0]+","+t[1],3===t.length&&(s+=","+t[2]),s+=")";case i.a.SqlServer:return s=3===t.length?"SUBSTRING("+t[0]+","+t[1]+","+t[2]+")":"SUBSTRING("+t[0]+",  "+t[1]+", LEN("+t[0]+") - "+t[1]+")";default:return s="SUBSTRING("+t[0]+" FROM "+t[1],3===t.length&&(s+=" FOR "+t[2]),s+=")"}case"extract":return"EXTRACT("+t[0].replace(/\'/g,"")+" FROM "+t[1]+")"}throw new Error("Function Not Recognised")}function h(e,t){var r=a.m.Moment(e),n=0===r.minute()&&0===r.hour()&&0===r.second()&&0===r.millisecond();switch(t){case i.a.FILEGDB:case i.a.Standardised:case i.a.StandardisedNoInterval:return n?"date '"+r.format("YYYY-MM-DD")+"'":"date '"+r.format("YYYY-MM-DD HH:mm:ss")+"'";case i.a.Oracle:return n?"TO_DATE('"+r.format("YYYY-MM-DD")+"','YYYY-MM-DD')":"TO_DATE('"+r.format("YYYY-MM-DD HH:mm:ss")+"','YYYY-MM-DD HH24:MI:SS')";case i.a.SqlServer:return"'"+r.format(n?"YYYY-MM-DD":"YYYY-MM-DD HH:mm:ss")+"'";case i.a.PGDB:return"#"+r.format(n?"MM-DD-YYYY":"MM-DD-YYYY HH:mm:ss")+"#";case i.a.Postgres:return"TIMESTAMP '"+r.format(n?"YYYY-MM-DD":"YYYY-MM-DD HH:mm:ss")+"'";default:return"date '"+r.format("YYYY-MM-DD HH:mm:ss")+"'"}}function p(e,t){switch(t){case i.a.FILEGDB:case i.a.Standardised:case i.a.StandardisedNoInterval:case i.a.Oracle:return e?"CURRENT_DATE":"CURRENT_TIMESTAMP";case i.a.SqlServer:return e?"CAST(GETDATE() AS DATE)":"GETDATE()";case i.a.PGDB:case i.a.Postgres:default:return e?"CURRENT_DATE":"CURRENT_TIMESTAMP"}}function y(e,t){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i={},s={},u={esriFieldTypeSmallInteger:"integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"double",esriFieldTypeDouble:"double",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"integer",oid:"integer",long:"integer","small-integer":"integer",integer:"integer",single:"double",double:"double",date:"date",string:"string"},l=Object(n.a)(t);try{for(l.s();!(r=l.n()).done;){var o=r.value,c=u[o.type];i[o.name.toLowerCase()]=void 0===c?"":c}}catch(h){l.e(h)}finally{l.f()}for(var f in a){var d=u[a[f]];s[f.toLowerCase()]=void 0===d?"":d}switch(v(i,e.parseTree,e.parameters,s)){case"double":return"double";case"integer":return"integer";case"double":return"double";case"date":return"date";case"string":return"string"}return""}function v(e,t,r,a){var i;switch(t.type){case"interval":return"integer";case"case_expression":var s=[];if("simple"===t.format){for(var u=0;u<t.clauses.length;u++)s.push(v(e,t.clauses[u].value,r,a));null!==t.else&&s.push(v(e,t.else,r,a))}else{for(var l=0;l<t.clauses.length;l++)s.push(v(e,t.else,r,a));null!==t.else&&s.push(v(e,t.else,r,a))}return g(s);case"param":var o=a[t.value.toLowerCase()];if(void 0===o&&r){var c=r[t.value.toLowerCase()];if(void 0===c)return"";if(null===c)return"";if("string"==typeof c||c instanceof String)return"string";if("boolean"==typeof c)return"boolean";if(c instanceof Date)return"date";if("number"==typeof c)return c%1==0?"integer":"double"}return void 0===o?"":o;case"expr_list":var f,d=[],h=Object(n.a)(t.value);try{for(h.s();!(f=h.n()).done;){var p=f.value;d.push(v(e,p,r,a))}}catch(b){h.e(b)}finally{h.f()}return d;case"unary_expr":return"boolean";case"binary_expr":switch(t.operator){case"AND":case"OR":return"boolean";case"IS":case"ISNOT":if("null"!==t.right.type)throw new Error("Unsupported RHS for IS");return"boolean";case"IN":case"NOT IN":case"BETWEEN":case"NOTBETWEEN":case"LIKE":case"NOT LIKE":return"boolean";case"<>":case"<":case">":case">=":case"<=":case"=":return"boolean";case"*":case"-":case"+":case"/":return g([v(e,t.left,r,a),v(e,t.right,r,a)]);default:throw new Error("Not Supported Operator "+t.operator)}case"null":return"";case"bool":return"boolean";case"string":return"string";case"number":return null===t.value?"":t.value%1==0?"integer":"double";case"date":case"timestamp":case"current_time":return"date";case"column_ref":var y=e[t.column.toLowerCase()];return void 0===y?"":y;case"function":switch(t.name.toLowerCase()){case"position":case"extract":case"char_length":return"integer";case"round":return(i=v(e,t.args,r,a))instanceof Array?i.length>0?i[0]:"":i;case"sign":return(i=v(e,t.args,r,a))instanceof Array&&(i=g(i)),"integer"===i||"double"===i?i:"double";case"ceiling":case"floor":case"abs":var _=v(e,t.args,r,a);return _ instanceof Array?g(_):_;case"area":case"length":case"log":case"log10":case"sin":case"cos":case"tan":case"asin":case"acos":case"atan":case"power":return"double";case"substring":case"trim":case"concat":case"lower":case"upper":return"string";case"truncate":return"double";case"round":return(i=v(e,t.args,r,a))instanceof Array?i.length>0?i[0]:"":i}return""}throw new Error("Unsupported sql syntax "+t.type)}var _={boolean:1,string:2,integer:3,double:4,date:5};function g(e){if(e){var t,r="",a=Object(n.a)(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;""!==i&&(r=""===r||_[r]<_[i]?i:r)}}catch(s){a.e(s)}finally{a.f()}return r}return""}function b(e,t){return function e(t,r){if(null==t)return!1;switch(t.type){case"when_clause":return e(t.operand,r)||e(t.value,r);case"case_expression":var a,i=Object(n.a)(t.clauses);try{for(i.s();!(a=i.n()).done;){var s=a.value;if(e(s,r))return!0}}catch(c){i.e(c)}finally{i.f()}return!("simple"!==t.format||!e(t.operand,r))||!(null===t.else||!e(t.else,r));case"param":return!1;case"expr_list":var u,l=Object(n.a)(t.value);try{for(l.s();!(u=l.n()).done;){var o=u.value;if(e(o,r))return!0}}catch(c){l.e(c)}finally{l.f()}return!1;case"unary_expr":return e(t.expr,r);case"binary_expr":return e(t.left,r)||e(t.right,r);case"null":case"bool":case"date":case"timestamp":case"string":case"number":return!1;case"column_ref":return r.toLowerCase()===t.column.toLowerCase();case"function":return e(t.args,r)}return!1}(e.parseTree,t)}function m(e){return"column_ref"===e.parseTree.type}function O(e){var t="";return t+=e.period.toUpperCase()}function j(e,t,r){return"INTERVAL "+r+" "+e+" "+("interval-period"===t.type?O(t):O(t.start)+" TO "+O(t.end))}},773:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(16),a=r(759);function i(e,t,r){if(r&&r.features&&r.hasZ){var i=Object(a.a)(r.geometryType,t,e.outSpatialReference);if(i){var s,u=Object(n.a)(r.features);try{for(u.s();!(s=u.n()).done;){i(s.value.geometry)}}catch(l){u.e(l)}finally{u.f()}}}}},776:function(e,t,r){"use strict";r.d(t,"a",(function(){return U})),r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return g})),r.d(t,"d",(function(){return b})),r.d(t,"e",(function(){return v})),r.d(t,"f",(function(){return H})),r.d(t,"g",(function(){return R})),r.d(t,"h",(function(){return k})),r.d(t,"i",(function(){return m})),r.d(t,"j",(function(){return O})),r.d(t,"k",(function(){return z})),r.d(t,"l",(function(){return re})),r.d(t,"m",(function(){return W})),r.d(t,"n",(function(){return X})),r.d(t,"o",(function(){return ne})),r.d(t,"p",(function(){return P})),r.d(t,"q",(function(){return j})),r.d(t,"r",(function(){return x})),r.d(t,"s",(function(){return q})),r.d(t,"t",(function(){return F})),r.d(t,"u",(function(){return ee})),r.d(t,"v",(function(){return te})),r.d(t,"w",(function(){return I})),r.d(t,"x",(function(){return J})),r.d(t,"y",(function(){return C})),r.d(t,"z",(function(){return E})),r.d(t,"A",(function(){return S})),r.d(t,"B",(function(){return L})),r.d(t,"C",(function(){return w}));r(11);var n,a=r(8),i=r.n(a),s=r(22),u=(r(48),r(182)),l=(r(86),r(395));function o(e){var t;return Array.isArray(e)?null==(t=e[0])?void 0:t.spatialReference:null==e?void 0:e.spatialReference}function c(e){return e?Array.isArray(e)?e.map(c):e.toJSON?e.toJSON():e:e}function f(e){return Array.isArray(e)?e.map((function(e){return Object(u.a)(e)})):Object(u.a)(e)}function d(e,t){return h.apply(this,arguments)}function h(){return(h=Object(s.a)(i.a.mark((function e(t,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(s.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(n||(n=Object(l.a)("geometryEngineWorker",{strategy:"distributed"})),n));case 1:case"end":return e.stop()}}),e)})))();case 2:return e.abrupt("return",e.sent.invoke("executeGEOperation",{operation:t,parameters:c(r)}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e,t){return y.apply(this,arguments)}function y(){return(y=Object(s.a)(i.a.mark((function e(t,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=f,e.next=3,d("clip",[o(t),t,r]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e,t){return _.apply(this,arguments)}function _(){return(_=Object(s.a)(i.a.mark((function e(t,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=f,e.next=3,d("cut",[o(t),t,r]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e,t){return d("contains",[o(e),e,t])}function b(e,t){return d("crosses",[o(e),e,t])}function m(e,t,r){return d("distance",[o(e),e,t,r])}function O(e,t){return d("equals",[o(e),e,t])}function j(e,t){return d("intersects",[o(e),e,t])}function S(e,t){return d("touches",[o(e),e,t])}function w(e,t){return d("within",[o(e),e,t])}function k(e,t){return d("disjoint",[o(e),e,t])}function F(e,t){return d("overlaps",[o(e),e,t])}function I(e,t,r){return d("relate",[o(e),e,t,r])}function x(e){return d("isSimple",[o(e),e])}function C(e){return T.apply(this,arguments)}function T(){return(T=Object(s.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=f,e.next=3,d("simplify",[o(t),t]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e,t){return D.apply(this,arguments)}function D(){return(D=Object(s.a)(i.a.mark((function e(t,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=f,e.next=3,d("difference",[o(t),t,r]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e,t){return N.apply(this,arguments)}function N(){return(N=Object(s.a)(i.a.mark((function e(t,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=f,e.next=3,d("symmetricDifference",[o(t),t,r]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e,t){return A.apply(this,arguments)}function A(){return(A=Object(s.a)(i.a.mark((function e(t,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=f,e.next=3,d("intersect",[o(t),t,r]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e){return G.apply(this,arguments)}function G(){return(G=Object(s.a)(i.a.mark((function e(t){var r,n,a=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:null,n=function(e,t){var r;return Array.isArray(e)?r=e:((r=[]).push(e),null!=t&&r.push(t)),r}(t,r),e.t0=f,e.next=5,d("union",[o(n),n]);case 5:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e,t,r,n,a,i){return B.apply(this,arguments)}function B(){return(B=Object(s.a)(i.a.mark((function e(t,r,n,a,s,u){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=f,e.next=3,d("offset",[o(t),t,r,n,a,s,u]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e,t,r){return M.apply(this,arguments)}function M(){return(M=Object(s.a)(i.a.mark((function e(t,r,n){var a,s,u=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=u.length>3&&void 0!==u[3]&&u[3],s=[o(t),t,r,n,a],e.t0=f,e.next=5,d("buffer",s);case 5:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e,t,r,n,a,i){return V.apply(this,arguments)}function V(){return(V=Object(s.a)(i.a.mark((function e(t,r,n,a,s,u){var l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=[o(t),t,r,n,a,s,u],e.t0=f,e.next=4,d("geodesicBuffer",l);case 4:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(e){return"xmin"in e?e.center:"x"in e?e:e.extent.center}function J(e,t,r){return Y.apply(this,arguments)}function Y(){return(Y=Object(s.a)(i.a.mark((function e(t,r,n){var a,s,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}throw new Error("Illegal Argument Exception");case 2:return s=t.spatialReference,n=null!=(a=n)?a:Q(t),e.t0=t.constructor,e.next=7,d("rotate",[s,t,r,n]);case 7:return e.t1=e.sent,u=e.t0.fromJSON.call(e.t0,e.t1),e.abrupt("return",(u.spatialReference=s,u));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e,t,r,n){return K.apply(this,arguments)}function K(){return(K=Object(s.a)(i.a.mark((function e(t,r,n,a){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=f,e.next=3,d("generalize",[o(t),t,r,n,a]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e,t,r){return Z.apply(this,arguments)}function Z(){return(Z=Object(s.a)(i.a.mark((function e(t,r,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=f,e.next=3,d("densify",[o(t),t,r,n]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e,t,r){return $.apply(this,arguments)}function $(){return($=Object(s.a)(i.a.mark((function e(t,r,n){var a,s=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>3&&void 0!==s[3]?s[3]:0,e.t0=f,e.next=4,d("geodesicDensify",[o(t),t,r,n,a]);case 4:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(e,t){return d("planarArea",[o(e),e,t])}function te(e,t){return d("planarLength",[o(e),e,t])}function re(e,t,r){return d("geodesicArea",[o(e),e,t,r])}function ne(e,t,r){return d("geodesicLength",[o(e),e,t,r])}},782:function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return b})),r.d(t,"c",(function(){return f})),r.d(t,"d",(function(){return j})),r.d(t,"e",(function(){return p})),r.d(t,"f",(function(){return y})),r.d(t,"g",(function(){return h})),r.d(t,"h",(function(){return _})),r.d(t,"i",(function(){return g})),r.d(t,"j",(function(){return v}));var n=r(15),a=r(758),i=r(757),s=r(767);function u(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t/e.length}function l(e){for(var t=u(e),r=0,n=0;n<e.length;n++)r+=Math.pow(t-e[n],2);return r/e.length}function o(e){for(var t=u(e),r=0,n=0;n<e.length;n++)r+=Math.pow(t-e[n],2);return r/(e.length-1)}function c(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t}function f(e){switch(e.toLowerCase()){case"distinct":return"distinct";case"avg":case"mean":return"avg";case"min":return"min";case"sum":return"sum";case"max":return"max";case"stdev":case"stddev":return"stddev";case"var":case"variance":return"var";case"count":return"count"}return""}function d(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;switch(e.toLowerCase()){case"distinct":return function(e,t){for(var r=[],n={},a=[],s=0;s<e.length;s++){if(void 0!==e[s]&&null!==e[s]){var u=e[s];if(Object(i.j)(u)||Object(i.k)(u))void 0===n[u]&&(r.push(u),n[u]=1);else{for(var l=!1,o=0;o<a.length;o++)!0===Object(i.g)(a[o],u)&&(l=!0);!1===l&&(a.push(u),r.push(u))}}if(r.length>=t&&-1!==t)return r}return r}(t,r);case"avg":case"mean":return u(t);case"min":return Math.min.apply(Math,t);case"sum":return c(t);case"max":return Math.max.apply(Math,t);case"stdev":case"stddev":return Math.sqrt(l(t));case"var":case"variance":return l(t);case"count":return t.length}return 0}function h(e,t,r){return m(e,t,r,!0).then((function(e){return 0===e.length?null:Math.min.apply(Math,e)}))}function p(e,t,r){return m(e,t,r,!0).then((function(e){return 0===e.length?null:Math.max.apply(Math,e)}))}function y(e,t,r){var n="";return!1===Object(s.c)(t)&&(n=Object(s.f)(t,e.fields,null)),m(e,t,r,!0).then((function(e){if(0===e.length)return null;var t,r=u(e);return null===r?r:"integer"===n?(t=+(t=r),isFinite(t)?t-t%1||(t<0?-0:0===t?t:0):t):r}))}function v(e,t,r){return m(e,t,r,!0).then((function(e){return 0===e.length?null:o(e)}))}function _(e,t,r){return m(e,t,r,!0).then((function(e){return 0===e.length?null:Math.sqrt(o(e))}))}function g(e,t,r){return m(e,t,r,!0).then((function(e){return 0===e.length?null:c(e)}))}function b(e,t){try{return e.iterator(t).count()}catch(e){return Object(n.r)(e)}}function m(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];try{var i=e.iterator(r);return Object(n.c)((function(e,r){O(i,[],t,a,e,r)}))}catch(s){return Object(n.r)(s)}}function O(e,t,r,n,i,s){Object(a.q)(e.next().then((function(a){try{if(null!==a){var u=r.calculateValue(a);return null===u?!1===n&&(t[t.length]=u):t[t.length]=u,O(e,t,r,n,i,s)}i(t)}catch(e){s(e)}}),s))}function j(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return function(e,t,r,a){try{return S(e.iterator(a),{},[],t,r)}catch(e){return Object(n.r)(e)}}(e,t,r,a)}function S(e,t,r,n,a){return e.next().then((function(i){if(null!==i){var s=n.calculateValue(i);return null!=s&&void 0===t[s]&&(r.push(s),t[s]=1),r.length>=a&&-1!==a?r:S(e,t,r,n,a)}return r}))}},800:function(e,t,r){"use strict";var n=r(2),a=r(3),i=function(){function e(){Object(n.a)(this,e),this._databaseTypeMetaData={},this._layerInfo={}}return Object(a.a)(e,[{key:"clearDatabaseType",value:function(e){void 0===this._databaseTypeMetaData[e]&&delete this._databaseTypeMetaData[e]}},{key:"getDatabaseType",value:function(e){return"MUSTBESET"===e||void 0===this._databaseTypeMetaData[e]?null:this._databaseTypeMetaData[e]}},{key:"setDatabaseType",value:function(e,t){this._databaseTypeMetaData[e]=t}},{key:"getLayerInfo",value:function(e){return void 0===this._layerInfo[e]?null:this._layerInfo[e]}},{key:"setLayerInfo",value:function(e,t){this._layerInfo[e]=t}},{key:"clearLayerInfo",value:function(e){void 0!==this._layerInfo[e]&&delete this._layerInfo[e]}}]),e}();i.applicationCache=null,t.a=i},801:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return n}));var n={Base64:0,Hex:1,String:2,Raw:3};function a(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function i(e,t,r,n,i,s){return a((u=a(a(t,e),a(n,s)))<<(l=i)|u>>>32-l,r);var u,l}function s(e,t,r,n,a,s,u){return i(t&r|~t&n,e,t,a,s,u)}function u(e,t,r,n,a,s,u){return i(t&n|r&~n,e,t,a,s,u)}function l(e,t,r,n,a,s,u){return i(t^r^n,e,t,a,s,u)}function o(e,t,r,n,a,s,u){return i(r^(t|~n),e,t,a,s,u)}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.Hex,r=t||n.Base64,i=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var r=1732584193,n=-271733879,i=-1732584194,c=271733878,f=0;f<e.length;f+=16){var d=r,h=n,p=i,y=c;r=s(r,n,i,c,e[f+0],7,-680876936),c=s(c,r,n,i,e[f+1],12,-389564586),i=s(i,c,r,n,e[f+2],17,606105819),n=s(n,i,c,r,e[f+3],22,-1044525330),r=s(r,n,i,c,e[f+4],7,-176418897),c=s(c,r,n,i,e[f+5],12,1200080426),i=s(i,c,r,n,e[f+6],17,-1473231341),n=s(n,i,c,r,e[f+7],22,-45705983),r=s(r,n,i,c,e[f+8],7,1770035416),c=s(c,r,n,i,e[f+9],12,-1958414417),i=s(i,c,r,n,e[f+10],17,-42063),n=s(n,i,c,r,e[f+11],22,-1990404162),r=s(r,n,i,c,e[f+12],7,1804603682),c=s(c,r,n,i,e[f+13],12,-40341101),i=s(i,c,r,n,e[f+14],17,-1502002290),r=u(r,n=s(n,i,c,r,e[f+15],22,1236535329),i,c,e[f+1],5,-165796510),c=u(c,r,n,i,e[f+6],9,-1069501632),i=u(i,c,r,n,e[f+11],14,643717713),n=u(n,i,c,r,e[f+0],20,-373897302),r=u(r,n,i,c,e[f+5],5,-701558691),c=u(c,r,n,i,e[f+10],9,38016083),i=u(i,c,r,n,e[f+15],14,-660478335),n=u(n,i,c,r,e[f+4],20,-405537848),r=u(r,n,i,c,e[f+9],5,568446438),c=u(c,r,n,i,e[f+14],9,-1019803690),i=u(i,c,r,n,e[f+3],14,-187363961),n=u(n,i,c,r,e[f+8],20,1163531501),r=u(r,n,i,c,e[f+13],5,-1444681467),c=u(c,r,n,i,e[f+2],9,-51403784),i=u(i,c,r,n,e[f+7],14,1735328473),r=l(r,n=u(n,i,c,r,e[f+12],20,-1926607734),i,c,e[f+5],4,-378558),c=l(c,r,n,i,e[f+8],11,-2022574463),i=l(i,c,r,n,e[f+11],16,1839030562),n=l(n,i,c,r,e[f+14],23,-35309556),r=l(r,n,i,c,e[f+1],4,-1530992060),c=l(c,r,n,i,e[f+4],11,1272893353),i=l(i,c,r,n,e[f+7],16,-155497632),n=l(n,i,c,r,e[f+10],23,-1094730640),r=l(r,n,i,c,e[f+13],4,681279174),c=l(c,r,n,i,e[f+0],11,-358537222),i=l(i,c,r,n,e[f+3],16,-722521979),n=l(n,i,c,r,e[f+6],23,76029189),r=l(r,n,i,c,e[f+9],4,-640364487),c=l(c,r,n,i,e[f+12],11,-421815835),i=l(i,c,r,n,e[f+15],16,530742520),r=o(r,n=l(n,i,c,r,e[f+2],23,-995338651),i,c,e[f+0],6,-198630844),c=o(c,r,n,i,e[f+7],10,1126891415),i=o(i,c,r,n,e[f+14],15,-1416354905),n=o(n,i,c,r,e[f+5],21,-57434055),r=o(r,n,i,c,e[f+12],6,1700485571),c=o(c,r,n,i,e[f+3],10,-1894986606),i=o(i,c,r,n,e[f+10],15,-1051523),n=o(n,i,c,r,e[f+1],21,-2054922799),r=o(r,n,i,c,e[f+8],6,1873313359),c=o(c,r,n,i,e[f+15],10,-30611744),i=o(i,c,r,n,e[f+6],15,-1560198380),n=o(n,i,c,r,e[f+13],21,1309151649),r=o(r,n,i,c,e[f+4],6,-145523070),c=o(c,r,n,i,e[f+11],10,-1120210379),i=o(i,c,r,n,e[f+2],15,718787259),n=o(n,i,c,r,e[f+9],21,-343485551),r=a(r,d),n=a(n,h),i=a(i,p),c=a(c,y)}return[r,n,i,c]}(function(e){for(var t=[],r=0,n=8*e.length;r<n;r+=8)t[r>>5]|=(255&e.charCodeAt(r/8))<<r%32;return t}(e),8*e.length);switch(r){case n.Raw:return i;case n.Hex:return function(e){for(var t="0123456789abcdef",r=[],n=0,a=4*e.length;n<a;n++)r.push(t.charAt(e[n>>2]>>n%4*8+4&15)+t.charAt(e[n>>2]>>n%4*8&15));return r.join("")}(i);case n.String:return function(e){for(var t=[],r=0,n=32*e.length;r<n;r+=8)t.push(String.fromCharCode(e[r>>5]>>>r%32&255));return t.join("")}(i);case n.Base64:return function(e){for(var t=[],r=0,n=4*e.length;r<n;r+=3)for(var a=(e[r>>2]>>r%4*8&255)<<16|(e[r+1>>2]>>(r+1)%4*8&255)<<8|e[r+2>>2]>>(r+2)%4*8&255,i=0;i<4;i++)8*r+6*i>32*e.length?t.push("="):t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>6*(3-i)&63));return t.join("")}(i)}}},802:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(2),a=r(3),i=r(4),s=r(5),u=r(15),l=r(757),o=r(760),c=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e)).declaredClass="esri.layers.featureset.sources.Empty",a._maxProcessing=1e3,a._wset=new o.a([],[],!1,null),a._parent=e.parentfeatureset,a._databaseType=l.a.Standardised,a}return Object(a.a)(r,[{key:"_getSet",value:function(){return Object(u.s)(this._wset)}},{key:"optimisePagingFeatureQueries",value:function(){}},{key:"_isInFeatureSet",value:function(){return l.b.NotInFeatureSet}},{key:"_getFeature",value:function(){return Object(u.r)(new Error("No Feature Found in EmptySet"))}},{key:"queryAttachments",value:function(){return Object(u.s)([])}},{key:"_getFeatures",value:function(){return Object(u.s)("success")}},{key:"_featureFromCache",value:function(){return null}},{key:"_fetchAndRefineFeatures",value:function(){return Object(u.r)(new Error("Fetch and Refine should not be called in this featureset"))}},{key:"_getFilteredSet",value:function(){return Object(u.s)(new o.a([],[],!1,null))}},{key:"_stat",value:function(e,t,r,n,a,i,s){return this._manualStat(e,t,i,s)}},{key:"_canDoAggregates",value:function(){return Object(u.s)(!1)}}]),r}(r(762).a)},803:function(e,t,r){"use strict";var n=r(16),a=r(8),i=r.n(a),s=r(11),u=r(22),l=r(2),o=r(3),c=r(4),f=r(5),d=r(0),h=r(13),p=r(10),y=(r(12),r(14),r(1)),v=r(6),_=(r(9),r(19),r(20),r(57)),g=(r(86),r(677)),b=r(267),m=r(799),O=r(349),j=r(792),S=r(766),w=r(299),k=r(761),F=r(759);function I(e,t){return t}function x(e,t,r,n){switch(r){case 0:return D(e,t+n,0);case 1:return"lowerLeft"===e.originPosition?D(e,t+n,1):function(e,t,r){var n=e.translate,a=e.scale;return n[1]-t*a[1]}(e,t+n)}}function C(e,t,r,n){switch(r){case 2:return D(e,t,2);default:return x(e,t,r,n)}}function T(e,t,r,n){switch(r){case 2:return D(e,t,3);default:return x(e,t,r,n)}}function R(e,t,r,n){switch(r){case 3:return D(e,t,3);default:return C(e,t,r,n)}}function D(e,t,r){var n=e.translate,a=e.scale;return n[r]+t*a[r]}var E=function(){function e(t){Object(l.a)(this,e),this.options=t,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=I,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,this.AttributesConstructor=function(){}}return Object(o.a)(e,[{key:"createFeatureResult",value:function(){return{fields:[],features:[]}}},{key:"finishFeatureResult",value:function(e){if(this.options.applyTransform&&(e.transform=null),this.AttributesConstructor=function(){},this.coordinateBuffer=null,this.lengths.length=0,e.hasZ){var t=Object(F.a)(e.geometryType,this.options.sourceSpatialReference,e.spatialReference);if(t){var r,a=Object(n.a)(e.features);try{for(a.s();!(r=a.n()).done;){t(r.value.geometry)}}catch(i){a.e(i)}finally{a.f()}}}}},{key:"createSpatialReference",value:function(){return{}}},{key:"addField",value:function(e,t){e.fields.push(t);var r=e.fields.map((function(e){return e.name}));this.AttributesConstructor=function(){var e,t=Object(n.a)(r);try{for(t.s();!(e=t.n()).done;){this[e.value]=null}}catch(a){t.e(a)}finally{t.f()}}}},{key:"addFeature",value:function(e,t){e.features.push(t)}},{key:"prepareFeatures",value:function(e){var t=this;switch(this.transform=e.transform,this.options.applyTransform&&e.transform&&(this.applyTransform=this.deriveApplyTransform(e)),this.vertexDimension=2,e.hasZ&&this.vertexDimension++,e.hasM&&this.vertexDimension++,e.geometryType){case"esriGeometryPoint":this.addCoordinate=function(e,r,n){return t.addCoordinatePoint(e,r,n)},this.createGeometry=function(e){return t.createPointGeometry(e)};break;case"esriGeometryPolygon":this.addCoordinate=function(e,r,n){return t.addCoordinatePolygon(e,r,n)},this.createGeometry=function(e){return t.createPolygonGeometry(e)};break;case"esriGeometryPolyline":this.addCoordinate=function(e,r,n){return t.addCoordinatePolyline(e,r,n)},this.createGeometry=function(e){return t.createPolylineGeometry(e)};break;case"esriGeometryMultipoint":this.addCoordinate=function(e,r,n){return t.addCoordinateMultipoint(e,r,n)},this.createGeometry=function(e){return t.createMultipointGeometry(e)};break;default:Object(w.a)(e.geometryType)}}},{key:"createFeature",value:function(){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,{attributes:new this.AttributesConstructor}}},{key:"addLength",value:function(e,t,r){0===this.lengths.length&&(this.toAddInCurrentPath=t),this.lengths.push(t)}},{key:"addQueryGeometry",value:function(e,t){var r=t.queryGeometry,n=t.queryGeometryType,a=Object(k.v)(r.clone(),r,!1,!1,this.transform),i=Object(k.h)(a,n,!1,!1);e.queryGeometryType=n,e.queryGeometry=Object(s.a)({},i)}},{key:"createPointGeometry",value:function(e){var t={x:0,y:0,spatialReference:e.spatialReference};return e.hasZ&&(t.z=0),e.hasM&&(t.m=0),t}},{key:"addCoordinatePoint",value:function(e,t,r){switch(t=this.applyTransform(this.transform,t,r,0),r){case 0:e.x=t;break;case 1:e.y=t;break;case 2:"z"in e?e.z=t:e.m=t;break;case 3:e.m=t}}},{key:"transformPathLikeValue",value:function(e,t){var r=0;return t<=1&&(r=this.previousCoordinate[t],this.previousCoordinate[t]+=e),this.applyTransform(this.transform,e,t,r)}},{key:"addCoordinatePolyline",value:function(e,t,r){this.dehydratedAddPointsCoordinate(e.paths,t,r)}},{key:"addCoordinatePolygon",value:function(e,t,r){this.dehydratedAddPointsCoordinate(e.rings,t,r)}},{key:"addCoordinateMultipoint",value:function(e,t,r){0===r&&e.points.push([]);var n=this.transformPathLikeValue(t,r);e.points[e.points.length-1].push(n)}},{key:"createPolygonGeometry",value:function(e){return{rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}},{key:"createPolylineGeometry",value:function(e){return{paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}},{key:"createMultipointGeometry",value:function(e){return{points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}},{key:"dehydratedAddPointsCoordinate",value:function(e,t,r){0===r&&0==this.toAddInCurrentPath--&&(e.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);var n=this.transformPathLikeValue(t,r),a=e[e.length-1];0===r&&(this.coordinateBufferPtr=0,this.coordinateBuffer=new Array(this.vertexDimension),a.push(this.coordinateBuffer)),this.coordinateBuffer[this.coordinateBufferPtr++]=n}},{key:"deriveApplyTransform",value:function(e){var t=e.hasZ,r=e.hasM;return t&&r?R:t?C:r?T:x}}]),e}(),N=r(680),P=r(818),A=r(58),L=r(798);function G(e,t){var r=e.toJSON();return r.objectIds&&(r.objectIds=r.objectIds.join(",")),r.orderByFields&&(r.orderByFields=r.orderByFields.join(",")),!r.outFields||null!=t&&t.returnCountOnly?delete r.outFields:-1!==r.outFields.indexOf("*")?r.outFields="*":r.outFields=r.outFields.join(","),r.outSpatialReference&&(r.outSR=r.outSR.wkid||JSON.stringify(r.outSR.toJSON()),delete r.outSpatialReference),r.dynamicDataSource&&(r.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r}function q(){return(q=Object(u.a)(i.a.mark((function e(t,r,a){var u,l,o,c,f,d,h,p,y,v;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U(t,r,a);case 2:u=e.sent,l=u.data,o=l.geometryType,c=l.spatialReference,f={},d=Object(n.a)(l.relatedRecordGroups);try{for(d.s();!(h=d.n()).done;)if(p=h.value,y={fields:void 0,objectIdFieldName:void 0,geometryType:o,spatialReference:c,hasZ:!!l.hasZ,hasM:!!l.hasM,features:p.relatedRecords},null!=p.objectId)f[p.objectId]=y;else for(v in p)p.hasOwnProperty(v)&&"relatedRecords"!==v&&(f[p[v]]=y)}catch(i){d.e(i)}finally{d.f()}return e.abrupt("return",Object(s.a)(Object(s.a)({},u),{},{data:f}));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(){return(B=Object(u.a)(i.a.mark((function e(t,r,a){var u,l,o,c,f,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U(t,r,a,{returnCountOnly:!0});case 2:u=e.sent,l=u.data,o={},c=Object(n.a)(l.relatedRecordGroups);try{for(c.s();!(f=c.n()).done;)null!=(d=f.value).objectId&&(o[d.objectId]=d.count)}catch(i){c.e(i)}finally{c.f()}return e.abrupt("return",Object(s.a)(Object(s.a)({},u),{},{data:o}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e,t){return M.apply(this,arguments)}function M(){return(M=Object(u.a)(i.a.mark((function e(t,r){var n,a,u,l=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.length>2&&void 0!==l[2]?l[2]:{},a=l.length>3?l[3]:void 0,u=Object(L.a)(Object(s.a)(Object(s.a)(Object(s.a)({},t.query),{},{f:"json"},a),G(r,a))),e.abrupt("return",Object(A.default)(t.path+"/queryRelatedRecords",Object(s.a)(Object(s.a)({},n),{},{query:Object(s.a)(Object(s.a)({},n.query),u)})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var W=function(e){Object(c.a)(r,e);var t=Object(f.a)(r);function r(e){var n;return Object(l.a)(this,r),(n=t.call(this,e)).dynamicDataSource=null,n.format="json",n.gdbVersion=null,n.sourceSpatialReference=null,n}return Object(o.a)(r,[{key:"execute",value:function(e,t){return this.executeJSON(e,t).then((function(e){return g.default.fromJSON(e)}))}},{key:"executeJSON",value:function(){var e=Object(u.a)(i.a.mark((function e(t,r){var n,a,u,l,o,c,f,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=Object(s.a)(Object(s.a)({},this.requestOptions),r),u=this._normalizeQuery(t),l=null!=(null==(n=t.outStatistics)?void 0:n[0]),o=Object(h.a)("featurelayer-pbf-statistics"),c=!l||o,"pbf"!==this.format||!c){e.next=14;break}return d=!u.quantizationParameters,e.prev=3,e.next=6,Object(N.executeQueryPBF)(this.parsedUrl,u,new E({sourceSpatialReference:this.sourceSpatialReference,applyTransform:d}),a);case 6:f=e.sent.data,e.next=14;break;case 9:if(e.prev=9,e.t0=e.catch(3),"query:parsing-pbf"===e.t0.name){e.next=13;break}throw e.t0;case 13:this.format="json";case 14:if("json"!==this.format&&c){e.next=18;break}return e.next=17,Object(N.executeQuery)(this.parsedUrl,u,this.sourceSpatialReference,a);case 17:f=e.sent.data;case 18:return e.abrupt("return",(this._normalizeFields(f.fields),f));case 19:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeForCount",value:function(e,t){return Object(N.executeQueryForCount)(this.parsedUrl,this._normalizeQuery(e),Object(s.a)(Object(s.a)({},this.requestOptions),t)).then((function(e){return e.data.count}))}},{key:"executeForExtent",value:function(e,t){return Object(N.executeQueryForExtent)(this.parsedUrl,this._normalizeQuery(e),Object(s.a)(Object(s.a)({},this.requestOptions),t)).then((function(e){return{count:e.data.count,extent:_.a.fromJSON(e.data.extent)}}))}},{key:"executeForIds",value:function(e,t){return Object(N.executeQueryForIds)(this.parsedUrl,this._normalizeQuery(e),Object(s.a)(Object(s.a)({},this.requestOptions),t)).then((function(e){return e.data.objectIds}))}},{key:"executeRelationshipQuery",value:function(e,t){return e=j.a.from(e),(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),function(e,t,r){return q.apply(this,arguments)}(this.parsedUrl,e,Object(s.a)(Object(s.a)({},this.requestOptions),t)).then((function(e){var t=e.data,r={};return Object.keys(t).forEach((function(e){return r[e]=g.default.fromJSON(t[e])})),r}))}},{key:"executeRelationshipQueryForCount",value:function(e,t){return e=j.a.from(e),(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),function(e,t,r){return B.apply(this,arguments)}(this.parsedUrl,e,Object(s.a)(Object(s.a)({},this.requestOptions),t)).then((function(e){return e.data}))}},{key:"executeAttachmentQuery",value:function(e,t){var r=this;return Object(P.a)(this.parsedUrl,m.a.from(e),Object(s.a)(Object(s.a)({},this.requestOptions),t)).then((function(e){return Object(P.b)(e.data.attachmentGroups,r.parsedUrl.path)}))}},{key:"_normalizeQuery",value:function(e){var t=O.a.from(e);if(!this.gdbVersion&&!this.dynamicDataSource)return t;var r=t===e?t.clone():t;return r.gdbVersion=e.gdbVersion||this.gdbVersion,r.dynamicDataSource=e.dynamicDataSource?b.a.from(e.dynamicDataSource):this.dynamicDataSource,r}},{key:"_normalizeFields",value:function(e){if(Object(p.g)(this.fieldsIndex)&&Object(p.g)(e)){var t,r=Object(n.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value,i=this.fieldsIndex.get(a.name);i&&Object.assign(a,i.toJSON())}}catch(s){r.e(s)}finally{r.f()}}}}]),r}(S.a);Object(d.a)([Object(y.b)({type:b.a})],W.prototype,"dynamicDataSource",void 0),Object(d.a)([Object(y.b)()],W.prototype,"fieldsIndex",void 0),Object(d.a)([Object(y.b)()],W.prototype,"format",void 0),Object(d.a)([Object(y.b)()],W.prototype,"gdbVersion",void 0),Object(d.a)([Object(y.b)()],W.prototype,"sourceSpatialReference",void 0);var V=W=Object(d.a)([Object(v.a)("esri.tasks.QueryTask")],W);t.a=V},818:function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return f}));var n=r(11),a=r(16),i=r(9),s=r(88),u=r(58),l=r(798),o=r(828);function c(e){var t=e.toJSON();return t.attachmentTypes&&(t.attachmentTypes=t.attachmentTypes.join(",")),t.keywords&&(t.keywords=t.keywords.join(",")),t.globalIds&&(t.globalIds=t.globalIds.join(",")),t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.size&&(t.size=t.size.join(",")),t}function f(e,t){var r,n={},u=Object(a.a)(e);try{for(u.s();!(r=u.n()).done;){var l,c=r.value,f=c.parentObjectId,d=c.parentGlobalId,h=c.attachmentInfos,p=Object(a.a)(h);try{for(p.s();!(l=p.n()).done;){var y=l.value,v=y.id,_=Object(i.b)(Object(s.a)("".concat(t,"/").concat(f,"/attachments/").concat(v))),g=o.a.fromJSON(y);g.set({url:_,parentObjectId:f,parentGlobalId:d}),n[f]?n[f].push(g):n[f]=[g]}}catch(b){p.e(b)}finally{p.f()}}}catch(b){u.e(b)}finally{u.f()}return n}function d(e,t,r){var a={query:Object(l.a)(Object(n.a)(Object(n.a)({},e.query),{},{f:"json"},c(t)))};return r&&(a=Object(n.a)(Object(n.a)(Object(n.a)({},r),a),{},{query:Object(n.a)(Object(n.a)({},r.query),a.query)})),Object(u.default)(e.path+"/queryAttachments",a)}},820:function(e,t,r){"use strict";var n=r(2),a=r(3),i=r(4),s=r(5),u=r(15),l=r(36),o=r(757),c=r(760),f=r(678),d=r(767),h=r(762),p=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e)).declaredClass="esri.arcade.featureset.actions.AttributeFilter",a._maxProcessing=1e3,a._parent=e.parentfeatureset,e.whereclause instanceof f.WhereClause?(a._whereclause=e.whereclause,a._whereClauseFunction=null):(a._whereClauseFunction=e.whereclause,a._whereclause=null),a}return Object(a.a)(r,[{key:"_initialiseFeatureSet",value:function(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new l.a({wkid:4326}),this.geometryType=o.m.point)}},{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._parent._getFilteredSet("",null,t._whereclause,null,e)})).then((function(r){return t._checkCancelled(e),null!==t._whereClauseFunction?t._wset=new c.a(r._candidates.slice(0).concat(r._known.slice(0)),[],r._ordered,t._clonePageDefinition(r.pagesDefinition)):t._wset=new c.a(r._candidates.slice(0),r._known.slice(0),r._ordered,t._clonePageDefinition(r.pagesDefinition)),t._wset})):Object(u.s)(this._wset)}},{key:"_isInFeatureSet",value:function(e){var t=this._parent._isInFeatureSet(e);return t===o.b.NotInFeatureSet?t:void 0===(t=this._idstates[e])?o.b.Unknown:t}},{key:"_getFeature",value:function(e,t,r){return this._parent._getFeature(e,t,r)}},{key:"_getFeatures",value:function(e,t,r,n){return this._parent._getFeatures(e,t,r,n)}},{key:"_featureFromCache",value:function(e){return this._parent._featureFromCache(e)}},{key:"executeWhereClause",value:function(e){return this._whereclause.testFeature(e)}},{key:"executeWhereClauseDeferred",value:function(e){if(null!==this._whereClauseFunction)try{var t=this._whereClauseFunction(e);return Object(u.n)(t)?t:Object(u.s)(t)}catch(r){return Object(u.r)(r)}return Object(u.s)(this.executeWhereClause(e))}},{key:"_fetchAndRefineFeatures",value:function(e,t,r){var n=this,a=new c.a([],e,!1,null),i=Math.min(t,e.length);return this._parent._getFeatures(a,-1,i,r).then((function(){if(n._checkCancelled(r),null==n._whereClauseFunction){for(var a=0;a<i;a++){var s=n._parent._featureFromCache(e[a]);!0===n.executeWhereClause(s)?n._idstates[e[a]]=o.b.InFeatureSet:n._idstates[e[a]]=o.b.NotInFeatureSet}return"success"}for(var l=[],c=0;c<i;c++){var f=n._parent._featureFromCache(e[c]);l.push(n.executeWhereClauseDeferred(f))}return Object(u.b)(l).then((function(r){for(var a=0;a<t;a++)!0===r[a]?n._idstates[e[a]]=o.b.InFeatureSet:n._idstates[e[a]]=o.b.NotInFeatureSet;return"success"}))}))}},{key:"_getFilteredSet",value:function(e,t,r,n,a){var i=this;return null!==this._whereClauseFunction||(null!==r?null!==this._whereclause&&(r=Object(d.a)(this._whereclause,r)):r=this._whereclause),this._ensureLoaded().then((function(){return i._parent._getFilteredSet(e,t,r,n,a)})).then((function(e){return i._checkCancelled(a),null!==i._whereClauseFunction?new c.a(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,i._clonePageDefinition(e.pagesDefinition)):new c.a(e._candidates.slice(0),e._known.slice(0),e._ordered,i._clonePageDefinition(e.pagesDefinition))}))}},{key:"_stat",value:function(e,t,r,n,a,i,s){var l=this;if(null!==this._whereClauseFunction)return null===a&&""===r&&null===n?this._manualStat(e,t,i,s):Object(u.s)({calculated:!1});var o=this._whereclause;return null!==a&&null!==this._whereclause&&(o=Object(d.a)(this._whereclause,a)),this._parent._stat(e,t,r,n,o,i,s).then((function(u){return!1===u.calculated?null===a&&""===r&&null===n?l._manualStat(e,t,i,s):{calculated:!1}:u}))}},{key:"_canDoAggregates",value:function(e,t,r,n,a){return null!==this._whereClauseFunction?Object(u.s)(!1):(null!==a?null!==this._whereclause&&(a=Object(d.a)(this._whereclause,a)):a=this._whereclause,null===this._parent?Object(u.s)(!1):this._parent._canDoAggregates(e,t,r,n,a))}},{key:"_getAggregatePagesDataSourceDefinition",value:function(e,t,r,n,a,i,s){return null===this._parent?Object(u.r)(new Error("Should never be called")):(null!==a?null!==this._whereclause&&(a=Object(d.a)(this._whereclause,a)):a=this._whereclause,this._parent._getAggregatePagesDataSourceDefinition(e,t,r,n,a,i,s))}}],[{key:"registerAction",value:function(){h.a._featuresetFunctions.filter=function(e){if("function"==typeof e)return new r({parentfeatureset:this,whereclause:e});var t=null;return e instanceof f.WhereClause&&(t=e),new r({parentfeatureset:this,whereclause:t})}}}]),r}(h.a);t.a=p},821:function(e,t,r){"use strict";var n=r(16),a=r(2),i=r(3),s=r(4),u=r(5),l=r(15),o=r(758),c=r(760),f=r(762),d=r(822),h=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e))._orderbyclause=null,n.declaredClass="esri.arcade.featureset.actions.OrderBy",n._maxProcessing=100,n._orderbyclause=e.orderbyclause,n._parent=e.parentfeatureset,n}return Object(i.a)(r,[{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._getFilteredSet("",null,null,t._orderbyclause,e)})).then((function(r){return t._checkCancelled(e),t._wset=r,t._wset})):Object(l.s)(this._wset)}},{key:"manualOrderSet",value:function(e,t){var r=this;return this.getIdColumnDictionary(e,[],-1,t).then((function(e){r._orderbyclause.order(e);for(var t=new c.a([],[],!0,null),n=0;n<e.length;n++)t._known.push(e[n].id);return t}))}},{key:"getIdColumnDictionary",value:function(e,t,r,a){var i=this;if(r<e._known.length-1){var s=this._maxQueryRate();if("GETPAGES"===e._known[r+1])return Object(o.q)(this._parent._expandPagedSet(e,s,0,0,a)).then((function(){return i.getIdColumnDictionary(e,t,r,a)}));for(var u=r+1,c=[];u<e._known.length&&"GETPAGES"!==e._known[u];)c.push(e._known[u]),u++;return r+=c.length,Object(o.q)(this._parent._getFeatureBatch(c,a)).then((function(s){i._checkCancelled(a);var u,l=Object(n.a)(s);try{for(l.s();!(u=l.n()).done;){var o=u.value;t.push({id:o.attributes[i.objectIdField],feature:o})}}catch(c){l.e(c)}finally{l.f()}return i.getIdColumnDictionary(e,t,r,a)}))}return e._candidates.length>0?Object(o.q)(this._refineSetBlock(e,this._maxProcessingRate(),a)).then((function(){return i._checkCancelled(a),i.getIdColumnDictionary(e,t,r,a)})):Object(l.s)(t)}},{key:"_isInFeatureSet",value:function(e){return this._parent._isInFeatureSet(e)}},{key:"_getFeatures",value:function(e,t,r,n){return this._parent._getFeatures(e,t,r,n)}},{key:"_featureFromCache",value:function(e){if(void 0===this._featureCache[e]){var t=this._parent._featureFromCache(e);if(void 0===t)return;return null===t?null:(this._featureCache[e]=t,t)}return this._featureCache[e]}},{key:"_fetchAndRefineFeatures",value:function(){return Object(l.r)(new Error("Fetch and Refine should not be called in this featureset"))}},{key:"_getFilteredSet",value:function(e,t,r,n,a){var i=this;return this._ensureLoaded().then((function(){return i._parent._getFilteredSet(e,t,r,null===n?i._orderbyclause:n,a)})).then((function(e){var n;i._checkCancelled(a),n=new c.a(e._candidates.slice(0),e._known.slice(0),e._ordered,i._clonePageDefinition(e.pagesDefinition));var s=!0;return e._candidates.length>0&&(s=!1),!1===n._ordered?i.manualOrderSet(n,a).then((function(e){return!1===s&&(null===t&&null===r||(e=new c.a(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,i._clonePageDefinition(e.pagesDefinition)))),e})):n}))}}],[{key:"registerAction",value:function(){f.a._featuresetFunctions.orderBy=function(e){return""===e?this:new r({parentfeatureset:this,orderbyclause:new d.a(e)})}}}]),r}(f.a);t.a=h},822:function(e,t,r){"use strict";var n=r(16),a=r(2),i=r(3);function s(e,t){return e===t?0:null===e?-1:null===t?1:e<t?-1:1}var u=function(){function e(t){Object(a.a)(this,e);var r=t.split(",");this._fields=[],this._directions=[];for(var n=0;n<r.length;n++){var i=r[n].match(/\S+/g);this._fields.push(i[0]),2===i.length?"asc"===i[1].toLowerCase()?this._directions.push(1):this._directions.push(0):this._directions.push(1)}}return Object(i.a)(e,[{key:"constructClause",value:function(){for(var e="",t=0;t<this._fields.length;t++)0!==t&&(e+=","),e+=this._fields[t],1===this._directions[t]?e+=" ASC":e+=" DESC";return e}},{key:"order",value:function(e){var t=this;e.sort((function(e,r){for(var n=0;n<t._fields.length;n++){var a,i=t.featureValue(e.feature,t._fields[n],n),u=t.featureValue(r.feature,t._fields[n],n);if(0!==(a=1===t._directions[n]?s(i,u):-1*s(i,u)))return a}return 0}))}},{key:"scanForField",value:function(e){for(var t=0;t<this._fields.length;t++)if(this._fields[t].toLowerCase().trim()===e.toLowerCase().trim())return!0;return!1}},{key:"replaceFields",value:function(t){for(var r="",a=0;a<this._fields.length;a++){0!==a&&(r+=",");var i,s=this._fields[a],u=Object(n.a)(t);try{for(u.s();!(i=u.n()).done;){var l=i.value;if(s.toLowerCase()===l.field.toLowerCase()){s=l.newfield;break}}}catch(o){u.e(o)}finally{u.f()}r+=s,1===this._directions[a]?r+=" ASC":r+=" DESC"}return new e(r)}},{key:"featureValue",value:function(e,t,r){var n=e.attributes[t];if(void 0!==n)return n;for(var a in e.attributes)if(t.toLowerCase()===a.toLowerCase())return this._fields[r]=a,e.attributes[a];return null}}]),e}();t.a=u},828:function(e,t,r){"use strict";var n,a=r(2),i=r(3),s=r(4),u=r(5),l=r(0),o=(r(13),r(12),r(14)),c=r(1),f=r(6),d=(r(9),r(19),r(20),r(23));var h={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}},p=n=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).contentType=null,n.exifInfo=null,n.id=null,n.globalId=null,n.keywords=null,n.name=null,n.parentGlobalId=null,n.parentObjectId=null,n.size=null,n.url=null,n}return Object(i.a)(r,[{key:"clone",value:function(){return new n({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}},{key:"orientationInfo",get:function(){var e=function(e){var t=e.exifInfo,r=e.exifName,n=e.tagName;if(!t||!r||!n)return null;var a=t.find((function(e){return e.name===r}));return a?function(e){var t=e.tagName,r=e.tags;if(!r||!t)return null;var n=r.find((function(e){return e.name===t}));return n&&n.value||null}({tagName:n,tags:a.tags}):null}({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:this.exifInfo});return h[e]||null}}]),r}(d.a);Object(l.a)([Object(c.b)({type:String})],p.prototype,"contentType",void 0),Object(l.a)([Object(c.b)()],p.prototype,"exifInfo",void 0),Object(l.a)([Object(c.b)({readOnly:!0,dependsOn:["exifInfo"]})],p.prototype,"orientationInfo",null),Object(l.a)([Object(c.b)({type:o.a})],p.prototype,"id",void 0),Object(l.a)([Object(c.b)({type:String})],p.prototype,"globalId",void 0),Object(l.a)([Object(c.b)({type:String})],p.prototype,"keywords",void 0),Object(l.a)([Object(c.b)({type:String})],p.prototype,"name",void 0),Object(l.a)([Object(c.b)({json:{read:!1}})],p.prototype,"parentGlobalId",void 0),Object(l.a)([Object(c.b)({json:{read:!1}})],p.prototype,"parentObjectId",void 0),Object(l.a)([Object(c.b)({type:o.a})],p.prototype,"size",void 0),Object(l.a)([Object(c.b)({json:{read:!1}})],p.prototype,"url",void 0);var y=p=n=Object(l.a)([Object(f.a)("esri.layers.support.AttachmentInfo")],p);t.a=y},840:function(e,t,r){"use strict";var n=r(2),a=r(3),i=r(4),s=r(5),u=r(15),l=r(757),o=r(776),c=r(760),f=r(762),d=r(802),h=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e))._relation="",a._relationGeom=null,a._relationString="",a.declaredClass="esri.arcade.featureset.actions.SpatialFilter",a._relationString=e.relationString,a._parent=e.parentfeatureset,a._maxProcessing=40,a._relation=e.relation,a._relationGeom=e.relationGeom,a}return Object(a.a)(r,[{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._parent._getFilteredSet("esriSpatialRelRelation"!==t._relation?t._relation:t._relation+":"+t._relationString,t._relationGeom,null,null,e)})).then((function(r){return t._checkCancelled(e),t._wset=new c.a(r._candidates.slice(0),r._known.slice(0),r._ordered,t._clonePageDefinition(r.pagesDefinition)),t._wset})):Object(u.s)(this._wset)}},{key:"_isInFeatureSet",value:function(e){var t=this._parent._isInFeatureSet(e);return t===l.b.NotInFeatureSet?t:void 0===(t=this._idstates[e])?l.b.Unknown:t}},{key:"_getFeature",value:function(e,t,r){return this._parent._getFeature(e,t,r)}},{key:"_getFeatures",value:function(e,t,r,n){return this._parent._getFeatures(e,t,r,n)}},{key:"_featureFromCache",value:function(e){return this._parent._featureFromCache(e)}},{key:"executeSpatialRelationTest",value:function(e){if(null===e.geometry)return Object(u.s)(!1);switch(this._relation){case"esriSpatialRelEnvelopeIntersects":var t=Object(l.p)(this._relationGeom),r=Object(l.p)(e.geometry);return Object(o.q)(t,r);case"esriSpatialRelIntersects":return Object(o.q)(this._relationGeom,e.geometry);case"esriSpatialRelContains":return Object(o.c)(this._relationGeom,e.geometry);case"esriSpatialRelOverlaps":return Object(o.t)(this._relationGeom,e.geometry);case"esriSpatialRelWithin":return Object(o.C)(this._relationGeom,e.geometry);case"esriSpatialRelTouches":return Object(o.A)(this._relationGeom,e.geometry);case"esriSpatialRelCrosses":return Object(o.d)(this._relationGeom,e.geometry);case"esriSpatialRelRelation":return Object(o.w)(this._relationGeom,e.geometry,this._relationString)}}},{key:"_fetchAndRefineFeatures",value:function(e,t,r){var n=this,a=new c.a([],e,!1,null),i=Math.min(t,e.length);return this._parent._getFeatures(a,-1,i,r).then((function(){n._checkCancelled(r);for(var t=[],a=0;a<i;a++){var s=n._parent._featureFromCache(e[a]);t.push(n.executeSpatialRelationTest(s))}return Object(u.b)(t)})).then((function(r){for(var a=0;a<t;a++)!0===r[a]?n._idstates[e[a]]=l.b.InFeatureSet:n._idstates[e[a]]=l.b.NotInFeatureSet;return"success"}))}},{key:"_getFilteredSet",value:function(e,t,r,n,a){var i=this;return this._ensureLoaded().then((function(){return i._parent._getFilteredSet("esriSpatialRelRelation"!==i._relation?i._relation:i._relation+":"+i._relationString,i._relationGeom,r,n,a)})).then((function(e){return i._checkCancelled(a),null!==t?new c.a(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,i._clonePageDefinition(e.pagesDefinition)):new c.a(e._candidates.slice(0),e._known.slice(0),e._ordered,i._clonePageDefinition(e.pagesDefinition))}))}},{key:"_stat",value:function(e,t,r,n,a,i,s){var l=this;return""!==r?Object(u.s)({calculated:!1}):this._parent._stat(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,a,i,s).then((function(u){return!1===u.calculated?null===a&&""===r&&null===n?l._manualStat(e,t,i,s):{calculated:!1}:u}))}},{key:"_canDoAggregates",value:function(e,t,r,n,a){return""!==r||null!==n||null===this._parent?Object(u.s)(!1):this._parent._canDoAggregates(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,a)}},{key:"_getAggregatePagesDataSourceDefinition",value:function(e,t,r,n,a,i,s){return null===this._parent?Object(u.r)(new Error("Should never be called")):this._parent._getAggregatePagesDataSourceDefinition(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,a,i,s)}}],[{key:"registerAction",value:function(){f.a._featuresetFunctions.intersects=function(e){return null==e?new d.a({parentfeatureset:this}):new r({parentfeatureset:this,relation:"esriSpatialRelIntersects",relationGeom:e})},f.a._featuresetFunctions.envelopeIntersects=function(e){return null==e?new d.a({parentfeatureset:this}):new r({parentfeatureset:this,relation:"esriSpatialRelEnvelopeIntersects",relationGeom:e})},f.a._featuresetFunctions.contains=function(e){return null==e?new d.a({parentfeatureset:this}):new r({parentfeatureset:this,relation:"esriSpatialRelContains",relationGeom:e})},f.a._featuresetFunctions.overlaps=function(e){return null==e?new d.a({parentfeatureset:this}):new r({parentfeatureset:this,relation:"esriSpatialRelOverlaps",relationGeom:e})},f.a._featuresetFunctions.within=function(e){return null==e?new d.a({parentfeatureset:this}):new r({parentfeatureset:this,relation:"esriSpatialRelWithin",relationGeom:e})},f.a._featuresetFunctions.touches=function(e){return null==e?new d.a({parentfeatureset:this}):new r({parentfeatureset:this,relation:"esriSpatialRelTouches",relationGeom:e})},f.a._featuresetFunctions.crosses=function(e){return null==e?new d.a({parentfeatureset:this}):new r({parentfeatureset:this,relation:"esriSpatialRelCrosses",relationGeom:e})},f.a._featuresetFunctions.relate=function(e,t){return null==e?new d.a({parentfeatureset:this}):new r({parentfeatureset:this,relation:"esriSpatialRelRelation",relationGeom:e,relationString:t})}}}]),r}(f.a);t.a=h},872:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r(2),a=r(3),i=r(15),s=function(){function e(){Object(n.a)(this,e),this.declaredRootClass="esri.arcade.featureSetCollection",this._layerById={},this._layerByName={}}return Object(a.a)(e,[{key:"add",value:function(e,t,r){this._layerById[t]=r,this._layerByName[e]=r}},{key:"featureSetByName",value:function(e){return void 0===this._layerByName[e]?this.resolvePromise(null):this.resolvePromise(this._layerByName[e])}},{key:"featureSetById",value:function(e){return void 0===this._layerById[e]?this.resolvePromise(null):this.resolvePromise(this._layerById[e])}},{key:"castToText",value:function(){return"object, FeatureSetCollection"}},{key:"resolvePromise",value:function(e){return Object(i.s)(e)}}]),e}()},873:function(e,t,r){"use strict";r.d(t,"a",(function(){return j})),r.d(t,"b",(function(){return b})),r.d(t,"c",(function(){return g})),r.d(t,"d",(function(){return O})),r.d(t,"e",(function(){return m}));var n=r(16),a=r(4),i=r(5),s=r(2),u=r(3),l=r(15),o=r(36),c=r(206),f=r(757),d=r(834),h=r(760),p=r(678),y=r(767),v=r(762),_=function(){function e(){Object(s.a)(this,e),this.sqlRewritable=!1}return Object(u.a)(e,[{key:"postInitialization",value:function(e,t){}}]),e}(),g=function(e){Object(a.a)(r,e);var t=Object(i.a)(r);function r(e){var n;return Object(s.a)(this,r),(n=t.call(this)).field=e,n.sqlRewritable=!0,n}return Object(u.a)(r,[{key:"extractValue",value:function(e){return e.attributes[this.field.name]}},{key:"rewriteSql",value:function(e){return{rewritten:this.sqlRewritable,where:e}}}]),r}(_),b=function(e){Object(a.a)(r,e);var t=Object(i.a)(r);function r(e,n,a){var i;return Object(s.a)(this,r),(i=t.call(this)).originalField=e,i.sqlRewritable=!0,i.field=Object(f.c)(e),i.field.name=n,i.field.alias=a,i}return Object(u.a)(r,[{key:"rewriteSql",value:function(e,t){return{rewritten:this.sqlRewritable,where:Object(y.g)(e,this.field.name,this.originalField.name,t.getFieldsIndex())}}},{key:"extractValue",value:function(e){return e.attributes[this.originalField.name]}}]),r}(_),m=function(e){Object(a.a)(r,e);var t=Object(i.a)(r);function r(e,n,a){var i;for(var u in Object(s.a)(this,r),(i=t.call(this)).field=e,i.codefield=n,i.lkp=a,i.reverseLkp={},a)i.reverseLkp[a[u]]=u;return i.sqlRewritable=!0,i}return Object(u.a)(r,[{key:"rewriteSql",value:function(e,t){var n=this.evaluateNodeToWhereClause(e.parseTree,f.a.Standardised,this.field.name,this.codefield instanceof p.WhereClause?Object(y.i)(this.codefield,f.a.Standardised):this.codefield,e.parameters);return n.indexOf(r.BADNESS)>=0?{rewritten:!1,where:e}:{rewritten:this.sqlRewritable,where:p.WhereClause.create(n,t._parent.getFieldsIndex())}}},{key:"evaluateNodeToWhereClause",value:function(e,t){var a,i,s,u,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4?arguments[4]:void 0;switch(e.type){case"interval":return Object(y.b)(this.evaluateNodeToWhereClause(e.value,t,l,o,c),e.qualifier,e.op);case"case_expression":var f=" CASE ";"simple"===e.format&&(f+=this.evaluateNodeToWhereClause(e.operand,t,l,r.BADNESS,c));for(var d=0;d<e.clauses.length;d++)f+=" WHEN "+this.evaluateNodeToWhereClause(e.clauses[d].operand,t,l,r.BADNESS,c)+" THEN "+this.evaluateNodeToWhereClause(e.clauses[d].value,t,l,r.BADNESS,c);return null!==e.else&&(f+=" ELSE "+this.evaluateNodeToWhereClause(e.else,t,l,r.BADNESS,c)),f+=" END ";case"param":var h=c[e.value.toLowerCase()];if("string"==typeof h)return"'"+c[e.value.toLowerCase()].toString().replace(/'/g,"''")+"'";if(h instanceof Date)return Object(y.d)(h,t);if(h instanceof Array){for(var p=[],v=0;v<h.length;v++)"string"==typeof h[v]?p.push("'"+h[v].toString().replace(/'/g,"''")+"'"):h[v]instanceof Date?p.push(Object(y.d)(h[v],t)):p.push(h[v].toString());return p}return h.toString();case"expr_list":i=[];var _,g=Object(n.a)(e.value);try{for(g.s();!(_=g.n()).done;){var b=_.value;i.push(this.evaluateNodeToWhereClause(b,t,l,o,c))}}catch(R){g.e(R)}finally{g.f()}return i;case"unary_expr":return" ( NOT "+this.evaluateNodeToWhereClause(e.expr,t,l,r.BADNESS,c)+" ) ";case"binary_expr":switch(e.operator){case"AND":return" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" AND "+this.evaluateNodeToWhereClause(e.right,t,l,o,c)+") ";case"OR":return" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" OR "+this.evaluateNodeToWhereClause(e.right,t,l,o,c)+") ";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" IS NOT NULL )";case"IN":if(a=[],"expr_list"===e.right.type){if("column_ref"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){var m,O=[],j=!0,S=Object(n.a)(e.right.value);try{for(S.s();!(m=S.n()).done;){var w=m.value;if("string"!==w.type){j=!1;break}if(void 0===this.lkp[w.value]){j=!1;break}O.push(this.lkp[w.value].toString())}}catch(R){S.e(R)}finally{S.f()}if(j)return" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" IN ("+O.join(",")+")) "}return a=this.evaluateNodeToWhereClause(e.right,t,l,o,c)," ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" IN ("+a.join(",")+")) "}return(u=this.evaluateNodeToWhereClause(e.right,t,l,o,c))instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" IN ("+u.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" IN ("+u+")) ";case"NOT IN":if(a=[],"expr_list"===e.right.type){if("column_ref"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){var k,F=[],I=!0,x=Object(n.a)(e.right.value);try{for(x.s();!(k=x.n()).done;){var C=k.value;if("string"!==C.type){I=!1;break}if(void 0===this.lkp[C.value]){I=!1;break}F.push(this.lkp[C.value].toString())}}catch(R){x.e(R)}finally{x.f()}if(I)return" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" NOT IN ("+F.join(",")+")) "}return a=this.evaluateNodeToWhereClause(e.right,t,l,o,c)," ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" NOT IN ("+a.join(",")+")) "}return(u=this.evaluateNodeToWhereClause(e.right,t,l,o,c))instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" NOT IN ("+u.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" NOT IN ("+u+")) ";case"BETWEEN":return s=this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)," ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" BETWEEN "+s[0]+" AND "+s[1]+" ) ";case"NOTBETWEEN":return s=this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)," ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" NOT BETWEEN "+s[0]+" AND "+s[1]+" ) ";case"LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" LIKE "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" LIKE "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)+") ";case"NOT LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)+") ";case"<>":case"=":if("column_ref"===e.left.type&&"string"===e.right.type){if(e.left.column.toUpperCase()===this.field.name.toUpperCase()&&void 0!==this.lkp[e.right.value.toString()])return" ("+o+" "+e.operator+" "+this.lkp[e.right.value.toString()].toString()+") "}else if("column_ref"===e.right.type&&"string"===e.left.type&&e.right.column.toUpperCase()===this.field.name.toUpperCase())return" ("+this.lkp[e.right.value.toString()].toString()+" "+e.operator+" "+o+") ";return" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)+") ";case"<":case">":case">=":case"<=":case"*":case"-":case"+":case"/":return" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)+") "}throw new Error("Not Supported Operator "+e.operator);case"null":return"null";case"bool":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replace(/'/g,"''")+"'";case"timestamp":case"date":return Object(y.d)(e.value,t);case"number":return e.value.toString();case"current_time":return Object(y.e)("date"===e.mode,t);case"column_ref":return l&&l.toLowerCase()===e.column.toLowerCase()?"("+o+")":e.column;case"function":var T=this.evaluateNodeToWhereClause(e.args,t,l,r.BADNESS,c);return Object(y.k)(e.name,T,t)}throw new Error("Unsupported sql syntax "+e.type)}},{key:"extractValue",value:function(e){return this.codefield instanceof p.WhereClause?this.reverseLkp[this.codefield.calculateValueCompiled(e)]:this.reverseLkp[e.attributes[this.codefield]]}}]),r}(_);m.BADNESS="_!!!_BAD_LKP_!!!!";var O=function(e){Object(a.a)(r,e);var t=Object(i.a)(r);function r(e,n){var a;return Object(s.a)(this,r),(a=t.call(this)).field=e,a.sql=n,a}return Object(u.a)(r,[{key:"rewriteSql",value:function(e,t){return{rewritten:!0,where:Object(y.g)(e,this.field.name,Object(y.i)(this.sql,f.a.Standardised),t.getFieldsIndex())}}},{key:"extractValue",value:function(e){return this.sql.calculateValueCompiled(e)}}]),r}(_),j=function(e){Object(a.a)(r,e);var t=Object(i.a)(r);function r(e){var n;return Object(s.a)(this,r),(n=t.call(this,e))._calcFunc=null,n.declaredClass="esri.arcade.featureset.actions.Adapted",n.adaptedFields=null,n._extraFilter=null,n._extraFilter=e.extraFilter,n._parent=e.parentfeatureset,n._maxProcessing=30,n.adaptedFields=e.adaptedFields,n}return Object(u.a)(r,[{key:"_initialiseFeatureSet",value:function(){null!==this._parent?(this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.spatialReference=new o.a({wkid:4326}),this.objectIdField="",this.globalIdField="",this.geometryType=f.m.point,this.typeIdField="",this.types=null),this.fields=[];var e,t=Object(n.a)(this.adaptedFields);try{for(t.s();!(e=t.n()).done;){var r=e.value;r.postInitialization(this,this._parent),this.fields.push(r.field)}}catch(a){t.e(a)}finally{t.f()}}},{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._extraFilter?t._getFilteredSet("",null,null,null,e):t._parent._getSet(e)})).then((function(r){return t._checkCancelled(e),t._wset=new h.a(r._candidates.slice(0),r._known.slice(0),r._ordered,t._clonePageDefinition(r.pagesDefinition)),t._wset})):Object(l.s)(this._wset)}},{key:"_isInFeatureSet",value:function(e){return this._parent._isInFeatureSet(e)}},{key:"_getFeatures",value:function(e,t,r,a){var i=this,s=[];-1!==t&&void 0===this._featureCache[t]&&s.push(t);var u=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,u))return this._expandPagedSet(e,u,0,0,a).then((function(){return i._getFeatures(e,t,r,a)}));for(var o=0,f=e._lastFetchedIndex;f<e._known.length&&(++o<=r&&(e._lastFetchedIndex+=1),!(void 0===this._featureCache[e._known[f]]&&(e._known[f]!==t&&s.push(e._known[f]),s.length>=u-1)));f++);if(0===s.length)return Object(l.s)("success");e=new h.a([],s,e._ordered,null);var p=Math.min(s.length,r);return this._parent._getFeatures(e,-1,p,a).then((function(){i._checkCancelled(a);for(var e=[],t=0;t<p;t++){var r=i._parent._featureFromCache(s[t]);void 0!==r&&e.push({geometry:r.geometry,attributes:r.attributes,id:s[t]})}for(var u=0,l=e;u<l.length;u++){var o,f=l[u],h=[],y=Object(n.a)(i.adaptedFields);try{for(y.s();!(o=y.n()).done;){var v=o.value;h[v.field.name]=v.extractValue(f)}}catch(_){y.e(_)}finally{y.f()}i._featureCache[f.id]=new c.a({attributes:h,geometry:Object(d.a)(f.geometry)})}return"success"}))}},{key:"_fetchAndRefineFeatures",value:function(){return Object(l.r)(new Error("Fetch and Refine should not be called in this featureset"))}},{key:"_getFilteredSet",value:function(e,t,r,a,i){var s,u=this,l=this.reformulateWithoutAdaptions(r);s=l.cannot,r=l.where;var o=!1;if(null!==a){o=!0;var c,f=[],d=Object(n.a)(this.adaptedFields);try{for(d.s();!(c=d.n()).done;){var p=c.value;if(!(p instanceof g)&&!0===a.scanForField(p.field.name)){if(!(p instanceof b)){a=null,o=!1;break}f.push({field:p.field.name,newfield:p.originalField.name})}}}catch(v){d.e(v)}finally{d.f()}a&&f.length>0&&(a=a.replaceFields(f))}return null!==r?null!==this._extraFilter&&(r=Object(y.a)(this._extraFilter,r)):r=this._extraFilter,this._ensureLoaded().then((function(){return u._parent._getFilteredSet(e,t,r,a,i)})).then((function(e){return u._checkCancelled(i),!0===s?new h.a(e._candidates.slice(0).concat(e._known.slice(0)),[],!0===o&&e._ordered,u._clonePageDefinition(e.pagesDefinition)):new h.a(e._candidates.slice(0),e._known.slice(0),!0===o&&e._ordered,u._clonePageDefinition(e.pagesDefinition))}))}},{key:"reformulateWithoutAdaptions",value:function(e){var t={cannot:!1,where:e};if(null!==e){var r,a=Object(n.a)(this.adaptedFields);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(!0===Object(y.h)(e,i.field.name)){var s=i.rewriteSql(e,this);if(!0!==s.rewritten){t.cannot=!0,t.where=null;break}t.where=s.where}}}catch(u){a.e(u)}finally{a.f()}}return t}},{key:"_stat",value:function(e,t,r,n,a,i,s){var u=this,o=!1,c=this.reformulateWithoutAdaptions(t);return o=c.cannot,t=c.where,c=this.reformulateWithoutAdaptions(a),o=o||c.cannot,null!==(a=c.where)?null!==this._extraFilter&&(a=Object(y.a)(this._extraFilter,a)):a=this._extraFilter,!0===o?null===a&&""===r&&null===n?this._manualStat(e,t,i,s):Object(l.s)({calculated:!1}):this._parent._stat(e,t,r,n,a,i,s).then((function(l){return!1===l.calculated?null===a&&""===r&&null===n?u._manualStat(e,t,i,s):{calculated:!1}:l}))}},{key:"_canDoAggregates",value:function(e,t,r,a,i){if(null===this._parent)return Object(l.s)(!1);for(var s=0;s<e.length;s++){var u,o=Object(n.a)(this.adaptedFields);try{for(o.s();!(u=o.n()).done;){var c=u.value;if(e[s].toLowerCase()===c.field.name.toLowerCase()&&!(c instanceof g))return Object(l.s)(!1)}}catch(b){o.e(b)}finally{o.f()}}for(var f=[],d=0;d<t.length;d++){var h=t[d];if(null!==h.workingexpr){var p=this.reformulateWithoutAdaptions(h.workingexpr);if(p.cannot)return Object(l.s)(!1);var v=h.clone();v.workingexpr=p.where,f.push(v)}else f.push(h)}var _=this.reformulateWithoutAdaptions(i);return _.cannot?Object(l.s)(!1):(null!==(i=_.where)?null!==this._extraFilter&&(i=Object(y.a)(this._extraFilter,i)):i=this._extraFilter,this._parent._canDoAggregates(e,f,r,a,i))}},{key:"_getAggregatePagesDataSourceDefinition",value:function(e,t,r,n,a,i,s){if(null===this._parent)return Object(l.r)(new Error("Should never be called"));for(var u=[],o=0;o<t.length;o++){var c=t[o];if(null!==c.workingexpr){var f=this.reformulateWithoutAdaptions(c.workingexpr);if(f.cannot)return Object(l.r)(new Error("Should never be called"));var d=c.clone();d.workingexpr=f.where,u.push(d)}else u.push(c)}var h=this.reformulateWithoutAdaptions(a);return h.cannot?Object(l.r)(new Error("Should never be called")):(null!==(a=h.where)?null!==this._extraFilter&&(a=Object(y.a)(this._extraFilter,a)):a=this._extraFilter,this._parent._getAggregatePagesDataSourceDefinition(e,u,r,n,a,i,s))}}],[{key:"findField",value:function(e,t){var r,a=Object(n.a)(e);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i.name.toLowerCase()===t.toString().toLowerCase())return i}}catch(s){a.e(s)}finally{a.f()}return null}}]),r}(v.a)},874:function(e,t,r){"use strict";var n=r(2),a=r(3),i=r(4),s=r(5),u=r(15),l=r(757),o=r(760),c=r(762),f=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e))._topnum=0,a.declaredClass="esri.arcade.featureset.actions.Top",a._countedin=0,a._maxProcessing=100,a._topnum=e.topnum,a._parent=e.parentfeatureset,a}return Object(a.a)(r,[{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._parent._getSet(e)})).then((function(e){return t._wset=new o.a(e._candidates.slice(0),e._known.slice(0),!1,t._clonePageDefinition(e.pagesDefinition)),t._setKnownLength(t._wset)>t._topnum&&(t._wset._known=t._wset._known.slice(0,t._topnum)),t._setKnownLength(t._wset)>=t._topnum&&(t._wset._candidates=[]),t._wset})):Object(u.s)(this._wset)}},{key:"_setKnownLength",value:function(e){return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]?e._known.length-1:e._known.length}},{key:"_isInFeatureSet",value:function(e){var t=this._parent._isInFeatureSet(e);if(t===l.b.NotInFeatureSet)return t;var r=this._idstates[e];return r===l.b.InFeatureSet||r===l.b.NotInFeatureSet?r:t===l.b.InFeatureSet&&void 0===r?this._countedin<this._topnum?(this._idstates[e]=l.b.InFeatureSet,this._countedin++,l.b.InFeatureSet):(this._idstates[e]=l.b.NotInFeatureSet,l.b.NotInFeatureSet):l.b.Unknown}},{key:"_expandPagedSet",value:function(e,t,r,n,a){var i=this;if(null===this._parent)return Object(u.r)(new Error("Parent Paging not implemented"));if(t>this._topnum&&(t=this._topnum),this._countedin>=this._topnum&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset){var s=e._known.length;return s>0&&"GETPAGES"===e._known[s-1]&&(e._known.length=s-1),(s=e._candidates.length)>0&&"GETPAGES"===e._candidates[s-1]&&(e._candidates.length=s-1),Object(u.s)("success")}return this._parent._expandPagedSet(e,t,r,n,a).then((function(t){return i._setKnownLength(e)>i._topnum&&(e._known.length=i._topnum),i._setKnownLength(e)>=i._topnum&&(e._candidates.length=0),t}))}},{key:"_getFeatures",value:function(e,t,r,n){var a=this,i=[],s=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,s))return this._expandPagedSet(e,s,0,0,n).then((function(){return a._getFeatures(e,t,r,n)}));-1!==t&&void 0===this._featureCache[t]&&i.push(t);for(var l=0,c=e._lastFetchedIndex;c<e._known.length&&(++l<=r&&(e._lastFetchedIndex+=1),!(void 0===this._featureCache[e._known[c]]&&(e._known[c]!==t&&i.push(e._known[c]),i.length>s-1)));c++);if(0===i.length)return Object(u.s)("success");var f=new o.a([],i,!1,null),d=Math.min(i.length,r);return this._parent._getFeatures(f,-1,d,n).then((function(){for(var e=0;e<d;e++){var t=a._parent._featureFromCache(i[e]);void 0!==t&&(a._featureCache[i[e]]=t)}return"success"}))}},{key:"_getFilteredSet",value:function(e,t,r,n,a){var i=this;return this._ensureLoaded().then((function(){return i._getSet(a)})).then((function(e){return new o.a(e._candidates.slice(0).concat(e._known.slice(0)),[],!1,i._clonePageDefinition(e.pagesDefinition))}))}},{key:"_refineKnowns",value:function(e,t){for(var r=0,n=null,a=[],i=0;i<e._candidates.length;i++){var s=this._isInFeatureSet(e._candidates[i]);if(s===l.b.InFeatureSet){if(e._known.push(e._candidates[i]),r+=1,null===n?n={start:i,end:i}:n.end===i-1?n.end=i:(a.push(n),n={start:i,end:i}),e._known.length>=this._topnum)break}else if(s===l.b.NotInFeatureSet)null===n?n={start:i,end:i}:n.end===i-1?n.end=i:(a.push(n),n={start:i,end:i}),r+=1;else if(s===l.b.Unknown)break;if(r>=t)break}null!==n&&a.push(n);for(var u=a.length-1;u>=0;u--)e._candidates.splice(a[u].start,a[u].end-a[u].start+1);this._setKnownLength(e)>this._topnum&&(e._known=e._known.slice(0,this._topnum)),this._setKnownLength(e)>=this._topnum&&(e._candidates=[])}},{key:"_stat",value:function(){return Object(u.s)({calculated:!1})}},{key:"_canDoAggregates",value:function(){return Object(u.s)(!1)}}],[{key:"registerAction",value:function(){c.a._featuresetFunctions.top=function(e){return new r({parentfeatureset:this,topnum:e})}}}]),r}(c.a);t.a=f},875:function(e,t,r){"use strict";var n=r(16),a=r(2),i=r(3),s=r(4),u=r(5),l=r(15),o=r(99),c=r(206),f=r(294),d=r(757),h=r(760),p=r(767),y=r(762),v=r(409),_=r(349),g=r(679),b=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory",n._removeGeometry=!1,n._overrideFields=null,n._forceIsTable=!1,e.spatialReference&&(n.spatialReference=e.spatialReference),n._transparent=!0,n._maxProcessing=1e3,n._layer=e.layer,n._wset=null,!0===e.isTable&&(n._forceIsTable=!0),void 0!==e.outFields&&(n._overrideFields=e.outFields),void 0!==e.includeGeometry&&(n._removeGeometry=!1===e.includeGeometry),n}return Object(i.a)(r,[{key:"_maxQueryRate",value:function(){return d.f}},{key:"end",value:function(){return this._layer}},{key:"optimisePagingFeatureQueries",value:function(){}},{key:"load",value:function(){var e=this;return null===this._loadPromise&&(this._loadPromise=Object(l.c)((function(t,r){if(!0===e._layer.loaded)return e._initialiseFeatureSet(),void t(e);e._layer.when().then((function(){try{e._initialiseFeatureSet(),t(e)}catch(t){r(t)}}),r),e._layer.load()}))),this._loadPromise}},{key:"_initialiseFeatureSet",value:function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&"*"===this._layer.outFields[0]);else{var e,t=[],r=Object(n.a)(this.fields);try{for(r.s();!(e=r.n()).done;){var a=e.value;if("oid"===a.type)t.push(a);else{var i,s=Object(n.a)(this._layer.outFields);try{for(s.s();!(i=s.n()).done;){if(i.value.toLowerCase()===a.name.toLowerCase()){t.push(a);break}}}catch(g){s.e(g)}finally{s.f()}}}}catch(g){r.e(g)}finally{r.f()}this.fields=t}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{var u,l=[],o=[],c=Object(n.a)(this.fields);try{for(c.s();!(u=c.n()).done;){var f=u.value;if("oid"===f.type)l.push(f),o.push(f.name);else{var h,p=Object(n.a)(this._overrideFields);try{for(p.s();!(h=p.n()).done;){if(h.value.toLowerCase()===f.name.toLowerCase()){l.push(f),o.push(f.name);break}}}catch(g){p.e(g)}finally{p.f()}}}}catch(g){c.e(g)}finally{c.f()}this.fields=l,this._overrideFields=o}this.objectIdField=this._layer.objectIdField;var y,v=Object(n.a)(this.fields);try{for(v.s();!(y=v.n()).done;){var _=y.value;"global-id"===_.type&&(this.globalIdField=_.name)}}catch(g){v.e(g)}finally{v.f()}this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this._databaseType=d.a.Standardised,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types}},{key:"isTable",value:function(){return this._forceIsTable||this._layer.isTable||"table"===this._layer.type||!this._layer.geometryType}},{key:"_isInFeatureSet",value:function(){return d.b.InFeatureSet}},{key:"_candidateIdTransform",value:function(e){return e}},{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._getFilteredSet("",null,null,null,e)})).then((function(e){return t._wset=e,e})):Object(l.s)(this._wset)}},{key:"_changeFeature",value:function(e){var t,r={},a=Object(n.a)(this.fields);try{for(a.s();!(t=a.n()).done;){var i=t.value;r[i.name]=e.attributes[i.name]}}catch(s){a.e(s)}finally{a.f()}return new c.a({geometry:!0===this._removeGeometry?null:e.geometry,attributes:r})}},{key:"_getFilteredSet",value:function(e,t,r,n,a){var i=this,s="",u=!1;if(null!==n&&(s=n.constructClause(),u=!0),this.isTable()&&t&&null!==e&&""!==e){var o=new h.a([],[],!0,null);return Object(l.s)(o)}var c=new _.a;return c.where=null===r?null===t?"1=1":"":Object(p.i)(r,d.a.Standardised),c.spatialRelationship=this._makeRelationshipEnum(e),c.outSpatialReference=this.spatialReference,c.orderByFields=""!==s?s.split(","):null,c.geometry=null===t?null:t,c.returnGeometry=!0,c.relationParameter=this._makeRelationshipParam(e),this._layer.queryFeatures(c).then((function(e){if(null===e)return new h.a([],[],u,null);i._checkCancelled(a);var t=[];return e.features.forEach((function(e){var r=e.attributes[i._layer.objectIdField];t.push(r),i._featureCache[r]=i._changeFeature(e)})),new h.a([],t,u,null)}))}},{key:"_makeRelationshipEnum",value:function(e){if(e.indexOf("esriSpatialRelRelation")>=0)return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}},{key:"_makeRelationshipParam",value:function(e){return e.indexOf("esriSpatialRelRelation")>=0?e.split(":")[1]:""}},{key:"_queryAllFeatures",value:function(){var e=this;if(this._wset)return Object(l.s)(this._wset);var t=new _.a;return t.where="1=1",this._ensureLoaded().then((function(){if(e._layer.source&&e._layer.source.items){var r=[];return e._layer.source.items.forEach((function(t){var n=t.attributes[e._layer.objectIdField];r.push(n),e._featureCache[n]=e._changeFeature(t)})),e._wset=new h.a([],r,!1,null),e._wset}return e._layer.queryFeatures(t).then((function(t){var r=[];return t.features.forEach((function(t){var n=t.attributes[e._layer.objectIdField];r.push(n),e._featureCache[n]=e._changeFeature(t)})),e._wset=new h.a([],r,!1,null),e._wset}))}))}},{key:"_getFeatures",value:function(e,t,r){var n=[];-1!==t&&void 0===this._featureCache[t]&&n.push(t);for(var a=e._lastFetchedIndex;a<e._known.length&&(e._lastFetchedIndex+=1,!(void 0===this._featureCache[e._known[a]]&&(e._known[a]!==t&&n.push(e._known[a]),n.length>r)));a++);return 0===n.length?Object(l.s)("success"):Object(l.r)(new Error("Unaccounted for Features. Not in Feature Collection"))}},{key:"_refineSetBlock",value:function(e){return Object(l.s)(e)}},{key:"_stat",value:function(){return Object(l.s)({calculated:!1})}},{key:"_canDoAggregates",value:function(){return Object(l.s)(!1)}},{key:"relationshipMetaData",value:function(){return[]}},{key:"nativeCapabilities",value:function(){return{title:this._layer.title,canQueryRelated:!1,source:this,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:!0}}},{key:"queryAttachments",value:function(){return Object(l.s)([])}},{key:"getFeatureByObjectId",value:function(e){var t=new _.a;return t.where=this.objectIdField+"="+e.toString(),this._layer.queryFeatures(t).then((function(e){return 1===e.features.length?e.features[0]:null}))}},{key:"getOwningSystemUrl",value:function(){return Object(l.s)("")}},{key:"getIdentityUser",value:function(){return Object(l.s)("")}},{key:"gdbVersion",get:function(){return""}}],[{key:"_cloneAttr",value:function(e){var t={};for(var r in e)t[r]=e[r];return t}},{key:"create",value:function(e,t){var a=e.layerDefinition.objectIdField,i=e.layerDefinition.typeIdField?e.layerDefinition.typeIdField:"",s=[];if(e.layerDefinition.types){var u,l=Object(n.a)(e.layerDefinition.types);try{for(l.s();!(u=l.n()).done;){var c=u.value;s.push(v.a.fromJSON(c))}}catch(G){l.e(G)}finally{l.f()}}var d=e.layerDefinition.geometryType;void 0===d&&(d=e.featureSet.geometryType||"");var h=e.featureSet.features,p=t.toJSON();if(""===a||void 0===a){var y,_=!1,b=Object(n.a)(e.layerDefinition.fields);try{for(b.s();!(y=b.n()).done;){var m=y.value;if("oid"===m.type||"esriFieldTypeOID"===m.type){a=m.name,_=!0;break}}}catch(G){b.e(G)}finally{b.f()}if(!1===_){for(var O="FID",j=!0,S=0;j;){var w,k=!0,F=Object(n.a)(e.layerDefinition.fields);try{for(F.s();!(w=F.n()).done;){if(w.value.name===O){k=!1;break}}}catch(G){F.e(G)}finally{F.f()}!0===k?j=!1:O="FID"+(++S).toString()}e.layerDefinition.fields.push({type:"esriFieldTypeOID",name:O,alias:O});for(var I=[],x=0;x<h.length;x++)I.push({geometry:e.featureSet.features[x].geometry,attributes:e.featureSet.features[x].attributes?this._cloneAttr(e.featureSet.features[x].attributes):{}}),I[x].attributes[O]=x;h=I,a=O}}var C,T=[],R=Object(n.a)(e.layerDefinition.fields);try{for(R.s();!(C=R.n()).done;){var D=C.value;D instanceof f.a?T.push(D):T.push(f.a.fromJSON(D))}}catch(G){R.e(G)}finally{R.f()}var E=d;switch(E){case"esriGeometryPoint":E="point";break;case"esriGeometryPolyline":E="polyline";break;case"esriGeometryPolygon":E="polygon";break;case"esriGeometryExtent":E="extent";break;case"esriGeometryMultipoint":E="multipoint"}var N,P=Object(n.a)(h);try{for(P.s();!(N=P.n()).done;){var A=N.value;A.geometry&&A.geometry instanceof o.a==0&&(A.geometry.type=E,void 0===A.geometry.spatialReference&&(A.geometry.spatialReference=p))}}catch(G){P.e(G)}finally{P.f()}var L={outFields:["*"],source:h,fields:T,types:s,typeIdField:i,objectIdField:a,spatialReference:t};return L.geometryType=E||"point",new r({layer:new g.default(L),spatialReference:t,isTable:null===E||""===E})}}]),r}(y.a);t.a=b},968:function(e,t,r){"use strict";r.r(t),r.d(t,"constructAssociationMetaDataFeatureSetFromUrl",(function(){return re})),r.d(t,"constructFeatureSet",(function(){return ee})),r.d(t,"constructFeatureSetFromPortalItem",(function(){return ce})),r.d(t,"constructFeatureSetFromRelationship",(function(){return ne})),r.d(t,"constructFeatureSetFromUrl",(function(){return $})),r.d(t,"createFeatureSetCollectionFromMap",(function(){return se})),r.d(t,"createFeatureSetCollectionFromService",(function(){return ue})),r.d(t,"getPortal",(function(){return le})),r.d(t,"initialiseMetaDataCache",(function(){return Z})),r.d(t,"lookupUser",(function(){return oe}));var n=r(11),a=r(2),i=r(3),s=r(4),u=r(5),l=r(16),o=r(15),c=r(88),f=r(58),d=r(75),h=r(266),p=r(757),y=r(872),v=r(800),_=r(678),g=r(820),b=r(821),m=r(36),O=r(206),j=r(758),S=r(294),w=r(760),k=r(767),F=r(782),I=r(392),x=r(762),C=r(873),T=r(822),R=function(){function e(){Object(a.a)(this,e)}return Object(i.a)(e,[{key:"clone",value:function(){var t=new e;return t.field=this.field,t.tofieldname=this.tofieldname,t.typeofstat=this.typeofstat,t.workingexpr=this.workingexpr,t}},{key:"toStatisticsName",value:function(){switch(this.typeofstat.toUpperCase()){case"MIN":return"min";case"MAX":return"max";case"SUM":return"sum";case"COUNT":return"count";case"VAR":return"var";case"STDDEV":return"stddev";case"AVG":return"avg";default:return"count"}}}],[{key:"parseStatField",value:function(t,r,n){var a=new e;a.field=t;var i=_.WhereClause.create(r,n),s=function(e){if("function"===e.parseTree.type){if(0===e.parseTree.args.value.length)return{name:e.parseTree.name,expr:null};if(e.parseTree.args.value.length>1)throw new Error("Statistic does not have 1 or 0 Parameters");var t=_.WhereClause.create(Object(k.j)(e.parseTree.args.value[0],p.a.Standardised,e.parameters),e.fieldsIndex);return{name:e.parseTree.name,expr:t}}return null}(i);if(null===s)throw new Error("Invalid Statistic Function");var u=s.name.toUpperCase().trim();if("MIN"===u){if(a.typeofstat="MIN",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else if("MAX"===u){if(a.typeofstat="MAX",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else if("COUNT"===u)a.typeofstat="COUNT",a.workingexpr=s.expr;else if("STDEV"===u){if(a.typeofstat="STDDEV",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else if("SUM"===u){if(a.typeofstat="SUM",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else if("MEAN"===u){if(a.typeofstat="AVG",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else if("AVG"===u){if(a.typeofstat="AVG",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else{if("VAR"!==u)throw new Error("Invalid Statistic Function");if(a.typeofstat="VAR",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}return a}}]),e}(),D=r(801);function E(e){if(!e)return"COUNT";switch(e.toLowerCase()){case"max":return"MAX";case"var":case"variance":return"VAR";case"avg":case"average":case"mean":return"AVG";case"min":return"MIN";case"sum":return"SUM";case"stdev":case"stddev":return"STDDEV";case"count":return"COUNT"}return"COUNT"}var N=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e))._decodedStatsfield=[],n._decodedGroupbyfield=[],n._candosimplegroupby=!0,n.phsyicalgroupbyfields=[],n.objectIdField="ROW__ID",n._internalObjectIdField="ROW__ID",n._adaptedFields=[],n.declaredClass="esri.arcade.featureset.actions.Aggregate",n._uniqueIds=1,n._maxQuery=10,n._maxProcessing=10,n._parent=e.parentfeatureset,n._config=e,n}return Object(i.a)(r,[{key:"isTable",value:function(){return!0}},{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._getFilteredSet("",null,null,null,e).then((function(e){return t._wset=e,t._wset})):Object(o.s)(this._wset)}},{key:"_isInFeatureSet",value:function(){return p.b.InFeatureSet}},{key:"nextUniqueName",value:function(e){for(;1===e["T"+this._uniqueIds.toString()];)this._uniqueIds++;var t="T"+this._uniqueIds.toString();return e[t]=1,t}},{key:"convertToEsriFieldType",value:function(e){return e}},{key:"_initialiseFeatureSet",value:function(){var e={},t=!1,r=1,n=this._parent?this._parent.getFieldsIndex():new I.a([]);for(this.objectIdField="ROW__ID",this.globalIdField="";!1===t;){for(var a=!1,i=0;i<this._config.groupbyfields.length;i++)if(this._config.groupbyfields[i].name.toLowerCase()===this.objectIdField.toLowerCase()){a=!0;break}if(!1===a)for(var s=0;s<this._config.statsfields.length;s++)if(this._config.statsfields[s].name.toLowerCase()===this.objectIdField.toLowerCase()){a=!0;break}!1===a?t=!0:(this.objectIdField="ROW__ID"+r.toString(),r++)}var u,o=Object(l.a)(this._config.statsfields);try{for(o.s();!(u=o.n()).done;){var c=u.value,f=new R;f.field=c.name,f.tofieldname=c.name,f.workingexpr=c.expression instanceof _.WhereClause?c.expression:_.WhereClause.create(c.expression,n),f.typeofstat=E(c.statistic),this._decodedStatsfield.push(f)}}catch(M){o.e(M)}finally{o.f()}this._decodedGroupbyfield=[];var d,h=Object(l.a)(this._config.groupbyfields);try{for(h.s();!(d=h.n()).done;){var y=d.value,v={name:y.name,singlefield:null,tofieldname:y.name,expression:y.expression instanceof _.WhereClause?y.expression:_.WhereClause.create(y.expression,n)};this._decodedGroupbyfield.push(v)}}catch(M){h.e(M)}finally{h.f()}if(null!==this._parent){this.geometryType=this._parent.geometryType,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField="";var g,b=Object(l.a)(this._parent.fields);try{for(b.s();!(g=b.n()).done;){e[g.value.name.toUpperCase()]=1}}catch(M){b.e(M)}finally{b.f()}this.types=null}else this.geometryType=p.m.point,this.typeIdField="",this.types=null,this.spatialReference=new m.a({wkid:4326});this.fields=[];var O=new R;O.field=this.nextUniqueName(e),O.tofieldname=this.objectIdField,O.workingexpr=_.WhereClause.create(this._parent.objectIdField,this._parent.getFieldsIndex()),O.typeofstat="MIN",this._decodedStatsfield.push(O);var j,w=Object(l.a)(this._decodedGroupbyfield);try{for(w.s();!(j=w.n()).done;){var F=j.value,x=new S.a;if(F.name=this.nextUniqueName(e),x.name=F.tofieldname,x.alias=x.name,Object(k.c)(F.expression)){var T=this._parent.getField(Object(k.i)(F.expression,p.a.Standardised));if(!T)throw new Error("Field is not present for Aggregation");F.name=T.name,F.singlefield=T.name,this.phsyicalgroupbyfields.push(T.name),x.type=T.type}else{x.type=this.convertToEsriFieldType(Object(k.f)(F.expression,this._parent.fields));var D=new S.a;D.name=F.name,D.alias=D.name,this.phsyicalgroupbyfields.push(F.name),this._adaptedFields.push(new C.d(D,F.expression)),this._candosimplegroupby=!1}this.fields.push(x)}}catch(M){w.e(M)}finally{w.f()}if(this._adaptedFields.length>0){var N,P=Object(l.a)(this._parent.fields);try{for(P.s();!(N=P.n()).done;){var A=N.value;this._adaptedFields.push(new C.c(A))}}catch(M){P.e(M)}finally{P.f()}}for(var L=0;L<this._decodedStatsfield.length;L++){var G=new S.a,q=null,B=this._decodedStatsfield[L];B.field=this.nextUniqueName(e),B.tofieldname===this.objectIdField&&(this._internalObjectIdField=B.field),G.name=B.tofieldname,G.alias=G.name;var U=null!==B.workingexpr&&Object(k.c)(B.workingexpr)?Object(k.i)(B.workingexpr,p.a.Standardised):"";switch(this._decodedStatsfield[L].typeofstat){case"SUM":if(""!==U){if(!(q=this._parent.getField(U)))throw new Error("Field is not present for Aggregation");G.type=q.type}else G.type="double";break;case"MIN":case"MAX":if(""!==U){if(!(q=this._parent.getField(U)))throw new Error("Field is not present for Aggregation");G.type=q.type}else G.type="double";break;case"COUNT":G.type="integer";break;case"STDDEV":case"VAR":case"AVG":if(""!==U&&!(q=this._parent.getField(U)))throw new Error("Field is not present for Aggregation");G.type="double"}this.fields.push(G)}}},{key:"_canDoAggregates",value:function(){return Object(o.s)(!1)}},{key:"_getFeatures",value:function(e,t,r,n){var a=this;-1!==t&&this._featureCache[t];var i=this._maxQuery;return!0===this._checkIfNeedToExpandKnownPage(e,i)?this._expandPagedSet(e,i,0,0,n).then((function(){return a._getFeatures(e,t,r,n)})):Object(o.s)("success")}},{key:"_getFilteredSet",value:function(e,t,r,n,a){var i=this;if(""!==e)return Object(o.s)(new w.a([],[],!0,null));var s=null,u={ordered:!1,nowhereclause:!1};return this._ensureLoaded().then((function(){if(null!==r)for(var e=0;e<i._decodedStatsfield.length;e++)if(!0===Object(k.h)(r,i._decodedStatsfield[e].tofieldname)){u.nowhereclause=!0,r=null;break}if(null!==n){u.ordered=!0;for(var t=0;t<i._decodedStatsfield.length;t++)if(!0===n.scanForField(i._decodedStatsfield[t].tofieldname)){n=null,u.ordered=!1;break}if(null!==n){var a,s=Object(l.a)(i._decodedGroupbyfield);try{for(s.s();!(a=s.n()).done;){var c=a.value;if(null===c.singlefield&&!0===n.scanForField(c.tofieldname)){n=null,u.ordered=!1;break}}}catch(f){s.e(f)}finally{s.f()}}}return!1===i._candosimplegroupby?Object(o.s)(!1):i._parent._canDoAggregates(i.phsyicalgroupbyfields,i._decodedStatsfield,"",null,null)})).then((function(e){if(e){var t=null;r&&(t=i._reformulateWhereClauseWithoutGroupByFields(r));var l=null;return n&&(l=i._reformulateOrderClauseWithoutGroupByFields(n)),i._parent._getAggregatePagesDataSourceDefinition(i.phsyicalgroupbyfields,i._decodedStatsfield,"",null,t,l,i._internalObjectIdField).then((function(e){return i._checkCancelled(a),s=!0===u.nowhereclause?new w.a(e._candidates.slice(0).concat(e._known.slice(0)),[],!0===u.ordered&&e._ordered,i._clonePageDefinition(e.pagesDefinition)):new w.a(e._candidates.slice(0),e._known.slice(0),!0===u.ordered&&e._ordered,i._clonePageDefinition(e.pagesDefinition))}))}var o=i._parent;if(i._adaptedFields.length>0&&(o=new C.a({parentfeatureset:i._parent,adaptedFields:i._adaptedFields,extraFilter:null})),!0===u.nowhereclause)s=new w.a(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:i._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new b.a({parentfeatureset:o,orderbyclause:new T.a(i.phsyicalgroupbyfields.join(",")+","+i._parent.objectIdField+" ASC")})}});else{var c=o;if(null!==r){var f=null;r&&(f=i._reformulateWhereClauseWithoutGroupByFields(r)),c=new g.a({parentfeatureset:c,whereclause:f})}s=new w.a(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:i._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new b.a({parentfeatureset:c,orderbyclause:new T.a(i.phsyicalgroupbyfields.join(",")+","+i._parent.objectIdField+" ASC")})}})}return s}))}},{key:"_reformulateWhereClauseWithoutStatsFields",value:function(e){var t,r=Object(l.a)(this._decodedStatsfield);try{for(r.s();!(t=r.n()).done;){var n=t.value;e=Object(k.g)(e,n.tofieldname,Object(k.i)(n.workingexpr,p.a.Standardised),this._parent.getFieldsIndex())}}catch(a){r.e(a)}finally{r.f()}return e}},{key:"_reformulateWhereClauseWithoutGroupByFields",value:function(e){var t,r=Object(l.a)(this._decodedGroupbyfield);try{for(r.s();!(t=r.n()).done;){var n=t.value;n.tofieldname!==n.name&&(e=Object(k.g)(e,n.tofieldname,Object(k.i)(n.expression,p.a.Standardised),this._parent.getFieldsIndex()))}}catch(a){r.e(a)}finally{r.f()}return e}},{key:"_reformulateOrderClauseWithoutGroupByFields",value:function(e){var t,r=[],n=Object(l.a)(this._decodedGroupbyfield);try{for(n.s();!(t=n.n()).done;){var a=t.value;a.tofieldname!==a.name&&r.push({field:a.tofieldname,newfield:a.name})}}catch(i){n.e(i)}finally{n.f()}return r.length>0?e.replaceFields(r):e}},{key:"_clonePageDefinition",value:function(e){return null===e?null:!0===e.aggregatefeaturesetpagedefinition?{aggregatefeaturesetpagedefinition:!0,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,internal:e.internal}:this._parent._clonePageDefinition(e)}},{key:"_refineSetBlock",value:function(e,t,r){var n=this;try{if(!0===this._checkIfNeedToExpandCandidatePage(e,this._maxQuery))return this._expandPagedSet(e,this._maxQuery,0,0,r).then((function(){return n._refineSetBlock(e,t,r)}));this._checkCancelled(r);e._candidates.length;return this._refineKnowns(e,t),e._candidates.length,e._candidates.length,Object(o.s)(e)}catch(a){return Object(o.r)(a)}}},{key:"_expandPagedSet",value:function(e,t,r,n,a){return this._expandPagedSetFeatureSet(e,t,r,n,a)}},{key:"_getPhysicalPage",value:function(e,t,r){var n=this;return!0===e.pagesDefinition.aggregatefeaturesetpagedefinition?Object(o.c)((function(t,a){n._sequentialGetPhysicalItem(e,e.pagesDefinition.resultRecordCount,r,[]).then((function(e){t(e)}),a)})):this._getAgregagtePhysicalPage(e,t,r).then((function(e){var t,r=Object(l.a)(e);try{for(r.s();!(t=r.n()).done;){var a,i=t.value,s={geometry:i.geometry,attributes:{}},u=Object(l.a)(n._decodedGroupbyfield);try{for(u.s();!(a=u.n()).done;){var o=a.value;s.attributes[o.tofieldname]=i.attributes[o.name]}}catch(h){u.e(h)}finally{u.f()}var c,f=Object(l.a)(n._decodedStatsfield);try{for(f.s();!(c=f.n()).done;){var d=c.value;s.attributes[d.tofieldname]=i.attributes[d.field]}}catch(h){f.e(h)}finally{f.f()}n._featureCache[s.attributes[n.objectIdField]]=new O.a(s)}}catch(h){r.e(h)}finally{r.f()}return e.length}))}},{key:"_sequentialGetPhysicalItem",value:function(e,t,r,n){var a=this;return Object(o.c)((function(i,s){null===e.pagesDefinition.internal.iterator&&(e.pagesDefinition.internal.iterator=e.pagesDefinition.internal.subfeatureset.iterator(r)),!0===e.pagesDefinition.internal.fullyResolved||0===t?i(n.length):a._nextAggregateItem(e,t,r,n,(function(s){null===s?i(n.length):(t-=1,i(a._sequentialGetPhysicalItem(e,t,r,n)))}),s)}))}},{key:"_nextAggregateItem",value:function(e,t,r,n,a,i){var s=this;try{Object(j.q)(e.pagesDefinition.internal.iterator.next()).then((function(u){if(null===u)if(null!==e.pagesDefinition.internal.workingItem){var l=s._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);n.push(l),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(l.attributes[s.objectIdField]),e.pagesDefinition.internal.fullyResolved=!0,a(null)}else e.pagesDefinition.internal.fullyResolved=!0,a(null);else{var o=s._generateAggregateHash(u);if(null===e.pagesDefinition.internal.workingItem)e.pagesDefinition.internal.workingItem={features:[u],id:o};else{if(o!==e.pagesDefinition.internal.workingItem.id){var c=s._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);return n.push(c),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(c.attributes[s.objectIdField]),t-=1,e.pagesDefinition.internal.workingItem={features:[u],id:o},void a(c)}e.pagesDefinition.internal.workingItem.features.push(u)}s._nextAggregateItem(e,t,r,n,a,i)}}),i)}catch(e){i(e)}}},{key:"_calculateFieldStat",value:function(e,t,r){for(var n=[],a=0;a<e.features.length;a++)if(null!==t.workingexpr){var i=t.workingexpr.calculateValue(e.features[a]);null!==i&&n.push(i)}else n.push(null);switch(t.typeofstat){case"MIN":r.attributes[t.tofieldname]=Object(F.a)("min",n,-1);break;case"MAX":r.attributes[t.tofieldname]=Object(F.a)("max",n,-1);break;case"SUM":r.attributes[t.tofieldname]=Object(F.a)("sum",n,-1);break;case"COUNT":r.attributes[t.tofieldname]=n.length;break;case"VAR":r.attributes[t.tofieldname]=Object(F.a)("var",n,-1);break;case"STDDEV":r.attributes[t.tofieldname]=Object(F.a)("stddev",n,-1);break;case"AVG":r.attributes[t.tofieldname]=Object(F.a)("avg",n,-1)}return!0}},{key:"_calculateAndAppendAggregateItem",value:function(e){var t,r={attributes:{},geometry:null},n=Object(l.a)(this._decodedGroupbyfield);try{for(n.s();!(t=n.n()).done;){var a=t.value,i=a.singlefield?e.features[0].attributes[a.singlefield]:a.expression.calculateValue(e.features[0]);r.attributes[a.tofieldname]=i}}catch(d){n.e(d)}finally{n.f()}var s,u=Object(l.a)(this._decodedStatsfield);try{for(u.s();!(s=u.n()).done;){var o=s.value;this._calculateFieldStat(e,o,r)}}catch(d){u.e(d)}finally{u.f()}for(var c=[],f=0;f<this._decodedStatsfield.length;f++)c.push(this._calculateFieldStat(e,this._decodedStatsfield[f],r));return this._featureCache[r.attributes[this.objectIdField]]=new O.a({attributes:r.attributes,geometry:r.geometry}),r}},{key:"_generateAggregateHash",value:function(e){var t,r="",n=Object(l.a)(this._decodedGroupbyfield);try{for(n.s();!(t=n.n()).done;){var a=t.value,i=a.singlefield?e.attributes[a.singlefield]:a.expression.calculateValue(e);r+=null==i?":":":"+i.toString()}}catch(s){n.e(s)}finally{n.f()}return Object(D.a)(r,D.b.String)}},{key:"_stat",value:function(){return Object(o.s)({calculated:!1})}},{key:"getFeatureByObjectId",value:function(){return Object(o.s)(null)}}],[{key:"registerAction",value:function(){x.a._featuresetFunctions.groupby=function(e,t){return new r({parentfeatureset:this,groupbyfields:e,statsfields:t})}}}]),r}(x.a),P=r(840),A=r(874),L=r(679),G=r(182),q=r(807),B=r(761),U=r(677),M=r(410),W=r(349),V=r(835),Q=r(680),J=r(803),Y=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic",n._removeGeometry=!1,n._overrideFields=null,n.formulaCredential=null,n._pageJustIds=!1,n._requestStandardised=!1,e.spatialReference&&(n.spatialReference=e.spatialReference),n._transparent=!0,n._maxProcessing=1e3,n._layer=e.layer,n._wset=null,void 0!==e.outFields&&(n._overrideFields=e.outFields),void 0!==e.includeGeometry&&(n._removeGeometry=!1===e.includeGeometry),n}return Object(i.a)(r,[{key:"_maxQueryRate",value:function(){return p.f}},{key:"end",value:function(){return this._layer}},{key:"optimisePagingFeatureQueries",value:function(e){this._pageJustIds=e}},{key:"convertQueryToLruCacheKey",value:function(e){var t=Object(p.q)(e.toJSON());return Object(D.a)(t,D.b.String)}},{key:"load",value:function(){var e=this;return null===this._loadPromise&&(this._loadPromise=Object(o.c)((function(t,r){try{if(!0===e._layer.loaded)return e._initialiseFeatureSet(),void t(e);e._layer.when().then((function(){try{e._initialiseFeatureSet(),t(e)}catch(t){r(t)}}),r),e._layer.load()}catch(t){r(t)}}))),this._loadPromise}},{key:"_initialiseFeatureSet",value:function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&"*"===this._layer.outFields[0]);else{var e,t=[],r=Object(l.a)(this.fields);try{for(r.s();!(e=r.n()).done;){var n=e.value;if("oid"===n.type)t.push(n);else{var a,i=Object(l.a)(this._layer.outFields);try{for(i.s();!(a=i.n()).done;){if(a.value.toLowerCase()===n.name.toLowerCase()){t.push(n);break}}}catch(b){i.e(b)}finally{i.f()}}}}catch(b){r.e(b)}finally{r.f()}this.fields=t}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{var s,u=[],o=[],c=Object(l.a)(this.fields);try{for(c.s();!(s=c.n()).done;){var f=s.value;if("oid"===f.type)u.push(f),o.push(f.name);else{var d,h=Object(l.a)(this._overrideFields);try{for(h.s();!(d=h.n()).done;){if(d.value.toLowerCase()===f.name.toLowerCase()){u.push(f),o.push(f.name);break}}}catch(b){h.e(b)}finally{h.f()}}}}catch(b){c.e(b)}finally{c.f()}this.fields=u,this._overrideFields=o}if(this._layer.source&&this._layer.source.sourceJSON){var y=this._layer.source.sourceJSON.currentVersion;!0===this._layer.source.sourceJSON.useStandardizedQueries?(this._databaseType=p.a.StandardisedNoInterval,null!=y&&y>=10.61&&(this._databaseType=p.a.Standardised)):null!=y&&(y>=10.5&&(this._databaseType=p.a.StandardisedNoInterval,this._requestStandardised=!0),y>=10.61&&(this._databaseType=p.a.Standardised))}this.objectIdField=this._layer.objectIdField;var v,_=Object(l.a)(this.fields);try{for(_.s();!(v=_.n()).done;){var g=v.value;"global-id"===g.type&&(this.globalIdField=g.name)}}catch(b){_.e(b)}finally{_.f()}this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types}},{key:"_isInFeatureSet",value:function(){return p.b.InFeatureSet}},{key:"_refineSetBlock",value:function(e){return Object(o.s)(e)}},{key:"_candidateIdTransform",value:function(e){return e}},{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._getFilteredSet("",null,null,null,e)})).then((function(e){return t._wset=e,e})):Object(o.s)(this._wset)}},{key:"_runDatabaseProbe",value:function(e){var t=this;return Object(o.c)((function(r,n){try{t._ensureLoaded().then((function(){try{var a=new W.a;a.where=e.replace("OBJECTID",t._layer.objectIdField),t._layer.queryObjectIds(a).then((function(){r(!0)}),(function(){try{r(!1)}catch(r){n(r)}}))}catch(r){n(r)}}))}catch(r){n(r)}}))}},{key:"_canUsePagination",value:function(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)}},{key:"_cacheableFeatureSetSourceKey",value:function(){return this._layer.url}},{key:"pbfSupportedForQuery",value:function(e){return!e.outStatistics&&this._layer&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsFormatPBF&&!0===this._layer.capabilities.query.supportsQuantizationEditMode}},{key:"queryPBF",value:function(e){return e.quantizationParameters={mode:"edit"},Object(Q.executeQueryPBF)(this._layer.parsedUrl,e,new V.b({})).then((function(e){return U.default.fromJSON(Object(B.g)(e.data)).unquantize()}))}},{key:"nativeCapabilities",value:function(){return{title:this._layer.title,source:this,canQueryRelated:!0,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:this._requestStandardised}}},{key:"executeQuery",value:function(e,t){var r=this,n=new J.a({url:this._layer.parsedUrl.path}),a="execute"===t&&this.pbfSupportedForQuery(e),i=null;if(this.recentlyUsedQueries){var s=this.convertQueryToLruCacheKey(e);null===(i=this.recentlyUsedQueries.getFromCache(s))&&(i=!0!==a?n[t](e):this.queryPBF(e),this.recentlyUsedQueries.addToCache(s,i),i=i.catch((function(e){throw r.recentlyUsedQueries.removeFromCache(s),e})))}return null===i&&(i=!0!==a?n[t](e):this.queryPBF(e)),i}},{key:"_getFilteredSet",value:function(e,t,r,n,a){var i=this;return this.databaseType().then((function(s){if(i.isTable()&&t&&null!==e&&""!==e)return new w.a([],[],!0,null);if(i._canUsePagination())return i._getFilteredSetUsingPaging(e,t,r,n,a);var u="",l=!1;null!==n&&i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsOrderBy&&(u=n.constructClause(),l=!0);var o=new W.a;return o.where=null===r?null===t?"1=1":"":Object(k.i)(r,s),i._requestStandardised&&(o.sqlFormat="standard"),o.spatialRelationship=i._makeRelationshipEnum(e),o.outSpatialReference=i.spatialReference,o.orderByFields=""!==u?u.split(","):null,o.geometry=null===t?null:t,o.relationParameter=i._makeRelationshipParam(e),i.executeQuery(o,"executeForIds").then((function(e){return null===e&&(e=[]),i._checkCancelled(a),new w.a([],e,l,null)}))}))}},{key:"_expandPagedSet",value:function(e,t,r,n,a){return this._expandPagedSetFeatureSet(e,t,r,n,a)}},{key:"_getFilteredSetUsingPaging",value:function(e,t,r,n,a){var i=this;try{var s="",u=!1;return null!==n&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(s=n.constructClause(),u=!0),this.databaseType().then((function(n){var l=null===r?null===t?"1=1":"":Object(k.i)(r,n);i._layer.definitionExpression&&(l=""!==l?"(("+i._layer.definitionExpression+") AND ("+l+"))":i._layer.definitionExpression);var o=i._maxQueryRate(),c=i._layer.capabilities.query.maxRecordCount;void 0!==c&&c<o&&(o=c);var f=null;if(!0===i._pageJustIds)f=new w.a([],["GETPAGES"],u,{spatialRel:i._makeRelationshipEnum(e),relationParam:i._makeRelationshipParam(e),outFields:i._layer.objectIdField,resultRecordCount:o,resultOffset:0,geometry:null===t?null:t,where:l,orderByFields:s,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}});else{var d=!0;!0===i._removeGeometry&&(d=!1);var h=null!==i._overrideFields?i._overrideFields:i._fieldsIncludingObjectId(i._layer.outFields?i._layer.outFields:["*"]);f=new w.a([],["GETPAGES"],u,{spatialRel:i._makeRelationshipEnum(e),relationParam:i._makeRelationshipParam(e),outFields:h.join(","),resultRecordCount:o,resultOffset:0,geometry:null===t?null:t,where:l,orderByFields:s,returnGeometry:d,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}return i._expandPagedSet(f,o,0,1,a).then((function(){return f}))}))}catch(e){return Object(o.r)(e)}}},{key:"_clonePageDefinition",value:function(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}},{key:"_getPhysicalPage",value:function(e,t,r){var n=this;try{var a=e.pagesDefinition.internal.lastRetrieved,i=a,s=e.pagesDefinition.internal.lastPage,u=new W.a;return this._requestStandardised&&(u.sqlFormat="standard"),u.spatialRelationship=e.pagesDefinition.spatialRel,u.relationParameter=e.pagesDefinition.relationParam,u.outFields=e.pagesDefinition.outFields.split(","),u.num=e.pagesDefinition.resultRecordCount,u.start=e.pagesDefinition.internal.lastPage,u.geometry=e.pagesDefinition.geometry,u.where=e.pagesDefinition.where,u.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,u.returnGeometry=e.pagesDefinition.returnGeometry,u.outSpatialReference=this.spatialReference,this.executeQuery(u,"execute").then((function(t){if(n._checkCancelled(r),e.pagesDefinition.internal.lastPage!==s)return"done";for(var u=0;u<t.features.length;u++)e.pagesDefinition.internal.set[i+u]=t.features[u].attributes[n._layer.objectIdField];if(!1===n._pageJustIds)for(var l=0;l<t.features.length;l++)n._featureCache[t.features[l].attributes[n._layer.objectIdField]]=t.features[l];return(void 0===t.exceededTransferLimit&&t.features.length!==e.pagesDefinition.resultRecordCount||!1===t.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=a+t.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,"done"}))}catch(e){return Object(o.r)(e)}}},{key:"_fieldsIncludingObjectId",value:function(e){if(null===e)return[this.objectIdField];var t=e.slice(0);if(t.indexOf("*")>-1)return t;var r,n=!1,a=Object(l.a)(t);try{for(a.s();!(r=a.n()).done;){if(r.value.toUpperCase()===this.objectIdField.toUpperCase()){n=!0;break}}}catch(i){a.e(i)}finally{a.f()}return!1===n&&t.push(this.objectIdField),t}},{key:"_getFeatures",value:function(e,t,r,n){var a=this,i=[];try{if(-1!==t&&void 0===this._featureCache[t]&&i.push(t),!0===this._checkIfNeedToExpandKnownPage(e,this._maxProcessingRate()))return this._expandPagedSet(e,this._maxProcessingRate(),0,0,n).then((function(){return a._getFeatures(e,t,r,n)}));for(var s=0,u=e._lastFetchedIndex;u<e._known.length;u++){if(e._lastFetchedIndex+=1,s++,void 0===this._featureCache[e._known[u]]){var l=!1;if(null!==this._layer._mode&&void 0!==this._layer._mode){var c=this._layer._mode;if(void 0!==c._featureMap[e._known[u]]){var f=c._featureMap[e._known[u]];null!==f&&(l=!0,this._featureCache[e._known[u]]=f)}}if(!1===l&&(e._known[u]!==t&&i.push(e._known[u]),i.length>=this._maxProcessingRate()-1))break}if(s>=r&&0===i.length)break}if(0===i.length)return Object(o.s)("success");try{var d=new W.a;return this._requestStandardised&&(d.sqlFormat="standard"),d.objectIds=i,d.outFields=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._layer.outFields?this._layer.outFields:["*"]),d.returnGeometry=!0,!0===this._removeGeometry&&(d.returnGeometry=!1),d.outSpatialReference=this.spatialReference,this.executeQuery(d,"execute").then((function(e){if(a._checkCancelled(n),void 0!==e.error)return Object(o.r)(new Error(e.error));for(var t=0;t<e.features.length;t++)a._featureCache[e.features[t].attributes[a._layer.objectIdField]]=e.features[t];return"success"}))}catch(e){return Object(o.r)(e)}}catch(e){return Object(o.r)(e)}}},{key:"_getDistinctPages",value:function(e,t,r,n,a,i,s,u,l){var c=this;return this._ensureLoaded().then((function(){return c.databaseType()})).then((function(f){for(var d=r.parseTree.column,h=0;h<c._layer.fields.length;h++)if(c._layer.fields[h].name.toLowerCase()===d.toLowerCase()){d=c._layer.fields[h].name;break}var p=new W.a;c._requestStandardised&&(p.sqlFormat="standard");var y=null===i?null===a?"1=1":"":Object(k.i)(i,f);return c._layer.definitionExpression&&(y=""!==y?"(("+c._layer.definitionExpression+") AND ("+y+"))":c._layer.definitionExpression),p.where=y,p.spatialRelationship=c._makeRelationshipEnum(n),p.relationParameter=c._makeRelationshipParam(n),p.geometry=null===a?null:a,p.returnDistinctValues=!0,p.returnGeometry=!1,p.outFields=[d],c.executeQuery(p,"execute").then((function(f){if(c._checkCancelled(l),!f.hasOwnProperty("features"))return Object(o.r)(new Error("Unnexected Result querying statistics from layer"));for(var h=!1,p=0;p<c._layer.fields.length;p++)if(c._layer.fields[p].name===d){"date"===c._layer.fields[p].type&&(h=!0);break}for(var y=0;y<f.features.length;y++){if(h){var v=f.features[y].attributes[d];null!==v?u.push(new Date(v)):u.push(v)}else u.push(f.features[y].attributes[d]);if(u.length>=s)break}return 0===f.features.length?u:f.features.length===c._layer.capabilities.query.maxRecordCount&&u.length<s?c._getDistinctPages(e+f.features.length,t,r,n,a,i,s,u,l).then((function(e){return{calculated:!0,result:e}})):u}))}))}},{key:"_distinctStat",value:function(e,t,r,n,a,i,s){return this._getDistinctPages(0,e,t,r,n,a,i,[],s).then((function(e){return{calculated:!0,result:e}}))}},{key:"isTable",value:function(){return this._layer.isTable||null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType}},{key:"_countstat",value:function(e,t,r,n){var a=this;return this.databaseType().then((function(e){var i=new W.a;if(a._requestStandardised&&(i.sqlFormat="standard"),a.isTable()&&r&&null!==t&&""!==t)return{calculated:!0,result:0};var s=null===n?null===r?"1=1":"":Object(k.i)(n,e);return a._layer.definitionExpression&&(s=""!==s?"(("+a._layer.definitionExpression+") AND ("+s+"))":a._layer.definitionExpression),i.where=s,i.where=s,i.spatialRelationship=a._makeRelationshipEnum(t),i.relationParameter=a._makeRelationshipParam(t),i.geometry=null===r?null:r,i.returnGeometry=!1,a.executeQuery(i,"executeForCount").then((function(e){return{calculated:!0,result:e}}))}))}},{key:"_stats",value:function(e,t,r,n,a,i,s){var u=this;return this._ensureLoaded().then((function(){var l=u._layer.capabilities&&u._layer.capabilities.query&&!0===u._layer.capabilities.query.supportsSqlExpression,c=u._layer.capabilities&&u._layer.capabilities.query&&!0===u._layer.capabilities.query.supportsStatistics,f=u._layer.capabilities&&u._layer.capabilities.query&&!0===u._layer.capabilities.query.supportsDistinct;return"count"===e?f?u._countstat(e,r,n,a):{calculated:!1}:!1===c||!1===Object(k.c)(t)&&!1===l||!1===t.isStandardized?""!==r||null!==a?{calculated:!1}:u._manualStat(e,t,i,s):"distinct"===e?!1===f?""!==r||null!==a?{calculated:!1}:u._manualStat(e,t,i,s):u._distinctStat(e,t,r,n,a,i,s):u.databaseType().then((function(i){if(u.isTable()&&n&&null!==r&&""!==r)return{calculated:!0,result:null};var s=new W.a;u._requestStandardised&&(s.sqlFormat="standard");var l=null===a?null===n?"1=1":"":Object(k.i)(a,i);u._layer.definitionExpression&&(l=""!==l?"(("+u._layer.definitionExpression+") AND ("+l+"))":u._layer.definitionExpression),s.where=l,s.spatialRelationship=u._makeRelationshipEnum(r),s.relationParameter=u._makeRelationshipParam(r),s.geometry=null===n?null:n;var c=new M.a;c.statisticType=Object(F.c)(e),c.onStatisticField=Object(k.i)(t,i),c.outStatisticFieldName="ARCADE_STAT_RESULT",s.returnGeometry=!1;var f="ARCADE_STAT_RESULT";return s.outStatistics=[c],u.executeQuery(s,"execute").then((function(e){if(!e.hasOwnProperty("features")||0===e.features.length)return Object(o.r)(new Error("Unnexected Result querying statistics from layer"));for(var t=!1,r=0;r<e.fields.length;r++)if("ARCADE_STAT_RESULT"===e.fields[r].name.toUpperCase()){f=e.fields[r].name,"date"===e.fields[r].type&&(t=!0);break}if(t){var n=e.features[0].attributes[f];return null!==n&&(n=new Date(e.features[0].attributes[f])),{calculated:!0,result:n}}return{calculated:!0,result:e.features[0].attributes[f]}}))}))}))}},{key:"_stat",value:function(e,t,r,n,a,i,s){return this._stats(e,t,r,n,a,i,s)}},{key:"_canDoAggregates",value:function(e,t){var r=this;return this._ensureLoaded().then((function(){var e=!1,n=r._layer.capabilities&&r._layer.capabilities.query&&!0===r._layer.capabilities.query.supportsSqlExpression;if(void 0!==r._layer.capabilities&&null!==r._layer.capabilities.query&&!0===r._layer.capabilities.query.supportsStatistics&&!0===r._layer.capabilities.query.supportsOrderBy&&(e=!0),e)for(var a=0;a<t.length-1;a++)null!==t[a].workingexpr&&(!1===t[a].workingexpr.isStandardized||!1===Object(k.c)(t[a].workingexpr)&&!1===n)&&(e=!1);return!1!==e}))}},{key:"_makeRelationshipEnum",value:function(e){if(e.indexOf("esriSpatialRelRelation")>=0)return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}},{key:"_makeRelationshipParam",value:function(e){return e.indexOf("esriSpatialRelRelation")>=0?e.split(":")[1]:""}},{key:"_getAggregatePagesDataSourceDefinition",value:function(e,t,r,n,a,i,s){var u=this;return this._ensureLoaded().then((function(){return u.databaseType()})).then((function(l){var o="",c=!1,f=!1;null!==i&&u._layer.capabilities&&u._layer.capabilities.query&&!0===u._layer.capabilities.query.supportsOrderBy&&(o=i.constructClause(),f=!0),u._layer.capabilities&&u._layer.capabilities.query&&!1===u._layer.capabilities.query.supportsPagination&&(f=!1,c=!0,o=u._layer.objectIdField);for(var d=[],h=0;h<t.length;h++){var p=new M.a;p.onStatisticField=null!==t[h].workingexpr?Object(k.i)(t[h].workingexpr,l):"",p.outStatisticFieldName=t[h].field,p.statisticType=t[h].toStatisticsName(),d.push(p)}""===o&&(o=e.join(","));var y=u._maxQueryRate(),v=u._layer.capabilities.query.maxRecordCount;void 0!==v&&v<y&&(y=v);var _=null===a?null===n?"1=1":"":Object(k.i)(a,l);return u._layer.definitionExpression&&(_=""!==_?"(("+u._layer.definitionExpression+") AND ("+_+"))":u._layer.definitionExpression),new w.a([],["GETPAGES"],f,{groupbypage:!0,spatialRel:u._makeRelationshipEnum(r),relationParam:u._makeRelationshipParam(r),outFields:["*"],useOIDpagination:c,generatedOid:s,resultRecordCount:y,resultOffset:0,groupByFieldsForStatistics:e,outStatistics:d,geometry:null===n?null:n,where:_,orderByFields:o,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}))}},{key:"_getAgregagtePhysicalPage",value:function(e,t,r){var n=this;try{var a=e.pagesDefinition.where;!0===e.pagesDefinition.useOIDpagination&&(a=""!==a?"("+a+") AND ("+e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString()+")":e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString());var i=e.pagesDefinition.internal.lastRetrieved,s=i,u=e.pagesDefinition.internal.lastPage,l=new W.a;return this._requestStandardised&&(l.sqlFormat="standard"),l.where=a,l.spatialRelationship=e.pagesDefinition.spatialRel,l.relationParameter=e.pagesDefinition.relationParam,l.outFields=e.pagesDefinition.outFields,l.outStatistics=e.pagesDefinition.outStatistics,l.geometry=e.pagesDefinition.geometry,l.groupByFieldsForStatistics=e.pagesDefinition.groupByFieldsForStatistics,l.num=e.pagesDefinition.resultRecordCount,l.start=e.pagesDefinition.internal.lastPage,l.returnGeometry=e.pagesDefinition.returnGeometry,l.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,this.isTable()&&l.geometry&&l.spatialRelationship?Object(o.s)([]):this.executeQuery(l,"execute").then((function(t){if(n._checkCancelled(r),!t.hasOwnProperty("features"))return Object(o.r)(new Error("Unnexected Result querying aggregates from layer"));var a=[];if(e.pagesDefinition.internal.lastPage!==u)return[];for(var l=0;l<t.features.length;l++)e.pagesDefinition.internal.set[s+l]=t.features[l].attributes[e.pagesDefinition.generatedOid];for(var c=0;c<t.features.length;c++)a.push(new O.a({attributes:t.features[c].attributes,geometry:null}));return!0===e.pagesDefinition.useOIDpagination?0===t.features.length?e.pagesDefinition.internal.fullyResolved=!0:e.pagesDefinition.internal.lastMaxId=t.features[t.features.length-1].attributes[e.pagesDefinition.generatedOid]:(void 0===t.exceededTransferLimit&&t.features.length!==e.pagesDefinition.resultRecordCount||!1===t.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=i+t.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,a}))}catch(e){return Object(o.r)(e)}}},{key:"relationshipMetaData",value:function(){return this._layer&&this._layer.source&&this._layer.source.sourceJSON&&this._layer.source.sourceJSON.relationships?this._layer.source.sourceJSON.relationships:[]}},{key:"serviceUrl",value:function(){return Object(p.i)(this._layer.parsedUrl.path)}},{key:"queryAttachments",value:function(e,t,r,n){var a=this;if(this._layer.capabilities.data.supportsAttachment&&this._layer.capabilities.operations.supportsQueryAttachments){var i={objectIds:[e]};return(t&&t>0||r&&r>0)&&(i.size=[t&&t>0?t:0,r&&r>0?r:t+1]),n&&n.length>0&&(i.attachmentTypes=n),this._layer.queryAttachments(i).then((function(t){var r=[];return t&&t[e]&&t[e].forEach((function(t){var n=a._layer.parsedUrl.path+"/"+e.toString()+"/attachments/"+t.id.toString();r.push(new q.a(t.id,t.name,t.contentType,t.size,n))})),r}))}return Object(o.s)([])}},{key:"queryRelatedFeatures",value:function(e){var t={f:"json",relationshipId:e.relationshipId.toString(),definitionExpression:e.where,outFields:e.outFields.join(","),returnGeometry:e.returnGeometry.toString()};return void 0!==e.resultOffset&&null!==e.resultOffset&&(t.resultOffset=e.resultOffset.toString()),void 0!==e.resultRecordCount&&null!==e.resultRecordCount&&(t.resultRecordCount=e.resultRecordCount.toString()),e.orderByFields&&(t.orderByFields=e.orderByFields.join(",")),e.objectIds.length>0&&(t.objectIds=e.objectIds.join(",")),e.outSpatialReference&&(t.outSR=JSON.stringify(e.outSpatialReference.toJSON())),Object(f.default)(this._layer.parsedUrl.path+"/queryRelatedRecords",{responseType:"json",query:t}).then((function(e){if(e.data){var t={},r=e.data;if(r&&r.relatedRecordGroups){var n,a=r.spatialReference,i=Object(l.a)(r.relatedRecordGroups);try{for(i.s();!(n=i.n()).done;){var s,u=n.value,c=u.objectId,f=[],d=Object(l.a)(u.relatedRecords);try{for(d.s();!(s=d.n()).done;){var h=s.value;h.geometry&&(h.geometry.spatialReference=a);var p=new O.a({geometry:h.geometry?Object(G.a)(h.geometry):null,attributes:h.attributes});f.push(p)}}catch(y){d.e(y)}finally{d.f()}t[c]={features:f,exceededTransferLimit:!0===r.exceededTransferLimit}}}catch(y){i.e(y)}finally{i.f()}}return t}return Object(o.r)("Invalid Request")}))}},{key:"getFeatureByObjectId",value:function(e,t){var r=new J.a({url:this._layer.parsedUrl.path}),n=new W.a;return n.outFields=t,n.returnGeometry=!1,n.outSpatialReference=this.spatialReference,n.where=this.objectIdField+"="+e.toString(),r.execute(n).then((function(e){return 1===e.features.length?e.features[0]:null}))}},{key:"getIdentityUser",value:function(){var e=this;return this.load().then((function(){var t,r=null==(t=c.b)?void 0:t.findCredential(e._layer.url);return r?r.userId:null}))}},{key:"getOwningSystemUrl",value:function(){var e=this;return this.load().then((function(){var t,r=null==(t=c.b)?void 0:t.findServerInfo(e._layer.url);if(r)return Object(o.s)(r.owningSystemUrl);var n=e._layer.url,a=n.toLowerCase().indexOf("/rest/services");return(n=a>-1?n.substring(0,a):n)?(n+="/rest/info",Object(o.c)((function(e,t){Object(f.default)(n,{query:{f:"json"}}).then((function(t){var r="";t.data&&t.data.owningSystemUrl&&(r=t.data.owningSystemUrl),e(r)}),(function(t){e("")}))}))):Object(o.s)("")}))}},{key:"gdbVersion",get:function(){return this._layer&&this._layer.capabilities&&this._layer.capabilities.data&&this._layer.capabilities.data.isVersioned?this._layer.gdbVersion?this._layer.gdbVersion:"SDE.DEFAULT":""}}],[{key:"create",value:function(e,t,n,a){return new r({layer:new L.default({url:e,outFields:null===t?["*"]:t}),spatialReference:n,lrucache:a})}}]),r}(x.a),z=r(875),K=r(792),H=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).declaredClass="esri.arcade.featureset.sources.FeatureLayerRelated",n._findObjectId=-1,n._requestStandardised=!1,n._removeGeometry=!1,n._overrideFields=null,n.featureObjectId=null,n.relatedLayer=null,n.relationship=null,e.spatialReference&&(n.spatialReference=e.spatialReference),n._transparent=!0,n._maxProcessing=1e3,n._layer=e.layer,n._wset=null,n._findObjectId=e.objectId,n.featureObjectId=e.objectId,n.relationship=e.relationship,n.relatedLayer=e.relatedLayer,void 0!==e.outFields&&(n._overrideFields=e.outFields),void 0!==e.includeGeometry&&(n._removeGeometry=!1===e.includeGeometry),n}return Object(i.a)(r,[{key:"_maxQueryRate",value:function(){return p.f}},{key:"end",value:function(){return this._layer}},{key:"optimisePagingFeatureQueries",value:function(){}},{key:"load",value:function(){var e=this;return null===this._loadPromise&&(this._loadPromise=Object(o.c)((function(t,r){Object(o.b)([e._layer.load(),e.relatedLayer.load()]).then((function(){e._initialiseFeatureSet(),t(e)}),r)}))),this._loadPromise}},{key:"nativeCapabilities",value:function(){return this.relatedLayer.nativeCapabilities()}},{key:"_initialiseFeatureSet",value:function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this.relatedLayer.geometryType,this.fields=this.relatedLayer.fields.slice(0),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{var e,t=[],r=[],n=Object(l.a)(this.fields);try{for(n.s();!(e=n.n()).done;){var a=e.value;if("oid"===a.type)t.push(a),r.push(a.name);else{var i,s=Object(l.a)(this._overrideFields);try{for(s.s();!(i=s.n()).done;){if(i.value.toLowerCase()===a.name.toLowerCase()){t.push(a),r.push(a.name);break}}}catch(o){s.e(o)}finally{s.f()}}}}catch(o){n.e(o)}finally{n.f()}this.fields=t,this._overrideFields=r}var u=this._layer.nativeCapabilities();u&&(this._databaseType=u.databaseType,this._requestStandardised=u.requestStandardised),this.objectIdField=this.relatedLayer.objectIdField,this.globalIdField=this.relatedLayer.globalIdField,this.hasM=this.relatedLayer.supportsM,this.hasZ=this.relatedLayer.supportsZ,this.typeIdField=this.relatedLayer.typeIdField,this.types=this.relatedLayer.types}},{key:"databaseType",value:function(){var e=this;return this.relatedLayer.databaseType().then((function(){return e._databaseType=e.relatedLayer._databaseType,e._databaseType}))}},{key:"isTable",value:function(){return this.relatedLayer.isTable()}},{key:"_isInFeatureSet",value:function(){return p.b.InFeatureSet}},{key:"_candidateIdTransform",value:function(e){return e}},{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._getFilteredSet("",null,null,null,e)})).then((function(e){return t._wset=e,e})):Object(o.s)(this._wset)}},{key:"_changeFeature",value:function(e){var t,r={},n=Object(l.a)(this.fields);try{for(n.s();!(t=n.n()).done;){var a=t.value;r[a.name]=e.attributes[a.name]}}catch(i){n.e(i)}finally{n.f()}return new O.a({geometry:!0===this._removeGeometry?null:e.geometry,attributes:r})}},{key:"_getFilteredSet",value:function(e,t,r,n,a){var i=this;return this.databaseType().then((function(){if(i.isTable()&&t&&null!==e&&""!==e)return new w.a([],[],!0,null);var s=i._layer.nativeCapabilities();if(!1===s.canQueryRelated)return new w.a([],[],!0,null);if(s.capabilities.queryRelated&&s.capabilities.queryRelated.supportsPagination)return i._getFilteredSetUsingPaging(e,t,r,n,a);var u="",l=!1;null!==n&&s.capabilities&&s.capabilities.queryRelated&&!0===s.capabilities.queryRelated.supportsOrderBy&&(u=n.constructClause(),l=!0);var o=new K.a;o.objectIds=[i._findObjectId];var c=null!==i._overrideFields?i._overrideFields:i._fieldsIncludingObjectId(i.relatedLayer.fields?i.relatedLayer.fields.map((function(e){return e.name})):["*"]);o.outFields=c,o.relationshipId=i.relationship.id,o.where="1=1";var f=!0;return!0===i._removeGeometry&&(f=!1),o.returnGeometry=f,i._requestStandardised&&(o.sqlFormat="standard"),o.outSpatialReference=i.spatialReference,o.orderByFields=""!==u?u.split(","):null,s.source.queryRelatedFeatures(o).then((function(n){i._checkCancelled(a);for(var s=n[i._findObjectId]?n[i._findObjectId].features:[],u=[],o=0;o<s.length;o++)i._featureCache[s[o].attributes[i._layer.objectIdField]]=s[o],u.push(s[o].attributes[i._layer.objectIdField]);var c=t&&null!==e&&""!==e,f=null!=r;return new w.a(c||f?u:[],c||f?[]:u,l,null)}))}))}},{key:"_fieldsIncludingObjectId",value:function(e){if(null===e)return[this.objectIdField];var t=e.slice(0);if(t.indexOf("*")>-1)return t;var r,n=!1,a=Object(l.a)(t);try{for(a.s();!(r=a.n()).done;){if(r.value.toUpperCase()===this.objectIdField.toUpperCase()){n=!0;break}}}catch(i){a.e(i)}finally{a.f()}return!1===n&&t.push(this.objectIdField),t}},{key:"_getFilteredSetUsingPaging",value:function(e,t,r,n,a){var i=this;try{var s="",u=!1,l=this._layer.nativeCapabilities();return null!==n&&l&&l.capabilities.queryRelated&&!0===l.capabilities.queryRelated.supportsOrderBy&&(s=n.constructClause(),u=!0),this.databaseType().then((function(){var n=i._maxQueryRate(),o=l.capabilities.query.maxRecordCount;void 0!==o&&o<n&&(n=o);var c,f=t&&null!==e&&""!==e,d=null!=r,h=!0;!0===i._removeGeometry&&(h=!1);var p=null!==i._overrideFields?i._overrideFields:i._fieldsIncludingObjectId(i.relatedLayer.fields?i.relatedLayer.fields.map((function(e){return e.name})):["*"]);return c=new w.a(f||d?["GETPAGES"]:[],f||d?[]:["GETPAGES"],u,{outFields:p.join(","),resultRecordCount:n,resultOffset:0,objectIds:[i._findObjectId],where:"1=1",orderByFields:s,returnGeometry:h,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}),i._expandPagedSet(c,n,0,0,a).then((function(){return c}))}))}catch(e){return Object(o.r)(e)}}},{key:"_expandPagedSet",value:function(e,t,r,n,a){return this._expandPagedSetFeatureSet(e,t,r,n,a)}},{key:"_clonePageDefinition",value:function(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}},{key:"_getPhysicalPage",value:function(e,t,r){var n=this;try{var a=e.pagesDefinition.internal.lastRetrieved,i=a,s=e.pagesDefinition.internal.lastPage,u=this._layer.nativeCapabilities(),l=new K.a;return!0===this._requestStandardised&&(l.sqlFormat="standard"),l.relationshipId=this.relationship.id,l.objectIds=e.pagesDefinition.objectIds,l.resultOffset=e.pagesDefinition.internal.lastPage,l.resultRecordCount=e.pagesDefinition.resultRecordCount,l.outFields=e.pagesDefinition.outFields.split(","),l.where=e.pagesDefinition.where,l.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,l.returnGeometry=e.pagesDefinition.returnGeometry,l.outSpatialReference=this.spatialReference,u.source.queryRelatedFeatures(l).then((function(t){if(n._checkCancelled(r),e.pagesDefinition.internal.lastPage!==s)return 0;for(var u=t[n._findObjectId]?t[n._findObjectId].features:[],l=0;l<u.length;l++)e.pagesDefinition.internal.set[i+l]=u[l].attributes[n._layer.objectIdField];for(var o=0;o<u.length;o++)n._featureCache[u[o].attributes[n._layer.objectIdField]]=u[o];var c=!t[n._findObjectId]||!1===t[n._findObjectId].exceededTransferLimit;return u.length!==e.pagesDefinition.resultRecordCount&&c&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=a+u.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,u.length}))}catch(e){return Object(o.r)(e)}}},{key:"_getFeatures",value:function(e,t,r,n){var a=this,i=[];-1!==t&&void 0===this._featureCache[t]&&i.push(t);var s=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,s))return this._expandPagedSet(e,s,0,0,n).then((function(){return a._getFeatures(e,t,r,n)}));for(var u=0,l=e._lastFetchedIndex;l<e._known.length&&(++u<=r&&(e._lastFetchedIndex+=1),!("GETPAGES"!==e._known[l]&&void 0===this._featureCache[e._known[l]]&&(e._known[l]!==t&&i.push(e._known[l]),i.length>r)))&&!(u>=r&&0===i.length);l++);return 0===i.length?Object(o.s)("success"):Object(o.r)(new Error("Unaccounted for Features. Not in Feature Collection"))}},{key:"_refineSetBlock",value:function(e,t,r){return Object(o.s)(e)}},{key:"_stat",value:function(e,t,r,n,a,i,s){return Object(o.s)({calculated:!1})}},{key:"_canDoAggregates",value:function(e,t,r,n,a){return Object(o.s)(!1)}},{key:"relationshipMetaData",value:function(){return this.relatedLayer.relationshipMetaData()}},{key:"serviceUrl",value:function(){return this.relatedLayer.serviceUrl()}},{key:"queryAttachments",value:function(e,t,r,n){return this.relatedLayer.queryAttachments(e,t,r,n)}},{key:"getFeatureByObjectId",value:function(e,t){return this.relatedLayer.getFeatureByObjectId(e,t)}},{key:"getOwningSystemUrl",value:function(){return this.relatedLayer.getOwningSystemUrl()}},{key:"getIdentityUser",value:function(){return this.relatedLayer.getIdentityUser()}},{key:"gdbVersion",get:function(){return this.relatedLayer.gdbVersion}}]),r}(x.a);function Z(){null===v.a.applicationCache&&(v.a.applicationCache=new v.a)}function X(e,t){if(v.a.applicationCache){var r=v.a.applicationCache.getLayerInfo(e);if(r)return r.then((function(r){return Object(o.s)(new L.default({url:e,outFields:t,sourceJSON:r}))}));var n=new L.default({url:e,outFields:t}),a=Object(o.c)((function(e,t){n.load().then((function(){e(n.sourceJSON)}),(function(e){t(e)}))}));return v.a.applicationCache&&(v.a.applicationCache.setLayerInfo(e,a),a=a.catch((function(t){throw v.a.applicationCache.clearLayerInfo(e),t}))),a.then((function(){return Object(o.s)(n)}))}return Object(o.s)(new L.default({url:e,outFields:t}))}function $(e,t,r,n,a){return X(e,["*"]).then((function(e){return Object(o.s)(ee(e,t,r,n,a))}))}function ee(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return!0===e._hasMemorySource()?new z.a({layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:a}):new Y({layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:a})}function te(e){if(null!==v.a.applicationCache){var t=v.a.applicationCache.getLayerInfo(e);if(null!==t)return t}var r=Object(f.default)(e,{responseType:"json",query:{f:"json"}}).then((function(e){if(e.data){var t=e.data;return t.layers||(t.layers=[]),t.tables||(t.tables=[]),Object(o.s)(t)}return Object(o.s)({layers:[],tables:[]})}));return null!==v.a.applicationCache&&(v.a.applicationCache.setLayerInfo(e,r),r=r.catch((function(t){throw v.a.applicationCache.clearLayerInfo(e),t}))),r}function re(e,t){var r={metadata:null,networkId:-1,unVersion:3,terminals:[],queryelem:null,layerNameLkp:{},lkp:null};return te(e).then((function(n){if(r.metadata=n,n.controllerDatasetLayers&&void 0!==n.controllerDatasetLayers.utilityNetworkLayerId&&null!==n.controllerDatasetLayers.utilityNetworkLayerId){if(n.layers){var a,i=Object(l.a)(n.layers);try{for(i.s();!(a=i.n()).done;){var s=a.value;r.layerNameLkp[s.id]=s.name}}catch(p){i.e(p)}finally{i.f()}}if(n.tables){var u,c=Object(l.a)(n.tables);try{for(c.s();!(u=c.n()).done;){var d=u.value;r.layerNameLkp[d.id]=d.name}}catch(p){c.e(p)}finally{c.f()}}var h=n.controllerDatasetLayers.utilityNetworkLayerId;return r.networkId=h,function(e,t){var r="QUERYDATAELEMTS:"+t.toString()+":"+e;if(null!==v.a.applicationCache){var n=v.a.applicationCache.getLayerInfo(r);if(null!==n)return n}var a=Object(f.default)(e+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([t.toString()]),f:"json"}}).then((function(e){if(e.data){var t=e.data;if(t.layerDataElements&&t.layerDataElements[0])return t.layerDataElements[0]}throw new Error("Not Found")}));return null!==v.a.applicationCache&&(v.a.applicationCache.setLayerInfo(r,a),a=a.catch((function(e){throw v.a.applicationCache.clearLayerInfo(r),e}))),a}(e,h).then((function(n){if(n){r.queryelem=n,r.queryelem&&r.queryelem.dataElement&&void 0!==r.queryelem.dataElement.schemaGeneration&&(r.unVersion=r.queryelem.dataElement.schemaGeneration),r.lkp={},r.queryelem.dataElement.domainNetworks||(r.queryelem.dataElement.domainNetworks=[]);var a,i=Object(l.a)(r.queryelem.dataElement.domainNetworks);try{for(i.s();!(a=i.n()).done;){var s,u=a.value,c=Object(l.a)(u.edgeSources?u.edgeSources:[]);try{for(c.s();!(s=c.n()).done;){var d=s.value,y={layerId:d.layerId,sourceId:d.sourceId,className:r.layerNameLkp[d.layerId]?r.layerNameLkp[d.layerId]:null};y.className&&(r.lkp[y.className]=y)}}catch(p){c.e(p)}finally{c.f()}var g,b=Object(l.a)(u.junctionSources?u.junctionSources:[]);try{for(b.s();!(g=b.n()).done;){var m=g.value,O={layerId:m.layerId,sourceId:m.sourceId,className:r.layerNameLkp[m.layerId]?r.layerNameLkp[m.layerId]:null};O.className&&(r.lkp[O.className]=O)}}catch(p){b.e(p)}finally{b.f()}}}catch(p){i.e(p)}finally{i.f()}if(r.queryelem.dataElement.terminalConfigurations){var j,S=Object(l.a)(r.queryelem.dataElement.terminalConfigurations);try{for(S.s();!(j=S.n()).done;){var w,k=j.value,F=Object(l.a)(k.terminals);try{for(F.s();!(w=F.n()).done;){var I=w.value;r.terminals.push({terminalId:I.terminalId,terminalName:I.terminalName})}}catch(p){F.e(p)}finally{F.f()}}}catch(p){S.e(p)}finally{S.f()}}return function(e){if(null!==v.a.applicationCache){var t=v.a.applicationCache.getLayerInfo(e);if(null!==t)return t}var r=Object(f.default)(e,{responseType:"json",query:{f:"json"}}).then((function(e){if(e.data){var t=e.data;return Object(o.s)(t)}return Object(o.s)(null)}));return null!==v.a.applicationCache&&(v.a.applicationCache.setLayerInfo(e,r),r=r.catch((function(t){throw v.a.applicationCache.clearLayerInfo(e),t}))),r}(e+"/"+h).then((function(n){if(n.systemLayers&&void 0!==n.systemLayers.associationsTableId&&null!==n.systemLayers.associationsTableId){var a=[];return r.unVersion>=4&&(a.push("STATUS"),a.push("PERCENTALONG")),$(e+"/"+n.systemLayers.associationsTableId.toString(),t,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID"].concat(a),!1,null).then((function(e){return e.load()})).then((function(e){return r.unVersion>=4?(e=e.filter(_.WhereClause.create("STATUS NOT IN (1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 60, 61, 62,63)",e.getFieldsIndex()))).load():e})).then((function(e){return{lkp:r.lkp,associations:e,unVersion:r.unVersion,terminals:r.terminals}}))}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}))}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}))}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}))}function ne(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=e.serviceUrl();return u?$(u="/"===u.charAt(u.length-1)?u+t.relatedTableId.toString():u+"/"+t.relatedTableId.toString(),n,a,i,s).then((function(u){return new H({layer:e,relatedLayer:u,relationship:t,objectId:r,spatialReference:n,outFields:a,includeGeometry:i,lrucache:s})})):null}g.a.registerAction(),N.registerAction(),b.a.registerAction(),P.a.registerAction(),A.a.registerAction();var ae=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(a.a)(this,r),(n=t.call(this))._map=e,n._overridespref=i,n.lrucache=s,n._instantLayers=[],n}return Object(i.a)(r,[{key:"makeAndAddFeatureSet",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=ee(e,this._overridespref,null===r?["*"]:r,t,this.lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}},{key:"featureSetByName",value:function(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then((function(){try{return t.featureSetByName(e,r,a)}catch(e){return Object(o.r)(e)}}));null===a&&(a=["*"]),a=(a=a.slice(0)).sort();for(var i=JSON.stringify(a),s=0;s<this._instantLayers.length;s++){var u=this._instantLayers[s];if(u.opitem.title===e&&u.includeGeometry===r&&u.outFields===i)return this.resolvePromise(this._instantLayers[s].featureset)}var l=this._map.layers.find((function(t){return t instanceof L.default&&t.title===e}));if(l)return this.resolvePromise(this.makeAndAddFeatureSet(l,r,a));if(this._map.tables){var c=this._map.tables.find((function(t){return!!(t.title&&t.title===e||t.title&&t.title===e)}));if(c){if(c instanceof L.default)return this.resolvePromise(this.makeAndAddFeatureSet(c,r,a));if(c._materializedTable);else{var f=c.outFields?c:Object(n.a)(Object(n.a)({},c),{},{outFields:["*"]});c._materializedTable=new L.default(f)}return c._materializedTable.load().then((function(){return t.resolvePromise(t.makeAndAddFeatureSet(c._materializedTable,r,a))}))}}return this.resolvePromise(null)}},{key:"featureSetById",value:function(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["*"];if(void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then((function(){try{return t.featureSetById(e,r,a)}catch(e){return Object(o.r)(e)}}));null===a&&(a=["*"]),a=(a=a.slice(0)).sort();for(var i=JSON.stringify(a),s=0;s<this._instantLayers.length;s++){var u=this._instantLayers[s];if(u.opitem.id===e&&u.includeGeometry===r&&u.outFields===i)return this.resolvePromise(this._instantLayers[s].featureset)}var l=this._map.layers.find((function(t){return t instanceof L.default&&t.id===e}));if(l)return this.resolvePromise(this.makeAndAddFeatureSet(l,r,a));if(this._map.tables){var c=this._map.tables.find((function(t){return t.id===e}));if(c){if(c instanceof L.default)return this.resolvePromise(this.makeAndAddFeatureSet(c,r,a));if(c._materializedTable);else{var f=Object(n.a)(Object(n.a)({},c),{},{outFields:["*"]});c._materializedTable=new L.default(f)}return c._materializedTable.load().then((function(){return t.resolvePromise(t.makeAndAddFeatureSet(c._materializedTable,r,a))}))}}return this.resolvePromise(null)}}]),r}(y.a),ie=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(a.a)(this,r),(n=t.call(this))._url=e,n._overridespref=i,n.lrucache=s,n.metadata=null,n._instantLayers=[],n}return Object(i.a)(r,[{key:"makeAndAddFeatureSet",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=ee(e,this._overridespref,null===r?["*"]:r,t,this.lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}},{key:"_loadMetaData",value:function(){var e=this;return te(this._url).then((function(t){return e.metadata=t,t}))}},{key:"load",value:function(){return this._loadMetaData()}},{key:"clone",value:function(){return new r(this._url,this._overridespref,this.lrucache)}},{key:"featureSetByName",value:function(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===n&&(n=["*"]),n=(n=n.slice(0)).sort();for(var a=JSON.stringify(n),i=0;i<this._instantLayers.length;i++){var s=this._instantLayers[i];if(s.opitem.title===e&&s.includeGeometry===r&&s.outFields===a)return this.resolvePromise(this._instantLayers[i].featureset)}return this._loadMetaData().then((function(a){var i,s=null,u=Object(l.a)(a.layers?a.layers:[]);try{for(u.s();!(i=u.n()).done;){var o=i.value;o.name===e&&(s=o)}}catch(h){u.e(h)}finally{u.f()}if(!s){var c,f=Object(l.a)(a.tables?a.tables:[]);try{for(f.s();!(c=f.n()).done;){var d=c.value;d.name===e&&(s=d)}}catch(h){f.e(h)}finally{f.f()}}return s?X(t._url+"/"+s.id,["*"]).then((function(e){return t.makeAndAddFeatureSet(e,r,n)})):t.resolvePromise(null)}))}},{key:"featureSetById",value:function(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["*"];null===n&&(n=["*"]),n=(n=n.slice(0)).sort();var a=JSON.stringify(n);e=null!=e?e.toString():"";for(var i=0;i<this._instantLayers.length;i++){var s=this._instantLayers[i];if(s.opitem.id===e&&s.includeGeometry===r&&s.outFields===a)return this.resolvePromise(this._instantLayers[i].featureset)}return this._loadMetaData().then((function(a){var i,s=null,u=Object(l.a)(a.layers?a.layers:[]);try{for(u.s();!(i=u.n()).done;){var o=i.value;null!==o.id&&void 0!==o.id&&o.id.toString()===e&&(s=o)}}catch(h){u.e(h)}finally{u.f()}if(!s){var c,f=Object(l.a)(a.tables?a.tables:[]);try{for(f.s();!(c=f.n()).done;){var d=c.value;null!==d.id&&void 0!==d.id&&d.id.toString()===e&&(s=d)}}catch(h){f.e(h)}finally{f.f()}}return s?X(t._url+"/"+s.id,["*"]).then((function(e){return t.makeAndAddFeatureSet(e,r,n)})):t.resolvePromise(null)}))}},{key:"url",get:function(){return this._url}}]),r}(y.a);function se(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new ae(e,t,r)}function ue(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new ie(e,t,r)}function le(e,t){return null===e?t:new d.a({url:e.field("url")})}function oe(e,t,r){return c.b.findCredential(e.restUrl)?"loaded"===e.loadStatus&&""===t&&e.user&&e.user.sourceJSON&&!1===r?Object(o.s)(e.user.sourceJSON):""===t?Object(f.default)(e.restUrl+"/community/self",{responseType:"json",query:Object(n.a)({f:"json"},!1===r?{}:{returnUserLicenseTypeExtensions:!0})}).then((function(e){if(e.data){var t=e.data;if(t&&t.username)return Object(o.s)(t)}return Object(o.s)(null)})):Object(f.default)(e.restUrl+"/community/users/"+t,{responseType:"json",query:{f:"json"}}).then((function(e){if(e.data){var t=e.data;return t.error?null:Object(o.s)(t)}return Object(o.s)(null)})):Object(o.s)(null)}function ce(e,t,r,n,a,i,s){if(v.a.applicationCache){var u=v.a.applicationCache.getLayerInfo(e+":"+i.url);if(u)return u.then((function(e){try{var i=new L.default({url:Object(p.i)(e.url)+"/"+t,outFields:["*"]});return Object(o.s)(ee(i,r,n,a,s))}catch(u){return Object(o.r)(u)}}),(function(e){return Object(o.r)(e)}))}return Object(o.c)((function(u,l){var o=new h.default({id:e,portal:i}).load();v.a.applicationCache&&v.a.applicationCache.setLayerInfo(e+":"+i.url,o),o.then((function(e){try{var i=new L.default({url:Object(p.i)(e.url)+"/"+t,outFields:["*"]});u(ee(i,r,n,a,s))}catch(u){l(u)}}),(function(t){v.a.applicationCache&&v.a.applicationCache.clearLayerInfo(e+":"+i.url),l(t)}))}))}}}]);
//# sourceMappingURL=32.843dd8fe.chunk.js.map