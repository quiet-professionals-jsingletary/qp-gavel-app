(this["webpackJsonpqp-ampd-app"]=this["webpackJsonpqp-ampd-app"]||[]).push([[26],{1e3:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(30),a=n(31);function o(){var e=Object(r.a)(["\n      float evaluateAmbientOcclusion() { return 0.0; } // no occlusion\n      float evaluateAmbientOcclusionInverse() { return 1.0; }\n    "]);return o=function(){return e},e}function i(){var e=Object(r.a)(["\n      float evaluateAmbientOcclusion() {\n        return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n      }\n\n      float evaluateAmbientOcclusionInverse() {\n        float ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n        return viewportPixelSz.z < 0.0 ? 1.0 : ssao;\n      }\n    "]);return i=function(){return e},e}function c(e,t){var n=e.fragment;t.receiveAmbientOcclusion?(n.uniforms.add("ssaoTex","sampler2D"),n.uniforms.add("viewportPixelSz","vec4"),n.code.add(Object(a.a)(i()))):n.code.add(Object(a.a)(o()))}},1014:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(30),a=n(31);function o(){var e=Object(r.a)(["\n    vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {\n      vec3 camToVert = posWorld - camPosWorld;\n\n      bool isBackface = dot(camToVert, normalWorld) > 0.0;\n      if (isBackface) {\n        posClip.z += 0.0000003 * posClip.w;\n      }\n      return posClip;\n    }\n  "]);return o=function(){return e},e}function i(e){e.vertex.code.add(Object(a.a)(o()))}},1015:function(e,t,n){"use strict";n.d(t,"a",(function(){return M}));var r=n(30),a=n(31),o=n(572),i=n(201),c=n(242),s=n(346),u=n(239),l=n(446),d=n(983),f=n(986),v=n(1093);function p(){var e=Object(r.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]);return p=function(){return e},e}function m(){var e=Object(r.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        outputHighlight();\n      }\n    "]);return m=function(){return e},e}function b(){var e=Object(r.a)(["\n      void main(void) {\n        vpos = calculateVPos();\n        vpos = subtractOrigin(vpos);\n        vpos = addVerticalOffset(vpos, localOrigin);\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "]);return b=function(){return e},e}function h(){var e=Object(r.a)(["\n            vec3 normal = normalize(vNormalWorld);\n            if (gl_FrontFacing == false) normal = -normal;"]);return h=function(){return e},e}function x(){var e=Object(r.a)(["\n            vec3 normal = screenDerivativeNormal(vPositionView);"]);return x=function(){return e},e}function g(){var e=Object(r.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]);return g=function(){return e},e}function O(){var e=Object(r.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n\n        ","\n        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);\n      }\n    "]);return O=function(){return e},e}function y(){var e=Object(r.a)(["\n        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));"]);return y=function(){return e},e}function j(){var e=Object(r.a)(["\n      void main(void) {\n        vpos = calculateVPos();\n        vpos = subtractOrigin(vpos);\n        ","\n        vpos = addVerticalOffset(vpos, localOrigin);\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "]);return j=function(){return e},e}function w(){var e=Object(r.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]);return w=function(){return e},e}function C(){var e=Object(r.a)(["\n      void main(void) {\n        discardBySlice(vpos);\n        ","\n        outputDepth(depth);\n      }\n    "]);return C=function(){return e},e}function T(){var e=Object(r.a)(["\n      void main(void) {\n        vpos = calculateVPos();\n        vpos = subtractOrigin(vpos);\n        vpos = addVerticalOffset(vpos, localOrigin);\n        gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n        forwardTextureCoordinates();\n      }\n    "]);return T=function(){return e},e}function M(e,t){var n=e.vertex.code,r=e.fragment.code;1!==t.output&&3!==t.output||(e.include(o.a,{linearDepth:!0}),e.include(d.a,t),e.include(s.a,t),e.include(l.a,t),e.include(i.a,t),e.vertex.uniforms.add("nearFar","vec2"),e.varyings.add("depth","float"),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),n.add(Object(a.a)(T())),e.include(u.a,t),r.add(Object(a.a)(C(),t.hasColorTexture?Object(a.a)(w()):""))),2===t.output&&(e.include(o.a,{linearDepth:!1}),e.include(f.a,t),e.include(v.a,t),e.include(d.a,t),e.include(s.a,t),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),e.vertex.uniforms.add("viewNormal","mat4"),e.varyings.add("vPositionView","vec3"),n.add(Object(a.a)(j(),0===t.normalType?Object(a.a)(y()):"")),e.include(i.a,t),e.include(u.a,t),r.add(Object(a.a)(O(),t.hasColorTexture?Object(a.a)(g()):"",3===t.normalType?Object(a.a)(x()):Object(a.a)(h())))),4===t.output&&(e.include(o.a,{linearDepth:!1}),e.include(d.a,t),e.include(s.a,t),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),n.add(Object(a.a)(b())),e.include(i.a,t),e.include(u.a,t),e.include(c.a),r.add(Object(a.a)(m(),t.hasColorTexture?Object(a.a)(p()):"")))}},1016:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(30),a=n(31),o=n(345);function i(){var e=Object(r.a)(["\n    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      vec3 internalMixed = internalColor * textureColor;\n      vec3 allMixed = internalMixed * externalColor;\n\n      if (mode == ",") {\n        return allMixed;\n      }\n      else if (mode == ",") {\n        return internalMixed;\n      }\n      else if (mode == ",") {\n        return externalColor;\n      }\n      else {\n        // tint (or something invalid)\n        float vIn = rgb2v(internalMixed);\n        vec3 hsvTint = rgb2hsv(externalColor);\n        vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);\n        return hsv2rgb(hsvOut);\n      }\n    }\n\n    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      float internalMixed = internalOpacity * textureOpacity;\n      float allMixed = internalMixed * externalOpacity;\n\n      if (mode == ",") {\n        return internalMixed;\n      }\n      else if (mode == ",") {\n        return externalOpacity;\n      }\n      else {\n        // multiply or tint (or something invalid)\n        return allMixed;\n      }\n    }\n  "]);return i=function(){return e},e}function c(e){e.include(o.a),e.code.add(Object(a.a)(i(),a.a.int(1),a.a.int(2),a.a.int(3),a.a.int(2),a.a.int(3)))}},1037:function(e,t,n){"use strict";n.d(t,"a",(function(){return _}));var r=n(30),a=n(31),o=n(586),i=n(963),c=n(985),s=n(1e3);function u(){var e=Object(r.a)(["\n        const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);\n\n        vec3 calculateAmbientRadiance(float ambientOcclusion)\n        {\n          vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;\n          return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;\n        }\n      "]);return u=function(){return e},e}function l(){var e=Object(r.a)(["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec3 ambientLight = 0.282095 * lightingAmbientSH0;\n\n        vec4 sh1 = vec4(\n          0.488603 * normal.x,\n          0.488603 * normal.z,\n          0.488603 * normal.y,\n          1.092548 * normal.x * normal.y\n        );\n        vec4 sh2 = vec4(\n          1.092548 * normal.y * normal.z,\n          0.315392 * (3.0 * normal.z * normal.z - 1.0),\n          1.092548 * normal.x * normal.z,\n          0.546274 * (normal.x * normal.x - normal.y * normal.y)\n        );\n        ambientLight += vec3(\n          dot(lightingAmbientSH_R1, sh1),\n          dot(lightingAmbientSH_G1, sh1),\n          dot(lightingAmbientSH_B1, sh1)\n        );\n        ambientLight += vec3(\n          dot(lightingAmbientSH_R2, sh2),\n          dot(lightingAmbientSH_G2, sh2),\n          dot(lightingAmbientSH_B2, sh2)\n        );\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "]);return l=function(){return e},e}function d(){var e=Object(r.a)(["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec4 sh0 = vec4(\n          0.282095,\n          0.488603 * normal.x,\n          0.488603 * normal.z,\n          0.488603 * normal.y\n        );\n        vec3 ambientLight = vec3(\n          dot(lightingAmbientSH_R, sh0),\n          dot(lightingAmbientSH_G, sh0),\n          dot(lightingAmbientSH_B, sh0)\n        );\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "]);return d=function(){return e},e}function f(){var e=Object(r.a)(["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec3 ambientLight = 0.282095 * lightingAmbientSH0;\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "]);return f=function(){return e},e}function v(e,t){var n=e.fragment,r=void 0!==t.lightingSphericalHarmonicsOrder?t.lightingSphericalHarmonicsOrder:2;0===r?(n.uniforms.add("lightingAmbientSH0","vec3"),n.code.add(Object(a.a)(f()))):1===r?(n.uniforms.add("lightingAmbientSH_R","vec4"),n.uniforms.add("lightingAmbientSH_G","vec4"),n.uniforms.add("lightingAmbientSH_B","vec4"),n.code.add(Object(a.a)(d()))):2===r&&(n.uniforms.add("lightingAmbientSH0","vec3"),n.uniforms.add("lightingAmbientSH_R1","vec4"),n.uniforms.add("lightingAmbientSH_G1","vec4"),n.uniforms.add("lightingAmbientSH_B1","vec4"),n.uniforms.add("lightingAmbientSH_R2","vec4"),n.uniforms.add("lightingAmbientSH_G2","vec4"),n.uniforms.add("lightingAmbientSH_B2","vec4"),n.code.add(Object(a.a)(l())),1!==t.pbrMode&&2!==t.pbrMode||n.code.add(Object(a.a)(u())))}function p(){var e=Object(r.a)(["\n    vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {\n      float dotVal = clamp(-dot(normal_global, lightingMainDirection), 0.0, 1.0);\n\n      // move lighting towards (1.0, 1.0, 1.0) if requested\n      dotVal = mix(dotVal, 1.0, lightingFixedFactor);\n\n      return lightingMainIntensity * ((1.0 - shadowing) * dotVal);\n    }\n  "]);return p=function(){return e},e}function m(e){var t=e.fragment;t.uniforms.add("lightingMainDirection","vec3"),t.uniforms.add("lightingMainIntensity","vec3"),t.uniforms.add("lightingFixedFactor","float"),t.code.add(Object(a.a)(p()))}function b(){var e=Object(r.a)(["vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));"]);return b=function(){return e},e}function h(){var e=Object(r.a)(["vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));"]);return h=function(){return e},e}function x(){var e=Object(r.a)(["\n        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);\n        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;\n        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));\n        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;\n        ","\n        return outColor;\n      }\n    "]);return x=function(){return e},e}function g(){var e=Object(r.a)(["\n        vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;\n        vec3 horizonRingH = normalize(viewDirection + horizonRingDir);\n        inputs.NdotH_Horizon = dot(normal, horizonRingH);\n\n        vec3 mainLightRadianceComponent  = normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);\n        vec3 horizonLightRadianceComponent = normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;\n        vec3 ambientLightRadianceComponent = calculateAmbientRadiance(ssao) + additionalLight; // calculateAmbientRadiance for localView and additionalLight for gloabalView\n\n        // Assemble the overall radiance of the sky that illuminates the surface\n        inputs.skyRadianceToSurface    =  ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;\n        // Assemble the overall radiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky radince by the groundReflectance\n        inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;\n\n        // Calculate average ambient radiance - this is used int the gamut mapping part to deduce the black level that is soft compressed\n        inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);\n        "]);return g=function(){return e},e}function O(){var e=Object(r.a)(["\n        vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);\n        ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));\n\n        inputs.NdotAmbDir = abs(dot(normal, ambientDir));\n\n        // Calculate the irradiance components: sun, fill lights and the sky.\n        vec3 mainLightIrradianceComponent  = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;\n        vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;\n        // calculateAmbientIrradiance for localView and additionalLight for gloabalView\n        vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;\n\n        // Assemble the overall irradiance of the sky that illuminates the surface\n        inputs.skyIrradianceToSurface    = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n        // Assemble the overall irradiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky irradiance by the groundReflectance\n        inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n      "]);return O=function(){return e},e}function y(){var e=Object(r.a)(["\n        inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;\n        inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0)); // more accurate then using  f90 = 1.0\n        inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);\n      "]);return y=function(){return e},e}function j(){var e=Object(r.a)(["\n      const float fillLightIntensity = 0.25;\n      const float horizonLightDiffusion = 0.4;\n      const float additionalAmbientIrradianceFactor = 0.02;\n\n      vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)\n      {\n        // Calculate half vector between view and light direction\n        vec3 viewDirection = -viewDir;\n        vec3 mainLightDirection = -lightingMainDirection;\n        vec3 h = normalize(viewDirection + mainLightDirection);\n\n        PBRShadingInfo inputs;\n        inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);\n        inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);\n        inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);\n        inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);\n        inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);\n        vec3 reflectedView = normalize(reflect(viewDirection, normal));\n        inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);\n\n        inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));\n        inputs.ssao = ssao;\n\n        inputs.metalness = mrr[0];\n        inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);\n      "]);return j=function(){return e},e}function w(){var e=Object(r.a)(["\n      vec3 evaluateSceneLighting(vec3 normalWorld, vec3 baseColor, float mainLightShadow, float ambientOcclusion, vec3 additionalLight)\n      {\n        vec3 mainLighting = evaluateMainLighting(normalWorld, mainLightShadow);\n        vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ambientOcclusion);\n        // inverse gamma correction on the base color\n        vec3 baseColorLinear = pow(baseColor, vec3(GAMMA_SRGB));\n\n        // physically correct BRDF normalizes by PI\n        vec3 totalLight = mainLighting + ambientLighting + additionalLight;\n        totalLight = min(totalLight, vec3(PI));\n        vec3 outColor = vec3((baseColorLinear / PI) * totalLight);\n\n        // apply gamma correction to the computed color\n        outColor = pow(outColor, vec3(INV_GAMMA_SRGB));\n\n        return outColor;\n      }\n      "]);return w=function(){return e},e}function C(){var e=Object(r.a)(["\n      vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {\n        float additionalAmbientScale = _oldHeuristicLighting(vPosWorld);\n        return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;\n      }\n    "]);return C=function(){return e},e}function T(){var e=Object(r.a)(["\n      float _oldHeuristicLighting(vec3 vPosWorld) {\n        float vndl = -dot(vec3(0.0, 0.0, 1.0), lightingMainDirection);\n        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n      }\n    "]);return T=function(){return e},e}function M(){var e=Object(r.a)(["\n      float _oldHeuristicLighting(vec3 vPosWorld) {\n        vec3 shadingNormalWorld = normalize(vPosWorld);\n        float vndl = -dot(shadingNormalWorld, lightingMainDirection);\n\n        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n      }\n    "]);return M=function(){return e},e}function S(){var e=Object(r.a)(["\n    vec3 evaluateSceneLightingExt(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\n      // evaluate the main light\n      #if defined(TREE_RENDERING)\n        // Special case for tree rendering:\n        // We shift the Lambert lobe to the back, allowing it to reach part of the hemisphere\n        // facing away from the light. The idea is to get an effect where light is transmitted\n        // through the tree.\n        float minDot = -0.5;\n        float dotRange = 1.0 - minDot;\n        float dotNormalization = 0.66; // guessed & hand tweaked value, for an exact value we could precompute an integral over the sphere\n\n        float dotVal = dotNormalization * (clamp(-dot(normal, lightingMainDirection), 1.0 - dotRange, 1.0) - minDot) * (1.0 / dotRange);\n      #else\n        float dotVal = clamp(-dot(normal, lightingMainDirection), 0.0, 1.0);\n      #endif\n\n      // move lighting towards (1.0, 1.0, 1.0) if requested\n      dotVal = mix(dotVal, 1.0, lightingFixedFactor);\n\n      vec3 mainLight = (1.0 - shadow) * lightingMainIntensity * dotVal;\n      vec3 ambientLight = calculateAmbientIrradiance(normal, ssao);\n\n      // inverse gamma correction on the albedo color\n      vec3 albedoGammaC = pow(albedo, vec3(GAMMA_SRGB));\n\n      // physically correct BRDF normalizes by PI\n      vec3 totalLight = mainLight + ambientLight + additionalLight;\n      totalLight = min(totalLight, vec3(PI));\n      vec3 outColor = vec3((albedoGammaC / PI) * (totalLight));\n\n      // apply gamma correction to the computed color\n      outColor = pow(outColor, vec3(INV_GAMMA_SRGB));\n\n      return outColor;\n    }\n  "]);return S=function(){return e},e}function A(){var e=Object(r.a)(["\n    const float GAMMA_SRGB = 2.1;\n    const float INV_GAMMA_SRGB = 0.4761904;\n    ","\n  "]);return A=function(){return e},e}function _(e,t){var n=e.fragment;e.include(m),e.include(s.a,t),0!==t.pbrMode&&e.include(c.a,t),e.include(v,t),t.receiveShadows&&e.include(i.a,t),n.uniforms.add("lightingGlobalFactor","float"),n.uniforms.add("ambientBoostFactor","float"),e.include(o.a),n.code.add(Object(a.a)(A(),0===t.pbrMode?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);")),t.useOldSceneLightInterface?n.code.add(Object(a.a)(S())):(1===t.viewingMode?n.code.add(Object(a.a)(M())):n.code.add(Object(a.a)(T())),n.code.add(Object(a.a)(C())),0===t.pbrMode||4===t.pbrMode?n.code.add(Object(a.a)(w())):1!==t.pbrMode&&2!==t.pbrMode||(n.code.add(Object(a.a)(j())),n.code.add(Object(a.a)(y())),n.code.add(Object(a.a)(O())),n.code.add(Object(a.a)(g())),n.code.add(Object(a.a)(x(),2===t.pbrMode?Object(a.a)(h()):Object(a.a)(b())))))}},1045:function(e,t,n){"use strict";n.d(t,"a",(function(){return y})),n.d(t,"b",(function(){return j}));var r=n(30),a=n(15),o=n(31),i=n(2),c=n(3),s=n(4),u=(n(46),n(24)),l=n(243),d=n(26),f=n(148),v=n(229),p=n(600),m=n(350),b=(n(530),function(){function e(t){Object(i.a)(this,e),this.context=t,this._doublePrecisionRequiresObfuscation=null}return Object(c.a)(e,[{key:"doublePrecisionRequiresObfuscation",get:function(){if(Object(s.g)(this._doublePrecisionRequiresObfuscation)){var e=x(this.context,!1),t=x(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==e&&(0===t||e/t>5)}return this._doublePrecisionRequiresObfuscation}}]),e}()),h=null;function x(e,t){var n=new m.a(e,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),r=f.a.createVertex(e,35044,new Uint16Array([0,0,1,0,0,1,1,1])),a=new v.a(e,{a_pos:0},{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:r}),o=Object(u.g)(5633261.287538229,2626832.878767164,1434988.0495278358),i=Object(u.g)(5633271.46742708,2626873.6381334523,1434963.231608387),c=function(n,r){var a=new l.a(e,"\n\n  precision highp float;\n\n  attribute vec2 a_pos;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ".concat(t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":"","\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  "),"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor = v_color;\n  }\n  ",{a_pos:0}),o=new Float32Array(6);Object(p.a)(n,o,3);var i=new Float32Array(6);return Object(p.a)(r,i,3),e.bindProgram(a),a.setUniform3f("u_highA",o[0],o[2],o[4]),a.setUniform3f("u_lowA",o[1],o[3],o[5]),a.setUniform3f("u_highB",i[0],i[2],i[4]),a.setUniform3f("u_lowB",i[1],i[3],i[5]),a}(o,i),s=e.getBoundFramebufferObject(),b=e.getViewport(),h=b.x,x=b.y,g=b.width,O=b.height;e.bindFramebuffer(n),e.setViewport(0,0,1,1),e.bindVAO(a),e.drawArrays(5,0,4);var y=new Uint8Array(4);n.readPixels(0,0,1,1,6408,5121,y),c.dispose(),a.dispose(!1),r.dispose(),n.dispose(),e.setViewport(h,x,g,O),e.bindFramebuffer(s);var j=(o[2]-i[2])/25,w=Object(d.m)(y);return Math.abs(j-w)}function g(){var e=Object(r.a)(["\n      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n        vec3 t1 = hiA + hiB;\n        vec3 e = t1 - hiA;\n        vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n        return t1 + t2;\n      }\n    "]);return g=function(){return e},e}function O(){var e=Object(r.a)(["\n      vec3 dpPlusFrc(vec3 a, vec3 b) {\n        return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n      }\n\n      vec3 dpMinusFrc(vec3 a, vec3 b) {\n        return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n      }\n\n      // based on https://www.thasler.com/blog/blog/glsl-part2-emu\n      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n        vec3 t1 = dpPlusFrc(hiA, hiB);\n        vec3 e = dpMinusFrc(t1, hiA);\n        vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n        return t1 + t2;\n      }\n    "]);return O=function(){return e},e}function y(e,t){var n=e.code;t.doublePrecisionRequiresObfuscation?n.add(Object(o.a)(O())):n.add(Object(o.a)(g()))}function j(e){return!!Object(a.a)("force-double-precision-obfuscation")||(t=e,(Object(s.g)(h)||h.context!==t)&&(h=new b(t)),h).doublePrecisionRequiresObfuscation;var t}},1046:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(30),a=n(31);function o(){var e=Object(r.a)(["\n    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n      float symbolAlpha = 0.0;\n\n      const float maxTint = 85.0;\n      const float maxReplace = 170.0;\n      const float scaleAlpha = 3.0;\n\n      if (symbolColor.a > maxReplace) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);\n      } else if (symbolColor.a > maxTint) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);\n      } else if (symbolColor.a > 0.0) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * symbolColor.a;\n      } else {\n        colorMixMode = ",";\n        symbolAlpha = 0.0;\n      }\n\n      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);\n    }\n  "]);return o=function(){return e},e}function i(e){e.vertex.code.add(Object(a.a)(o(),a.a.int(1),a.a.int(3),a.a.int(4),a.a.int(1)))}function c(){var e=Object(r.a)(["\n    vec4 getSymbolColor() { return vec4(1.0); }\n    void forwardColorMixMode() {}\n    "]);return c=function(){return e},e}function s(){var e=Object(r.a)(["\n    int symbolColorMixMode;\n\n    vec4 getSymbolColor() {\n      return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;\n    }\n\n    void forwardColorMixMode() {\n      colorMixMode = float(symbolColorMixMode) + 0.5;\n    }\n  "]);return s=function(){return e},e}function u(e,t){t.symbolColor?(e.include(i),e.attributes.add("symbolColor","vec4"),e.varyings.add("colorMixMode","mediump float")):e.fragment.uniforms.add("colorMixMode","int"),t.symbolColor?e.vertex.code.add(Object(a.a)(s())):e.vertex.code.add(Object(a.a)(c()))}},1080:function(e,t,n){"use strict";n.d(t,"a",(function(){return $})),n.d(t,"b",(function(){return Q}));var r=n(30),a=n(31),o=n(572),i=n(238),c=n(201),s=n(346),u=n(239),l=n(575),d=n(574),f=n(963),v=n(979),p=n(985),m=n(997),b=n(983),h=n(998),x=n(1014),g=n(986),O=n(999),y=n(1046),j=n(1093),w=n(1015),C=n(1117),T=n(1e3),M=n(1037),S=n(1118),A=n(1119),_=n(1016);function R(){var e=Object(r.a)(["\n            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"]);return R=function(){return e},e}function P(){var e=Object(r.a)([""]);return P=function(){return e},e}function B(){var e=Object(r.a)(["vec3 normalGround = vec3(0.0, 0.0, 1.0);"]);return B=function(){return e},e}function k(){var e=Object(r.a)(["vec3 normalGround = normalize(vpos + localOrigin);"]);return k=function(){return e},e}function I(){var e=Object(r.a)(["\n              mat3 tangentSpace = ","\n              vec3 shadedNormal = computeTextureNormal(tangentSpace, vuv0);"]);return I=function(){return e},e}function L(){var e=Object(r.a)(["\n        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "]);return L=function(){return e},e}function F(){var e=Object(r.a)(["\n        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]);return F=function(){return e},e}function E(){var e=Object(r.a)(["\n        shadingParams.normalView = vNormalWorld;\n        vec3 normal = shadingNormal(shadingParams);"]);return E=function(){return e},e}function N(){var e=Object(r.a)(["\n        vec3 normal = screenDerivativeNormal(localvpos);"]);return N=function(){return e},e}function D(){var e=Object(r.a)(["vec4 texColor = vec4(1.0);"]);return D=function(){return e},e}function z(){var e=Object(r.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"]);return z=function(){return e},e}function U(){var e=Object(r.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        shadingParams.viewDirection = normalize(vpos - camPos);\n        ","\n        ","\n        float ssao = evaluateAmbientOcclusionInverse();\n        ssao *= getBakedOcclusion();\n\n        float additionalAmbientScale = _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor = max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);\n        ","\n      }\n    "]);return U=function(){return e},e}function V(){var e=Object(r.a)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "]);return V=function(){return e},e}function G(){var e=Object(r.a)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]);return G=function(){return e},e}function q(){var e=Object(r.a)(["vec4 texColor = vec4(1.0);"]);return q=function(){return e},e}function H(){var e=Object(r.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"]);return H=function(){return e},e}function W(){var e=Object(r.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        gl_FragColor = vec4(opacity_);\n      }\n    "]);return W=function(){return e},e}function X(){var e=Object(r.a)(["\n          vNormalWorld = dpNormal(vvLocalNormal(normalModel()));"]);return X=function(){return e},e}function J(){var e=Object(r.a)(["\n      void main(void) {\n        forwardNormalizedVertexColor();\n        vcolorExt = externalColor;\n        ","\n        vcolorExt *= vvColor();\n        vcolorExt *= getSymbolColor();\n        forwardColorMixMode();\n\n        if (vcolorExt.a < ",") {\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        }\n        else {\n          vpos = calculateVPos();\n          localvpos = vpos - view[3].xyz;\n          vpos = subtractOrigin(vpos);\n          ","\n          vpos = addVerticalOffset(vpos, localOrigin);\n          ","\n          gl_Position = transformPosition(proj, view, vpos);\n          ","\n        }\n        forwardLinearDepth();\n        forwardTextureCoordinates();\n      }\n    "]);return J=function(){return e},e}function Q(e){var t=new i.a,n=t.vertex.code,r=t.fragment.code;return t.include(A.a,{name:"Default Material Shader",output:e.output}),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.include(O.a),t.varyings.add("vpos","vec3"),t.include(s.a,e),t.include(m.a,e),t.include(l.a,e),0!==e.output&&7!==e.output||(t.include(g.a,e),t.include(o.a,{linearDepth:!1}),0===e.normalType&&e.offsetBackfaces&&t.include(x.a),t.include(C.a,e),t.include(j.a,e),e.instancedColor&&t.attributes.add("instanceColor","vec4"),t.varyings.add("localvpos","vec3"),t.include(b.a,e),t.include(v.a,e),t.include(y.a,e),t.include(d.a,e),t.vertex.uniforms.add("externalColor","vec4"),t.varyings.add("vcolorExt","vec4"),n.add(Object(a.a)(J(),e.instancedColor?"vcolorExt *= instanceColor;":"",a.a.float(u.c),0===e.normalType?Object(a.a)(X()):"",e.vertexTangets?"vTangent = dpTransformVertexTangent(tangent);":"",0===e.normalType&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":""))),7===e.output&&(t.include(c.a,e),t.include(u.a,e),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.fragment.include(_.a),r.add(Object(a.a)(W(),e.hasColorTexture?Object(a.a)(H(),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):Object(a.a)(q()),e.attributeColor?Object(a.a)(G()):Object(a.a)(V())))),0===e.output&&(t.include(c.a,e),t.include(M.a,e),t.include(T.a,e),t.include(u.a,e),e.receiveShadows&&t.include(f.a,e),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.include(h.a,e),t.include(p.a,e),t.fragment.include(_.a),t.include(S.a,e),r.add(Object(a.a)(U(),e.hasColorTexture?Object(a.a)(z(),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):Object(a.a)(D()),3===e.normalType?Object(a.a)(N()):Object(a.a)(E()),1===e.pbrMode?"applyPBRFactors();":"",e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":1===e.viewingMode?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;",e.attributeColor?Object(a.a)(F()):Object(a.a)(L()),e.hasNormalTexture?Object(a.a)(I(),e.vertexTangets?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"):"vec3 shadedNormal = normal;",1===e.pbrMode||2===e.pbrMode?1===e.viewingMode?Object(a.a)(k()):Object(a.a)(B()):Object(a.a)(P()),1===e.pbrMode||2===e.pbrMode?Object(a.a)(R()):"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);",e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),t.include(w.a,e),t}var $=Object.freeze({__proto__:null,build:Q})},1081:function(e,t,n){"use strict";n.d(t,"a",(function(){return G})),n.d(t,"b",(function(){return V}));var r=n(30),a=n(31),o=n(572),i=n(238),c=n(201),s=n(346),u=n(239),l=n(575),d=n(574),f=n(963),v=n(979),p=n(985),m=n(997),b=n(983),h=n(998),x=n(1014),g=n(986),O=n(999),y=n(1046),j=n(1015),w=n(1e3),C=n(1037),T=n(1016);function M(){var e=Object(r.a)(["\n            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"]);return M=function(){return e},e}function S(){var e=Object(r.a)([""]);return S=function(){return e},e}function A(){var e=Object(r.a)(["vec3 normalGround = vec3(0.0, 0.0, 1.0);"]);return A=function(){return e},e}function _(){var e=Object(r.a)(["vec3 normalGround = normalize(vpos + localOrigin);"]);return _=function(){return e},e}function R(){var e=Object(r.a)(["\n        vec3 shadedNormal = normalize(vNormalWorld);\n        albedo_ *= 1.2;\n        vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);\n        float alignmentLightView = clamp(dot(-viewForward, lightingMainDirection), 0.0, 1.0);\n        float transmittance = 1.0 - clamp(dot(-viewForward, shadedNormal), 0.0, 1.0);\n        float treeRadialFalloff = vColor.r;\n        float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);\n        additionalLight += backLightFactor * lightingMainIntensity;"]);return R=function(){return e},e}function P(){var e=Object(r.a)(["\n        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "]);return P=function(){return e},e}function B(){var e=Object(r.a)(["\n        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]);return B=function(){return e},e}function k(){var e=Object(r.a)(["vec4 texColor = vec4(1.0);"]);return k=function(){return e},e}function I(){var e=Object(r.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"]);return I=function(){return e},e}function L(){var e=Object(r.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        vec3 viewDirection = normalize(vpos - camPos);\n        ","\n        float ssao = evaluateAmbientOcclusionInverse();\n        ssao *= getBakedOcclusion();\n\n        float additionalAmbientScale = _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor = max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);\n        ","\n      }\n    "]);return L=function(){return e},e}function F(){var e=Object(r.a)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "]);return F=function(){return e},e}function E(){var e=Object(r.a)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]);return E=function(){return e},e}function N(){var e=Object(r.a)(["vec4 texColor = vec4(1.0);"]);return N=function(){return e},e}function D(){var e=Object(r.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"]);return D=function(){return e},e}function z(){var e=Object(r.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n\n        gl_FragColor = vec4(opacity_);\n      }\n    "]);return z=function(){return e},e}function U(){var e=Object(r.a)(["\n        void main(void) {\n          forwardNormalizedVertexColor();\n          vcolorExt = externalColor;\n          ","\n          vcolorExt *= vvColor();\n          vcolorExt *= getSymbolColor();\n          forwardColorMixMode();\n\n          if (vcolorExt.a < ",") {\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          }\n          else {\n            vpos = calculateVPos();\n            localvpos = vpos - view[3].xyz;\n            vpos = subtractOrigin(vpos);\n            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));\n            vpos = addVerticalOffset(vpos, localOrigin);\n            gl_Position = transformPosition(proj, view, vpos);\n            ","\n          }\n          forwardLinearDepth();\n          forwardTextureCoordinates();\n        }\n      "]);return U=function(){return e},e}function V(e){var t=new i.a,n=t.vertex.code,r=t.fragment.code;return t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.include(O.a),t.varyings.add("vpos","vec3"),t.include(s.a,e),t.include(m.a,e),t.include(l.a,e),0!==e.output&&7!==e.output||(t.include(g.a,e),t.include(o.a,{linearDepth:!1}),e.offsetBackfaces&&t.include(x.a),e.instancedColor&&t.attributes.add("instanceColor","vec4"),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("localvpos","vec3"),t.include(b.a,e),t.include(v.a,e),t.include(y.a,e),t.include(d.a,e),t.vertex.uniforms.add("externalColor","vec4"),t.varyings.add("vcolorExt","vec4"),n.add(Object(a.a)(U(),e.instancedColor?"vcolorExt *= instanceColor;":"",a.a.float(u.c),e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":""))),7===e.output&&(t.include(c.a,e),t.include(u.a,e),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),t.fragment.uniforms.add("view","mat4"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.fragment.include(T.a),r.add(Object(a.a)(z(),e.hasColorTexture?Object(a.a)(D(),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):Object(a.a)(N()),e.attributeColor?Object(a.a)(E()):Object(a.a)(F())))),0===e.output&&(t.include(c.a,e),t.include(C.a,e),t.include(w.a,e),t.include(u.a,e),e.receiveShadows&&t.include(f.a,e),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),t.fragment.uniforms.add("view","mat4"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.include(h.a,e),t.include(p.a,e),t.fragment.include(T.a),r.add(Object(a.a)(L(),e.hasColorTexture?Object(a.a)(I(),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):Object(a.a)(k()),1===e.pbrMode?"applyPBRFactors();":"",e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":1===e.viewingMode?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;",e.attributeColor?Object(a.a)(B()):Object(a.a)(P()),Object(a.a)(R()),1===e.pbrMode||2===e.pbrMode?1===e.viewingMode?Object(a.a)(_()):Object(a.a)(A()):Object(a.a)(S()),1===e.pbrMode||2===e.pbrMode?Object(a.a)(M()):"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);",e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),t.include(j.a,e),t}var G=Object.freeze({__proto__:null,build:V})},1093:function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var r,a=n(30),o=n(31),i=n(986),c=n(2),s=n(24),u=n(267),l=n(115),d=n(1045),f=n(999);function v(){var e=Object(a.a)(["\n    vec3 positionWorld() {\n      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n    }\n  "]);return v=function(){return e},e}function p(){var e=Object(a.a)(["\n    // compute position in world space orientation, but relative to the camera position\n    vec3 positionWorldCameraRelative() {\n      vec3 rotatedModelPosition = uTransform_WorldFromModel_RS * positionModel();\n\n      vec3 transform_CameraRelativeFromModel = dpAdd(\n        uTransform_WorldFromModel_TL,\n        uTransform_WorldFromModel_TH,\n        -uTransform_WorldFromView_TL,\n        -uTransform_WorldFromView_TH\n      );\n\n      return transform_CameraRelativeFromModel + rotatedModelPosition;\n    }\n\n    // position in view space, that is relative to the camera position and orientation\n    vec3 position_view() {\n      return uTransform_ViewFromCameraRelative_RS * positionWorldCameraRelative();\n    }\n\n    // compute gl_Position and forward related varyings to fragment shader\n    void forwardPosition() {\n      vPositionWorldCameraRelative = positionWorldCameraRelative();\n      vPosition_view = position_view();\n      gl_Position = uTransform_ProjFromView * vec4(vPosition_view, 1.0);\n    }\n\n    vec3 positionWorld() {\n      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n    }\n  "]);return p=function(){return e},e}function m(e,t){e.include(f.a),e.vertex.include(d.a,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),e.vertex.uniforms.add("uTransform_WorldFromModel_RS","mat3"),e.vertex.uniforms.add("uTransform_WorldFromModel_TH","vec3"),e.vertex.uniforms.add("uTransform_WorldFromModel_TL","vec3"),e.vertex.uniforms.add("uTransform_WorldFromView_TH","vec3"),e.vertex.uniforms.add("uTransform_WorldFromView_TL","vec3"),e.vertex.uniforms.add("uTransform_ViewFromCameraRelative_RS","mat3"),e.vertex.uniforms.add("uTransform_ProjFromView","mat4"),e.vertex.code.add(Object(o.a)(p())),e.fragment.uniforms.add("uTransform_WorldFromView_TL","vec3"),e.fragment.code.add(Object(o.a)(v()))}function b(){var e=Object(a.a)(["\n      void forwardNormal() {}\n    "]);return b=function(){return e},e}function h(){var e=Object(a.a)(["vec3(0.0, 0.0, 1.0);"]);return h=function(){return e},e}function x(){var e=Object(a.a)(["normalize(vPositionWorldCameraRelative);"]);return x=function(){return e},e}function g(){var e=Object(a.a)(["\n    void forwardNormal() {\n      vNormalWorld = ","\n    }\n    "]);return g=function(){return e},e}function O(){var e=Object(a.a)(["\n      void forwardNormal() {\n        vNormalWorld = uTransformNormal_GlobalFromModel * normalModel();\n        vNormalView = uTransformNormal_ViewFromGlobal * vNormalWorld;\n      }\n    "]);return O=function(){return e},e}function y(e,t){0===t.normalType||1===t.normalType?(e.include(i.a,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add("uTransformNormal_GlobalFromModel","mat3"),e.vertex.uniforms.add("uTransformNormal_ViewFromGlobal","mat3"),e.vertex.code.add(Object(o.a)(O()))):2===t.normalType?(e.include(m,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(Object(o.a)(g(),1===t.viewingMode?Object(o.a)(x()):Object(o.a)(h())))):e.vertex.code.add(Object(o.a)(b()))}(r=m||(m={})).ModelTransform=function(){return function e(){Object(c.a)(this,e),this.worldFromModel_RS=Object(u.a)(),this.worldFromModel_TH=Object(s.e)(),this.worldFromModel_TL=Object(s.e)()}}(),r.ViewProjectionTransform=function(){return function e(){Object(c.a)(this,e),this.worldFromView_TH=Object(s.e)(),this.worldFromView_TL=Object(s.e)(),this.viewFromCameraRelative_RS=Object(u.a)(),this.projFromView=Object(l.b)()}}(),r.bindModelTransform=function(e,t){e.setUniformMatrix3fv("uTransform_WorldFromModel_RS",t.worldFromModel_RS),e.setUniform3fv("uTransform_WorldFromModel_TH",t.worldFromModel_TH),e.setUniform3fv("uTransform_WorldFromModel_TL",t.worldFromModel_TL)},r.bindViewProjTransform=function(e,t){e.setUniform3fv("uTransform_WorldFromView_TH",t.worldFromView_TH),e.setUniform3fv("uTransform_WorldFromView_TL",t.worldFromView_TL),e.setUniformMatrix4fv("uTransform_ProjFromView",t.projFromView),e.setUniformMatrix3fv("uTransform_ViewFromCameraRelative_RS",t.viewFromCameraRelative_RS)},(y||(y={})).bindUniforms=function(e,t){e.setUniformMatrix4fv("viewNormal",t)}},1117:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(30),a=n(31),o=n(1130);function i(){var e=Object(r.a)(["\n    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {\n      vtc.uv = uv;\n      ","\n      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;\n      return tangentSpace * rawNormal;\n    }\n  "]);return i=function(){return e},e}function c(){var e=Object(r.a)(['\n    mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {\n\n      vec3 Q1 = dFdx(pos);\n      vec3 Q2 = dFdy(pos);\n\n      vec2 stx = dFdx(st);\n      vec2 sty = dFdy(st);\n\n      float det = stx.t * sty.s - sty.t * stx.s;\n\n      vec3 T = stx.t * Q2 - sty.t * Q1; // compute tangent\n      T = T - normal * dot(normal, T); // orthogonalize tangent\n      T *= inversesqrt(max(dot(T,T), 1.e-10)); // "soft" normalize - goes to 0 when T goes to 0\n      vec3 B = sign(det) * cross(normal, T); // assume normal is normalized, B has the same lenght as B\n      return mat3(T, B, normal); // T and B go to 0 when the tangent space is not well defined by the uv coordinates\n    }\n  ']);return c=function(){return e},e}function s(){var e=Object(r.a)(["\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness = vTangent.w;\n        vec3 tangent = normalize(vTangent.xyz);\n        vec3 bitangent = cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    "]);return s=function(){return e},e}function u(){var e=Object(r.a)(["\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;\n        vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);\n        vec3 bitangent = cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    "]);return u=function(){return e},e}function l(e,t){var n=e.fragment;n.uniforms.add("normalTexture","sampler2D"),n.uniforms.add("normalTextureSize","vec2"),t.vertexTangets?(e.attributes.add("tangent","vec4"),e.varyings.add("vTangent","vec4"),2===t.doubleSidedMode?n.code.add(Object(a.a)(u())):n.code.add(Object(a.a)(s()))):(e.extensions.add("GL_OES_standard_derivatives"),n.code.add(Object(a.a)(c()))),0!==t.attributeTextureCoordinates&&(e.include(o.a,t),n.code.add(Object(a.a)(i(),t.supportsTextureAtlas?"vtc.size = normalTextureSize;":"")))}},1118:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(30),a=n(31);function o(){var e=Object(r.a)(["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return normalize(params.normalView);\n      }\n    "]);return o=function(){return e},e}function i(){var e=Object(r.a)(["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);\n      }\n    "]);return i=function(){return e},e}function c(){var e=Object(r.a)(["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);\n      }\n    "]);return c=function(){return e},e}function s(){var e=Object(r.a)(["\n    struct ShadingNormalParameters {\n      vec3 normalView;\n      vec3 viewDirection;\n    } shadingParams;\n    "]);return s=function(){return e},e}function u(e,t){var n=e.fragment;n.code.add(Object(a.a)(s())),1===t.doubleSidedMode?n.code.add(Object(a.a)(c())):2===t.doubleSidedMode?n.code.add(Object(a.a)(i())):n.code.add(Object(a.a)(o()))}},1119:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(30),a=(n(15),n(31));function o(){var e=Object(r.a)(["\n  /*\n  *  ","\n  *  ","\n  */\n  "]);return o=function(){return e},e}function i(e,t){Object(a.a)(o(),t.name,0===t.output?"RenderOutput: Color":1===t.output?"RenderOutput: Depth":3===t.output?"RenderOutput: Shadow":2===t.output?"RenderOutput: Normal":4===t.output?"RenderOutput: Highlight":"")}},1130:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(30),a=n(31),o=n(983);function i(){var e=Object(r.a)(["\n    #ifndef GL_EXT_shader_texture_lod\n      float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\n        float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));\n        return max(0.0, 0.5 * log2(deltaMaxSqr));\n      }\n    #endif\n\n    vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {\n      //[umin, vmin, umax, vmax]\n      vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;\n      vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;\n\n      // calculate derivative of continuous texture coordinate\n      // to avoid mipmapping artifacts caused by manual wrapping in shader\n      vec2 dUVdx = dFdx(textureCoordinates) * atlasScale;\n      vec2 dUVdy = dFdy(textureCoordinates) * atlasScale;\n\n      #ifdef GL_EXT_shader_texture_lod\n        return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);\n      #else\n        // use bias to compensate for difference in automatic vs desired mipmap level\n        vec2 dUVdxAuto = dFdx(uvAtlas);\n        vec2 dUVdyAuto = dFdy(uvAtlas);\n        float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);\n        float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);\n\n        return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);\n      #endif\n    }\n  "]);return i=function(){return e},e}function c(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(Object(a.a)(i()))}function s(){var e=Object(r.a)(["\n    vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\n        return textureAtlasLookup(tex, params.size, params.uv, vuvRegion);\n      }\n    "]);return s=function(){return e},e}function u(){var e=Object(r.a)(["\n      vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\n        return texture2D(tex, params.uv);\n      }\n    "]);return u=function(){return e},e}function l(){var e=Object(r.a)(["\n  struct TextureLookupParameter {\n    vec2 uv;\n    ","\n  } vtc;\n  "]);return l=function(){return e},e}function d(e,t){e.include(o.a,t),e.fragment.code.add(Object(a.a)(l(),t.supportsTextureAtlas?"vec2 size;":"")),1===t.attributeTextureCoordinates&&e.fragment.code.add(Object(a.a)(u())),2===t.attributeTextureCoordinates&&(e.include(c),e.fragment.code.add(Object(a.a)(s())))}},1203:function(e,t,n){"use strict";n.r(t),n.d(t,"fetch",(function(){return Ft})),n.d(t,"gltfToEngineResources",(function(){return Dt})),n.d(t,"parseUrl",(function(){return Nt}));var r=n(7),a=n.n(r),o=n(13),i=n(10),c=n(16),s=n(4),u=n(24),l=n(9),d=n(87),f=n(507),v=n(267),p=n(115),m=n(221),b=n(111),h=n(14),x=h.a.getLogger("esri.views.3d.support.buffer.math");function g(e,t,n){if(e.count===t.count)for(var r=e.count,a=n[0],o=n[1],i=n[2],c=n[4],s=n[5],u=n[6],l=n[8],d=n[9],f=n[10],v=n[12],p=n[13],m=n[14],b=e.typedBuffer,h=e.typedBufferStride,g=t.typedBuffer,O=t.typedBufferStride,y=0;y<r;y++){var j=y*h,w=y*O,C=g[w],T=g[w+1],M=g[w+2];b[j]=a*C+c*T+l*M+v,b[j+1]=o*C+s*T+d*M+p,b[j+2]=i*C+u*T+f*M+m}else x.error("source and destination buffers need to have the same number of elements")}function O(e,t,n){if(e.count===t.count)for(var r=e.count,a=n[0],o=n[1],i=n[2],c=n[3],s=n[4],u=n[5],l=n[6],d=n[7],f=n[8],v=e.typedBuffer,p=e.typedBufferStride,m=t.typedBuffer,b=t.typedBufferStride,h=0;h<r;h++){var g=h*p,O=h*b,y=m[O],j=m[O+1],w=m[O+2];v[g]=a*y+c*j+l*w,v[g+1]=o*y+s*j+d*w,v[g+2]=i*y+u*j+f*w}else x.error("source and destination buffers need to have the same number of elements")}function y(e,t,n){for(var r=Math.min(e.count,t.count),a=e.typedBuffer,o=e.typedBufferStride,i=t.typedBuffer,c=t.typedBufferStride,s=0;s<r;s++){var u=s*o,l=s*c;a[u]=n*i[l],a[u+1]=n*i[l+1],a[u+2]=n*i[l+2]}}Object.freeze({__proto__:null,transformMat4:g,transformMat3:O,scale:y,shiftRight:function(e,t,n){for(var r=Math.min(e.count,t.count),a=e.typedBuffer,o=e.typedBufferStride,i=t.typedBuffer,c=t.typedBufferStride,s=0;s<r;s++){var u=s*o,l=s*c;a[u]=i[l]>>n,a[u+1]=i[l+1]>>n,a[u+2]=i[l+2]>>n}}});var j=n(164),w=n(146),C=n(174),T=n(2),M=n(3),S=n(62),A=n(59),_=n(5),R=n(6),P=n(204),B=n(1009),k=n(630),I=n(196),L=n(269),F=n(306),E=n(239),N=n(159),D=n(0),z=n(244),U=n(245),V=n(69),G=n(246),q=n(243),H=n(106),W=n(226),X=n(201),J=n(242),Q=n(346),$=n(575),Y=n(172),K=n(963),Z=n(1045),ee=n(997),te=n(998),ne=n(1080),re=function(e){Object(_.a)(n,e);var t=Object(R.a)(n);function n(){return Object(T.a)(this,n),t.apply(this,arguments)}return Object(M.a)(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get(),r=this.configuration,a=t.build({OITEnabled:0===r.transparencyPassType,output:r.output,viewingMode:e.viewingMode,receiveShadows:r.receiveShadows,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:r.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:r.symbolColors,vvSize:r.vvSize,vvColor:r.vvColor,vvInstancingEnabled:!0,instanced:r.instanced,instancedColor:r.instancedColor,instancedDoublePrecision:r.instancedDoublePrecision,useOldSceneLightInterface:!1,pbrMode:r.usePBR?r.isSchematic?2:1:0,hasMetalnessAndRoughnessTexture:r.hasMetalnessAndRoughnessTexture,hasEmissionTexture:r.hasEmissionTexture,hasOcclusionTexture:r.hasOcclusionTexture,hasNormalTexture:r.hasNormalTexture,hasColorTexture:r.hasColorTexture,receiveAmbientOcclusion:r.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:r.normalsTypeDerivate?3:0,doubleSidedMode:r.doubleSidedMode,vertexTangets:r.vertexTangents,attributeTextureCoordinates:r.hasMetalnessAndRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture||r.hasColorTexture?1:0,textureAlphaPremultiplied:r.textureAlphaPremultiplied,attributeColor:r.vertexColors,screenSizePerspectiveEnabled:r.screenSizePerspective,verticalOffsetEnabled:r.verticalOffset,offsetBackfaces:r.offsetBackfaces,doublePrecisionRequiresObfuscation:Object(Z.b)(e.rctx),alphaDiscardMode:r.alphaDiscardMode,supportsTextureAtlas:!1});return new q.a(e.rctx,a.generateSource("vertex"),a.generateSource("fragment"),G.a)}},{key:"bindPass",value:function(e,t,n){W.a.bindProjectionMatrix(this.program,n.camera.projectionMatrix);var r=this.configuration.output;7===r&&(this.program.setUniform1f("opacity",t.opacity),this.program.setUniform1f("layerOpacity",t.layerOpacity),this.program.setUniform4fv("externalColor",t.externalColor),this.program.setUniform1i("colorMixMode",I.b[t.colorMixMode])),0===r?(n.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("ambient",t.ambient),this.program.setUniform3fv("diffuse",t.diffuse),this.program.setUniform4fv("externalColor",t.externalColor),this.program.setUniform1i("colorMixMode",I.b[t.colorMixMode]),this.program.setUniform1f("opacity",t.opacity),this.program.setUniform1f("layerOpacity",t.layerOpacity),this.configuration.usePBR&&te.a.bindUniforms(this.program,t,this.configuration.isSchematic)):1===r||3===r?this.program.setUniform2fv("nearFar",n.camera.nearFar):4===r&&J.a.bindOutputHighlight(e,this.program,n),Q.a.bindUniformsForSymbols(this.program,t),$.a.bindUniforms(this.program,t,n),Object(I.a)(t.screenSizePerspective,this.program,"screenSizePerspectiveAlignment"),2!==t.textureAlphaMode&&3!==t.textureAlphaMode||this.program.setUniform1f("textureAlphaCutoff",t.textureAlphaCutoff)}},{key:"bindDraw",value:function(e){var t=this.configuration.instancedDoublePrecision?Object(u.g)(e.camera.viewInverseTransposeMatrix[3],e.camera.viewInverseTransposeMatrix[7],e.camera.viewInverseTransposeMatrix[11]):e.origin;W.a.bindViewCustomOrigin(this.program,t,e.camera.viewMatrix),(0===this.configuration.output||7===this.configuration.output||1===this.configuration.output&&this.configuration.screenSizePerspective||2===this.configuration.output&&this.configuration.screenSizePerspective||4===this.configuration.output&&this.configuration.screenSizePerspective)&&W.a.bindCamPosition(this.program,t,e.camera.viewInverseTransposeMatrix),2===this.configuration.output&&this.program.setUniformMatrix4fv("viewNormal",e.camera.viewInverseTransposeMatrix),this.configuration.instancedDoublePrecision&&ee.a.bindCustomOrigin(this.program,t),X.a.bindUniforms(this.program,this.configuration,e.slicePlane,t),0===this.configuration.output&&K.a.bindViewCustomOrigin(this.program,e,t)}},{key:"setPipeline",value:function(e,t){var n=this.configuration,r=3===e,a=2===e;return Object(H.d)({blending:0!==n.output&&7!==n.output||!n.transparent?null:r?N.f:Object(N.a)(e),culling:ae(n),depthTest:{func:Object(N.b)(e)},depthWrite:r||a?n.writeDepth&&H.c:null,colorWrite:H.b,stencilWrite:n.sceneHasOcludees?Y.h:null,stencilTest:n.sceneHasOcludees?t?Y.d:Y.c:null,polygonOffset:r||a?null:Object(N.g)(n.enableOffset)})}},{key:"initializePipeline",value:function(){return this._occludeePipelineState=this.setPipeline(this.configuration.transparencyPassType,!0),this.setPipeline(this.configuration.transparencyPassType,!1)}},{key:"getPipelineState",value:function(e){return e?this._occludeePipelineState:this.pipeline}}]),n}(U.a);re.shader=new z.a(ne.a,(function(){return n.e(130).then(n.bind(null,1198))}));var ae=function(e){return function(e){return e.cullFace?0!==e.cullFace:!e.slicePlaneEnabled&&!e.transparent&&!e.doubleSidedMode}(e)&&{face:1===e.cullFace?1028:1029,mode:2305}},oe=function(e){Object(_.a)(n,e);var t=Object(R.a)(n);function n(){var e;return Object(T.a)(this,n),(e=t.apply(this,arguments)).output=0,e.alphaDiscardMode=1,e.doubleSidedMode=0,e.isSchematic=!1,e.vertexColors=!1,e.offsetBackfaces=!1,e.symbolColors=!1,e.vvSize=!1,e.vvColor=!1,e.verticalOffset=!1,e.receiveShadows=!1,e.slicePlaneEnabled=!1,e.sliceHighlightDisabled=!1,e.receiveAmbientOcclusion=!1,e.screenSizePerspective=!1,e.textureAlphaPremultiplied=!1,e.hasColorTexture=!1,e.usePBR=!1,e.hasMetalnessAndRoughnessTexture=!1,e.hasEmissionTexture=!1,e.hasOcclusionTexture=!1,e.hasNormalTexture=!1,e.instanced=!1,e.instancedColor=!1,e.instancedDoublePrecision=!1,e.vertexTangents=!1,e.normalsTypeDerivate=!1,e.writeDepth=!0,e.sceneHasOcludees=!1,e.transparent=!1,e.enableOffset=!0,e.cullFace=0,e.transparencyPassType=3,e}return n}(V.a);Object(D.a)([Object(V.b)({count:8})],oe.prototype,"output",void 0),Object(D.a)([Object(V.b)({count:4})],oe.prototype,"alphaDiscardMode",void 0),Object(D.a)([Object(V.b)({count:3})],oe.prototype,"doubleSidedMode",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"isSchematic",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"vertexColors",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"offsetBackfaces",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"symbolColors",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"vvSize",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"vvColor",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"verticalOffset",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"receiveShadows",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"slicePlaneEnabled",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"sliceHighlightDisabled",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"receiveAmbientOcclusion",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"screenSizePerspective",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"textureAlphaPremultiplied",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"hasColorTexture",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"usePBR",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"hasMetalnessAndRoughnessTexture",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"hasEmissionTexture",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"hasOcclusionTexture",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"hasNormalTexture",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"instanced",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"instancedColor",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"instancedDoublePrecision",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"vertexTangents",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"normalsTypeDerivate",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"writeDepth",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"sceneHasOcludees",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"transparent",void 0),Object(D.a)([Object(V.b)()],oe.prototype,"enableOffset",void 0),Object(D.a)([Object(V.b)({count:3})],oe.prototype,"cullFace",void 0),Object(D.a)([Object(V.b)({count:4})],oe.prototype,"transparencyPassType",void 0);var ie=n(1081),ce=function(e){Object(_.a)(n,e);var t=Object(R.a)(n);function n(){return Object(T.a)(this,n),t.apply(this,arguments)}return Object(M.a)(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get(),r=this.configuration,a=t.build({OITEnabled:0===r.transparencyPassType,output:r.output,viewingMode:e.viewingMode,receiveShadows:r.receiveShadows,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:r.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:r.symbolColors,vvSize:r.vvSize,vvColor:r.vvColor,vvInstancingEnabled:!0,instanced:r.instanced,instancedColor:r.instancedColor,instancedDoublePrecision:r.instancedDoublePrecision,useOldSceneLightInterface:!1,pbrMode:r.usePBR?1:0,hasMetalnessAndRoughnessTexture:!1,hasEmissionTexture:!1,hasOcclusionTexture:!1,hasNormalTexture:!1,hasColorTexture:r.hasColorTexture,receiveAmbientOcclusion:r.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:0,doubleSidedMode:2,vertexTangets:!1,attributeTextureCoordinates:r.hasColorTexture?1:0,textureAlphaPremultiplied:r.textureAlphaPremultiplied,attributeColor:r.vertexColors,screenSizePerspectiveEnabled:r.screenSizePerspective,verticalOffsetEnabled:r.verticalOffset,offsetBackfaces:r.offsetBackfaces,doublePrecisionRequiresObfuscation:Object(Z.b)(e.rctx),alphaDiscardMode:r.alphaDiscardMode,supportsTextureAtlas:!1});return new q.a(e.rctx,a.generateSource("vertex"),a.generateSource("fragment"),G.a)}}]),n}(re);ce.shader=new z.a(ie.a,(function(){return n.e(127).then(n.bind(null,1199))}));var se=function(e){Object(_.a)(n,e);var t=Object(R.a)(n);function n(e,r){var a;return Object(T.a)(this,n),(a=t.call(this,r,e,de)).supportsEdges=!0,a.techniqueConfig=new oe,a.vertexBufferLayout=n.getVertexBufferLayout(a.params),a.instanceBufferLayout=e.instanced?n.getInstanceBufferLayout(a.params):null,a}return Object(M.a)(n,[{key:"isVisibleInPass",value:function(e){return 4!==e||this.params.castShadows}},{key:"isVisible",value:function(){var e=this.params;if(!Object(S.a)(Object(A.a)(n.prototype),"isVisible",this).call(this)||0===e.layerOpacity)return!1;var t=e.instanced,r=e.vertexColors,a=e.symbolColors,o=!!t&&t.indexOf("color")>-1,i=e.vvColorEnabled,c="replace"===e.colorMixMode,s=e.opacity>0,u=e.externalColor&&e.externalColor[3]>0;return r&&(o||i||a)?!!c||s:r?c?u:s:o||i||a?!!c||s:c?u:s}},{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.hasNormalTexture=!!this.params.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.params.textureId,this.techniqueConfig.vertexTangents=this.params.vertexTangents,this.techniqueConfig.instanced=!!this.params.instanced,this.techniqueConfig.instancedDoublePrecision=this.params.instancedDoublePrecision,this.techniqueConfig.vvSize=this.params.vvSizeEnabled,this.techniqueConfig.verticalOffset=null!==this.params.verticalOffset,this.techniqueConfig.screenSizePerspective=null!==this.params.screenSizePerspective,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.sliceHighlightDisabled=this.params.sliceHighlightDisabled,this.techniqueConfig.alphaDiscardMode=this.params.textureAlphaMode,this.techniqueConfig.normalsTypeDerivate="screenDerivative"===this.params.normals,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.cullFace=null!=this.params.cullFace?this.params.cullFace:0,0!==e&&7!==e||(this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.symbolColors=this.params.symbolColors,this.params.treeRendering?this.techniqueConfig.doubleSidedMode=2:this.techniqueConfig.doubleSidedMode=this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===this.params.doubleSidedType?2:0,this.techniqueConfig.instancedColor=!!this.params.instanced&&this.params.instanced.indexOf("color")>-1,this.techniqueConfig.receiveShadows=this.params.receiveShadows&&this.params.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=this.params.receiveSSAO,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.params.textureAlphaPremultiplied,this.techniqueConfig.usePBR=this.params.usePBR,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.params.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.params.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.params.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.params.transparent||!this.params.offsetTransparentBackfaces),this.techniqueConfig.isSchematic=this.params.usePBR&&this.params.isSchematic,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<N.e),this.techniqueConfig}},{key:"intersect",value:function(e,t,n,r,a,o,i){if(null!==this.params.verticalOffset){var c=r.camera;Object(l.t)(xe,n[12],n[13],n[14]);var s=null;switch(r.viewingMode){case 1:s=Object(l.o)(be,xe);break;case 2:s=Object(l.h)(be,me)}var u=0;if(null!==this.params.verticalOffset){var d=Object(l.g)(ge,xe,c.eye),f=Object(l.m)(d),v=Object(l.b)(d,d,1/f),p=null;this.params.screenSizePerspective&&(p=Object(l.e)(s,v)),u+=Object(I.f)(c,f,this.params.verticalOffset,p,this.params.screenSizePerspective)}Object(l.b)(s,s,u),Object(l.u)(he,s,r.transform.inverseRotation),a=Object(l.g)(ve,a,he),o=Object(l.g)(pe,o,he)}Object(I.d)(e,t,r,a,o,Object(B.f)(r.verticalOffset),i)}},{key:"getGLMaterial",value:function(e){if(0===e.output||7===e.output||1===e.output||2===e.output||3===e.output||4===e.output)return new ue(e)}},{key:"createBufferWriter",value:function(){return new fe(this.vertexBufferLayout,this.instanceBufferLayout)}}],[{key:"getVertexBufferLayout",value:function(e){var t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,n=Object(P.a)().vec3f("position").vec3f("normal");return e.vertexTangents&&n.vec4f("tangent"),t&&n.vec2f("uv0"),e.vertexColors&&n.vec4u8("color"),e.symbolColors&&n.vec4u8("symbolColor"),n}},{key:"getInstanceBufferLayout",value:function(e){var t=Object(P.a)();return t=e.instancedDoublePrecision?t.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):t.mat4f("model").mat4f("modelNormal"),e.instanced&&e.instanced.indexOf("color")>-1&&(t=t.vec4f("instanceColor")),e.instanced&&e.instanced.indexOf("featureAttribute")>-1&&(t=t.vec4f("instanceFeatureAttribute")),t}}]),n}(L.a),ue=function(e){Object(_.a)(n,e);var t=Object(R.a)(n);function n(e){var r;Object(T.a)(this,n);var a=e.material;return(r=t.call(this,Object(i.a)(Object(i.a)({},e),a.params))).updateParameters(),r}return Object(M.a)(n,[{key:"updateParameters",value:function(e){var t=this.material.params;this.updateTexture(t.textureId),this.technique=t.treeRendering?this.techniqueRep.acquireAndReleaseExisting(ce,this.material.getTechniqueConfig(this.output,e),this.technique):this.techniqueRep.acquireAndReleaseExisting(re,this.material.getTechniqueConfig(this.output,e),this.technique)}},{key:"selectPipelines",value:function(){}},{key:"_updateShadowState",value:function(e){e.shadowMappingEnabled!==this.material.params.shadowMappingEnabled&&this.material.setParameterValues({shadowMappingEnabled:e.shadowMappingEnabled})}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this.material.params.sceneHasOcludees&&this.material.setParameterValues({sceneHasOcludees:e.hasOccludees})}},{key:"ensureParameters",value:function(e){0!==this.output&&7!==this.output||(this._updateShadowState(e),this._updateOccludeeState(e)),this.updateParameters(e)}},{key:"bind",value:function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.params,t),this.bindTexture(e,this.technique.program)}},{key:"beginSlot",value:function(e){return e===(this.material.params.transparent?this.material.params.writeDepth?5:8:3)}},{key:"getPipelineState",value:function(e,t){return this.technique.getPipelineState(t)}}]),n}(k.a),le=2.1,de=Object(i.a)({textureId:void 0,initTextureTransparent:!1,isSchematic:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],mrrFactors:[0,1,.5],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,receiveShadows:!0,castShadows:!0,shadowMappingEnabled:!1,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:Object(v.a)(),transparent:!1,writeDepth:!0,textureAlphaMode:0,textureAlphaCutoff:E.b,textureAlphaPremultiplied:!1,sceneHasOcludees:!1},L.b),fe=function(){function e(t,n){Object(T.a)(this,e),this.vertexBufferLayout=t,this.instanceBufferLayout=n}return Object(M.a)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.position.length}},{key:"write",value:function(e,t,n,r){Object(F.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,n,r)}}]),e}(),ve=Object(u.e)(),pe=Object(u.e)(),me=Object(u.g)(0,0,1),be=Object(u.e)(),he=Object(u.e)(),xe=Object(u.e)(),ge=Object(u.e)(),Oe=n(360),ye=n(20),je=n(12),we=n(17),Ce=n(66),Te=n(322),Me=function(){function e(t){Object(T.a)(this,e),this.streamDataRequester=t}return Object(M.a)(e,[{key:"loadJSON",value:function(){var e=Object(c.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.load("json",t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadBinary",value:function(){var e=Object(c.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(je.u)(t)?(Object(we.u)(n),Object(je.j)(t)):this.load("binary",t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadImage",value:function(){var e=Object(c.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.load("image",t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=Object(c.a)(a.a.mark((function e(t,n,r){var o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(s.g)(this.streamDataRequester)){e.next=4;break}return e.next=3,Object(Ce.default)(n,{responseType:Se[t]});case 3:return e.abrupt("return",e.sent.data);case 4:return e.next=6,Object(Te.c)(this.streamDataRequester.request(n,t,r));case 6:if(!0!==(o=e.sent).ok){e.next=9;break}return e.abrupt("return",o.value);case 9:throw Object(we.t)(o.error),new ye.a("","Request for resource failed: ".concat(o.error));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),e}(),Se={image:"image",binary:"array-buffer",json:"json"},Ae=n(599);function _e(e,t,n){for(var r=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,i=t.typedBufferStride,c=n?n.count:t.count,s=(n&&n.dstIndex?n.dstIndex:0)*a,u=(n&&n.srcIndex?n.srcIndex:0)*i,l=0;l<c;++l)r[s]=o[u],r[s+1]=o[u+1],s+=a,u+=i}function Re(e,t,n){var r=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,i=t.typedBufferStride,c=n?n.count:t.count,s=(n&&n.dstIndex?n.dstIndex:0)*a,u=(n&&n.srcIndex?n.srcIndex:0)*i;if(Object(Ae.b)(t.elementType)){var l=Object(Ae.d)(t.elementType);if(Object(Ae.c)(t.elementType))for(var d=0;d<c;++d)r[s]=Math.max(o[u]/l,-1),r[s+1]=Math.max(o[u+1]/l,-1),s+=a,u+=i;else for(var f=0;f<c;++f)r[s]=o[u]/l,r[s+1]=o[u+1]/l,s+=a,u+=i}else _e(e,t,n);return e}Object.freeze({__proto__:null,copy:_e,normalizeIntegerBuffer:Re});function Pe(e,t,n){for(var r=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,i=t.typedBufferStride,c=n?n.count:t.count,s=(n&&n.dstIndex?n.dstIndex:0)*a,u=(n&&n.srcIndex?n.srcIndex:0)*i,l=0;l<c;++l)r[s]=o[u],r[s+1]=o[u+1],r[s+2]=o[u+2],s+=a,u+=i}Object.freeze({__proto__:null,copy:Pe});function Be(e,t,n){for(var r=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,i=t.typedBufferStride,c=n?n.count:t.count,s=(n&&n.dstIndex?n.dstIndex:0)*a,u=(n&&n.srcIndex?n.srcIndex:0)*i,l=0;l<c;++l)r[s]=o[u],r[s+1]=o[u+1],r[s+2]=o[u+2],r[s+3]=o[u+3],s+=a,u+=i}function ke(e,t,n,r,a,o){for(var i=e.typedBuffer,c=e.typedBufferStride,s=o?o.count:e.count,u=(o&&o.dstIndex?o.dstIndex:0)*c,l=0;l<s;++l)i[u]=t,i[u+1]=n,i[u+2]=r,i[u+3]=a,u+=c}Object.freeze({__proto__:null,copy:Be,fill:ke});Object.freeze({__proto__:null,copy:function(e,t,n){for(var r=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,i=t.typedBufferStride,c=n?n.count:t.count,s=(n&&n.dstIndex?n.dstIndex:0)*a,u=(n&&n.srcIndex?n.srcIndex:0)*i,l=0;l<c;++l){for(var d=0;d<9;++d)r[s+d]=o[u+d];s+=a,u+=i}}});Object.freeze({__proto__:null,copy:function(e,t,n){for(var r=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,i=t.typedBufferStride,c=n?n.count:t.count,s=(n&&n.dstIndex?n.dstIndex:0)*a,u=(n&&n.srcIndex?n.srcIndex:0)*i,l=0;l<c;++l){for(var d=0;d<16;++d)r[s+d]=o[u+d];s+=a,u+=i}}});function Ie(e,t){var n=e.count;t||(t=new e.TypedArrayConstructor(n));for(var r=0;r<n;r++)t[r]=e.get(r);return t}Object.freeze({__proto__:null,copy:function(e,t,n){for(var r=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,i=t.typedBufferStride,c=n?n.count:t.count,s=(n&&n.dstIndex?n.dstIndex:0)*a,u=(n&&n.srcIndex?n.srcIndex:0)*i,l=0;l<c;++l)r[s]=o[u],s+=a,u+=i},makeDense:Ie});function Le(e,t){return new e(new ArrayBuffer(t*e.ElementCount*Object(Ae.a)(e.ElementType)))}var Fe=n(39),Ee=h.a.getLogger("esri.views.3d.glTF"),Ne=function(){function e(){Object(T.a)(this,e)}return Object(M.a)(e,[{key:"error",value:function(e){throw new ye.a("gltf-loader-error",e)}},{key:"errorUnsupported",value:function(e){throw new ye.a("gltf-loader-unsupported-feature",e)}},{key:"errorUnsupportedIf",value:function(e,t){e&&this.errorUnsupported(t)}},{key:"assert",value:function(e,t){e||this.error(t)}},{key:"warn",value:function(e){Ee.warn(e)}},{key:"warnUnsupported",value:function(e){this.warn("[Unsupported Feature] "+e)}},{key:"warnUnsupportedIf",value:function(e,t){e&&this.warnUnsupported(t)}}]),e}();var De=n(185),ze=n(32),Ue=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";Object(T.a)(this,e),this.major=t,this.minor=n,this._context=r}return Object(M.a)(e,[{key:"lessThan",value:function(e,t){return this.major<e||e===this.major&&this.minor<t}},{key:"since",value:function(e,t){return!this.lessThan(e,t)}},{key:"validate",value:function(e){if(this.major!==e.major){var t=this._context&&this._context+":",n=this._context&&this._context+" ";throw new ye.a(t+"unsupported-version","Required major ".concat(n,"version is '").concat(this.major,"', but got '${version.major}.${version.minor}'"),{version:e})}}},{key:"clone",value:function(){return new e(this.major,this.minor,this._context)}}],[{key:"parse",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=t.split("."),a=Object(ze.a)(r,2),o=a[0],i=a[1],c=/^\s*\d+\s*$/;if(!o||!o.match||!o.match(c))throw new ye.a((n&&n+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:t});if(!i||!i.match||!i.match(c))throw new ye.a((n&&n+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:t});var s=parseInt(o,10),u=parseInt(i,10);return new e(s,u,n)}}]),e}(),Ve=n(301),Ge=n(532),qe=function(){function e(t){Object(T.a)(this,e),this.data=t,this.offset4=0,this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}return Object(M.a)(e,[{key:"readUint32",value:function(){var e=this.offset4;return this.offset4+=1,this.dataUint32[e]}},{key:"readUint8Array",value:function(e){var t=4*this.offset4;return this.offset4+=e/4,new Uint8Array(this.data,t,e)}},{key:"remainingBytes",value:function(){return this.data.byteLength-4*this.offset4}}]),e}(),He={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},We={pbrMetallicRoughness:He,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},Xe={ESRI_externalColorMixMode:"tint"},Je=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object(i.a)(Object(i.a)({},He),e.pbrMetallicRoughness),n=function(e){switch(e.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:Object(De.a)(e.ESRI_externalColorMixMode),e.ESRI_externalColorMixMode="tint"}return e}(Object(i.a)(Object(i.a)({},Xe),e.extras));return Object(i.a)(Object(i.a)(Object(i.a)({},We),e),{},{pbrMetallicRoughness:t,extras:n})},Qe={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497},$e=function(e){return Object(i.a)(Object(i.a)({},Qe),e)};var Ye=function(){function e(t,n,r,a,o){Object(T.a)(this,e),this.context=t,this.errorContext=n,this.uri=r,this.json=a,this.glbBuffer=o,this.bufferCache=new Map,this.textureCache=new Map,this.materialCache=new Map,this.nodeParentMap=new Map,this.nodeTransformCache=new Map,this.baseUri=function(e){var t,n;return e.replace(/^(.*\/)?([^/]*)$/,(function(e,r,a){return t=r||"",n=a||"",""})),{dirPart:t,filePart:n}}(this.uri).dirPart,this.checkVersionSupported(),this.checkRequiredExtensionsSupported(),n.errorUnsupportedIf(null==a.scenes,"Scenes must be defined."),n.errorUnsupportedIf(null==a.meshes,"Meshes must be defined"),n.errorUnsupportedIf(null==a.nodes,"Nodes must be defined."),this.computeNodeParents()}return Object(M.a)(e,[{key:"getBuffer",value:function(){var e=Object(c.a)(a.a.mark((function e(t,n){var r,o,i,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.json.buffers[t],o=this.errorContext,null!=r.uri){e.next=3;break}return e.abrupt("return",(o.assert(null!=this.glbBuffer,"GLB buffer not present"),this.glbBuffer));case 3:if(i=this.bufferCache.get(t)){e.next=9;break}return e.next=7,this.context.loadBinary(this.resolveUri(r.uri),n);case 7:c=e.sent,i=new Uint8Array(c),this.bufferCache.set(t,i),o.assert(i.byteLength===r.byteLength,"Buffer byte lengths should match.");case 9:return e.abrupt("return",i);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAccessor",value:function(){var e=Object(c.a)(a.a.mark((function e(t,n){var r,o,i,c,s,u,l,d;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.json.accessors[t],(o=this.errorContext).errorUnsupportedIf(null==r.bufferView,"Some accessor does not specify a bufferView."),o.errorUnsupportedIf(r.type in["MAT2","MAT3","MAT4"],"AttributeType ".concat(r.type," is not supported")),i=this.json.bufferViews[r.bufferView],e.next=5,this.getBuffer(i.buffer,n);case 5:return c=e.sent,s=tt[r.type],u=nt[r.componentType],l=s*u,d=i.byteStride||l,e.abrupt("return",{raw:c.buffer,byteStride:d,byteOffset:c.byteOffset+(i.byteOffset||0)+(r.byteOffset||0),entryCount:r.count,isDenselyPacked:d===l,componentCount:s,componentByteSize:u,componentType:r.componentType,min:r.min,max:r.max,normalized:!!r.normalized});case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getIndexData",value:function(){var e=Object(c.a)(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t.indices){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,this.getAccessor(t.indices,n);case 4:if(!(r=e.sent).isDenselyPacked){e.next=14;break}e.t0=r.componentType,e.next=5121===e.t0?9:5123===e.t0?10:5125===e.t0?11:12;break;case 9:return e.abrupt("return",new Uint8Array(r.raw,r.byteOffset,r.entryCount));case 10:return e.abrupt("return",new Uint16Array(r.raw,r.byteOffset,r.entryCount));case 11:return e.abrupt("return",new Uint32Array(r.raw,r.byteOffset,r.entryCount));case 12:e.next=20;break;case 14:e.t1=r.componentType,e.next=5121===e.t1?17:5123===e.t1?18:5125===e.t1?19:20;break;case 17:return e.abrupt("return",Ie(this.wrapAccessor(b.l,r)));case 18:return e.abrupt("return",Ie(this.wrapAccessor(b.j,r)));case 19:return e.abrupt("return",Ie(this.wrapAccessor(b.k,r)));case 20:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getPositionData",value:function(){var e=Object(c.a)(a.a.mark((function e(t,n){var r,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=this.errorContext).errorUnsupportedIf(null==t.attributes.POSITION,"No POSITION vertex data found."),e.next=4,this.getAccessor(t.attributes.POSITION,n);case 4:return o=e.sent,e.abrupt("return",(r.errorUnsupportedIf(5126!==o.componentType,"Expected type FLOAT for POSITION vertex attribute, but found "+ot[o.componentType]),r.errorUnsupportedIf(3!==o.componentCount,"POSITION vertex attribute must have 3 components, but found "+o.componentCount.toFixed()),this.wrapAccessor(b.u,o)));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNormalData",value:function(){var e=Object(c.a)(a.a.mark((function e(t,n){var r,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=this.errorContext).assert(null!=t.attributes.NORMAL,"No NORMAL vertex data found."),e.next=4,this.getAccessor(t.attributes.NORMAL,n);case 4:return o=e.sent,e.abrupt("return",(r.errorUnsupportedIf(5126!==o.componentType,"Expected type FLOAT for NORMAL vertex attribute, but found "+ot[o.componentType]),r.errorUnsupportedIf(3!==o.componentCount,"NORMAL vertex attribute must have 3 components, but found "+o.componentCount.toFixed()),this.wrapAccessor(b.u,o)));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getTangentData",value:function(){var e=Object(c.a)(a.a.mark((function e(t,n){var r,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=this.errorContext).assert(null!=t.attributes.TANGENT,"No TANGENT vertex data found."),e.next=4,this.getAccessor(t.attributes.TANGENT,n);case 4:return o=e.sent,e.abrupt("return",(r.errorUnsupportedIf(5126!==o.componentType,"Expected type FLOAT for TANGENT vertex attribute, but found "+ot[o.componentType]),r.errorUnsupportedIf(4!==o.componentCount,"TANGENT vertex attribute must have 4 components, but found "+o.componentCount.toFixed()),new b.C(o.raw,o.byteOffset,o.byteStride,o.byteOffset+o.byteStride*o.entryCount)));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getTextureCoordinates",value:function(){var e=Object(c.a)(a.a.mark((function e(t,n){var r,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=this.errorContext).assert(null!=t.attributes.TEXCOORD_0,"No TEXCOORD_0 vertex data found."),e.next=4,this.getAccessor(t.attributes.TEXCOORD_0,n);case 4:return o=e.sent,e.abrupt("return",(r.errorUnsupportedIf(2!==o.componentCount,"TEXCOORD_0 vertex attribute must have 2 components, but found "+o.componentCount.toFixed()),5126===o.componentType?this.wrapAccessor(b.m,o):(r.errorUnsupportedIf(!o.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0."),function(e){switch(e.componentType){case 5120:return new b.q(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5121:return new b.t(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5122:return new b.o(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5123:return new b.r(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5125:return new b.s(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5126:return new b.m(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);default:return void Object(De.a)(e.componentType)}}(o))));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getVertexColors",value:function(){var e=Object(c.a)(a.a.mark((function e(t,n){var r,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=this.errorContext).assert(null!=t.attributes.COLOR_0,"No COLOR_0 vertex data found."),e.next=4,this.getAccessor(t.attributes.COLOR_0,n);case 4:if(o=e.sent,r.errorUnsupportedIf(4!==o.componentCount&&3!==o.componentCount,"COLOR_0 attribute must have 3 or 4 components, but found "+o.componentCount.toFixed()),4!==o.componentCount){e.next=14;break}if(5126!==o.componentType){e.next=8;break}return e.abrupt("return",this.wrapAccessor(b.C,o));case 8:if(5121!==o.componentType){e.next=10;break}return e.abrupt("return",this.wrapAccessor(b.J,o));case 10:if(5123!==o.componentType){e.next=12;break}return e.abrupt("return",this.wrapAccessor(b.H,o));case 12:e.next=21;break;case 14:if(3!==o.componentCount){e.next=21;break}if(5126!==o.componentType){e.next=17;break}return e.abrupt("return",this.wrapAccessor(b.u,o));case 17:if(5121!==o.componentType){e.next=19;break}return e.abrupt("return",this.wrapAccessor(b.B,o));case 19:if(5123!==o.componentType){e.next=21;break}return e.abrupt("return",this.wrapAccessor(b.z,o));case 21:r.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+ot[o.componentType]);case 22:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"hasPositions",value:function(e){return void 0!==e.attributes.POSITION}},{key:"hasNormals",value:function(e){return void 0!==e.attributes.NORMAL}},{key:"hasVertexColors",value:function(e){return void 0!==e.attributes.COLOR_0}},{key:"hasTextureCoordinates",value:function(e){return void 0!==e.attributes.TEXCOORD_0}},{key:"hasTangents",value:function(e){return void 0!==e.attributes.TANGENT}},{key:"getMaterial",value:function(){var e=Object(c.a)(a.a.mark((function e(t,n){var r,o,i,c,s,u,l,d,f,v,p;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.errorContext,o=this.materialCache.get(t.material)){e.next=48;break}if(i=null!=t.material?Je(this.json.materials[t.material]):Je(),c=i.pbrMetallicRoughness,s=this.hasVertexColors(t),e.t0=c.baseColorTexture,!e.t0){e.next=10;break}return r.errorUnsupportedIf(0!==(c.baseColorTexture.texCoord||0),"Only TEXCOORD with index 0 is supported."),e.next=9,this.getTexture(c.baseColorTexture.index,n);case 9:u=e.sent;case 10:if(e.t1=i.normalTexture,!e.t1){e.next=19;break}if(0===(i.normalTexture.texCoord||0)){e.next=16;break}r.warnUnsupported("Only TEXCOORD with index 0 is supported for the normal map texture."),e.next=19;break;case 16:return e.next=18,this.getTexture(i.normalTexture.index,n);case 18:l=e.sent;case 19:if(e.t2=i.occlusionTexture,!e.t2){e.next=28;break}if(0===(i.occlusionTexture.texCoord||0)){e.next=25;break}r.warnUnsupported("Only TEXCOORD with index 0 is supported for the occlusion texture."),e.next=28;break;case 25:return e.next=27,this.getTexture(i.occlusionTexture.index,n);case 27:d=e.sent;case 28:if(e.t3=i.emissiveTexture,!e.t3){e.next=37;break}if(0===(i.emissiveTexture.texCoord||0)){e.next=34;break}r.warnUnsupported("Only TEXCOORD with index 0 is supported for the emissive texture."),e.next=37;break;case 34:return e.next=36,this.getTexture(i.emissiveTexture.index,n);case 36:f=e.sent;case 37:if(e.t4=c.metallicRoughnessTexture,!e.t4){e.next=46;break}if(0===(c.metallicRoughnessTexture.texCoord||0)){e.next=43;break}r.warnUnsupported("Only TEXCOORD with index 0 is supported for the metallicRoughness texture."),e.next=46;break;case 43:return e.next=45,this.getTexture(c.metallicRoughnessTexture.index,n);case 45:v=e.sent;case 46:p=null!=t.material?t.material:-1,o={alphaMode:i.alphaMode,alphaCutoff:i.alphaCutoff,color:c.baseColorFactor,doubleSided:!!i.doubleSided,colorTexture:u,normalTexture:l,name:i.name,id:p,occlusionTexture:d,emissiveTexture:f,emissiveFactor:i.emissiveFactor,metallicFactor:c.metallicFactor,roughnessFactor:c.roughnessFactor,metallicRoughnessTexture:v,vertexColors:s,ESRI_externalColorMixMode:i.extras.ESRI_externalColorMixMode};case 48:return e.abrupt("return",o);case 49:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getTexture",value:function(){var e=Object(c.a)(a.a.mark((function e(t,n){var r,o,i,s,u,l,d,f;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.errorContext,o=this.json.textures[t],i=$e(null!=o.sampler?this.json.samplers[o.sampler]:{}),r.errorUnsupportedIf(null==o.source,"Source is expected to be defined for a texture."),s=this.json.images[o.source],u=this.textureCache.get(t)){e.next=21;break}if(!s.uri){e.next=11;break}return e.next=8,this.context.loadImage(this.resolveUri(s.uri),n);case 8:l=e.sent,e.next=20;break;case 11:return r.errorUnsupportedIf(null==s.bufferView,"Image bufferView must be defined."),r.errorUnsupportedIf(null==s.mimeType,"Image mimeType must be defined."),d=this.json.bufferViews[s.bufferView],e.next=15,this.getBuffer(d.buffer,n);case 15:return f=e.sent,r.errorUnsupportedIf(null!=d.byteStride,"byteStride not supported for image buffer"),e.next=19,function(){var e=Object(c.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(we.c)((function(e,r){var a=new Blob([t],{type:n}),o=URL.createObjectURL(a),i=new Image;i.addEventListener("load",(function(){URL.revokeObjectURL(o),"decode"in i?i.decode().then((function(){return e(i)}),(function(){return e(i)})):e(i)})),i.addEventListener("error",(function(e){URL.revokeObjectURL(o),r(e)})),i.src=o})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(new Uint8Array(f.buffer,f.byteOffset+(d.byteOffset||0),d.byteLength),s.mimeType);case 19:l=e.sent;case 20:u={data:l,wrapS:i.wrapS,wrapT:i.wrapT,minFilter:i.minFilter,name:s.name,id:t},this.textureCache.set(t,u);case 21:return e.abrupt("return",u);case 22:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNodeTransform",value:function(e){if(void 0===e)return Ze;var t=this.nodeTransformCache.get(e);if(!t){var n=this.getNodeTransform(this.getNodeParent(e)),r=this.json.nodes[e];r.matrix?t=Object(d.l)(Object(p.b)(),n,r.matrix):r.translation||r.rotation||r.scale?(t=Object(p.c)(n),r.translation&&Object(d.q)(t,t,r.translation),r.rotation&&(et[3]=Object(Ge.b)(et,r.rotation),Object(d.o)(t,t,et[3],et)),r.scale&&Object(d.p)(t,t,r.scale)):t=n,this.nodeTransformCache.set(e,t)}return t}},{key:"wrapAccessor",value:function(e,t){return new e(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*(t.entryCount-1)+t.componentByteSize*t.componentCount)}},{key:"resolveUri",value:function(e){return Object(je.y)(e,this.baseUri)}},{key:"getNodeParent",value:function(e){return this.nodeParentMap.get(e)}},{key:"checkVersionSupported",value:function(){var e=Ue.parse(this.json.asset.version,"glTF");Ke.validate(e)}},{key:"checkRequiredExtensionsSupported",value:function(){var e=this.json,t=this.errorContext;e.extensionsRequired&&0!==e.extensionsRequired.length&&t.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}},{key:"computeNodeParents",value:function(){var e=this;this.json.nodes.forEach((function(t,n){t.children&&t.children.forEach((function(t){e.nodeParentMap.set(t,n)}))}))}}],[{key:"load",value:function(){var t=Object(c.a)(a.a.mark((function t(n,r,o,i){var c,s,u,l,d,f;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Object(je.u)(o)){t.next=13;break}if("model/gltf-binary"===(c=Object(je.i)(o)).mediaType){t.next=10;break}return t.prev=3,s=JSON.parse(c.isBase64?atob(c.data):c.data),t.abrupt("return",new e(n,r,o,s));case 8:t.prev=8,t.t0=t.catch(3);case 10:if(u=Object(je.j)(o),!e.isGLBData(u)){t.next=13;break}return t.abrupt("return",this.fromGLBData(n,r,o,u));case 13:if(!o.endsWith(".gltf")){t.next=18;break}return t.next=16,n.loadJSON(o,i);case 16:return l=t.sent,t.abrupt("return",new e(n,r,o,l));case 18:return t.next=20,n.loadBinary(o,i);case 20:if(d=t.sent,!e.isGLBData(d)){t.next=23;break}return t.abrupt("return",this.fromGLBData(n,r,o,d));case 23:return t.next=25,n.loadJSON(o,i);case 25:return f=t.sent,t.abrupt("return",new e(n,r,o,f));case 27:case"end":return t.stop()}}),t,this,[[3,8]])})));return function(e,n,r,a){return t.apply(this,arguments)}}()},{key:"isGLBData",value:function(e){var t=new qe(e);return t.remainingBytes()>=4&&1179937895===t.readUint32()}},{key:"fromGLBData",value:function(){var t=Object(c.a)(a.a.mark((function t(n,r,o,i){var c;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.parseGLBData(r,i);case 2:return c=t.sent,t.abrupt("return",new e(n,r,o,c.json,c.binaryData));case 4:case"end":return t.stop()}}),t)})));return function(e,n,r,a){return t.apply(this,arguments)}}()},{key:"parseGLBData",value:function(){var e=Object(c.a)(a.a.mark((function e(t,n){var r,o,i,c,s,u,l,d,f;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new qe(n),t.assert(r.remainingBytes()>=12,"GLB binary data is insufficiently large."),o=r.readUint32(),i=r.readUint32(),c=r.readUint32(),t.assert(1179937895===o,"Magic first 4 bytes do not fit to expected GLB value."),t.assert(n.byteLength>=c,"GLB binary data is smaller than header specifies."),t.errorUnsupportedIf(2!==i,"An unsupported GLB container version was detected. Only version 2 is supported."),l=0;case 5:if(!(r.remainingBytes()>=8)){e.next=19;break}if(d=r.readUint32(),f=r.readUint32(),0!==l){e.next=15;break}return t.assert(1313821514===f,"First GLB chunk must be JSON."),t.assert(d>=0,"No JSON data found."),e.next=12,rt(r.readUint8Array(d));case 12:s=e.sent,e.next=16;break;case 15:1===l?(t.errorUnsupportedIf(5130562!==f,"Second GLB chunk expected to be BIN."),u=r.readUint8Array(d)):t.warnUnsupported("More than 2 GLB chunks detected. Skipping.");case 16:l+=1;case 17:e.next=5;break;case 19:return e.abrupt("return",(s||t.error("No GLB JSON chunk detected."),{json:s,binaryData:u}));case 20:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),Ke=new Ue(2,0,"glTF"),Ze=Object(d.j)(Object(p.b)(),Math.PI/2),et=Object(Ve.a)(),tt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},nt={5120:1,5121:1,5122:2,5123:2,5126:4,5125:4};function rt(e){return at.apply(this,arguments)}function at(){return(at=Object(c.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(we.c)((function(e,n){var r=new Blob([t]),a=new FileReader;a.onload=function(){var t=a.result;e(JSON.parse(t))},a.onerror=function(e){n(e)},a.readAsText(r)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ot={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"},it=0;function ct(e,t){return st.apply(this,arguments)}function st(){return(st=Object(c.a)(a.a.mark((function e(t,n){var r,i,u,l,d,f=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=f.length>2&&void 0!==f[2]?f[2]:{},e.next=3,Ye.load(t,vt,n,r);case 3:return i=e.sent,u="gltf_"+it++,l={lods:[],materials:new Map,textures:new Map,meta:ut(i)},d=!(!i.json.asset.extras||"symbolResource"!==i.json.asset.extras.ESRI_type),e.next=9,function(){var e=Object(c.a)(a.a.mark((function e(t,n){var r,i,s,u,l,d,f,v,p,m,b;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b=function(){return(b=Object(c.a)(a.a.mark((function e(i,c){var s,u,l,d,f,v,p,b,h;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=r.nodes[i],u=t.getNodeTransform(i),vt.warnUnsupportedIf(null!=s.weights,"Morph targets are not supported."),null==s.mesh){e.next=20;break}l=r.meshes[s.mesh],d=Object(o.a)(l.primitives),e.prev=4,d.s();case 6:if((f=d.n()).done){e.next=12;break}return v=f.value,e.next=10,n(v,u,c,l.name);case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),d.e(e.t0);case 17:return e.prev=17,d.f(),e.finish(17);case 20:p=Object(o.a)(s.children||[]),e.prev=21,p.s();case 23:if((b=p.n()).done){e.next=29;break}return h=b.value,e.next=27,m(h,c);case 27:e.next=23;break;case 29:e.next=34;break;case 31:e.prev=31,e.t1=e.catch(21),p.e(e.t1);case 34:return e.prev=34,p.f(),e.finish(34);case 37:case"end":return e.stop()}}),e,null,[[4,14,17,20],[21,31,34,37]])})))).apply(this,arguments)},m=function(e,t){return b.apply(this,arguments)},r=t.json,i=r.scenes[r.scene||0].nodes,s=i.length>1,u=Object(o.a)(i),e.prev=4,u.s();case 6:if((l=u.n()).done){e.next=14;break}return d=l.value,f=r.nodes[d],v=[m(d,0)],lt(f)&&!s&&(p=f.extensions.MSFT_lod.ids,v.push.apply(v,Object(Fe.a)(p.map((function(e,t){return m(e,t+1)}))))),e.next=12,Object(we.b)(v);case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),u.e(e.t0);case 19:return e.prev=19,u.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[4,16,19,22]])})));return function(t,n){return e.apply(this,arguments)}}()(i,function(){var e=Object(c.a)(a.a.mark((function e(t,n,o,c){var d,f,v,m,b;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d=void 0!==t.mode?t.mode:4,f=function(e){switch(e){case 4:case 5:case 6:return e;default:return null}}(d),!Object(s.g)(f)){e.next=3;break}return e.abrupt("return",void vt.warnUnsupported("Unsupported primitive mode ("+mt[d]+"). Skipping primitive."));case 3:if(i.hasPositions(t)){e.next=5;break}return e.abrupt("return",void vt.warn("Skipping primitive without POSITION vertex attribute."));case 5:return e.next=7,i.getMaterial(t,r);case 7:return v=e.sent,e.t0=Object(p.c)(n),e.next=11,i.getPositionData(t,r);case 11:return e.t1=e.sent,e.t2={position:e.t1,normal:null,texCoord0:null,color:null,tangent:null},e.next=15,i.getIndexData(t,r);case 15:if(e.t3=e.sent,e.t4=f,e.t5=dt(l,v,u),m={transform:e.t0,attributes:e.t2,indices:e.t3,primitiveType:e.t4,material:e.t5},e.t6=i.hasNormals(t),!e.t6){e.next=24;break}return e.next=23,i.getNormalData(t,r);case 23:m.attributes.normal=e.sent;case 24:if(e.t7=i.hasTangents(t),!e.t7){e.next=29;break}return e.next=28,i.getTangentData(t,r);case 28:m.attributes.tangent=e.sent;case 29:if(e.t8=i.hasTextureCoordinates(t),!e.t8){e.next=34;break}return e.next=33,i.getTextureCoordinates(t,r);case 33:m.attributes.texCoord0=e.sent;case 34:if(e.t9=i.hasVertexColors(t),!e.t9){e.next=39;break}return e.next=38,i.getVertexColors(t,r);case 38:m.attributes.color=e.sent;case 39:b=null,Object(s.h)(l.meta)&&Object(s.h)(l.meta.ESRI_lod)&&"screenSpaceRadius"===l.meta.ESRI_lod.metric&&(b=l.meta.ESRI_lod.thresholds[o]),l.lods[o]=l.lods[o]||{parts:[],name:c,lodThreshold:b},l.lods[o].parts.push(m);case 41:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}());case 9:return e.abrupt("return",{model:l,meta:{isEsriSymbolResource:d,uri:i.uri},customMeta:{}});case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ut(e){var t=e.json,n=null;return t.nodes.forEach((function(e){var t=e.extras;Object(s.h)(t)&&(t.ESRI_proxyEllipsoid||t.ESRI_lod)&&(n=t)})),n}function lt(e){return e.extensions&&e.extensions.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}function dt(e,t,n){var r=function(t){var r="".concat(n,"_tex_").concat(t&&t.id).concat(t&&t.name?"_"+t.name:"");if(t&&!e.textures.has(r)){var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{data:e,parameters:Object(i.a)({wrap:Object(i.a)({s:10497,t:10497},t.wrap),noUnpackFlip:!0,mipmap:!1},t)}}(t.data,{wrap:{s:ft(t.wrapS),t:ft(t.wrapT)},mipmap:pt.some((function(e){return e===t.minFilter})),noUnpackFlip:!0});e.textures.set(r,a)}return r},a="".concat(n,"_mat_").concat(t.id,"_").concat(t.name);if(!e.materials.has(a)){var o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i.a)({color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply"},e)}({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?r(t.colorTexture):void 0,textureNormal:t.normalTexture?r(t.normalTexture):void 0,textureOcclusion:t.occlusionTexture?r(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?r(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?r(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor});e.materials.set(a,o)}return a}function ft(e){if(33071===e||33648===e||10497===e)return e;vt.error("Unexpected TextureSampler WrapMode: ".concat(e))}var vt=new Ne,pt=[9987,9985],mt=["POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN"],bt=n(109),ht=n(219);function xt(e){return"number"==typeof e?(t=e,Object(ht.d)(t)):Object(bt.i)(e)||Object(bt.k)(e)?new Uint32Array(e):e;var t}var gt=n(23),Ot=n(629),yt=h.a.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");function jt(e,t){return wt.apply(this,arguments)}function wt(){return(wt=Object(c.a)(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,function(){var e=Object(c.a)(a.a.mark((function e(t,n){var r,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=Object(s.h)(n)&&n.streamDataRequester)){e.next=3;break}return e.abrupt("return",function(){var e=Object(c.a)(a.a.mark((function e(t,n,r){var o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Te.c)(n.request(t,"json",r));case 2:if(!0!==(o=e.sent).ok){e.next=5;break}return e.abrupt("return",o.value);case 5:return e.abrupt("return",(Object(we.t)(o.error),void Ct(o.error.details.url)));case 6:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()(t,r,n));case 3:return e.next=5,Object(Te.c)(Object(Ce.default)(t,Object(s.n)(n)));case 5:if(!0!==(o=e.sent).ok){e.next=8;break}return e.abrupt("return",o.value.data);case 8:return e.abrupt("return",(Object(we.t)(o.error),void Ct(o.error)));case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 2:return r=e.sent,e.t0=r,e.next=6,At(r.textureDefinitions,n);case 6:return e.t1=e.sent,e.abrupt("return",{resource:e.t0,textures:e.t1});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ct(e){throw new ye.a("","Request for object resource failed: ".concat(e))}function Tt(e){var t=e.params,n=t.topology,r=!0;switch(t.vertexAttributes||(yt.warn("Geometry must specify vertex attributes"),r=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:var a=t.faces;if(a){if(t.vertexAttributes)for(var o in t.vertexAttributes){var i=a[o];i&&i.values?(null!=i.valueType&&"UInt32"!==i.valueType&&(yt.warn("Unsupported indexed geometry indices type '".concat(i.valueType,"', only UInt32 is currently supported")),r=!1),null!=i.valuesPerElement&&1!==i.valuesPerElement&&(yt.warn("Unsupported indexed geometry values per element '".concat(i.valuesPerElement,"', only 1 is currently supported")),r=!1)):(yt.warn("Indexed geometry does not specify face indices for '".concat(o,"' attribute")),r=!1)}}else yt.warn("Indexed geometries must specify faces"),r=!1;break;default:yt.warn("Unsupported topology '".concat(n,"'")),r=!1}e.params.material||(yt.warn("Geometry requires material"),r=!1);var c=e.params.vertexAttributes;for(var s in c)c[s].values||(yt.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function Mt(e,t){var n=[],r=[],a=[],o=[],i=e.resource,c=Ue.parse(i.version||"1.0","wosr");kt.validate(c);for(var l=i.model.name,d=i.model.geometries,f=i.materialDefinitions,v=e.textures,p=0,m=new Map,b=0;b<d.length;b++){var h=d[b];if(Tt(h)){var x=Pt(h),g=h.params.vertexAttributes,O={};for(var y in g){var j=g[y],T=j.values;O[y]={data:T,size:j.valuesPerElement}}var M={};if("PerAttributeArray"===h.params.topology){var S=Bt(O.position.data.length/O.position.size);for(var A in O)M[A]=S}else{var _=h.params.faces;for(var R in _)M[R]=new Uint32Array(_[R].values)}var P=v&&v[x.texture];if(P&&!m.has(x.texture)){var B=P.image,k=P.params,I=new Oe.a(B,l,k);o.push(I),m.set(x.texture,I)}var L=m.get(x.texture),F=L?L.id:void 0,E=a[x.material]?a[x.material][x.texture]:null;if(!E){var N=f[x.material.substring(x.material.lastIndexOf("/")+1)].params;1===N.transparency&&(N.transparency=0);var D=P&&P.alphaChannelUsage,z=N.transparency>0||"transparency"===D||"maskAndTransparency"===D,U={ambient:Object(u.f)(N.diffuse),diffuse:Object(u.f)(N.diffuse),opacity:1-(N.transparency||0),transparent:z,textureAlphaMode:P?Rt(P.alphaChannelUsage):void 0,textureAlphaCutoff:.33,textureId:F,initTextureTransparent:!0,doubleSided:!0,cullFace:0,colorMixMode:N.externalColorMixMode||"tint",textureAlphaPremultiplied:!0};Object(s.h)(t)&&t.materialParamsMixin&&Object(gt.d)(U,t.materialParamsMixin),E=new se(U,l),a[x.material]||(a[x.material]={}),a[x.material][x.texture]=E}r.push(E);var V=new C.a(new w.a(O,M),l);p+=M.position?M.position.length:0,n.push(V)}}return{name:l,stageResources:{textures:o,materials:r,geometries:n},pivotOffset:i.model.pivotOffset,boundingBox:St(n),numberOfVertices:p,lodThreshold:null}}function St(e){var t=Object(j.e)();return e.forEach((function(e){var n=e.boundingInfo;Object(j.j)(t,n.getBBMin()),Object(j.j)(t,n.getBBMax())})),t}function At(e,t){return _t.apply(this,arguments)}function _t(){return(_t=Object(c.a)(a.a.mark((function e(t,n){var r,i,c,u,l,d,f,v;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],i=function(e){var a=t[e],o=a.images[0].data;if(!o)return yt.warn("Externally referenced texture data is not yet supported"),"continue";var i=a.encoding+";base64,"+o,c="/textureDefinitions/"+e,u={noUnpackFlip:!0,wrap:{s:10497,t:10497},preMultiplyAlpha:!0},l=Object(s.h)(n)&&n.disableTextures?Object(we.s)(null):Object(Ot.a)(i,n);r.push(l.then((function(e){return{refId:c,image:e,params:u,alphaChannelUsage:"rgba"===a.channels?a.alphaChannelUsage||"transparency":"none"}})))},e.t0=a.a.keys(t);case 3:if((e.t1=e.t0()).done){e.next=10;break}if(c=e.t1.value,"continue"!==i(c)){e.next=8;break}return e.abrupt("continue",3);case 8:e.next=3;break;case 10:return e.next=12,Object(we.b)(r);case 12:u=e.sent,l={},d=Object(o.a)(u);try{for(d.s();!(f=d.n()).done;)v=f.value,l[v.refId]=v}catch(p){d.e(p)}finally{d.f()}return e.abrupt("return",l);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Rt(e){switch(e){case"mask":return 2;case"maskAndTransparency":return 3;case"none":return 1;case"transparency":default:return 0}}function Pt(e){var t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}function Bt(e){for(var t=new Uint32Array(e),n=0;n<e;n++)t[n]=n;return t}var kt=new Ue(1,2,"wosr");function It(e,t,n){if(e.count===t.count)for(var r=e.count,a=n[0],o=n[1],i=n[2],c=n[3],s=n[4],u=n[5],l=n[6],d=n[7],f=n[8],v=e.typedBuffer,p=e.typedBufferStride,m=t.typedBuffer,b=t.typedBufferStride,h=0;h<r;h++){var g=h*p,O=h*b,y=m[O],j=m[O+1],w=m[O+2],C=m[O+3];v[g]=a*y+c*j+l*w,v[g+1]=o*y+s*j+d*w,v[g+2]=i*y+u*j+f*w,v[g+3]=C}else x.error("source and destination buffers need to have the same number of elements")}function Lt(e,t,n){for(var r=Math.min(e.count,t.count),a=e.typedBuffer,o=e.typedBufferStride,i=t.typedBuffer,c=t.typedBufferStride,s=0;s<r;s++){var u=s*o,l=s*c;a[u]=n*i[l],a[u+1]=n*i[l+1],a[u+2]=n*i[l+2],a[u+3]=n*i[l+3]}}Object.freeze({__proto__:null,transformMat4:function(e,t,n){if(e.count===t.count)for(var r=e.count,a=n[0],o=n[1],i=n[2],c=n[3],s=n[4],u=n[5],l=n[6],d=n[7],f=n[8],v=n[9],p=n[10],m=n[11],b=n[12],h=n[13],g=n[14],O=n[15],y=e.typedBuffer,j=e.typedBufferStride,w=t.typedBuffer,C=t.typedBufferStride,T=0;T<r;T++){var M=T*j,S=T*C,A=w[S],_=w[S+1],R=w[S+2],P=w[S+3];y[M]=a*A+s*_+f*R+b*P,y[M+1]=o*A+u*_+v*R+h*P,y[M+2]=i*A+l*_+p*R+g*P,y[M+3]=c*A+d*_+m*R+O*P}else x.error("source and destination buffers need to have the same number of elements")},transformMat3:It,scale:Lt,shiftRight:function(e,t,n){for(var r=Math.min(e.count,t.count),a=e.typedBuffer,o=e.typedBufferStride,i=t.typedBuffer,c=t.typedBufferStride,s=0;s<r;s++){var u=s*o,l=s*c;a[u]=i[l]>>n,a[u+1]=i[l+1]>>n,a[u+2]=i[l+2]>>n,a[u+3]=i[l+3]>>n}}});function Ft(e,t){return Et.apply(this,arguments)}function Et(){return(Et=Object(c.a)(a.a.mark((function e(t,n){var r,c,v,m,h,x,g,O,y,j;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("wosr"!==(r=Nt(Object(f.a)(t))).fileType){e.next=7;break}return e.next=4,n.cache?n.cache.loadWOSR(r.url,n):jt(r.url,n);case 4:return c=e.sent,v=Mt(c,n),e.abrupt("return",{lods:[v],referenceBoundingBox:v.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:c.remove});case 7:return e.next=9,n.cache?n.cache.loadGLTF(r.url,n):ct(new Me(n.streamDataRequester),r.url,n);case 9:if(m=e.sent,h=Object(s.f)(m.model.meta,"ESRI_proxyEllipsoid"),m.meta.isEsriSymbolResource&&Object(s.h)(h)&&-1!==m.meta.uri.indexOf("/RealisticTrees/")&&function(e,t){for(var n=0;n<e.model.lods.length;++n){var r=e.model.lods[n];e.customMeta.esriTreeRendering=!0;var a,i=Object(o.a)(r.parts);try{for(i.s();!(a=i.n()).done;){var c=a.value,f=c.attributes.normal;if(Object(s.g)(f))return;for(var v=c.attributes.position,m=v.count,h=Object(u.e)(),x=Object(u.e)(),g=Object(u.e)(),O=Le(b.J,m),y=Le(b.u,m),j=Object(d.a)(Object(p.b)(),c.transform),w=0;w<m;w++){v.getVec(w,x),f.getVec(w,h),Object(l.j)(x,x,c.transform),Object(l.g)(g,x,t.center),Object(l.a)(g,g,t.radius);var C=g[2],T=Object(l.m)(g),M=Math.min(.45+.55*T*T,1);Object(l.a)(g,g,t.radius),Object(l.j)(g,g,j),Object(l.o)(g,g),n+1!==e.model.lods.length&&e.model.lods.length>1&&Object(l.f)(g,g,h,C>-1?.2:Math.min(-4*C-3.8,1)),y.setVec(w,g),O.set(w,0,255*M),O.set(w,1,255*M),O.set(w,2,255*M),O.set(w,3,255)}c.attributes.normal=y,c.attributes.color=O}}catch(S){i.e(S)}finally{i.f()}}}(m,h),x=m.meta.isEsriSymbolResource?{usePBR:n.usePBR,isSchematic:!1,treeRendering:m.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:!0,isSchematic:!1,mrrFactors:[0,1,.5]},g=Object(i.a)(Object(i.a)({},n.materialParamsMixin),{},{treeRendering:m.customMeta.esriTreeRendering}),null==r.specifiedLodIndex){e.next=18;break}return O=Dt(m,x,g,r.specifiedLodIndex),y=O[0].boundingBox,0!==r.specifiedLodIndex&&(y=Dt(m,x,g,0)[0].boundingBox),e.abrupt("return",{lods:O,referenceBoundingBox:y,isEsriSymbolResource:m.meta.isEsriSymbolResource,isWosr:!1,remove:m.remove});case 18:return j=Dt(m,x,g),e.abrupt("return",{lods:j,referenceBoundingBox:j[0].boundingBox,isEsriSymbolResource:m.meta.isEsriSymbolResource,isWosr:!1,remove:m.remove});case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Nt(e){var t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:null!=t[4]?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function Dt(e,t,n,r){var a=e.model,o=Object(v.a)(),c=new Array,u=new Map,l=new Map;return a.lods.forEach((function(e,d){if(void 0===r||d===r){var f=0,v={name:e.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:Object(s.h)(e.lodThreshold)?e.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:Object(j.e)()};c.push(v),e.parts.forEach((function(r){var c=r.material+(r.attributes.normal?"_normal":"")+(r.attributes.color?"_color":"")+(r.attributes.texCoord0?"_texCoord0":"")+(r.attributes.tangent?"_tangent":""),d=a.materials.get(r.material),p=Object(s.h)(r.attributes.texCoord0),h=Object(s.h)(r.attributes.normal);if(!u.has(c)){if(p){if(Object(s.h)(d.textureColor)&&!l.has(d.textureColor)){var x=a.textures.get(d.textureColor),T=Object(i.a)(Object(i.a)({},x.parameters),{},{preMultiplyAlpha:!0});l.set(d.textureColor,new Oe.a(x.data,d.textureColor,T))}if(Object(s.h)(d.textureNormal)&&!l.has(d.textureNormal)){var M=a.textures.get(d.textureNormal),S=Object(i.a)(Object(i.a)({},M.parameters),{},{preMultiplyAlpha:!0});l.set(d.textureNormal,new Oe.a(M.data,d.textureNormal,S))}if(Object(s.h)(d.textureOcclusion)&&!l.has(d.textureOcclusion)){var A=a.textures.get(d.textureOcclusion),_=Object(i.a)(Object(i.a)({},A.parameters),{},{preMultiplyAlpha:!0});l.set(d.textureOcclusion,new Oe.a(A.data,d.textureOcclusion,_))}if(Object(s.h)(d.textureEmissive)&&!l.has(d.textureEmissive)){var R=a.textures.get(d.textureEmissive),P=Object(i.a)(Object(i.a)({},R.parameters),{},{preMultiplyAlpha:!0});l.set(d.textureEmissive,new Oe.a(R.data,d.textureEmissive,P))}if(Object(s.h)(d.textureMetallicRoughness)&&!l.has(d.textureMetallicRoughness)){var B=a.textures.get(d.textureMetallicRoughness),k=Object(i.a)(Object(i.a)({},B.parameters),{},{preMultiplyAlpha:!0});l.set(d.textureMetallicRoughness,new Oe.a(B.data,d.textureMetallicRoughness,k))}}var I=Math.pow(d.color[0],1/le),L=Math.pow(d.color[1],1/le),F=Math.pow(d.color[2],1/le),E=Math.pow(d.emissiveFactor[0],1/le),N=Math.pow(d.emissiveFactor[1],1/le),D=Math.pow(d.emissiveFactor[2],1/le);u.set(c,new se(Object(i.a)(Object(i.a)({},t),{},{transparent:"BLEND"===d.alphaMode,textureAlphaMode:zt(d.alphaMode),textureAlphaCutoff:d.alphaCutoff,diffuse:[I,L,F],ambient:[I,L,F],opacity:d.opacity,doubleSided:d.doubleSided,doubleSidedType:"winding-order",cullFace:d.doubleSided?0:2,vertexColors:!!r.attributes.color,vertexTangents:!!r.attributes.tangent,normals:h?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:Object(s.h)(d.textureColor)&&p?l.get(d.textureColor).id:void 0,colorMixMode:d.colorMixMode,normalTextureId:Object(s.h)(d.textureNormal)&&p?l.get(d.textureNormal).id:void 0,textureAlphaPremultiplied:!0,occlusionTextureId:Object(s.h)(d.textureOcclusion)&&p?l.get(d.textureOcclusion).id:void 0,emissiveTextureId:Object(s.h)(d.textureEmissive)&&p?l.get(d.textureEmissive).id:void 0,metallicRoughnessTextureId:Object(s.h)(d.textureMetallicRoughness)&&p?l.get(d.textureMetallicRoughness).id:void 0,emissiveFactor:[E,N,D],mrrFactors:[d.metallicFactor,d.roughnessFactor,t.mrrFactors[2]],isSchematic:!1},n),c))}var z=function(e,t){switch(t){case 4:return xt(e);case 5:return function(e){var t="number"==typeof e?e:e.length;if(t<3)return new Uint32Array(0);var n=t-2,r=new Uint32Array(3*n);if("number"==typeof e)for(var a=0,o=0;o<n;o+=1)o%2==0?(r[a++]=o,r[a++]=o+1,r[a++]=o+2):(r[a++]=o+1,r[a++]=o,r[a++]=o+2);else for(var i=0,c=0;c<n;c+=1)if(c%2==0){var s=e[c],u=e[c+1],l=e[c+2];r[i++]=s,r[i++]=u,r[i++]=l}else{var d=e[c+1],f=e[c],v=e[c+2];r[i++]=d,r[i++]=f,r[i++]=v}return r}(e);case 6:return function(e){var t="number"==typeof e?e:e.length;if(t<3)return new Uint32Array(0);var n=t-2,r=new Uint32Array(3*n);if("number"==typeof e){for(var a=0,o=0;o<n;++o)r[a++]=0,r[a++]=o+1,r[a++]=o+2;return r}for(var i=e[0],c=e[1],s=0,u=0;u<n;++u){var l=e[u+2];r[s++]=i,r[s++]=c,r[s++]=l,c=l}return r}(e)}}(r.indices||r.attributes.position.count,r.primitiveType),U={},V={},G=r.attributes.position.count,q=Le(b.u,G);if(g(q,r.attributes.position,r.transform),V.position={data:q.typedBuffer,size:q.elementCount},U.position=z,Object(s.h)(r.attributes.normal)){var H=Le(b.u,G);Object(m.g)(o,r.transform),O(H,r.attributes.normal,o),V.normal={data:H.typedBuffer,size:H.elementCount},U.normal=z}if(Object(s.h)(r.attributes.tangent)){var W=Le(b.C,G);Object(m.g)(o,r.transform),It(W,r.attributes.tangent,o),V.tangent={data:W.typedBuffer,size:W.elementCount},U.tangent=z}if(Object(s.h)(r.attributes.texCoord0)){var X=Le(b.m,G);Re(X,r.attributes.texCoord0),V.uv0={data:X.typedBuffer,size:X.elementCount},U.uv0=z}if(Object(s.h)(r.attributes.color)){var J=Le(b.J,G);if(4===r.attributes.color.elementCount)r.attributes.color instanceof b.C?Lt(J,r.attributes.color,255):r.attributes.color instanceof b.J?Be(J,r.attributes.color):r.attributes.color instanceof b.H&&Lt(J,r.attributes.color,1/256);else{ke(J,255,255,255,255);var Q=new b.B(J.buffer,0,4);r.attributes.color instanceof b.u?y(Q,r.attributes.color,255):r.attributes.color instanceof b.B?Pe(Q,r.attributes.color):r.attributes.color instanceof b.z&&y(Q,r.attributes.color,1/256)}V.color={data:J.typedBuffer,size:J.elementCount},U.color=z}var $=new C.a(new w.a(V,U),"gltf_".concat(e.name,"_").concat(f++));v.stageResources.geometries.push($),v.stageResources.materials.push(u.get(c)),p&&(Object(s.h)(d.textureColor)&&v.stageResources.textures.push(l.get(d.textureColor)),Object(s.h)(d.textureNormal)&&v.stageResources.textures.push(l.get(d.textureNormal)),Object(s.h)(d.textureOcclusion)&&v.stageResources.textures.push(l.get(d.textureOcclusion)),Object(s.h)(d.textureEmissive)&&v.stageResources.textures.push(l.get(d.textureEmissive)),Object(s.h)(d.textureMetallicRoughness)&&v.stageResources.textures.push(l.get(d.textureMetallicRoughness))),v.numberOfVertices+=G;var Y=$.boundingInfo;Object(j.j)(v.boundingBox,Y.getBBMin()),Object(j.j)(v.boundingBox,Y.getBBMax())}))}})),c}function zt(e){switch(e){case"BLEND":return 0;case"MASK":return 2;case"OPAQUE":return 1;default:return 0}}},983:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(30),a=n(31);function o(){var e=Object(r.a)(["\n      void forwardTextureCoordinates() {}\n    "]);return o=function(){return e},e}function i(){var e=Object(r.a)(["\n      void forwardTextureCoordinates() {\n        vuv0 = uv0;\n        vuvRegion = uvRegion;\n      }\n    "]);return i=function(){return e},e}function c(){var e=Object(r.a)(["\n      void forwardTextureCoordinates() {\n        vuv0 = uv0;\n      }\n    "]);return c=function(){return e},e}function s(e,t){1===t.attributeTextureCoordinates&&(e.attributes.add("uv0","vec2"),e.varyings.add("vuv0","vec2"),e.vertex.code.add(Object(a.a)(c()))),2===t.attributeTextureCoordinates&&(e.attributes.add("uv0","vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add("uvRegion","vec4"),e.varyings.add("vuvRegion","vec4"),e.vertex.code.add(Object(a.a)(i()))),0===t.attributeTextureCoordinates&&e.vertex.code.add(Object(a.a)(o()))}},986:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(30),a=n(31);function o(){var e=Object(r.a)(["\n    vec3 decodeNormal(vec2 f) {\n      float z = 1.0 - abs(f.x) - abs(f.y);\n      return vec3(f + sign(f) * min(z, 0.0), z);\n    }\n  "]);return o=function(){return e},e}function i(e){var t=Object(a.a)(o());e.fragment.code.add(t),e.vertex.code.add(t)}function c(){var e=Object(r.a)(["\n      vec3 screenDerivativeNormal(vec3 positionView) {\n        return normalize(cross(dFdx(positionView), dFdy(positionView)));\n      }\n    "]);return c=function(){return e},e}function s(){var e=Object(r.a)(["\n      vec3 normalModel() {\n        return decodeNormal(normalCompressed);\n      }\n    "]);return s=function(){return e},e}function u(){var e=Object(r.a)(["\n      vec3 normalModel() {\n        return normal;\n      }\n    "]);return u=function(){return e},e}function l(e,t){0===t.normalType&&(e.attributes.add("normal","vec3"),e.vertex.code.add(Object(a.a)(u()))),1===t.normalType&&(e.include(i),e.attributes.add("normalCompressed","vec2"),e.vertex.code.add(Object(a.a)(s()))),3===t.normalType&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(Object(a.a)(c())))}},997:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r,a=n(2),o=n(30),i=n(24),c=n(31),s=n(600),u=n(1045);function l(){var e=Object(o.a)([""]);return l=function(){return e},e}function d(){var e=Object(o.a)(["\n    vec4 dpTransformVertexTangent(vec4 _tangent) {\n      ","\n\n    }\n    "]);return d=function(){return e},e}function f(){var e=Object(o.a)(["\n    vec3 dpNormalView(vec4 _normal) {\n      ","\n    }\n    "]);return f=function(){return e},e}function v(){var e=Object(o.a)(["\n    vec3 dpNormal(vec4 _normal) {\n      ","\n    }\n    "]);return v=function(){return e},e}function p(){var e=Object(o.a)(["\n          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n          return _pos - originDelta;"]);return p=function(){return e},e}function m(){var e=Object(o.a)(["\n    vec3 subtractOrigin(vec3 _pos) {\n      ","\n    }\n    "]);return m=function(){return e},e}function b(){var e=Object(o.a)(["\n    vec3 calculateVPos() {\n      ","\n    }\n    "]);return b=function(){return e},e}function h(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add("modelOriginHi","vec3"),e.attributes.add("modelOriginLo","vec3"),e.attributes.add("model","mat3"),e.attributes.add("modelNormal","mat3")),t.instancedDoublePrecision&&(e.vertex.include(u.a,t),e.vertex.uniforms.add("viewOriginHi","vec3"),e.vertex.uniforms.add("viewOriginLo","vec3"));var n=[Object(c.a)(b(),t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"),Object(c.a)(m(),t.instancedDoublePrecision?Object(c.a)(p()):"return vpos;"),Object(c.a)(v(),t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"),Object(c.a)(f(),t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"),t.vertexTangets?Object(c.a)(d(),t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"):Object(c.a)(l())];e.vertex.code.add(n[0]),e.vertex.code.add(n[1]),e.vertex.code.add(n[2]),2===t.output&&e.vertex.code.add(n[3]),e.vertex.code.add(n[4])}(r=h||(h={})).Uniforms=function(){return function e(){Object(a.a)(this,e)}}(),r.bindCustomOrigin=function(e,t){Object(s.b)(t,x,g,3),e.setUniform3fv("viewOriginHi",x),e.setUniform3fv("viewOriginLo",g)};var x=Object(i.e)(),g=Object(i.e)()},998:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var r=n(30),a=n(31),o=n(76),i=n(1130);function c(){var e=Object(r.a)(["\n      const vec3 mrr = vec3(0.0, 0.6, 0.2);\n      const vec3 emission = vec3(0.0);\n      float occlusion = 1.0;\n\n      void applyPBRFactors() {}\n\n      float getBakedOcclusion() { return 1.0; }\n    "]);return c=function(){return e},e}function s(){var e=Object(r.a)(["\n    void applyPBRFactors() {\n      mrr = mrrFactors;\n      emission = emissionFactor;\n      occlusion = 1.0;\n      ","\n      ","\n      ","\n      ","\n    }\n  "]);return s=function(){return e},e}function u(){var e=Object(r.a)(["\n      float getBakedOcclusion() { return 1.0; }\n      "]);return u=function(){return e},e}function l(){var e=Object(r.a)(["\n      void applyOcclusion(TextureLookupParameter params) {\n        occlusion *= textureLookup(texOcclusion, params).r;\n      }\n\n      float getBakedOcclusion() {\n        return occlusion;\n      }\n      "]);return l=function(){return e},e}function d(){var e=Object(r.a)(["\n      void applyEmission(TextureLookupParameter params) {\n        emission *= textureLookup(texEmission, params).rgb;\n      }"]);return d=function(){return e},e}function f(){var e=Object(r.a)(["\n      void applyMetallnessAndRoughness(TextureLookupParameter params) {\n        vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;\n\n        mrr[0] *= metallicRoughness.b;\n        mrr[1] *= metallicRoughness.g;\n      }"]);return f=function(){return e},e}function v(){var e=Object(r.a)(["\n      vec3 mrr;\n      vec3 emission;\n      float occlusion;\n    "]);return v=function(){return e},e}function p(){var e=Object(r.a)(["\n      float getBakedOcclusion() { return 1.0; }\n  "]);return p=function(){return e},e}Object(o.c)(0,.6,.2);function m(e,t){var n=e.fragment,r=t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;1===t.pbrMode&&r&&e.include(i.a,t),2!==t.pbrMode?(0===t.pbrMode&&n.code.add(Object(a.a)(p())),1===t.pbrMode&&(n.uniforms.add("emissionFactor","vec3"),n.uniforms.add("mrrFactors","vec3"),n.code.add(Object(a.a)(v())),t.hasMetalnessAndRoughnessTexture&&(n.uniforms.add("texMetallicRoughness","sampler2D"),t.supportsTextureAtlas&&n.uniforms.add("texMetallicRoughnessSize","vec2"),n.code.add(Object(a.a)(f()))),t.hasEmissionTexture&&(n.uniforms.add("texEmission","sampler2D"),t.supportsTextureAtlas&&n.uniforms.add("texEmissionSize","vec2"),n.code.add(Object(a.a)(d()))),t.hasOcclusionTexture?(n.uniforms.add("texOcclusion","sampler2D"),t.supportsTextureAtlas&&n.uniforms.add("texOcclusionSize","vec2"),n.code.add(Object(a.a)(l()))):n.code.add(Object(a.a)(u())),n.code.add(Object(a.a)(s(),r?"vtc.uv = vuv0;":"",t.hasMetalnessAndRoughnessTexture?t.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":"",t.hasEmissionTexture?t.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":"",t.hasOcclusionTexture?t.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":"")))):n.code.add(Object(a.a)(c()))}(m||(m={})).bindUniforms=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n||(e.setUniform3fv("mrrFactors",t.mrrFactors),e.setUniform3fv("emissionFactor",t.emissiveFactor))}},999:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(30),a=n(31);function o(){var e=Object(r.a)(["\n    vec3 positionModel() { return position; }\n  "]);return o=function(){return e},e}function i(e){e.attributes.add("position","vec3"),e.vertex.code.add(Object(a.a)(o()))}}}]);
//# sourceMappingURL=26.e0aedb09.chunk.js.map