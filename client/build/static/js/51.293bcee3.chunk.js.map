{"version":3,"sources":["../node_modules/@arcgis/core/layers/graphics/data/BoundsStore.js","../node_modules/@arcgis/core/layers/graphics/data/optimizedFeatureQueryEngineAdapter.js","../node_modules/@arcgis/core/layers/graphics/data/FeatureStore.js","../node_modules/@arcgis/core/layers/graphics/sources/csv/csv.js","../node_modules/@arcgis/core/layers/graphics/sources/support/CSVSourceWorker.js"],"names":["d","minX","minY","maxX","maxY","n","this","_indexInvalid","_boundsToLoad","_boundsById","Map","_idByBounds","_index","i","s","_loadIndex","Array","size","forEach","clear","load","length","filter","has","get","remove","search","set","push","o","getObjectId","t","objectId","getAttributes","attributes","getAttribute","e","cloneWithGeometry","r","getGeometry","geometry","getCentroid","centroid","hasZ","hasM","geometryInfo","_boundsStore","_featuresById","_markedIds","Set","events","featureAdapter","h","_add","_emitChanged","_remove","invalidateIndex","forEachInBounds","emit","add","displayId","onFeatureAdd","coords","a","getLogger","error","feature","onFeatureRemove","geometryType","numFeatures","Math","min","max","featureCount","vertexCount","indexOf","substring","trim","includes","f","l","next","x","value","done","u","exec","replace","j","I","w","E","D","q","v","S","C","y","V","RegExp","regexp","group","factor","NaN","decimal","k","Number","isInteger","isFinite","floor","_fieldsIndex","_queryEngine","destroy","_fetch","url","_checkProjection","parsing","spatialReference","_parse","_createQueryEngine","layerDefinition","extent","fullExtent","timeInfo","timeExtent","start","end","executeQuery","signal","executeQueryForCount","executeQueryForIds","executeQueryForExtent","c","path","query","responseType","data","columnDelimiter","locationInfo","latitudeFieldName","latitudeField","longitudeFieldName","longitudeField","csv","split","b","name","drawingInfo","objectIdField","fields","xmin","POSITIVE_INFINITY","ymin","xmax","NEGATIVE_INFINITY","ymax","wkid","_inferLocationInfo","_inferFields","toLowerCase","some","type","alias","editable","nullable","unshift","g","startTimeField","endTimeField","trackIdField","find","T","map","_inferFieldType","test","isNaN","Date","_isValidDate","reduce","Object","prototype","toString","call","getTime","match","_parseCoordinateValue","m","F","WGS84","N","_","cacheSpatialQueries","featureStore","p","addMany","abs","parseFloat"],"mappings":"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","file":"static/js/51.293bcee3.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport s from\"../../../core/has.js\";import{r as i}from\"../../../chunks/rbush.js\";const d={minX:0,minY:0,maxX:0,maxY:0};class n{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=i(9,s(\"csp-restrictions\")?s=>({minX:s[0],minY:s[1],maxX:s[2],maxY:s[3]}):[\"[0]\",\"[1]\",\"[2]\",\"[3]\"]),this._loadIndex=()=>{if(this._indexInvalid){const s=new Array(this._idByBounds.size);let i=0;this._idByBounds.forEach(((d,n)=>{s[i++]=n})),this._indexInvalid=!1,this._index.clear(),this._index.load(s)}else this._boundsToLoad.length&&(this._index.load(this._boundsToLoad.filter((s=>this._idByBounds.has(s)))),this._boundsToLoad.length=0)}}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(s){const i=this._boundsById.get(s);this._boundsById.delete(s),i&&(this._idByBounds.delete(i),this._indexInvalid||this._index.remove(i))}forEachInBounds(s,i){this._loadIndex();for(const n of function(s,i){return d.minX=i[0],d.minY=i[1],d.maxX=i[2],d.maxY=i[3],s.search(d)}(this._index,s))i(this._idByBounds.get(n))}get(s){return this._boundsById.get(s)}has(s){return this._boundsById.has(s)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(s,i){if(!this._indexInvalid){const i=this._boundsById.get(s);i&&(this._index.remove(i),this._idByBounds.delete(i))}this._boundsById.set(s,i),i&&(this._idByBounds.set(i,s),this._indexInvalid||(this._boundsToLoad.push(i),this._boundsToLoad.length>5e4&&this._loadIndex()))}}export{n as BoundsStore};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport t from\"../OptimizedFeature.js\";import e from\"../OptimizedGeometry.js\";import{getCentroidOptimizedGeometry as r}from\"../centroid.js\";const o={getObjectId:t=>t.objectId,getAttributes:t=>t.attributes,getAttribute:(t,e)=>t.attributes[e],cloneWithGeometry:(e,r)=>new t(r,e.attributes,null,e.objectId),getGeometry:t=>t.geometry,getCentroid:(t,o)=>(t.centroid||(t.centroid=r(new e,t.geometry,o.hasZ,o.hasM)),t.centroid)};export default o;export{o as optimizedFeatureQueryEngineAdapter};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import t from\"../../../core/Logger.js\";import r from\"../../../core/Error.js\";import s from\"../../../core/Evented.js\";import{create as o,NEGATIVE_INFINITY as i}from\"../../../geometry/support/aaBoundingRect.js\";import{getBoundsOptimizedGeometry as a}from\"../featureConversionUtils.js\";import{fromRect as d}from\"../../../geometry/support/aaBoundingBox.js\";import{BoundsStore as n}from\"./BoundsStore.js\";import{optimizedFeatureQueryEngineAdapter as h}from\"./optimizedFeatureQueryEngineAdapter.js\";export default class{constructor(e){this.geometryInfo=e,this._boundsStore=new n,this._featuresById=new Map,this._markedIds=new Set,this.events=new s,this.featureAdapter=h}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){if(!this.numFeatures)return null;const e=o(i);return this._featuresById.forEach((t=>{const r=this._boundsStore.get(t.objectId);r&&(e[0]=Math.min(r[0],e[0]),e[1]=Math.min(r[1],e[1]),e[2]=Math.max(r[2],e[2]),e[3]=Math.max(r[3],e[3]))})),e}get storeStatistics(){let e=0;return this._featuresById.forEach((t=>{t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}add(e){this._add(e),this._emitChanged()}addMany(e){for(const t of e)this._add(t);this._emitChanged()}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(e){const t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}removeManyById(e){this._boundsStore.invalidateIndex();for(const t of e){const e=this._featuresById.get(t);e&&this._remove(e)}this._emitChanged()}forEachBounds(e,t,r){for(const s of e){const e=this._boundsStore.get(s.objectId);e&&t(d(r,e))}}getFeature(e){return this._featuresById.get(e)}has(e){return this._featuresById.has(e)}forEach(e){this._featuresById.forEach((t=>e(t)))}forEachInBounds(e,t){this._boundsStore.forEachInBounds(e,(e=>{t(this._featuresById.get(e))}))}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){let e=!1;this._featuresById.forEach(((t,r)=>{this._markedIds.has(r)||(e=!0,this._remove(t))})),this._markedIds.clear(),e&&this._emitChanged()}_emitChanged(){this.events.emit(\"changed\",void 0)}_add(s){if(!s)return;const i=s.objectId;if(null==i)return void t.getLogger(\"esri.layers.graphics.data.FeatureStore\").error(new r(\"featurestore:invalid-feature\",\"feature id is missing\",{feature:s}));const d=this._featuresById.get(i);let n;if(this._markedIds.add(i),d?(s.displayId=d.displayId,n=this._boundsStore.get(i),this._boundsStore.delete(i)):e(this.onFeatureAdd)&&this.onFeatureAdd(s),!s.geometry||!s.geometry.coords||!s.geometry.coords.length)return this._boundsStore.set(i,null),void this._featuresById.set(i,s);n=a(n||o(),s.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),this._boundsStore.set(i,n),this._featuresById.set(i,s)}_remove(t){return e(this.onFeatureRemove)&&this.onFeatureRemove(t),this._markedIds.delete(t.objectId),this._boundsStore.delete(t.objectId),this._featuresById.delete(t.objectId),t}}\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst n=/^\\s*\"([\\S\\s]*)\"\\s*$/,t=/\"\"/g,e=[\",\",\" \",\";\",\"|\",\"\\t\"];function o(n,t){const e={},o=n.length;for(let r=0;r<o;r++)e[n[r]]=t[r];return e}function*r(n,t,e){let o=0;for(;o<=n.length;){const r=n.indexOf(t,o),i=n.substring(o,r>-1?r:void 0);o+=i.length+1,e&&!i.trim()||(yield i)}}function i(n){const t=n.includes(\"\\r\\n\")?\"\\r\\n\":\"\\n\";return r(n,t,!0)}function c(n,t){return r(n,t,!1)}function f(n){const t=n.trim();let o=0,r=\"\";for(const n of e){const e=t.split(n).length;e>o&&(o=e,r=n)}return\"\"===r?null:r}function*s(e,r,i){let f=\"\",s=\"\",l=0,d=[];n:for(;;){const{value:x,done:g}=e.next();if(g)return;const h=c(x,i);t:for(;;){const{value:e,done:o}=h.next();if(o)break t;if(f+=s+e,s=\"\",l+=u(e),l%2==0){if(l>0){const e=n.exec(f);if(!e){d=[],f=\"\",l=0;continue n}d.push(e[1].replace(t,'\"'))}else d.push(f);f=\"\",l=0}else s=i}0===l?(yield o(r,d),d=[]):s=\"\\n\"}}function u(n){let t=0,e=0;for(e=n.indexOf('\"',e);e>=0;)t++,e=n.indexOf('\"',e+1);return t}export{f as inferDelimiter,s as parseRows,c as readRowParts,i as readRows};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport e from\"../../../../core/has.js\";import{mixin as t}from\"../../../../core/lang.js\";import i from\"../../../../core/Error.js\";import{urlToObject as n,getFilename as r}from\"../../../../core/urlUtils.js\";import{all as o}from\"../../../../core/promiseUtils.js\";import{equals as l,isWebMercator as s,WGS84 as a}from\"../../../../geometry/support/spatialReferenceUtils.js\";import d from\"../../../../geometry/SpatialReference.js\";import{lngLatToXY as u}from\"../../../../geometry/support/webMercatorUtils.js\";import\"../../../../geometry.js\";import c from\"../../../../request.js\";import{projectMany as m}from\"../../../../geometry/projection.js\";import{_parseInfo as f}from\"../../../../core/number.js\";import p from\"../../OptimizedFeature.js\";import y from\"../../OptimizedGeometry.js\";import g from\"../../../support/FieldsIndex.js\";import{jsonAdapter as F}from\"../../../../geometry/geometryAdapters/json.js\";import{checkProjectionSupport as h}from\"../../data/projectionSupport.js\";import{createDrawingInfo as I}from\"./clientSideDefaults.js\";import N from\"../../data/FeatureStore.js\";import _ from\"../../data/QueryEngine.js\";import{readRows as x,inferDelimiter as b,parseRows as T}from\"../csv/csv.js\";const j=I(\"esriGeometryPoint\"),w=[\"esriFieldTypeSmallInteger\",\"esriFieldTypeInteger\",\"esriFieldTypeSingle\",\"esriFieldTypeDouble\",\"esriFieldTypeLong\"],E=[\"lat\",\"latitude\",\"latitude83\",\"latdecdeg\",\"lat_dd\",\"y\",\"ycenter\",\"point-y\"],D=[\"lon\",\"lng\",\"long\",\"longitude\",\"longitude83\",\"longdecdeg\",\"long_dd\",\"x\",\"xcenter\",\"point-x\"],q=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,v=[\"csv\"],S=[0,0];class C{constructor(e,t){this.x=e,this.y=t}}const V=function(){const e=f(),t=new RegExp(\"^\"+e.regexp+\"$\"),i=new RegExp(\"[\"+e.group+\"\\\\s\\\\xa0]\",\"g\"),n=e.factor;return function(r){const o=t.exec(r);if(e.factor=n,!o)return NaN;let l=o[1];if(!o[1]){if(!o[2])return NaN;l=o[2],e.factor*=-1}return l=l.replace(i,\"\").replace(e.decimal,\".\"),+l*e.factor}}(),k=\"isInteger\"in Number?Number.isInteger:e=>\"number\"==typeof e&&isFinite(e)&&Math.floor(e)===e;export default class{constructor(){this._fieldsIndex=null,this._queryEngine=null}destroy(){this._queryEngine&&this._queryEngine&&this._queryEngine.destroy(),this._queryEngine=null,this._fieldsIndex=null}async load(e,t={}){const[i]=await o([this._fetch(e.url,t),this._checkProjection(t&&e.parsing&&e.parsing.spatialReference)]),n=this._parse(i,e);if(this._queryEngine=this._createQueryEngine(i,n),n.layerDefinition.extent=this._queryEngine.fullExtent,n.layerDefinition.timeInfo){const{start:e,end:t}=this._queryEngine.timeExtent;n.layerDefinition.timeInfo.timeExtent=[e,t]}return n}async applyEdits(){throw new i(\"csv-source:editing-not-supported\",\"applyEdits() is not supported on CSVLayer\")}async queryFeatures(e={},t={}){return this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(e={},t={}){return this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(e={},t={}){return this._queryEngine.executeQueryForIds(e,t.signal)}async queryExtent(e={},t={}){return this._queryEngine.executeQueryForExtent(e,t.signal)}async _fetch(e,t){if(!e)throw new i(\"csv-source:invalid-source\",\"url not defined\");const r=n(e);return(await c(r.path,{query:r.query,responseType:\"text\",signal:t.signal})).data}_parse(e,n){const o=n.parsing||{},l={columnDelimiter:o.columnDelimiter,layerDefinition:null,locationInfo:{latitudeFieldName:o.latitudeField,longitudeFieldName:o.longitudeField}},s=x(e);let{value:a}=s.next();if(!a)throw new i(\"csv\",\"CSV is empty\",{csv:e});if(a=a.trim(),!o.columnDelimiter){const e=b(a);if(!e)throw new i(\"csv-source:invalid-delimiter\",\"Unable to detect the delimiter from CSV\");l.columnDelimiter=e}const d=a.split(l.columnDelimiter),u=l.layerDefinition={name:r(n.url,v)||\"csv\",drawingInfo:j,geometryType:\"esriGeometryPoint\",objectIdField:null,fields:[],timeInfo:o.timeInfo,extent:{xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,spatialReference:o.spatialReference||{wkid:102100}}};if(!o.latitudeField||!o.longitudeField){const e=this._inferLocationInfo(d);if(!o.longitudeField&&!e.longitudeFieldName||!o.latitudeField&&!e.latitudeFieldName)throw new i(\"csv\",\"Unable to identify latitudeField and/or longitudeField from CSV\");l.locationInfo={longitudeFieldName:o.longitudeField||e.longitudeFieldName,latitudeFieldName:o.latitudeField||e.latitudeFieldName}}const c=this._inferFields(s,l.columnDelimiter,d,l.locationInfo);if(o.fields&&o.fields.length){const e=new Map;for(const t of o.fields)e.set(t.name.toLowerCase(),t);for(const i of c){const n=e.get(i.name.toLowerCase());if(n){const e=i.name;t(i,n),i.name=e}}}u.fields=c;if(!u.fields.some((e=>\"esriFieldTypeOID\"===e.type&&(u.objectIdField=e.name,!0)))){const e={name:\"__OBJECTID\",alias:\"__OBJECTID\",type:\"esriFieldTypeOID\",editable:!1,nullable:!1};u.objectIdField=e.name,u.fields.unshift(e)}if(this._fieldsIndex=new g(u.fields),u.timeInfo){const e=u.timeInfo;if(e.startTimeField){const t=this._fieldsIndex.get(e.startTimeField);t?(e.startTimeField=t.name,t.type=\"esriFieldTypeDate\"):e.startTimeField=null}if(e.endTimeField){const t=this._fieldsIndex.get(e.endTimeField);t?(e.endTimeField=t.name,t.type=\"esriFieldTypeDate\"):e.endTimeField=null}if(e.trackIdField){const t=this._fieldsIndex.get(e.trackIdField);e.trackIdField=t?t.name:null}e.startTimeField||e.endTimeField||(u.timeInfo=null)}return l}_inferLocationInfo(e){let t=null,i=null;const n=t=>e.find((e=>e.toLowerCase()===t));return D.some((e=>(t=n(e),!!t))),E.some((e=>(i=n(e),!!i))),{longitudeFieldName:t,latitudeFieldName:i}}_inferFields(e,t,i,n){const r=[],o=T(e,i,t),l=[];e:for(;l.length<10;){const{value:e,done:t}=o.next();if(t)break e;l.push(e)}for(const e of i)if(e===n.longitudeFieldName||e===n.latitudeFieldName)r.push({name:e,type:\"esriFieldTypeDouble\",alias:e});else{const t=l.map((t=>t[e])),i=this._inferFieldType(t),n={name:e,type:null,alias:e};switch(i){case\"integer\":n.type=\"esriFieldTypeInteger\";break;case\"double\":n.type=\"esriFieldTypeDouble\";break;case\"date\":n.type=\"esriFieldTypeDate\",n.length=36;break;default:n.type=\"esriFieldTypeString\",n.length=255}r.push(n)}return r}_inferFieldType(e){if(!e.length)return\"string\";const t=/[^+-.,0-9]/;return e.map((e=>{let i=!1;if(\"\"!==e){if(t.test(e))i=!0;else{let t=V(e);if(!isNaN(t))return/[.,]/.test(e)||!k(t)||t>214783647||t<-214783648?\"double\":\"integer\";if(-1===e.indexOf(\"E\"))i=!0;else{if(t=Number(e),!isNaN(t))return\"double\";if(-1===e.indexOf(\",\"))i=!0;else{if(e=e.replace(\",\",\".\"),t=Number(e),!isNaN(t))return\"double\";i=!0}}}if(i){if(!/^[-]?\\d*[.,]?\\d*$/.test(e)){const t=new Date(e);return this._isValidDate(t,e)?\"date\":\"string\"}return\"string\"}return\"string\"}})).reduce(((e,t)=>void 0===e||e===t?t:\"string\"===e||\"string\"===t?\"string\":\"double\"===e||\"double\"===t?\"double\":void 0))}_isValidDate(t,i){if(!t||\"[object Date]\"!==Object.prototype.toString.call(t)||isNaN(t.getTime()))return!1;let n=!0;if(e(\"chrome\")&&/\\d+\\W*$/.test(i)){const e=i.match(/[a-zA-Z]{2,}/);if(e){let t=!1,i=0;for(;!t&&i<=e.length;)t=!q.test(e[i]),i++;n=!t}}return n}_createQueryEngine(e,t){const{latitudeFieldName:i,longitudeFieldName:n}=t.locationInfo,{objectIdField:r,fields:o,extent:a,timeInfo:c}=t.layerDefinition;let f=[];const g=[],h=new Set,I=new Set,b=[];for(const{name:e,type:t}of o)\"esriFieldTypeDate\"===t?h.add(e):w.indexOf(t)>-1&&I.add(e),e!==r&&b.push(e);let j=0;const E=x(e);E.next();const D=T(E,b,t.columnDelimiter);e:for(;;){const{value:e,done:t}=D.next();if(t)break e;const o=this._parseCoordinateValue(e[i]),l=this._parseCoordinateValue(e[n]);if(null!=l&&null!=o&&!isNaN(o)&&!isNaN(l)){e[i]=o,e[n]=l;for(const t in e)if(t!==i&&t!==n)if(h.has(t)){const i=new Date(e[t]);e[t]=this._isValidDate(i,e[t])?i.getTime():null}else if(I.has(t)){const i=V(e[t]);isNaN(i)?e[t]=null:e[t]=i}e[r]=j,j++,f.push(new C(l,o)),g.push(e)}}if(!l({wkid:4326},a.spatialReference))if(s(a.spatialReference))for(const e of f)[e.x,e.y]=u(e.x,e.y,S);else f=m(F,f,d.WGS84,a.spatialReference,null);const q=new N({geometryType:\"esriGeometryPoint\",hasM:!1,hasZ:!1}),v=new _({fields:t.layerDefinition.fields,geometryType:\"esriGeometryPoint\",hasM:!1,hasZ:!1,timeInfo:c,objectIdField:r,spatialReference:a.spatialReference||{wkid:4326},cacheSpatialQueries:!0,featureStore:q}),k=[];for(let e=0;e<f.length;e++){const{x:t,y:i}=f[e],n=g[e];n[r]=e+1,k.push(new p(new y([],[t,i]),n,null,n[r]))}return q.addMany(k),v}_parseCoordinateValue(e){if(null==e||\"\"===e)return null;let t=V(e);return(isNaN(t)||Math.abs(t)>181)&&(t=parseFloat(e)),t}async _checkProjection(e){try{await h(a,e)}catch{throw new i(\"csv-layer\",\"Projection not supported\")}}}export{E as csvLatitudeFieldNames,D as csvLongitudeFieldNames};\n"],"sourceRoot":""}