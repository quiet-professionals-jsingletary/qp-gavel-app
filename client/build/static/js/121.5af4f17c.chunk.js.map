{"version":3,"sources":["../node_modules/@arcgis/core/views/2d/layers/features/support/whereUtils.js","../node_modules/@arcgis/core/layers/graphics/data/FeatureFilter.js"],"names":["t","e","getLogger","a","getAttribute","r","field","s","n","o","WhereClause","create","isStandardized","error","readArcadeFeature","testFeature","warn","_","this","_geometryBounds","_idToVisibility","Map","_serviceInfo","_applyFilter","_resetAllHiddenIds","update","show","hide","forEach","set","i","Set","get","h","has","push","geometry","spatialRel","where","timeExtent","objectIds","fromJSON","_hash","JSON","stringify","_setGeometryFilter","_setIdFilter","_setAttributeFilter","_setTimeFilter","_clause","m","fieldsIndex","_idsToShow","_idsToHide","hiddenIds","_spatialQueryOperator","l","geometryType","hasZ","hasM","_timeOperator","timeInfo","d","_filterByGeometry","_filterById","_filterByTime","_filterByExpression","size","getObjectId","readHydratedGeometry"],"mappings":"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","file":"static/js/121.5af4f17c.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../core/Logger.js\";import r from\"../../../../../core/Error.js\";const t=e.getLogger(\"esri.views.2d.layers.features.support.whereUtils\"),a={getAttribute:(e,r)=>e.field(r)};async function s(e,s){const n=await import(\"../../../../../core/sql/WhereClause.js\");try{const o=n.WhereClause.create(e,s);if(!o.isStandardized){const e=new r(\"mapview - bad input\",\"Unable to apply filter's definition expression, as expression is not standardized.\",o);t.error(e)}return e=>{const r=e.readArcadeFeature();return o.testFeature(r,a)}}catch(r){return t.warn(\"mapview-bad-where-clause\",\"Encountered an error when evaluating where clause\",e),e=>!0}}export{s as createWhereClause};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../core/maybe.js\";import e from\"../../../core/Logger.js\";import i from\"../../../core/Error.js\";import{all as s}from\"../../../core/promiseUtils.js\";import{getBoundsXY as r}from\"../../../geometry/support/boundsUtils.js\";import{create as o}from\"../../../geometry/support/aaBoundingRect.js\";import h from\"../../../tasks/support/Query.js\";import{n as a,g as l}from\"../../../chunks/spatialQuerySupport.js\";import{getTimeOperator as n}from\"./timeSupport.js\";import{featureAdapter as d}from\"../../../views/2d/layers/features/FeatureStore2D.js\";import{createWhereClause as m}from\"../../../views/2d/layers/features/support/whereUtils.js\";const _=e.getLogger(\"esri.views.2d.layers.features.controllers.FeatureFilter\");export default class{constructor(t){this._geometryBounds=o(),this._idToVisibility=new Map,this._serviceInfo=t}get hash(){return this._hash}check(t){return this._applyFilter(t)}clear(){const t=this._resetAllHiddenIds();return this.update(),{show:t,hide:[]}}invalidate(){this._idToVisibility.forEach(((t,e)=>{this._idToVisibility.set(e,0)}))}setKnownIds(t){for(const e of t)this._idToVisibility.set(e,1)}setTrue(t){const e=[],i=[],s=new Set(t);return this._idToVisibility.forEach(((t,r)=>{const o=!!(1&this._idToVisibility.get(r)),h=s.has(r);!o&&h?e.push(r):o&&!h&&i.push(r),this._idToVisibility.set(r,h?3:0)})),{show:e,hide:i}}createQuery(){const{geometry:t,spatialRel:e,where:i,timeExtent:s,objectIds:r}=this;return h.fromJSON({geometry:t,spatialRel:e,where:i,timeExtent:s,objectIds:r})}async update(t,e){this._hash=JSON.stringify(t);const i=await a(t,null,e);await s([this._setGeometryFilter(i),this._setIdFilter(i),this._setAttributeFilter(i),this._setTimeFilter(i)])}async _setAttributeFilter(t){if(!t||!t.where)return this._clause=null,void(this.where=null);this._clause=await m(t.where,this._serviceInfo.fieldsIndex),this.where=t.where}_setIdFilter(t){this._idsToShow=t&&t.objectIds&&new Set(t.objectIds),this._idsToHide=t&&t.hiddenIds&&new Set(t.hiddenIds),this.objectIds=t&&t.objectIds}async _setGeometryFilter(t){if(!t||!t.geometry)return this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null);const e=t.geometry,i=t.spatialRel||\"esriSpatialRelIntersects\",s=await l(i,e,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);r(this._geometryBounds,e),this._spatialQueryOperator=s,this.geometry=e,this.spatialRel=i}_setTimeFilter(t){if(this.timeExtent=this._timeOperator=null,t&&t.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=t.timeExtent,this._timeOperator=n(this._serviceInfo.timeInfo,t.timeExtent,d);else{const e=new i(\"feature-layer-view:time-filter-not-available\",\"Unable to apply time filter, as layer doesn't have time metadata.\",t.timeExtent);_.error(e)}}_applyFilter(t){return this._filterByGeometry(t)&&this._filterById(t)&&this._filterByTime(t)&&this._filterByExpression(t)}_filterByExpression(t){return!this.where||this._clause(t)}_filterById(t){return(!this._idsToHide||!this._idsToHide.size||!this._idsToHide.has(t.getObjectId()))&&(!this._idsToShow||!this._idsToShow.size||this._idsToShow.has(t.getObjectId()))}_filterByGeometry(t){if(!this.geometry)return!0;const e=t.readHydratedGeometry();return!!e&&this._spatialQueryOperator(e)}_filterByTime(e){return!t(this._timeOperator)||this._timeOperator(e)}_resetAllHiddenIds(){const t=[];return this._idToVisibility.forEach(((e,i)=>{1&e||(this._idToVisibility.set(i,1),t.push(i))})),t}}\n"],"sourceRoot":""}