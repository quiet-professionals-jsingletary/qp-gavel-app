(this["webpackJsonpqp-ampd-app"]=this["webpackJsonpqp-ampd-app"]||[]).push([[111],{1035:function(e,t,r){"use strict";r.r(t);var a=r(13),n=r(7),l=r.n(n),i=r(16),o=r(39),s=r(10),u=r(2),c=r(3),b=r(41),y=r(5),f=r(6),p=r(0),v=(r(15),r(4)),d=(r(14),r(19)),O=r(1),j=r(35),h=r(8),m=r(36),g=r(12),S=(r(21),r(22),r(17)),k=r(50),w=r(75),E=(r(98),r(40)),x=r(268),_=r(183),G=r(237),I=r(129),L=r(288),P=r(290),F=r(287),M=r(434),C=r(289),N=r(23),R=r(105),T=r(321),J=(r(241),r(118)),K=r(66),z=(r(323),r(291),r(164)),A={esriGeometryPoint:"points",esriGeometryPolyline:"polylines",esriGeometryPolygon:"polygons"};function H(e){var t=e.folders||[],r=t.slice(),a=new Map,n=new Map,l=new Map,i=new Map,o=new Map,s={esriGeometryPoint:n,esriGeometryPolyline:l,esriGeometryPolygon:i};(e.featureCollection&&e.featureCollection.layers||[]).forEach((function(e){var t=Object(N.a)(e);t.featureSet.features=[];var r=e.featureSet.geometryType;a.set(r,t);var o=e.layerDefinition.objectIdField;"esriGeometryPoint"===r?U(n,o,e.featureSet.features):"esriGeometryPolyline"===r?U(l,o,e.featureSet.features):"esriGeometryPolygon"===r&&U(i,o,e.featureSet.features)})),e.groundOverlays&&e.groundOverlays.forEach((function(e){o.set(e.id,e)})),t.forEach((function(t){t.networkLinkIds.forEach((function(a){var n=function(e,t,r){var a=function(e,t){var r;return t.some((function(t){return t.id===e&&(r=t,!0)})),r}(e,r);return a&&(a.parentFolderId=t,a.networkLink=a),a}(a,t.id,e.networkLinks);n&&r.push(n)}))})),r.forEach((function(e){e.featureInfos&&(e.points=Object(N.a)(a.get("esriGeometryPoint")),e.polylines=Object(N.a)(a.get("esriGeometryPolyline")),e.polygons=Object(N.a)(a.get("esriGeometryPolygon")),e.mapImages=[],e.featureInfos.map((function(t){switch(t.type){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryPolygon":var r=s[t.type].get(t.id);r&&e[A[t.type]].featureSet.features.push(r);break;case"GroundOverlay":var a=o.get(t.id);a&&e.mapImages.push(a)}})),e.fullExtent=V([e]))}));var u=V(r);return{folders:t,sublayers:r,extent:u}}function W(e,t,r,a){var n=J.b&&J.b.findCredential(e);e=Object(g.e)(e,{token:n&&n.token});var l=R.a.kmlServiceUrl;return Object(K.default)(l,{query:{url:e,model:"simple",folders:"",refresh:0!==r||void 0,outSR:JSON.stringify(t)},responseType:"json",signal:a})}function q(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],n=[],l={},i=t.sublayers,o=t.folders.map((function(e){return e.id}));return i.forEach((function(t){var i=new e;if(r?i.read(t,r):i.read(t),a.length&&o.indexOf(i.id)>-1&&(i.visible=-1!==a.indexOf(i.id)),l[t.id]=i,null!=t.parentFolderId&&-1!==t.parentFolderId){var s=l[t.parentFolderId];s.sublayers||(s.sublayers=[]),s.sublayers.unshift(i)}else n.unshift(i)})),n}function U(e,t,r){r.forEach((function(r){e.set(r.attributes[t],r)}))}function V(e){var t,r=Object(z.d)(),n=Object(z.d)(z.a),l=Object(a.a)(e);try{for(l.s();!(t=l.n()).done;){var i=t.value;if(i.polygons&&i.polygons.featureSet&&i.polygons.featureSet.features){var o,s=Object(a.a)(i.polygons.featureSet.features);try{for(s.s();!(o=s.n()).done;){var u=o.value;Object(T.b)(r,u.geometry),Object(z.g)(n,r)}}catch(h){s.e(h)}finally{s.f()}}if(i.polylines&&i.polylines.featureSet&&i.polylines.featureSet.features){var c,b=Object(a.a)(i.polylines.featureSet.features);try{for(b.s();!(c=b.n()).done;){var y=c.value;Object(T.b)(r,y.geometry),Object(z.g)(n,r)}}catch(h){b.e(h)}finally{b.f()}}if(i.points&&i.points.featureSet&&i.points.featureSet.features){var f,p=Object(a.a)(i.points.featureSet.features);try{for(p.s();!(f=p.n()).done;){var v=f.value;Object(T.b)(r,v.geometry),Object(z.g)(n,r)}}catch(h){p.e(h)}finally{p.f()}}if(i.mapImages){var d,O=Object(a.a)(i.mapImages);try{for(O.s();!(d=O.n()).done;){var j=d.value;Object(T.b)(r,j.extent),Object(z.g)(n,r)}}catch(h){O.e(h)}finally{O.f()}}}}catch(h){l.e(h)}finally{l.f()}return Object(z.f)(n,z.a)?null:{xmin:n[0],ymin:n[1],zmin:n[2],xmax:n[3],ymax:n[4],zmax:n[5],spatialReference:k.a.WGS84}}var D,B=r(63),Q=r(27),X=r(86),Y=r(127),Z=r(29),$=D=function(e){Object(y.a)(r,e);var t=Object(f.a)(r);function r(){var e;return Object(u.a)(this,r),(e=t.apply(this,arguments))._sublayersHandles=null,e.description=null,e.id=null,e.networkLink=null,e.title=null,e.sourceJSON=null,e.fullExtent=null,e}return Object(c.a)(r,[{key:"initialize",value:function(){var e=this;Object(Z.j)(this,"networkLink").then((function(){return Object(Z.l)(e,"visible")})).then((function(){return e.load()}))}},{key:"load",value:function(e){var t=this;if(this.networkLink){var r=Object(v.h)(e)?e.signal:null,a=this._fetchService(this._get("networkLink").href,r).then((function(e){var r=V(e.sublayers);t.fullExtent=w.a.fromJSON(r),t.sourceJSON=e;var a=Object(d.m)(E.a.ofType(D),q(D,e));t.sublayers?t.sublayers.addMany(a):t.sublayers=a,t.layer.emit("sublayer-update"),t.layer&&t.layer.notifyChange("visibleSublayers")}));return this.addResolvingPromise(a),Object(S.s)(this)}}},{key:"castSublayers",value:function(e){return Object(d.m)(E.a.ofType(D),e)}},{key:"readVisible",value:function(e,t){return!!t.visibility}},{key:"_fetchService",value:function(e,t){return W(e,this.layer.outSpatialReference,this.layer.refreshInterval,t).then((function(e){return H(e.data)}))}},{key:"sublayers",set:function(e){var t=this,r=this._get("sublayers");r&&(r.forEach((function(e){e.parent=null,e.layer=null})),this._sublayersHandles.forEach((function(e){return e.remove()})),this._sublayersHandles=null),e&&(e.forEach((function(e){e.parent=t,e.layer=t.layer})),this._sublayersHandles=[e.on("after-add",(function(e){var r=e.item;r.parent=t,r.layer=t.layer})),e.on("after-remove",(function(e){var t=e.item;t.parent=null,t.layer=null}))]),this._set("sublayers",e)}},{key:"visible",get:function(){return this._get("visible")},set:function(e){this._get("visible")!==e&&(this._set("visible",e),this.layer&&this.layer.notifyChange("visibleSublayers"))}},{key:"layer",set:function(e){this._set("layer",e),this.sublayers&&this.sublayers.forEach((function(t){return t.layer=e}))}}]),r}(X.a.EventedMixin(Object(Q.b)(Y.a)));Object(p.a)([Object(O.b)()],$.prototype,"description",void 0),Object(p.a)([Object(O.b)()],$.prototype,"id",void 0),Object(p.a)([Object(O.b)({readOnly:!0,value:null})],$.prototype,"networkLink",void 0),Object(p.a)([Object(O.b)({json:{write:{allowNull:!0}}})],$.prototype,"parent",void 0),Object(p.a)([Object(O.b)({value:null,json:{write:{allowNull:!0}}})],$.prototype,"sublayers",null),Object(p.a)([Object(B.a)("sublayers")],$.prototype,"castSublayers",null),Object(p.a)([Object(O.b)({value:null,json:{read:{source:"name"}}})],$.prototype,"title",void 0),Object(p.a)([Object(O.b)({value:!0})],$.prototype,"visible",null),Object(p.a)([Object(j.a)("visible",["visibility"])],$.prototype,"readVisible",null),Object(p.a)([Object(O.b)()],$.prototype,"sourceJSON",void 0),Object(p.a)([Object(O.b)({value:null})],$.prototype,"layer",null),Object(p.a)([Object(O.b)({type:w.a})],$.prototype,"fullExtent",void 0);var ee=$=D=Object(p.a)([Object(h.a)("esri.layers.support.KMLSublayer")],$),te=["kml","xml"],re=function(e){Object(y.a)(r,e);var t=Object(f.a)(r);function r(){var e;Object(u.a)(this,r);for(var a=arguments.length,n=new Array(a),l=0;l<a;l++)n[l]=arguments[l];return(e=t.call.apply(t,[this].concat(n)))._visibleFolders=[],e.allSublayers=new x.a({root:Object(b.a)(e),rootCollectionNames:["sublayers"],getChildrenFunction:function(e){return e.sublayers}}),e.outSpatialReference=k.a.WGS84,e.path=null,e.legendEnabled=!1,e.operationalLayerType="KML",e.sublayers=null,e.type="kml",e.url=null,e}return Object(c.a)(r,[{key:"initialize",value:function(){var e=this;this.watch("sublayers",(function(t,r){r&&r.forEach((function(e){e.parent=null,e.layer=null})),t&&t.forEach((function(t){t.parent=e,t.layer=e}))}),!0),this.on("sublayer-update",(function(){return e.notifyChange("fullExtent")}))}},{key:"normalizeCtorArgs",value:function(e,t){return"string"==typeof e?Object(s.a)({url:e},t):e}},{key:"readSublayersFromItemOrWebMap",value:function(e,t){this._visibleFolders=t.visibleFolders}},{key:"readSublayers",value:function(e,t,r){return q(ee,t,r,this._visibleFolders)}},{key:"writeSublayers",value:function(e,t){for(var r=[],a=e.toArray();a.length;){var n=a[0];n.networkLink||(n.visible&&r.push(n.id),n.sublayers&&a.push.apply(a,Object(o.a)(n.sublayers.toArray()))),a.shift()}t.visibleFolders=r}},{key:"load",value:function(e){var t=this,r=Object(v.h)(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["KML"]},e).then((function(){return t._fetchService(r)}))),Object(S.s)(this)}},{key:"_fetchService",value:function(){var e=Object(i.a)(l.a.mark((function e(t){var r,a,n=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(S.s)().then((function(){return n.resourceInfo?{ssl:!1,data:n.resourceInfo}:W(n.url,n.outSpatialReference,n.refreshInterval,t)}));case 2:r=e.sent,(a=H(r.data))&&this.read(a,{origin:"service"});case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_recomputeFullExtent",value:function(){var e=null;this.extent&&(e=this.extent.clone());return function t(r){if(r.sublayers){var n,l=Object(a.a)(r.sublayers.items);try{for(l.s();!(n=l.n()).done;){var i=n.value;t(i),i.visible&&i.fullExtent&&(e?e.union(i.fullExtent):e=i.fullExtent.clone())}}catch(o){l.e(o)}finally{l.f()}}}(this),e}},{key:"title",get:function(){var e=this._get("title");return e&&"defaults"!==this.originOf("title")?e:this.url?Object(g.k)(this.url,te)||"KML":e||""},set:function(e){this._set("title",e)}},{key:"visibleSublayers",get:function(){var e=this.sublayers,t=[];return e&&e.forEach((function e(r){r.visible&&(t.push(r),r.sublayers&&r.sublayers.forEach(e))})),t}},{key:"fullExtent",get:function(){return this._recomputeFullExtent()}}]),r}(Object(P.a)(Object(M.a)(Object(C.a)(Object(L.a)(Object(F.a)(Object(G.a)(_.a)))))));Object(p.a)([Object(O.b)({readOnly:!0})],re.prototype,"allSublayers",void 0),Object(p.a)([Object(O.b)({type:k.a})],re.prototype,"outSpatialReference",void 0),Object(p.a)([Object(O.b)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],re.prototype,"path",void 0),Object(p.a)([Object(O.b)({readOnly:!0,json:{read:!1,write:!1}})],re.prototype,"legendEnabled",void 0),Object(p.a)([Object(O.b)({type:["show","hide","hide-children"]})],re.prototype,"listMode",void 0),Object(p.a)([Object(O.b)({type:["KML"]})],re.prototype,"operationalLayerType",void 0),Object(p.a)([Object(O.b)({type:E.a.ofType(ee),json:{write:{ignoreOrigin:!0}}})],re.prototype,"sublayers",void 0),Object(p.a)([Object(j.a)(["web-map","portal-item"],"sublayers",["visibleFolders"])],re.prototype,"readSublayersFromItemOrWebMap",null),Object(p.a)([Object(j.a)("service","sublayers",["sublayers"])],re.prototype,"readSublayers",null),Object(p.a)([Object(m.a)("sublayers")],re.prototype,"writeSublayers",null),Object(p.a)([Object(O.b)({readOnly:!0,json:{read:!1}})],re.prototype,"type",void 0),Object(p.a)([Object(O.b)({json:{origins:{"web-map":{read:{source:"title"}}},write:{ignoreOrigin:!0}},dependsOn:["url","parsedUrl"]})],re.prototype,"title",null),Object(p.a)([Object(O.b)(I.j)],re.prototype,"url",void 0),Object(p.a)([Object(O.b)({readOnly:!0,dependsOn:["sublayers"]})],re.prototype,"visibleSublayers",null),Object(p.a)([Object(O.b)({type:w.a})],re.prototype,"extent",void 0),Object(p.a)([Object(O.b)({dependsOn:["extent"]})],re.prototype,"fullExtent",null);var ae=re=Object(p.a)([Object(h.a)("esri.layers.KMLLayer")],re);t.default=ae}}]);
//# sourceMappingURL=111.42b1a359.chunk.js.map