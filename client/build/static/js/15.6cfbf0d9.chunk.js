(this["webpackJsonpqp-ampd-app"]=this["webpackJsonpqp-ampd-app"]||[]).push([[15],{759:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return l}));var a=n(16),i=n(10),r=n(40),o=n(78);function s(e,t,n){if(Object(i.f)(t)||Object(i.f)(n)||n.vcsWkid||Object(r.c)(t,n))return null;var s=Object(o.c)(t)/Object(o.c)(n);if(1===s)return null;switch(e){case"point":case"esriGeometryPoint":return function(e){return n=s,void((t=e)&&null!=t.z&&(t.z*=n));var t,n};case"polyline":case"esriGeometryPolyline":return function(e){return function(e,t){if(e){var n,i=Object(a.a)(e.paths);try{for(i.s();!(n=i.n()).done;){var r,o=n.value,s=Object(a.a)(o);try{for(s.s();!(r=s.n()).done;){var c=r.value;c.length>2&&(c[2]*=t)}}catch(l){s.e(l)}finally{s.f()}}}catch(l){i.e(l)}finally{i.f()}}}(e,s)};case"polygon":case"esriGeometryPolygon":return function(e){return function(e,t){if(e){var n,i=Object(a.a)(e.rings);try{for(i.s();!(n=i.n()).done;){var r,o=n.value,s=Object(a.a)(o);try{for(s.s();!(r=s.n()).done;){var c=r.value;c.length>2&&(c[2]*=t)}}catch(l){s.e(l)}finally{s.f()}}}catch(l){i.e(l)}finally{i.f()}}}(e,s)};case"multipoint":case"esriGeometryMultipoint":return function(e){return function(e,t){if(e){var n,i=Object(a.a)(e.points);try{for(i.s();!(n=i.n()).done;){var r=n.value;r.length>2&&(r[2]*=t)}}catch(o){i.e(o)}finally{i.f()}}}(e,s)};default:return null}}function c(e,t,n){if(null==e.hasM||e.hasZ){var i,r=Object(a.a)(t);try{for(r.s();!(i=r.n()).done;){var o,s=i.value,c=Object(a.a)(s);try{for(c.s();!(o=c.n()).done;){var l=o.value;l.length>2&&(l[2]*=n)}}catch(u){c.e(u)}finally{c.f()}}}catch(u){r.e(u)}finally{r.f()}}}function l(e,t,n){if((e||t)&&n){var a=Object(o.c)(n);u(e,n,a),u(t,n,a)}}function u(e,t,n){if(e){var i,r=Object(a.a)(e);try{for(r.s();!(i=r.n()).done;){d(i.value.geometry,t,n)}}catch(o){r.e(o)}finally{r.f()}}}function d(e,t,n){if(e&&e.spatialReference&&!Object(r.c)(e.spatialReference,t)){var i=Object(o.c)(e.spatialReference)/n;if(1!==i)if("x"in e)null!=e.z&&(e.z*=i);else if("rings"in e)c(e,e.rings,i);else if("paths"in e)c(e,e.paths,i);else if("points"in e&&(null==e.hasM||e.hasZ)){var s,l=Object(a.a)(e.points);try{for(l.s();!(s=l.n()).done;){var u=s.value;u.length>2&&(u[2]*=i)}}catch(d){l.e(d)}finally{l.f()}}}}},773:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(16),i=n(759);function r(e,t,n){if(n&&n.features&&n.hasZ){var r=Object(i.a)(n.geometryType,t,e.outSpatialReference);if(r){var o,s=Object(a.a)(n.features);try{for(s.s();!(o=s.n()).done;){r(o.value.geometry)}}catch(c){s.e(c)}finally{s.f()}}}}},775:function(e,t,n){"use strict";var a,i=n(2),r=n(3),o=n(4),s=n(5),c=n(0),l=(n(13),n(12),n(14),n(1)),u=n(6),d=(n(9),n(19),n(20),n(23)),p=n(231),h=a=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).value=0,a.unit="milliseconds",a}return Object(r.a)(n,[{key:"toMilliseconds",value:function(){return this.value*p.a[this.unit]}},{key:"clone",value:function(){return new a({value:this.value,unit:this.unit})}}]),n}(d.a);Object(c.a)([Object(l.b)({type:Number,json:{write:!0},nonNullable:!0})],h.prototype,"value",void 0),Object(c.a)([Object(l.b)({type:p.c.apiValues,json:{type:p.c.jsonValues,read:p.c.read,write:p.c.write},nonNullable:!0})],h.prototype,"unit",void 0);var f=h=a=Object(c.a)([Object(u.a)("esri.TimeInterval")],h);t.a=f},791:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var a=n(2),i=n(3),r=n(4),o=n(5),s=n(0),c=(n(13),n(12),n(14),n(1)),l=n(28),u=n(6),d=(n(9),n(19),n(20),n(69)),p=n(231),h=n(296),f=n(775),b=n(794);var v=function(e){var t=function(e){Object(r.a)(n,e);var t=Object(o.a)(n);function n(){var e;return Object(a.a)(this,n),(e=t.apply(this,arguments)).timeExtent=null,e.timeOffset=null,e.useViewTime=!0,e}return Object(i.a)(n,[{key:"readOffset",value:function(e,t){var n=t.timeInfo.exportOptions;if(!n)return null;var a=n.timeOffset,i=p.c.fromJSON(n.timeOffsetUnits);return a&&i?new f.a({value:a,unit:i}):null}},{key:"timeInfo",set:function(e){Object(d.g)(e,this.fields),this._set("timeInfo",e)}}]),n}(e);return Object(s.a)([Object(c.b)({type:h.a,json:{write:!1}})],t.prototype,"timeExtent",void 0),Object(s.a)([Object(c.b)({type:f.a})],t.prototype,"timeOffset",void 0),Object(s.a)([Object(l.a)("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),Object(s.a)([Object(c.b)({value:null,type:b.a,json:{write:!0,origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),Object(s.a)([Object(c.b)({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],t.prototype,"useViewTime",void 0),t=Object(s.a)([Object(u.a)("esri.layers.mixins.TemporalLayer")],t),t}},792:function(e,t,n){"use strict";var a,i=n(2),r=n(3),o=n(4),s=n(5),c=n(0),l=(n(13),n(18)),u=(n(12),n(14)),d=n(1),p=n(6),h=n(26),f=(n(9),n(19),n(20),n(23)),b=n(36),v=(n(86),n(267)),y=a=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).dynamicDataSource=void 0,a.gdbVersion=null,a.geometryPrecision=void 0,a.historicMoment=null,a.maxAllowableOffset=void 0,a.objectIds=null,a.orderByFields=null,a.outFields=null,a.outSpatialReference=null,a.relationshipId=void 0,a.start=void 0,a.num=void 0,a.returnGeometry=!1,a.returnM=void 0,a.returnZ=void 0,a.where=null,a}return Object(r.a)(n,[{key:"_writeHistoricMoment",value:function(e,t){t.historicMoment=e&&e.getTime()}},{key:"writeStart",value:function(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}},{key:"clone",value:function(){return new a(Object(l.a)({dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}}]),n}(f.a);Object(c.a)([Object(d.b)({type:v.a,json:{write:!0}})],y.prototype,"dynamicDataSource",void 0),Object(c.a)([Object(d.b)({type:String,json:{write:!0}})],y.prototype,"gdbVersion",void 0),Object(c.a)([Object(d.b)({type:Number,json:{write:!0}})],y.prototype,"geometryPrecision",void 0),Object(c.a)([Object(d.b)({type:Date})],y.prototype,"historicMoment",void 0),Object(c.a)([Object(h.a)("historicMoment")],y.prototype,"_writeHistoricMoment",null),Object(c.a)([Object(d.b)({type:Number,json:{write:!0}})],y.prototype,"maxAllowableOffset",void 0),Object(c.a)([Object(d.b)({type:[Number],json:{write:!0}})],y.prototype,"objectIds",void 0),Object(c.a)([Object(d.b)({type:[String],json:{write:!0}})],y.prototype,"orderByFields",void 0),Object(c.a)([Object(d.b)({type:[String],json:{write:!0}})],y.prototype,"outFields",void 0),Object(c.a)([Object(d.b)({type:b.a,json:{read:{source:"outSR"},write:{target:"outSR"}}})],y.prototype,"outSpatialReference",void 0),Object(c.a)([Object(d.b)({json:{write:!0}})],y.prototype,"relationshipId",void 0),Object(c.a)([Object(d.b)({type:Number,json:{read:{source:"resultOffset"}}})],y.prototype,"start",void 0),Object(c.a)([Object(h.a)("start"),Object(h.a)("num")],y.prototype,"writeStart",null),Object(c.a)([Object(d.b)({type:Number,json:{read:{source:"resultRecordCount"}}})],y.prototype,"num",void 0),Object(c.a)([Object(d.b)({json:{write:!0}})],y.prototype,"returnGeometry",void 0),Object(c.a)([Object(d.b)({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],y.prototype,"returnM",void 0),Object(c.a)([Object(d.b)({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],y.prototype,"returnZ",void 0),Object(c.a)([Object(d.b)({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],y.prototype,"where",void 0),(y=a=Object(c.a)([Object(p.a)("esri.tasks.support.RelationshipQuery")],y)).from=Object(u.m)(y);var m=y;t.a=m},794:function(e,t,n){"use strict";var a,i=n(2),r=n(3),o=n(4),s=n(5),c=n(0),l=(n(13),n(18)),u=(n(12),n(14),n(1)),d=n(28),p=n(6),h=n(26),f=(n(9),n(19),n(20),n(23)),b=n(231),v=n(296),y=n(775),m=a=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).respectsDaylightSaving=!1,a.timezone=null,a}return Object(r.a)(n,[{key:"readRespectsDaylightSaving",value:function(e,t){return void 0!==t.respectsDaylightSaving?t.respectsDaylightSaving:void 0!==t.respectDaylightSaving&&t.respectDaylightSaving}},{key:"clone",value:function(){var e=this.respectsDaylightSaving,t=this.timezone;return new a({respectsDaylightSaving:e,timezone:t})}}]),n}(f.a);Object(c.a)([Object(u.b)({type:Boolean,json:{write:!0}})],m.prototype,"respectsDaylightSaving",void 0),Object(c.a)([Object(d.a)("respectsDaylightSaving",["respectsDaylightSaving","respectDaylightSaving"])],m.prototype,"readRespectsDaylightSaving",null),Object(c.a)([Object(u.b)({type:String,json:{read:{source:"timeZone"},write:{target:"timeZone"}}})],m.prototype,"timezone",void 0);var g,O=m=a=Object(c.a)([Object(p.a)("esri.layers.support.TimeReference")],m),j=g=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).cumulative=!1,a.endField=null,a.fullTimeExtent=null,a.hasLiveData=!1,a.interval=null,a.startField=null,a.timeReference=null,a.trackIdField=null,a.useTime=!0,a}return Object(r.a)(n,[{key:"readFullTimeExtent",value:function(e,t){if(!t.timeExtent||!Array.isArray(t.timeExtent)||2!==t.timeExtent.length)return null;var n=new Date(t.timeExtent[0]),a=new Date(t.timeExtent[1]);return new v.a({start:n,end:a})}},{key:"writeFullTimeExtent",value:function(e,t){e&&e.start&&e.end?t.timeExtent=[e.start.getTime(),e.end.getTime()]:t.timeExtent=null}},{key:"readInterval",value:function(e,t){return t.timeInterval&&t.timeIntervalUnits?new y.a({value:t.timeInterval,unit:b.c.fromJSON(t.timeIntervalUnits)}):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?new y.a({value:t.defaultTimeInterval,unit:b.c.fromJSON(t.defaultTimeIntervalUnits)}):null}},{key:"writeInterval",value:function(e,t){if(e){var n=e.toJSON();t.timeInterval=n.value,t.timeIntervalUnits=n.unit}else t.timeInterval=null,t.timeIntervalUnits=null}},{key:"clone",value:function(){var e=this.cumulative,t=this.endField,n=this.hasLiveData,a=this.interval,i=this.startField,r=this.timeReference,o=this.fullTimeExtent,s=this.trackIdField,c=this.useTime;return new g({cumulative:e,endField:t,hasLiveData:n,interval:a,startField:i,timeReference:Object(l.a)(r),fullTimeExtent:Object(l.a)(o),trackIdField:s,useTime:c})}}]),n}(f.a);Object(c.a)([Object(u.b)({type:Boolean,json:{read:{source:"exportOptions.timeDataCumulative"},write:{target:"exportOptions.timeDataCumulative"}}})],j.prototype,"cumulative",void 0),Object(c.a)([Object(u.b)({type:String,json:{read:{source:"endTimeField"},write:{target:"endTimeField",allowNull:!0}}})],j.prototype,"endField",void 0),Object(c.a)([Object(u.b)({type:v.a,json:{write:{enabled:!0,allowNull:!0}}})],j.prototype,"fullTimeExtent",void 0),Object(c.a)([Object(d.a)("fullTimeExtent",["timeExtent"])],j.prototype,"readFullTimeExtent",null),Object(c.a)([Object(h.a)("fullTimeExtent")],j.prototype,"writeFullTimeExtent",null),Object(c.a)([Object(u.b)({type:Boolean,json:{write:!0}})],j.prototype,"hasLiveData",void 0),Object(c.a)([Object(u.b)({type:y.a,json:{write:{enabled:!0,allowNull:!0}}})],j.prototype,"interval",void 0),Object(c.a)([Object(d.a)("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],j.prototype,"readInterval",null),Object(c.a)([Object(h.a)("interval")],j.prototype,"writeInterval",null),Object(c.a)([Object(u.b)({type:String,json:{read:{source:"startTimeField"},write:{target:"startTimeField",allowNull:!0}}})],j.prototype,"startField",void 0),Object(c.a)([Object(u.b)({type:O,json:{write:{enabled:!0,allowNull:!0}}})],j.prototype,"timeReference",void 0),Object(c.a)([Object(u.b)({type:String,json:{write:{enabled:!0,allowNull:!0}}})],j.prototype,"trackIdField",void 0),Object(c.a)([Object(u.b)({type:Boolean,json:{read:{source:"exportOptions.useTime"},write:{target:"exportOptions.useTime"}}})],j.prototype,"useTime",void 0);var _=j=g=Object(c.a)([Object(p.a)("esri.layers.support.TimeInfo")],j);t.a=_},799:function(e,t,n){"use strict";var a,i=n(2),r=n(3),o=n(4),s=n(5),c=n(0),l=(n(13),n(18)),u=(n(12),n(14)),d=n(1),p=n(6),h=n(26),f=(n(9),n(19),n(20),n(23)),b=a=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).attachmentTypes=null,a.attachmentsWhere=null,a.keywords=null,a.globalIds=null,a.name=null,a.num=null,a.objectIds=null,a.returnMetadata=!1,a.size=null,a.start=null,a.where=null,a}return Object(r.a)(n,[{key:"writeStart",value:function(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}},{key:"clone",value:function(){return new a(Object(l.a)({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}}]),n}(f.a);Object(c.a)([Object(d.b)({type:[String],json:{write:!0}})],b.prototype,"attachmentTypes",void 0),Object(c.a)([Object(d.b)({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],b.prototype,"attachmentsWhere",void 0),Object(c.a)([Object(d.b)({type:[String],json:{write:!0}})],b.prototype,"keywords",void 0),Object(c.a)([Object(d.b)({type:[Number],json:{write:!0}})],b.prototype,"globalIds",void 0),Object(c.a)([Object(d.b)({json:{write:!0}})],b.prototype,"name",void 0),Object(c.a)([Object(d.b)({type:Number,json:{read:{source:"resultRecordCount"}}})],b.prototype,"num",void 0),Object(c.a)([Object(d.b)({type:[Number],json:{write:!0}})],b.prototype,"objectIds",void 0),Object(c.a)([Object(d.b)({type:Boolean,json:{default:!1,write:!0}})],b.prototype,"returnMetadata",void 0),Object(c.a)([Object(d.b)({type:[Number],json:{write:!0}})],b.prototype,"size",void 0),Object(c.a)([Object(d.b)({type:Number,json:{read:{source:"resultOffset"}}})],b.prototype,"start",void 0),Object(c.a)([Object(h.a)("start"),Object(h.a)("num")],b.prototype,"writeStart",null),Object(c.a)([Object(d.b)({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],b.prototype,"where",void 0),(b=a=Object(c.a)([Object(p.a)("esri.tasks.support.AttachmentQuery")],b)).from=Object(u.m)(b);var v=b;t.a=v},805:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(39),i=n(362);function r(e){return function(t){t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);var n=t._delegatedEventNames,r=Array.isArray(e)?e:Object(i.b)(e);n.push.apply(n,Object(a.a)(r))}}},851:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));n(115),n(104),n(207),n(74),n(805),n(32);function a(e){return e&&"function"==typeof e.render}function i(e){return e&&"function"==typeof e.postMixInProperties&&"function"==typeof e.buildRendering&&"function"==typeof e.postCreate&&"function"==typeof e.startup}},880:function(e,t,n){"use strict";n.r(t);var a,i,r=n(8),o=n.n(r),s=n(22),c=n(11),l=n(2),u=n(3),d=n(4),p=n(5),h=n(0),f=n(13),b=n(10),v=n(12),y=n(14),m=n(1),g=n(28),O=n(6),j=n(26),_=n(21),w=(n(9),n(19),n(77)),k=(n(20),n(15)),M=n(57),I=n(58),x=n(399),C=n(183),T=n(296),F=n(184),E=n(185),A=n(228),P=n(233),S=n(230),L=n(416),V=n(227),R=n(394),N=n(229),D=n(791),B=n(298),z=n(932),U=n(505),H=n(251),W=n(420),q=n(512),G=n(43),K=n(51),J=n(52),$=n(49),X=n(84),Y=n(188),Z=n(40),Q=n(36),ee=n(153),te=n(42),ne=n(235),ae=n(101),ie=n(398),re=n(54),oe=n(196),se=n(16),ce=n(299),le=n(18),ue=n(23),de=n(37),pe=n(174),he=n(169),fe=n(29),be=a=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).type="none",a}return Object(u.a)(n,[{key:"clone",value:function(){return new a({type:this.type})}}]),n}(ue.a);Object(h.a)([Object(fe.a)({none:"none",stayAbove:"stay-above"})],be.prototype,"type",void 0),be=a=Object(h.a)([Object(O.a)("esri.ground.NavigationConstraint")],be);var ve=v.a.getLogger("esri.Ground"),ye=i=function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(e){var n;Object(l.a)(this,a),(n=t.call(this,e)).opacity=1,n.surfaceColor=null,n.navigationConstraint=null,n.layers=new te.a;return n.layers.on("after-add",(function(e){return function(e){e.parent&&e.parent!==Object(K.a)(n)&&"remove"in e.parent&&e.parent.remove(e),e.parent=Object(K.a)(n),"elevation"!==e.type&&"base-elevation"!==e.type&&ve.error("Layer '".concat(e.title,", id:").concat(e.id,"' of type '").concat(e.type,"' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported."))}(e.item)})),n.layers.on("after-remove",(function(e){e.item.parent=null})),n}return Object(u.a)(a,[{key:"initialize",value:function(){this.when().catch((function(e){ve.error("#load()","Failed to load ground",e)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}},{key:"destroy",value:function(){var e,t=this.layers.removeAll(),n=Object(se.a)(t);try{for(n.s();!(e=n.n()).done;){e.value.destroy()}}catch(a){n.e(a)}finally{n.f()}this.layers.destroy()}},{key:"normalizeCtorArgs",value:function(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e=Object(c.a)({},e)).resourceInfo),e}},{key:"writeLayers",value:function(e,t,n,a){var i=[];e?(a=Object(c.a)(Object(c.a)({},a),{},{layerContainerType:"ground"}),e.forEach((function(e){if("write"in e){var t={};Object(ce.b)(e)().write(t,a)&&i.push(t)}else a&&a.messages&&a.messages.push(new _.a("layer:unsupported","Layers (".concat(e.title,", ").concat(e.id,") of type '").concat(e.declaredClass,"' cannot be persisted in the ground"),{layer:e}))})),t.layers=i):t.layers=i}},{key:"load",value:function(e){return this.addResolvingPromise(this._loadFromSource(e)),Object(k.s)(this)}},{key:"loadAll",value:function(){var e=this;return Object(x.a)(this,(function(t){t(e.layers)}))}},{key:"queryElevation",value:function(){var e=Object(s.a)(o.a.mark((function e(t,a){var i,r,s,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load({signal:null==a?void 0:a.signal});case 2:return e.next=4,n.e(10).then(n.bind(null,1047));case 4:return i=e.sent,r=i.ElevationQuery,Object(k.u)(a),s=new r,c=this.layers.filter(me).toArray(),e.abrupt("return",s.queryAll(c,t,a));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createElevationSampler",value:function(){var e=Object(s.a)(o.a.mark((function e(t,a){var i,r,s,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load({signal:null==a?void 0:a.signal});case 2:return e.next=4,n.e(10).then(n.bind(null,1047));case 4:return i=e.sent,r=i.ElevationQuery,Object(k.u)(a),s=new r,c=this.layers.filter(me).toArray(),e.abrupt("return",s.createSamplerAll(c,t,a));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"clone",value:function(){var e={opacity:this.opacity,surfaceColor:Object(le.a)(this.surfaceColor),navigationConstraint:Object(le.a)(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new i({resourceInfo:this.resourceInfo}).set(e)}},{key:"read",value:function(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),Object(J.a)(Object($.a)(a.prototype),"read",this).call(this,e,t)}},{key:"_loadFromSource",value:function(e){var t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Object(k.s)(null)}},{key:"_loadLayersFromJSON",value:function(e,t,a){var i=this,r=t&&t.origin||"web-scene",o=t&&t.portal||null,s=t&&t.url||null;return n.e(18).then(n.bind(null,751)).then((function(t){var n=t.populateOperationalLayers;Object(k.u)(a);var c=[];if(e.layers&&Array.isArray(e.layers)){var l={context:{origin:r,url:s,portal:o,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};c.push(n(i.layers,e.layers,l))}return Object(k.i)(c)})).then((function(){}))}},{key:"layers",set:function(e){this._set("layers",Object(he.b)(e,this._get("layers")))}}]),a}(Object(ue.b)(ae.a));function me(e){return"elevation"===e.type||function(e){return e&&"createElevationSampler"in e}(e)}Object(h.a)([Object(m.b)({json:{read:!1}})],ye.prototype,"layers",null),Object(h.a)([Object(j.a)("layers")],ye.prototype,"writeLayers",null),Object(h.a)([Object(m.b)({readOnly:!0})],ye.prototype,"resourceInfo",void 0),Object(h.a)([Object(m.b)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:y.a,read:{reader:pe.b,source:"transparency"},write:{writer:function(e,t){t.transparency=Object(pe.a)(e)},target:"transparency"}}})],ye.prototype,"opacity",void 0),Object(h.a)([Object(m.b)({type:de.a,json:{type:[y.a],write:function(e,t){t.surfaceColor=e.toJSON().slice(0,3)}}})],ye.prototype,"surfaceColor",void 0),Object(h.a)([Object(m.b)({type:be,json:{write:!0}})],ye.prototype,"navigationConstraint",void 0);var ge=ye=i=Object(h.a)([Object(O.a)("esri.Ground")],ye),Oe=n(502),je=v.a.getLogger("esri.support.groundUtils"),_e={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};var we=n(929),ke=n(930),Me=v.a.getLogger("esri.Map"),Ie=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).allLayers=new ie.a({root:Object(K.a)(a),rootCollectionNames:["basemap.baseLayers","ground.layers","layers","basemap.referenceLayers"],getChildrenFunction:function(e){return e.layers}}),a.allTables=a._createTablesFlattener(Object(K.a)(a)),a.basemap=null,a.ground=new ge,a._basemapCache=Object(Oe.b)(),a}return Object(u.a)(n,[{key:"destroy",value:function(){var e,t;this.allLayers.destroy(),this.allTables.destroy(),null==(e=this.ground)||e.destroy(),null==(t=this.basemap)||t.destroy(),Object(Oe.c)(this._basemapCache),this._basemapCache=null}},{key:"castBasemap",value:function(e){return Object(Oe.d)(e,this._basemapCache)}},{key:"castGround",value:function(e){return function(e){var t;return"string"==typeof e?e in _e?t=new ge({resourceInfo:{data:{layers:[_e[e]]}}}):je.warn("Unable to find ground definition for: ".concat(e,'. Try "world-elevation"')):t=Object(y.m)(ge,e),t}(e)||(Me.error("Map.ground may not be set to null or undefined"),this._get("ground"))}},{key:"findLayerById",value:function(e){return this.allLayers.find((function(t){return t.id===e}))}},{key:"findTableById",value:function(e){return this.allTables.find((function(t){return t.id===e}))}},{key:"_createTablesFlattener",value:function(e){var t=this;return new ie.a({root:e,rootCollectionNames:["tables","layers"],getChildrenFunction:function(e){return e&&"group"===e.type?t._createTablesFlattener(e):null},itemFilterFunction:function(e){return t._isMapOrGroupLayer(e.parent)&&e.parent.tables.includes(e)}})}},{key:"_isMapOrGroupLayer",value:function(e){return e&&(e===this||this._isGroupLayer(e))}},{key:"_isGroupLayer",value:function(e){return e&&"group"===e.type}}]),n}(Object(ke.a)(Object(we.a)(ee.a.EventedMixin(G.a))));Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:[],autoTracked:!1})],Ie.prototype,"allLayers",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Ie.prototype,"allTables",void 0),Object(h.a)([Object(m.b)({type:oe.default})],Ie.prototype,"basemap",void 0),Object(h.a)([Object(re.a)("basemap")],Ie.prototype,"castBasemap",null),Object(h.a)([Object(m.b)({type:ge,nonNullable:!0})],Ie.prototype,"ground",void 0),Object(h.a)([Object(re.a)("ground")],Ie.prototype,"castGround",null);var xe=Ie=Object(h.a)([Object(O.a)("esri.Map")],Ie),Ce=n(73),Te=n(402),Fe=n(365),Ee=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).view=null,a.baseLayerViews=new te.a,a.referenceLayerViews=new te.a,a._loadingHandle=Object(Ce.a)(Object(K.a)(a),"view.map.basemap",(function(e){e&&e.load().catch((function(){}))})),a}return Object(u.a)(n,[{key:"destroy",value:function(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}},{key:"suspended",get:function(){return!this.view||this.view.suspended}},{key:"updating",get:function(){return(!this.view||!this.view.suspended)&&!(!(this.view&&this.view.map&&this.view.map.basemap)||this.view.map.basemap.loaded)}}]),n}(G.a);Object(h.a)([Object(m.b)({constructOnly:!0})],Ee.prototype,"view",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Ee.prototype,"baseLayerViews",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Ee.prototype,"referenceLayerViews",void 0),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["view.suspended"]})],Ee.prototype,"suspended",null),Object(h.a)([Object(m.b)({type:Boolean,readOnly:!0,dependsOn:["view.suspended","view.map.basemap.loaded"]})],Ee.prototype,"updating",null),Ee=Object(h.a)([Object(O.a)("esri.views.BasemapView")],Ee);var Ae=n(31),Pe=n(39),Se=n(417);function Le(e,t){var n,a=Object(se.a)(e);try{for(a.s();!(n=a.n()).done;){var i=Object(Ae.a)(n.value,2),r=i[0];if(t(i[1],r))return!0}}catch(o){a.e(o)}finally{a.f()}return!1}var Ve=v.a.getLogger("esri.views.LayerViewManager"),Re=function(){function e(t,n,a){var i=this;Object(l.a)(this,e),this.layer=t,this.view=n,this.layerViewImporter=a,this._controller=Object(k.d)(),this._deferred=Object(k.f)(),this._started=!1,this.done=!1,Object(k.p)(this._controller.signal,(function(){var e=new _.a("cancelled:layerview-create","layerview creation cancelled",{layer:t});i._deferred.reject(e)}))}return Object(u.a)(e,[{key:"destroy",value:function(){this._controller.abort();var e=this.layerView;if(e){var t=this.layer,n=this.view;t.emit("layerview-destroy",{view:n,layerView:e}),n.emit("layerview-destroy",{layer:t,layerView:e}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}}},{key:"start",value:function(){var e=Object(s.a)(o.a.mark((function e(){var t,n,a,i,r,s,c,l,u,d=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._started){e.next=2;break}return e.abrupt("return");case 2:return this._started=!0,t=this._controller.signal,n=this.layer,a=this.view,this._map=a.map,e.prev=5,e.next=8,n.load({signal:t});case 8:if(e.t0="prefetchResources"in n,!e.t0){e.next=12;break}return e.next=12,n.prefetchResources({signal:t});case 12:if(!n.createLayerView){e.next=18;break}return e.next=15,n.createLayerView(a,{signal:t});case 15:s=e.sent,e.next=24;break;case 18:if(this.layerViewImporter.hasLayerViewModule(n)){e.next=20;break}throw new _.a("layer:view-not-supported","No layerview implementation was found");case 20:return e.next=22,this.layerViewImporter.importLayerView(n);case 22:l=e.sent,Object(k.u)(t),s="default"in l?new l.default({layer:n,view:a}):new l({layer:n,view:a});case 24:return u=function(){c=Object(b.l)(c),s.destroy(),s.layer=null,s.parent=null,s.view=null,d.done=!0},c=Object(k.p)(t,u),Object(k.u)(t),e.prev=26,e.next=29,s.when();case 29:e.next=34;break;case 31:throw e.prev=31,e.t1=e.catch(26),u(),e.t1;case 34:if(null==(i=this._map)||null==(r=i.allLayers)?void 0:r.includes(n)){e.next=36;break}return e.abrupt("return",(u(),void this._deferred.reject(new _.a("view:no-layerview-for-layer","The layer has been removed from the map",{layer:n}))));case 36:this.layerView=s,n.emit("layerview-create",{view:a,layerView:s}),a.emit("layerview-create",{layer:n,layerView:s}),this.done=!0,this._deferred.resolve(s),e.next=42;break;case 39:e.prev=39,e.t2=e.catch(5),n.emit("layerview-create-error",{view:a,error:e.t2}),a.emit("layerview-create-error",{layer:n,error:e.t2}),this.done=!0,this._deferred.reject(new _.a("layerview:create-error","layerview creation failed",{layer:n,error:e.t2}));case 42:case"end":return e.stop()}}),e,this,[[5,39],[26,31]])})));return function(){return e.apply(this,arguments)}}()},{key:"promise",get:function(){return this._deferred.promise}}]),e}(),Ne=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e))._layerLayerViewInfoMap=new Map,a._watchUpdatingTracking=new Se.a,a.supportsGround=!0,a._preloadLayerViewModules=function(){var e,t=null==(e=a.view.map)?void 0:e.allLayers;if(t){var n,i=Object(se.a)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;a.layerViewImporter.hasLayerViewModule(r)&&a.layerViewImporter.importLayerView(r)}}catch(o){i.e(o)}finally{i.f()}}},a._reschedule=function(){return Object(b.f)(a._workPromise)&&(a._workPromise=Object(k.f)()),a.handles.remove("reschedule"),a.handles.add(Object(Y.b)(a._doWork),"reschedule"),a._workPromise.promise},a._doWork=function(){var e,t,n,i=a.view.map;if(a._map!==i&&(a.clear(),a._map=i),Object(b.f)(a._workPromise))a.notifyChange("updating");else{a.handles.remove("reschedule"),a.handles.remove("collection-change");var r=new ie.a({root:Object(K.a)(a),rootCollectionNames:a._rootCollectionNames,getChildrenFunction:function(e){return e.layers}});if(!r)return a._workPromise.resolve(),void(a._workPromise=null);var o,s=Object(se.a)(r);try{for(s.s();!(o=s.n()).done;){var c=o.value;a._createLayerView(c)}}catch(y){s.e(y)}finally{s.f()}a._refreshCollections();var l,u=Object(se.a)(a._layerLayerViewInfoMap);try{for(u.s();!(l=u.n()).done;){var d=Object(Ae.a)(l.value,2),p=d[0],h=d[1];r.includes(p)||(a._layerLayerViewInfoMap.delete(h.layer),h.destroy())}}catch(y){u.e(y)}finally{u.f()}var f=r.filter((function(e){return"group"===e.type})).map((function(e){return e.layers})),v=[null==i||null==(e=i.ground)?void 0:e.layers,null==i||null==(t=i.basemap)?void 0:t.baseLayers,null==i||null==(n=i.basemap)?void 0:n.referenceLayers,null==i?void 0:i.layers].concat(Object(Pe.a)(f)).filter((function(e){return!!e}));a.handles.add(v.map((function(e){return a._watchUpdatingTracking.addOnCollectionChange(e,a._reschedule)})),"collection-change"),a._workPromise.resolve(),a._workPromise=null}},a}return Object(u.a)(n,[{key:"initialize",value:function(){this.handles.add([Object(Ce.b)(this,"view.map.allLayers","change",this._preloadLayerViewModules,this._preloadLayerViewModules),Object(Ce.a)(this.view,["map.basemap","map.ground","map.layers","ready"],this._reschedule,!0)]),this._preloadLayerViewModules(),this._reschedule()}},{key:"destroy",value:function(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null}},{key:"clear",value:function(){if(!this.destroyed){var e,t=Object(se.a)(this._layerLayerViewInfoMap.values());try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(n){t.e(n)}finally{t.f()}this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}},{key:"whenLayerView",value:function(){var e=Object(s.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._reschedule();case 2:return e.abrupt("return",this._layerLayerViewInfoMap.has(t)?this._layerLayerViewInfoMap.get(t).promise:Object(k.r)(new _.a("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:t})));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_refreshCollections",value:function(){var e,t=Object(se.a)(this._layersToLayerViews);try{for(t.s();!(e=t.n()).done;){var n=Object(Ae.a)(e.value,2),a=n[0],i=n[1];this._populateLayerViewsOwners(this.get(a),this.get(i),this.view)}}catch(r){t.e(r)}finally{t.f()}this.notifyChange("updating")}},{key:"_populateLayerViewsOwners",value:function(e,t,n){if(e&&t){var a,i=0,r=Object(se.a)(e);try{for(r.s();!(a=r.n()).done;){var o=a.value,s=this._layerLayerViewInfoMap.get(o);if(s&&s.layerView){var c=s.layerView;c.layer=o,c.parent=n,t.getItemAt(i)!==c&&t.splice(i,0,c),o.layers&&this._populateLayerViewsOwners(o.layers,c.layerViews,c),i+=1}}}catch(l){r.e(l)}finally{r.f()}i<t.length&&t.splice(i,t.length)}else t&&t.removeAll()}},{key:"_createLayerView",value:function(e){var t=this;if(this._layerLayerViewInfoMap.has(e))return this.view.ready&&this._layerLayerViewInfoMap.get(e).start(),void this.notifyChange("updating");e.load().catch((function(){})),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);var n=new Re(e,this.view,this.layerViewImporter);n.promise.then((function(){return t._refreshCollections()}),(function(n){var a,i;n&&(Object(k.l)(n)||"cancelled:layerview-create"===n.name)||Ve.error("Failed to create layerview for layer title:'".concat(null!=(a=e.title)?a:"no title","', id:'").concat(null!=(i=e.id)?i:"no id","' of type '").concat(e.type,"'."),{layer:e,error:n}),t._refreshCollections()})),this._layerLayerViewInfoMap.set(e,n),this.view.ready&&n.start(),this.notifyChange("updating")}},{key:"_layersToLayerViews",get:function(){var e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}},{key:"_rootCollectionNames",get:function(){return Array.from(this._layersToLayerViews.keys())}},{key:"updating",get:function(){return!(!Object(b.g)(this._workPromise)&&!this._watchUpdatingTracking.updating)||Le(this._layerLayerViewInfoMap,(function(e){return!e.done}))}}]),n}(B.a);Object(h.a)([Object(m.b)()],Ne.prototype,"_workPromise",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Ne.prototype,"_watchUpdatingTracking",void 0),Object(h.a)([Object(m.b)({dependsOn:["supportsGround"],readOnly:!0})],Ne.prototype,"_layersToLayerViews",null),Object(h.a)([Object(m.b)({dependsOn:["_layersToLayerViews"],readOnly:!0})],Ne.prototype,"_rootCollectionNames",null),Object(h.a)([Object(m.b)()],Ne.prototype,"layerViewImporter",void 0),Object(h.a)([Object(m.b)()],Ne.prototype,"supportsGround",void 0),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["_workPromise","_watchUpdatingTracking.updating"]})],Ne.prototype,"updating",null),Object(h.a)([Object(m.b)({constructOnly:!0})],Ne.prototype,"view",void 0);var De=Ne=Object(h.a)([Object(O.a)("esri.views.LayerViewManager")],Ne),Be=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).factor=1.5,a.offsetX=0,a.offsetY=0,a.position=null,a.size=120,a.mask=null,a.maskEnabled=!0,a.overlay=null,a.overlayEnabled=!0,a.visible=!1,a}return Object(u.a)(n,[{key:"version",get:function(){return this.factor,this.offsetX,this.offsetY,this.position,this.visible,this.size,this.mask,this.maskEnabled,this.overlay,this.overlayEnabled,(this._get("version")||0)+1}}]),n}(G.a);Object(h.a)([Object(m.b)({type:Number})],Be.prototype,"factor",void 0),Object(h.a)([Object(m.b)({type:Number})],Be.prototype,"offsetX",void 0),Object(h.a)([Object(m.b)({type:Number})],Be.prototype,"offsetY",void 0),Object(h.a)([Object(m.b)()],Be.prototype,"position",void 0),Object(h.a)([Object(m.b)({type:Number,range:{min:0}})],Be.prototype,"size",void 0),Object(h.a)([Object(m.b)()],Be.prototype,"mask",void 0),Object(h.a)([Object(m.b)()],Be.prototype,"maskEnabled",void 0),Object(h.a)([Object(m.b)()],Be.prototype,"overlay",void 0),Object(h.a)([Object(m.b)()],Be.prototype,"overlayEnabled",void 0),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["factor","offsetX","offsetY","position","visible","mask","overlay","maskEnabled","overlayEnabled","size"]})],Be.prototype,"version",null),Object(h.a)([Object(m.b)({type:Boolean})],Be.prototype,"visible",void 0);var ze=Be=Object(h.a)([Object(O.a)("esri.views.Magnifier")],Be),Ue=n(87);function He(e){return"refresh"in e}var We=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(){var e;return Object(l.a)(this,n),(e=t.apply(this,arguments))._handles=new Ue.a,e._currentTick=0,e}return Object(u.a)(n,[{key:"initialize",value:function(){var e=this;this._handles.add([this.view.allLayerViews.on("after-changes",(function(){e.notifyChange("tickInterval"),e._handles.remove("layerViewsUpdating"),e._handles.add(e._getLayerViewHandles(),"layerViewsUpdating")})),this.watch("tickInterval",(function(){return e._restartTicking()})),this.watch("view.ready",(function(){return e._restartTicking()}))]),this._restartTicking()}},{key:"destroy",value:function(){this._handles&&(this._handles.destroy(),this._handles=null,this._intervalID&&clearInterval(this._intervalID),this._currentTick=0)}},{key:"_restartTicking",value:function(){var e=this;this._currentTick=0,this._intervalID&&clearInterval(this._intervalID),this.get("view.ready")&&this.tickInterval&&(this._intervalID=setInterval((function(){var t=Date.now();e._currentTick+=e.tickInterval,e.view.allLayerViews.forEach((function(n){if(He(n)){var a=Math.round(6e4*n.refreshInterval),i=e._currentTick%a==0,r=t-n.refreshTimestamp<5400;a&&i&&!r&&n.refresh(t)}}))}),this.tickInterval))}},{key:"_getLayerViewHandles",value:function(){var e=this,t=[],n=function(){return e.notifyChange("tickInterval")};return this.view.allLayerViews.forEach((function(e){He(e)&&e.layer&&t.push(e.watch("refreshInterval",n),e.layer.on("refresh",(function(){e.refresh(Date.now())})))})),t}},{key:"_getCommonInterval",value:function(e){return e.toArray().reduce((function(e,t){return function e(t,n){return isNaN(t)||isNaN(n)?0:n<=0?t:e(n,t%n)}(Math.round(6e4*t.refreshInterval),e)}),0)}},{key:"tickInterval",get:function(){var e=this.view.allLayerViews.filter((function(e){return He(e)}));return this._getCommonInterval(e)}}]),n}(G.a);Object(h.a)([Object(m.b)()],We.prototype,"view",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],We.prototype,"tickInterval",null);for(var qe=We=Object(h.a)([Object(O.a)("esri.views.RefreshManager")],We),Ge=n(71),Ke=n(53),Je=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Object(l.a)(this,e),this.eventType=t,this.keyModifiers=n}return Object(u.a)(e,[{key:"matches",value:function(e){if(e.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;var t,n=e.modifiers,a=Object(se.a)(this.keyModifiers);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(!n.has(i))return!1}}catch(r){a.e(r)}finally{a.f()}return!0}}]),e}(),$e=v.a.getLogger("esri.views.input.InputHandler"),Xe=function(){function e(t){Object(l.a)(this,e),this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=t}return Object(u.a)(e,[{key:"onInstall",value:function(e){var t=this;this._manager?$e.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback((function(e){return t._handleEvent(e)})),e.setUninstallCallback((function(){return t._onUninstall()})),this._manager=e)}},{key:"onUninstall",value:function(){}},{key:"registerIncoming",value:function(e,t,n){var a,i=this;"function"==typeof t?(n=t,a=[]):a=t||[];var r="string"==typeof e?new Je(e,a):e,o=function(){i._incomingEventTypes=null,i._incomingEventMatches=null},s=function(e){var t=i._incoming[e.match.eventType];if(t){var n=t.indexOf(e);t.splice(n,1),o(),i._manager&&i._manager.updateDependencies()}},c=new Ye(r,n,{onPause:s,onRemove:s,onResume:function(e){var t=i._incoming[e.match.eventType];t&&-1===t.indexOf(e)&&(t.push(e),o(),i._manager&&i._manager.updateDependencies())}}),l=this._incoming[r.eventType];return l||(l=[],this._incoming[r.eventType]=l),l.push(c),o(),this._manager&&this._manager.updateDependencies(),c}},{key:"registerOutgoing",value:function(e){var t=this;if(this._outgoing[e])throw Error("There is already a callback registered for this outgoing InputEvent: "+e);var n=new Ze(e,{onEmit:function(e,n,a,i){t._manager.emit(e.eventType,n,a,i)},onRemove:function(e){delete t._outgoing[e.eventType],t._manager.updateDependencies()}});return this._outgoing[e]=n,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),n}},{key:"startCapturingPointer",value:function(e){this._manager.setPointerCapture(e,!0)}},{key:"stopCapturingPointer",value:function(e){this._manager.setPointerCapture(e,!1)}},{key:"refreshHasPendingInputs",value:function(){this._manager.refreshHasPendingInputs()}},{key:"_onUninstall",value:function(){this._manager?(this.onUninstall(),this._manager=null):$e.error("This InputHandler is not registered with an InputManager")}},{key:"_handleEvent",value:function(e){var t=this._incoming[e.type];if(t){var n,a=Object(se.a)(t);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i.match.matches(e)&&(i.callback(e),e.shouldStopPropagation()))break}}catch(r){a.e(r)}finally{a.f()}}}},{key:"incomingEventMatches",get:function(){if(!this._incomingEventMatches)for(var e in this._incomingEventMatches=[],this._incoming){var t,n=this._incoming[e],a=Object(se.a)(n);try{for(a.s();!(t=a.n()).done;){var i=t.value;this._incomingEventMatches.push(i.match)}}catch(r){a.e(r)}finally{a.f()}}return this._incomingEventMatches}},{key:"incomingEventTypes",get:function(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map((function(e){return e.eventType}))),this._incomingEventTypes}},{key:"outgoingEventTypes",get:function(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}},{key:"hasSideEffects",get:function(){return this._hasSideEffects}},{key:"hasPendingInputs",get:function(){return!1}}]),e}(),Ye=function(){function e(t,n,a){Object(l.a)(this,e),this.match=t,this._callback=n,this._handler=a}return Object(u.a)(e,[{key:"pause",value:function(){this._handler.onPause(this)}},{key:"resume",value:function(){this._handler.onResume(this)}},{key:"remove",value:function(){this._handler.onRemove(this)}},{key:"callback",get:function(){return this._callback}}]),e}(),Ze=function(){function e(t,n){Object(l.a)(this,e),this.eventType=t,this._removed=!1,this._handler=n}return Object(u.a)(e,[{key:"emit",value:function(e,t,n){this._removed||this._handler.onEmit(this,e,t,n)}},{key:"remove",value:function(){this._removed=!0,this._handler.onRemove(this)}}]),e}(),Qe=n(923),et=n(125),tt=Object(f.a)("mac")?"Meta":"Ctrl",nt={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"},at=48;at<58;at++)nt[at]=String.fromCharCode(at);for(var it=1;it<25;it++)nt[111+it]="F".concat(it);for(var rt=65;rt<91;rt++)nt[rt]=[String.fromCharCode(rt+32),String.fromCharCode(rt)];function ot(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}var st=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,!0))._onChange=e,a._value="mouse",a.registerIncoming("pointer-down",(function(e){var t="touch"===e.data.native.pointerType;a._setValue(t?"touch":"mouse")})),a._moveHandler=a.registerIncoming("pointer-move",(function(e){var t="touch"===e.data.native.pointerType;a._setValue(t?"touch":"mouse")})),a._moveHandler.pause(),a}return Object(u.a)(n,[{key:"_setValue",value:function(e){e!==this._value&&("touch"===e?this._moveHandler.resume():this._moveHandler.pause(),this._value=e,this._onChange(e))}}]),n}(Xe),ct=v.a.getLogger("esri.views.input.InputManager"),lt=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e))._pointerCaptures=new Map,a._nameToGroup={},a._handlers=[],a._currentPropagation=null,a._sourceEvents=new Set,a._keyModifiers=new Set,a._activeKeyModifiers=new Set,a._stoppedPropagationEventIds=new Set,a.primaryKey=tt,a.latestPointerType="mouse",a.test={timestamp:void 0,hasCurrentPropagation:function(){return!!a._currentPropagation}},a}return Object(u.a)(n,[{key:"initialize",value:function(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}},{key:"destroy",value:function(){for(var e=0,t=Object.keys(this._nameToGroup);e<t.length;e++){var n=t[e];this.uninstallHandlers(n)}this.eventSource=null,this._currentPropagation=null}},{key:"installHandlers",value:function(e,t){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:dt.INTERNAL;if(this._nameToGroup[e])ct.error("There is already an InputHandler group registered under the name `"+e+"`");else if(0!==t.length){var i={name:e,handlers:t.map((function(e){return{handler:e,active:!0,removed:!1,priorityIndex:0,groupPriority:a,eventCallback:null,uninstallCallback:null}}))};this._nameToGroup[e]=i;for(var r=function(e){var t=i.handlers[e];n._handlers.push(t),t.handler.onInstall({updateDependencies:function(){n.updateDependencies()},emit:function(e,a,i,r,o){n._emitInputEvent(t.priorityIndex+1,e,a,i,o,r)},setPointerCapture:function(e,a){n._setPointerCapture(i,t,e,a)},setEventCallback:function(e){t.eventCallback=e},setUninstallCallback:function(e){t.uninstallCallback=e},refreshHasPendingInputs:function(){n.notifyChange("hasPendingInputs")}})},o=i.handlers.length-1;o>=0;o--)r(o);this.updateDependencies()}else ct.error("Can't register a group of zero handlers")}},{key:"uninstallHandlers",value:function(e){var t=this._nameToGroup[e];t?(t.handlers.forEach((function(e){e.removed=!0,e.uninstallCallback()})),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):ct.error("There is no InputHandler group registered under the name `"+e+"`")}},{key:"hasHandlers",value:function(e){return void 0!==this._nameToGroup[e]}},{key:"updateDependencies",value:function(){var e=new Set,t=new Set;this._handlersPriority=[];for(var n=this._handlers.length-1;n>=0;n--){var a=this._handlers[n];a.priorityIndex=n,this._handlersPriority.push(a)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(var i=this._handlersPriority.length-1;i>=0;i--){var r=this._handlersPriority[i];r.priorityIndex=i;var o=r.handler.hasSideEffects;if(!o){var s,c=Object(se.a)(r.handler.outgoingEventTypes);try{for(c.s();!(s=c.n()).done;){var l=s.value;if(e.has(l)){o=!0;break}}}catch(v){c.e(v)}finally{c.f()}}if(o){var u,d=Object(se.a)(r.handler.incomingEventMatches);try{for(d.s();!(u=d.n()).done;){var p=u.value;e.add(p.eventType);var h,f=Object(se.a)(p.keyModifiers);try{for(f.s();!(h=f.n()).done;){var b=h.value;ot(b)||t.add(b)}}catch(v){f.e(v)}finally{f.f()}}}catch(v){d.e(v)}finally{d.f()}}r.active=o}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}},{key:"_setLatestPointerType",value:function(e){this._set("latestPointerType",e)}},{key:"_onEventReceived",value:function(e,t){if("pointer-capture-lost"===e){var n=t;this._pointerCaptures.delete(n.native.pointerId)}this._updateKeyModifiers(e,t);var a=null!=this.test.timestamp?this.test.timestamp:t.native?t.native.timestamp:void 0,i=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,a,i)}},{key:"_updateKeyModifiers",value:function(e,t){var n=this;if(t){var a=!1,i=function(){if(!a){var e=new Set;n._activeKeyModifiers.forEach((function(t){e.add(t)})),n._activeKeyModifiers=e,a=!0}},r=function(e,t){t&&!n._activeKeyModifiers.has(e)?(i(),n._activeKeyModifiers.add(e)):!t&&n._activeKeyModifiers.has(e)&&(i(),n._activeKeyModifiers.delete(e))};if("key-down"===e||"key-up"===e){var o=t.key;this._keyModifiers.has(o)&&r(o,"key-down"===e)}var s=t.native;r("Alt",!(!s||!s.altKey)),r("Ctrl",!(!s||!s.ctrlKey)),r("Shift",!(!s||!s.shiftKey)),r("Meta",!(!s||!s.metaKey)),r("Primary",this._activeKeyModifiers.has(this.primaryKey))}}},{key:"_installRecognizers",value:function(){var e=this;this._latestPointerTypeHandler=new st((function(t){return e._setLatestPointerType(t)})),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,dt.INTERNAL),this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler],dt.INTERNAL)}},{key:"_setPointerCapture",value:function(e,t,n,a){var i=e.name+"-"+t.priorityIndex,r=this._pointerCaptures.get(n.pointerId)||new Set;this._pointerCaptures.set(n.pointerId,r),a?(r.add(i),1===r.size&&this.eventSource&&this.eventSource.setPointerCapture(n,!0)):r.has(i)&&(r.delete(i),0===r.size&&(this._pointerCaptures.delete(n.pointerId),this.eventSource&&this.eventSource.setPointerCapture(n,!1)))}},{key:"_garbageCollectRemovedHandlers",value:function(){this._handlers=this._handlers.filter((function(e){return!e.removed})),this.updateDependencies()}},{key:"_emitInputEventFromSource",value:function(e,t,n,a){this._emitInputEvent(0,e,t,n,a)}},{key:"_emitInputEvent",value:function(e,t,n,a,i,r){var o=void 0!==a?a:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),s=void 0!==i&&i,c={event:new ut(t,n,o,r||this._activeKeyModifiers,s),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}},{key:"_doNewPropagation",value:function(e){this._currentPropagation={events:new Qe.a,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}},{key:"_continuePropagation",value:function(){var e=this,t=this._currentPropagation;if(t){for(;this._currentPropagation.events.length>0;){var n=this._currentPropagation.events.pop(),a=n.event,i=n.priorityIndex,r=a.data&&a.data.eventId;if(null==r||!this._stoppedPropagationEventIds.has(r))for(t.currentHandler=this._handlersPriority[i];t.currentHandler;){if(t.currentHandler.removed)t.needsHandlerGarbageCollect=!0;else{if(t.currentHandler.active&&!a.shouldStopPropagation()&&t.currentHandler.eventCallback(a),a.shouldStopPropagation()){null!=r&&this._stoppedPropagationEventIds.add(r);break}if(a.shouldPausePropagation((function(){return e._continuePropagation()})))return void this._pausePropagation({event:a,priorityIndex:t.currentHandler.priorityIndex+1})}t.currentHandler=this._handlersPriority[t.currentHandler.priorityIndex+1]}}t.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null}}},{key:"_pausePropagation",value:function(e){var t=new Qe.a;for(t.push(e);this._currentPropagation.events.length;)t.push(this._currentPropagation.events.pop());this._currentPropagation.events=t,this._currentPropagation.currentHandler=null}},{key:"_compareHandlerPriority",value:function(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;var n,a=Object(se.a)(e.handler.incomingEventMatches);try{for(a.s();!(n=a.n()).done;){var i,r=n.value,o=Object(se.a)(t.handler.incomingEventMatches);try{var s=function(){var e=i.value;if(r.eventType!==e.eventType)return"continue";var t=r.keyModifiers.filter((function(t){return-1!==e.keyModifiers.indexOf(t)}));return t.length===r.keyModifiers.length!==(t.length===e.keyModifiers.length)?{v:r.keyModifiers.length>e.keyModifiers.length?-1:1}:void 0};for(o.s();!(i=o.n()).done;){var c=s();if("continue"!==c&&"object"===typeof c)return c.v}}catch(l){o.e(l)}finally{o.f()}}}catch(l){a.e(l)}finally{a.f()}return e.priorityIndex>t.priorityIndex?-1:1}},{key:"_sortHandlersPriority",value:function(e){var t,n=[],a=Object(se.a)(e);try{for(a.s();!(t=a.n()).done;){for(var i=t.value,r=0;r<n.length&&this._compareHandlerPriority(i,n[r])>=0;)r++;n.splice(r,0,i)}}catch(o){a.e(o)}finally{a.f()}return n}},{key:"hasPendingInputs",get:function(){return this._handlers.some((function(e){return e.handler.hasPendingInputs}))}},{key:"debug",get:function(){var e=this,t=function(t){var n=e._setPointerCapture;e._setPointerCapture=function(){},t(),e._setPointerCapture=n};return{injectEvent:function(n,a){t((function(){e._onEventReceived(n,a)}))},disablePointerCapture:t}}}]),n}(G.a);Object(h.a)([Object(m.b)({readOnly:!0})],lt.prototype,"hasPendingInputs",null),Object(h.a)([Object(m.b)()],lt.prototype,"eventSource",void 0),Object(h.a)([Object(m.b)()],lt.prototype,"recognizers",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],lt.prototype,"latestPointerType",void 0),lt=Object(h.a)([Object(O.a)("esri.views.input.InputManager")],lt);var ut=function(){function e(t,n,a,i,r){Object(l.a)(this,e),this.type=t,this.data=n,this.timestamp=a,this.modifiers=i,this.cancelable=r,this._propagationState=0,this._resumeCallback=null}return Object(u.a)(e,[{key:"stopPropagation",value:function(){this._propagationState|=1}},{key:"shouldStopPropagation",value:function(){return 0!=(1&this._propagationState)}},{key:"async",value:function(e){var t=this;this._propagationState|=2;var n=function(e,n){t._propagationState&=-3;var a=t._resumeCallback;if(t._resumeCallback=null,a&&a(),n)throw e;return e};return("function"==typeof e?e():e).then((function(e){return n(e,!1)}),(function(e){return n(e,!0)}))}},{key:"shouldPausePropagation",value:function(e){return!!(2&this._propagationState)&&(this._resumeCallback=e,!0)}},{key:"preventDefault",value:function(){this.data.native.preventDefault()}}]),e}(),dt={DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3},pt=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],ht={};function ft(e){return!!ht[e]}pt.forEach((function(e){ht[e]=!0}));var bt=function(){function e(t){Object(l.a)(this,e),this.handlers=new Map,this.counter=0,this.handlerCounts=new Map,this.view=t,this.inputManager=null}return Object(u.a)(e,[{key:"connect",value:function(e){var t=this;e&&this.disconnect(),this.inputManager=e,this.handlers.forEach((function(e,n){var a=e.handler,i=e.priority;return t.inputManager.installHandlers(n,[a],i)}))}},{key:"disconnect",value:function(){var e=this;this.inputManager&&this.handlers.forEach((function(t,n){return e.inputManager.uninstallHandlers(n)})),this.inputManager=null}},{key:"destroy",value:function(){this.disconnect(),this.handlers.clear(),this.view=null}},{key:"on",value:function(e,t,n,a){var i,r,o=this,s=Array.isArray(e)?e:e.split(",");if(!function(e){var t,n=Object(se.a)(e);try{for(n.s();!(t=n.n()).done;){if(!ft(t.value))return!1}}catch(a){n.e(a)}finally{n.f()}return!0}(s))return s.some(ft)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;Array.isArray(t)?r=t:(i=t,r=[]),"function"==typeof n?i=n:a=n,a=null!=a?a:dt.DEFAULT;var c=this.createUniqueGroupName(),l=new vt(this.view,s,r,i);this.handlers.set(c,{handler:l,priority:a});var u,d=Object(se.a)(s);try{for(d.s();!(u=d.n()).done;){var p=u.value,h=this.handlerCounts.get(p)||0;this.handlerCounts.set(p,h+1)}}catch(f){d.e(f)}finally{d.f()}return this.inputManager&&this.inputManager.installHandlers(c,[l],a),{remove:function(){return o.removeHandler(c,s)}}}},{key:"hasHandler",value:function(e){return!!this.handlerCounts.get(e)}},{key:"removeHandler",value:function(e,t){if(this.handlers.has(e)){this.handlers.delete(e);var n,a=Object(se.a)(t);try{for(a.s();!(n=a.n()).done;){var i=n.value,r=this.handlerCounts.get(i);void 0===r?console.error("Trying to remove handler for event that has no handlers registered: ",i):1===r?this.handlerCounts.delete(i):this.handlerCounts.set(i,r-1)}}catch(o){a.e(o)}finally{a.f()}}this.inputManager&&this.inputManager.uninstallHandlers(e)}},{key:"createUniqueGroupName",value:function(){return this.counter+=1,"viewEvents_".concat(this.counter)}}]),e}(),vt=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e,a,i,r){var o;Object(l.a)(this,n),(o=t.call(this,!0)).view=e;var s,c=Object(se.a)(a);try{for(c.s();!(s=c.n()).done;){switch(s.value){case"click":o.registerIncoming("click",i,(function(e){return r(o.wrapClick(e))}));break;case"double-click":o.registerIncoming("double-click",i,(function(e){return r(o.wrapDoubleClick(e))}));break;case"immediate-click":o.registerIncoming("immediate-click",i,(function(e){return r(o.wrapImmediateClick(e))}));break;case"immediate-double-click":o.registerIncoming("immediate-double-click",i,(function(e){return r(o.wrapImmediateDoubleClick(e))}));break;case"hold":o.registerIncoming("hold",i,(function(e){return r(o.wrapHold(e))}));break;case"drag":o.registerIncoming("drag",i,(function(e){var t=o.wrapDrag(e);t&&r(t)}));break;case"key-down":o.registerIncoming("key-down",i,(function(e){return r(o.wrapKeyDown(e))}));break;case"key-up":o.registerIncoming("key-up",i,(function(e){return r(o.wrapKeyUp(e))}));break;case"pointer-down":o.registerIncoming("pointer-down",i,(function(e){return r(o.wrapPointer(e,"pointer-down"))}));break;case"pointer-move":o.registerIncoming("pointer-move",i,(function(e){return r(o.wrapPointer(e,"pointer-move"))}));break;case"pointer-up":o.registerIncoming("pointer-up",i,(function(e){return r(o.wrapPointer(e,"pointer-up"))}));break;case"pointer-drag":o.registerIncoming("pointer-drag",i,(function(e){return r(o.wrapPointerDrag(e))}));break;case"mouse-wheel":o.registerIncoming("mouse-wheel",i,(function(e){return r(o.wrapMouseWheel(e))}));break;case"pointer-enter":o.registerIncoming("pointer-enter",i,(function(e){return r(o.wrapPointer(e,"pointer-enter"))}));break;case"pointer-leave":o.registerIncoming("pointer-leave",i,(function(e){return r(o.wrapPointer(e,"pointer-leave"))}));break;case"gamepad":o.registerIncoming("gamepad",i,(function(e){r(o.wrapGamepad(e))}));break;case"focus":o.registerIncoming("focus",i,(function(e){r(o.wrapFocus(e))}));break;case"blur":o.registerIncoming("blur",i,(function(e){r(o.wrapBlur(e))}))}}}catch(u){c.e(u)}finally{c.f()}return o}return Object(u.a)(n,[{key:"wrapFocus",value:function(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"wrapBlur",value:function(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"wrapClick",value:function(e){var t=e.data,n=t.pointerType,a=t.button,i=t.buttons,r=t.x,o=t.y,s=t.native,c=t.eventId,l=e.cancelable;return{type:"click",pointerType:n,button:a,buttons:i,x:r,y:o,native:s,timestamp:e.timestamp,screenPoint:Object(Ke.b)(r,o),mapPoint:this.getMapPoint(r,o),eventId:c,cancelable:l,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"wrapDoubleClick",value:function(e){var t=e.data,n=t.pointerType,a=t.button,i=t.buttons,r=t.x,o=t.y,s=t.native,c=t.eventId,l=e.cancelable;return{type:"double-click",pointerType:n,button:a,buttons:i,x:r,y:o,native:s,timestamp:e.timestamp,mapPoint:this.getMapPoint(r,o),eventId:c,cancelable:l,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"wrapImmediateClick",value:function(e){var t=e.data,n=t.pointerType,a=t.button,i=t.buttons,r=t.x,o=t.y,s=t.native,c=t.eventId,l=s.pointerId,u=e.cancelable;return{type:"immediate-click",pointerId:l,pointerType:n,button:a,buttons:i,x:r,y:o,native:s,timestamp:e.timestamp,mapPoint:this.getMapPoint(r,o),eventId:c,cancelable:u,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"wrapImmediateDoubleClick",value:function(e){var t=e.data,n=t.pointerType,a=t.button,i=t.buttons,r=t.x,o=t.y,s=t.native,c=t.eventId,l=s.pointerId,u=e.cancelable;return{type:"immediate-double-click",pointerId:l,pointerType:n,button:a,buttons:i,x:r,y:o,native:s,timestamp:e.timestamp,mapPoint:this.getMapPoint(r,o),eventId:c,cancelable:u,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"wrapHold",value:function(e){var t=e.data,n=t.pointerType,a=t.button,i=t.buttons,r=t.x,o=t.y,s=t.native,c=e.cancelable;return{type:"hold",pointerType:n,button:a,buttons:i,x:r,y:o,native:s,timestamp:e.timestamp,mapPoint:this.getMapPoint(r,o),cancelable:c,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"getMapPoint",value:function(e,t){return this.view.toMap(Object(Ke.b)(e,t),{exclude:[]})}},{key:"wrapDrag",value:function(e){var t=e.data,n=t.center,a=n.x,i=n.y,r=t.action,o=t.pointerType,s=t.button;if("start"===r&&(this.latestDragStart=t),this.latestDragStart){var c=t.pointer.native,l=t.buttons,u=e.cancelable,d=e.timestamp,p={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};return"end"===r&&(this.latestDragStart=void 0),{type:"drag",action:r,x:a,y:i,origin:p,pointerType:o,button:s,buttons:l,radius:t.radius,angle:Object(Ge.o)(t.angle),native:c,timestamp:d,cancelable:u,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}}},{key:"wrapKeyDown",value:function(e){var t=e.data,n=t.key,a=t.repeat,i=t.native,r=e.cancelable;return{type:"key-down",key:n,repeat:a,native:i,timestamp:e.timestamp,cancelable:r,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"wrapKeyUp",value:function(e){var t=e.data,n=t.key,a=t.native,i=e.cancelable;return{type:"key-up",key:n,native:a,timestamp:e.timestamp,cancelable:i,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"wrapPointer",value:function(e,t){var n=e.data,a=n.x,i=n.y,r=n.button,o=n.buttons,s=n.native,c=n.eventId,l=s.pointerId,u=s.pointerType,d=e.cancelable;return{type:t,x:a,y:i,pointerId:l,pointerType:u,button:r,buttons:o,native:s,timestamp:e.timestamp,eventId:c,cancelable:d,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"wrapPointerDrag",value:function(e){var t=e.data.currentEvent,n=t.x,a=t.y,i=t.buttons,r=t.native,o=t.eventId,s=e.data.startEvent.button,c=e.data.startEvent.native.pointerId,l=e.data.startEvent.native.pointerType,u=e.data.action,d={x:e.data.startEvent.x,y:e.data.startEvent.y},p=e.cancelable;return{type:"pointer-drag",x:n,y:a,pointerId:c,pointerType:l,button:s,buttons:i,action:u,origin:d,native:r,timestamp:e.timestamp,eventId:o,cancelable:p,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"wrapMouseWheel",value:function(e){var t=e.cancelable,n=e.data,a=e.timestamp;return{type:"mouse-wheel",x:n.x,y:n.y,deltaY:n.deltaY,native:n.native,timestamp:a,cancelable:t,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"wrapGamepad",value:function(e){var t=e.data,n=t.action,a=t.state,i=t.device,r=e.cancelable;return{type:"gamepad",device:i,timestamp:e.timestamp,action:n,buttons:a.buttons,axes:a.axes,cancelable:r,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}}]),n}(Xe),yt=(n(281),n(128),n(520)),mt=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(){var e;return Object(l.a)(this,n),(e=t.apply(this,arguments)).items=new te.a,e._watchUpdatingTracking=new Se.a,e._callbacks=new Map,e._projector=Object(yt.a)(),e._hiddenProjector=Object(yt.a)(),e}return Object(u.a)(n,[{key:"initialize",value:function(){var e=this,t=document.createElement("div");t.className="esri-overlay-surface",this._set("surface",t),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),t.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(this.items,(function(t){t.added.map((function(t){var n=function(){return t.render()};e._callbacks.set(t,n),e._projector.append(e.surface,n)})),t.removed.map((function(t){var n=e._projector.detach(e._callbacks.get(t));e.surface.removeChild(n.domNode),e._callbacks.delete(t)}))}))}},{key:"addItem",value:function(e){this.items.add(e)}},{key:"removeItem",value:function(e){this.items.remove(e)}},{key:"destroy",value:function(){var e=this;this.items.removeAll(),this._callbacks.forEach((function(t){return e._projector.detach(t)})),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}},{key:"render",value:function(){this._projector.renderNow()}},{key:"computeBoundingRect",value:function(e){var t=this._hiddenSurface,n=this._hiddenProjector,a=null,i=function(){return a=e.render()};n.append(t,i),n.renderNow();var r={left:0,top:0,right:0,bottom:0};if(a&&a.domNode){var o=a.domNode.getBoundingClientRect();r.left=o.left,r.top=o.top,r.right=o.right,r.bottom=o.bottom}for(n.detach(i);t.firstChild;)t.removeChild(t.firstChild);return r}},{key:"overlaps",value:function(e,t){var n=this.computeBoundingRect(e),a=this.computeBoundingRect(t);return Math.max(n.left,a.left)<=Math.min(n.right,a.right)&&Math.max(n.top,a.top)<=Math.min(n.bottom,a.bottom)}},{key:"renderCanvas",value:function(e){if(this.items.some((function(e){return e.visible}))){var t=e.getContext("2d");t.save(),t.font="10px ".concat(getComputedStyle(this.surface).fontFamily),this.items.forEach((function(e){t.save(),e.renderCanvas(t),t.restore()})),t.restore()}}},{key:"needsRender",get:function(){return this.items.length>0}},{key:"hasVisibleItems",get:function(){return this.items.some((function(e){return e.visible}))}}]),n}(G.a);Object(h.a)([Object(m.b)({readOnly:!0})],mt.prototype,"surface",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],mt.prototype,"items",void 0),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["items.length"]})],mt.prototype,"needsRender",null),Object(h.a)([Object(m.b)({readOnly:!0})],mt.prototype,"_watchUpdatingTracking",void 0),Object(h.a)([Object(m.b)({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],mt.prototype,"updating",void 0);mt=Object(h.a)([Object(O.a)("esri.views.overlay.ViewOverlay")],mt);var gt=n(44),Ot=n(415),jt=n(401);n(268);function _t(e,t,n,a){var i=null,r=1e3;"number"==typeof t?(r=t,a=n):(i=null!=t?t:null,r=n);var o,s=0,c=function(){s=0,e.apply(a,o)},l=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i&&i.apply(a,t),o=t,r?s||(s=setTimeout(c,r)):c()};return l.remove=function(){s&&(clearTimeout(s),s=0)},l.forceUpdate=function(){s&&(clearTimeout(s),c())},l.hasPendingUpdates=function(){return!!s},l}var wt=n(115),kt=n(104),Mt=n(207),It=n(74),xt=n(805),Ct=n(32),Tt=n(186),Ft=n(851),Et=function(e){var t=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(){var e;return Object(l.a)(this,n),(e=t.apply(this,arguments)).renderNodeContent=function(t){return Object(Ft.b)(t)&&!t.destroyed?Object(Ct.a)("div",{key:t},t.render()):t instanceof HTMLElement?Object(Ct.a)("div",{key:t,bind:t,afterCreate:e._attachToNode}):Object(Ft.a)(t)?Object(Ct.a)("div",{key:t,bind:t.domNode,afterCreate:e._attachToNode}):null},e}return Object(u.a)(n,[{key:"_attachToNode",value:function(e){e.appendChild(this)}}]),n}(e);return t=Object(h.a)([Object(O.a)("esri.widgets.Feature.ContentMixin")],t)},At=n(100),Pt=n(143);n(78);var St=["B","kB","MB","GB","TB"];var Lt=n(206),Vt=n(799),Rt=n(828),Nt=n(69),Dt=n(80),Bt=n(260),zt=v.a.getLogger("esri.widgets.Feature.support.featureUtils"),Ut=/href=(""|'')/gi,Ht=/(\{([^\{\r\n]+)\})/g,Wt=/\'/g,qt=/^\s*expression\//i,Gt=/(\n)/gi,Kt=/[\u00A0-\u9999<>\&]/gim,Jt=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,$t=/^(?:mailto:|tel:)/,Xt=Object(Dt.a)("short-date-short-time");function Yt(e){if(!Object(b.f)(e))return e.get("sourceLayer")||e.get("layer")}function Zt(e,t){return Qt.apply(this,arguments)}function Qt(){return(Qt=Object(s.a)(o.a.mark((function e(t,n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return","function"==typeof t?t.call(null,n):t);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function en(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e)return!$t.test(e.trim().toLowerCase())}function tn(e,t){var n=function(e,t){if(!function(e){return qt.test(e)}(t)||!e)return null;var n,a=t.replace(qt,"").toLowerCase();return e.some((function(e){return e.name.toLowerCase()===a&&(n=e,!0)})),n}(t,null==e?void 0:e.fieldName);return n?n.title||null:e?e.label||e.fieldName:null}function nn(e,t){var n=an(t,e);return n?n.name:e}function an(e,t){return e&&"function"==typeof e.getField?e.getField(t):null}function rn(e){return"".concat(e).trim()}function on(e){var t=e.formattedAttributes,n=e.template,a=e.fieldInfoMap;return rn(Object(At.c)(Object(At.c)(n,(function(e){return function(e,t){var n=t.get(e.toLowerCase());return"{".concat(n&&n.fieldName||e,"}")}(e,a)})),t).replace(Ut,""))}function sn(e,t){return e.replace(Ht,(function(e,n,a){var i=an(t,a);return i?"{".concat(i.name,"}"):n}))}function cn(e,t,n){var a=sn(e,n);return a?a.replace(Jt,(function(e,n,a){return function(e,t,n){var a=(t=rn(t))&&"{"!==t[0];return Object(At.c)(e,function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Object(c.a)({},e);return Object.keys(n).forEach((function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=t[e];if("string"==typeof a){var i="%27",r=(n?encodeURIComponent(a):a).replace(Wt,i);t[e]=r}}(e,n,t)})),n}(n,a))}(e,n||a,t)})):a}function ln(e,t){var n=t.fieldInfos,a=t.fieldName,i=un(n,a),r=null==i?void 0:i.clone(),o=t.preventPlacesFormatting,s=an(t.layer,a);if(r&&s&&"date"===s.type){var l=r.format||new Bt.a;l.dateFormat=l.dateFormat||"short-date-short-time",r.format=l}var u=r&&r.format;return"string"==typeof(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){var n=Number(e);if(!isNaN(n))return n}return e}(e,u))||null==e||null==u?e:o?Object(Pt.b)(e,Object(c.a)(Object(c.a)({},Object(Pt.a)(u)),{},{minimumFractionDigits:0,maximumFractionDigits:20})):u.format(e)}function un(e,t){if(e&&e.length&&t){var n,a=t.toLowerCase();return e.some((function(e){return!(!e.fieldName||e.fieldName.toLowerCase()!==a)&&(n=e,!0)})),n}}function dn(e){var t=[];if(!e)return t;var n=e.fieldInfos,a=e.content;return n&&t.push.apply(t,Object(Pe.a)(n)),a&&Array.isArray(a)?(a.forEach((function(e){if("fields"===e.type){var n=e&&e.fieldInfos;n&&t.push.apply(t,Object(Pe.a)(n))}})),t):t}function pn(e){return e.replace(Kt,(function(e){return"&#".concat(e.charCodeAt(0),";")}))}function hn(e){return"string"==typeof e?e.replace(Gt,'<br class="esri-text-new-line" />'):e}function fn(e){var t=e.fieldInfos,n=e.attributes,a=e.layer,i=e.graphic,r=e.fieldInfoMap,o=e.relatedInfos,s=Object(c.a)({},n);return null==o||o.forEach((function(e){return function(e,t){e&&t&&(t.relatedFeatures&&t.relatedFeatures&&t.relatedFeatures.forEach((function(n){return mn({attributes:e,graphic:n,relatedInfo:t})})),t.relatedStatsFeatures&&t.relatedStatsFeatures&&t.relatedStatsFeatures.forEach((function(n){return mn({attributes:e,graphic:n,relatedInfo:t})})))}(s,e)})),Object.keys(s).forEach((function(e){var n=s[e];s[e]=function(e){var t=e.value,n=e.fieldName,a=e.fieldInfos,i=e.fieldInfoMap,r=e.layer,o=e.graphic;if(null==t)return"";var s=function(e){var t=e.fieldName,n=e.value,a=e.graphic,i=e.layer;if(yn(t))return null;if(!i||"function"!=typeof i.getFieldDomain)return null;var r=i.getFieldDomain(t,{feature:a});return r&&"coded-value"===r.type?r.getName(n):null}({fieldName:n,value:t,graphic:o,layer:r});if(s)return s;var c=function(e){var t=e.fieldName,n=e.graphic,a=e.layer;if(yn(t))return null;if(!a||"function"!=typeof a.getFeatureType)return null;var i=a.typeIdField;if(!i||t!==i)return null;var r=a.getFeatureType(n);return r?r.name:null}({fieldName:n,graphic:o,layer:r});if(c)return c;if(i.get(n.toLowerCase()))return ln(t,{fieldInfos:a,fieldName:n,layer:r});var l=r&&r.fieldsIndex;return l&&l.isDateField(n)?Object(Dt.b)(t,Xt):hn(t)}({fieldName:e,fieldInfos:t,fieldInfoMap:r,layer:a,value:n,graphic:i})})),s}function bn(e,t){return vn.apply(this,arguments)}function vn(){return(vn=Object(s.a)(o.a.mark((function e(t,n){var a,i,r,l,u,d,p,h,f,b;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.graphic,i=t.popupTemplate,(r=t.layer)&&i){e.next=3;break}return e.abrupt("return");case 3:if(l=i.returnGeometry,e.t0="function"==typeof r.load,!e.t0){e.next=8;break}return e.next=8,r.load(n);case 8:if(null!=(u=a.attributes[r.objectIdField])){e.next=11;break}return e.abrupt("return");case 11:return d=[u],e.next=14,i.getRequiredFields(r.fields);case 14:if(p=e.sent,h=Object(Nt.d)(p,a),f=h?[]:p,!h||l){e.next=19;break}return e.abrupt("return");case 19:return e.next=21,function(){var e=Object(s.a)(o.a.mark((function e(t,n){var a,i,r,s,c,l,u,d,p,h,f,b,v;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.layer,i=t.graphic,r=t.outFields,s=t.objectIds,c=t.returnGeometry,"number"==typeof(l=s[0])){e.next=4;break}throw u="Could not query required fields for the specified feature. The feature's ID is invalid.",d={layer:a,graphic:i,objectId:l,requiredFields:r},p=new _.a("layer-query-features-invalid-objectid",u,d),zt.warn(u,d),p;case 4:if("function"==typeof a.queryFeatures){e.next=7;break}throw h="The specified layer does not support the method 'queryFeatures'. The following fields will not be available.",f={layer:a,graphic:i,requiredFields:r},b=new _.a("layer-query-features-unsupported",h,f),zt.warn(h,f),b;case 7:return(v=a.createQuery()).objectIds=s,v.outFields=r,v.returnGeometry=!!c,e.next=13,a.queryFeatures(v,n);case 13:return e.abrupt("return",e.sent.features[0]);case 14:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()({layer:r,graphic:a,outFields:f,objectIds:d,returnGeometry:l},n);case 21:(b=e.sent)&&(b.geometry&&(a.geometry=b.geometry),b.attributes&&(a.attributes=Object(c.a)(Object(c.a)({},a.attributes),b.attributes)));case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function yn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!e&&-1!==e.indexOf("relationships/")}function mn(e){var t=e.attributes,n=e.graphic,a=e.relatedInfo;t&&n&&a&&Object.keys(n.attributes).forEach((function(e){var i,r=(i={layerId:a.relation.id.toString(),fieldName:e})?"relationships/".concat(i.layerId,"/").concat(i.fieldName):"";t[r]=n.attributes[e]}))}var gn={editing:!1,operations:{add:!0,update:!0,delete:!0}},On=te.a.ofType(Rt.a),jn=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e))._getAttachmentsPromise=null,a._attachmentLayer=null,a.abilities=Object(c.a)({},gn),a.activeAttachmentInfo=null,a.attachmentInfos=new On,a.graphic=null,a.mode="view",a.handles.add([Object(Ce.a)(Object(K.a)(a),"graphic",(function(){return a._graphicChanged()}))]),a}return Object(u.a)(n,[{key:"destroy",value:function(){this._attachmentLayer=null,this.graphic=null}},{key:"castAbilities",value:function(e){return Object(c.a)(Object(c.a)({},gn),e)}},{key:"getAttachments",value:function(){var e=Object(s.a)(o.a.mark((function e(){var t,n,a,i,r,s,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._attachmentLayer,n=this.attachmentInfos,t&&"function"==typeof t.queryAttachments){e.next=3;break}throw new _.a("invalid-layer","getAttachments(): A valid layer is required.");case 3:return a=this._getFeatureId(),i=new Vt.a({objectIds:[a],returnMetadata:!0}),r=[],s=t.queryAttachments(i).then((function(e){return e[a]||r})).catch((function(){return r})),this._getAttachmentsPromise=s,this.notifyChange("state"),e.next=7,s;case 7:return c=e.sent,e.abrupt("return",(n.removeAll(),c.length&&n.addMany(c),this._getAttachmentsPromise=null,this.notifyChange("state"),c));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"addAttachment",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var n,a,i,r,s,c,l=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._attachmentLayer,a=this.attachmentInfos,i=this.graphic,r=this.abilities,t){e.next=3;break}throw new _.a("invalid-attachment","addAttachment(): An attachment is required.",{attachment:t});case 3:if(r.operations.add){e.next=5;break}throw new _.a("invalid-abilities","addAttachment(): add abilities are required.");case 5:if(n&&"function"==typeof n.addAttachment){e.next=7;break}throw new _.a("invalid-layer","addAttachment(): A valid layer is required.");case 7:return s=n.addAttachment(i,t).then((function(e){return l._queryAttachment(e.objectId)})),e.next=10,s;case 10:return c=e.sent,e.abrupt("return",(a.add(c),c));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteAttachment",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var n,a,i,r,s,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._attachmentLayer,a=this.attachmentInfos,i=this.graphic,r=this.abilities,t){e.next=3;break}throw new _.a("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:t});case 3:if(r.operations.delete){e.next=5;break}throw new _.a("invalid-abilities","deleteAttachment(): delete abilities are required.");case 5:if(n&&"function"==typeof n.deleteAttachments){e.next=7;break}throw new _.a("invalid-layer","deleteAttachment(): A valid layer is required.");case 7:return s=n.deleteAttachments(i,[t.id]).then((function(){return t})),e.next=10,s;case 10:return c=e.sent,e.abrupt("return",(a.remove(c),c));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateAttachment",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var n,a,i,r,s,c,l,u,d=this,p=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=p.length>1&&void 0!==p[1]?p[1]:this.activeAttachmentInfo,a=this._attachmentLayer,i=this.attachmentInfos,r=this.graphic,s=this.abilities,t){e.next=4;break}throw new _.a("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:t});case 4:if(n){e.next=6;break}throw new _.a("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:n});case 6:if(s.operations.update){e.next=8;break}throw new _.a("invalid-abilities","updateAttachment(): Update abilities are required.");case 8:if(c=i.findIndex((function(e){return e===n})),a&&"function"==typeof a.updateAttachment){e.next=11;break}throw new _.a("invalid-layer","updateAttachment(): A valid layer is required.");case 11:return l=a.updateAttachment(r,n.id,t).then((function(e){return d._queryAttachment(e.objectId)})),e.next=14,l;case 14:return u=e.sent,e.abrupt("return",(i.splice(c,1,u),u));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_queryAttachment",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var n,a,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new _.a("invalid-attachment-id","Could not query attachment.");case 2:return n=this._attachmentLayer,a=this._getFeatureId(),i=new Vt.a({objectIds:[a],attachmentsWhere:"AttachmentId=".concat(t),returnMetadata:!0}),e.abrupt("return",n.queryAttachments(i).then((function(e){return e[a][0]})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getFeatureId",value:function(){var e=this._attachmentLayer,t=this.graphic;if(!e||!t)return null;var n=e.objectIdField,a=t.attributes;return a&&a[n]}},{key:"_graphicChanged",value:function(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch((function(){})))}},{key:"_setAttachmentLayer",value:function(){var e=Yt(this.graphic);this._attachmentLayer=e?"scene"===e.type&&Object(b.g)(e.associatedLayer)?e.associatedLayer:e:null}},{key:"state",get:function(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}},{key:"supportsResizeAttachments",get:function(){return this.get("graphic.layer.capabilities.operations.supportsResizeAttachments")||!1}}]),n}(B.a);Object(h.a)([Object(m.b)()],jn.prototype,"abilities",void 0),Object(h.a)([Object(re.a)("abilities")],jn.prototype,"castAbilities",null),Object(h.a)([Object(m.b)()],jn.prototype,"activeAttachmentInfo",void 0),Object(h.a)([Object(m.b)({readOnly:!0,type:On})],jn.prototype,"attachmentInfos",void 0),Object(h.a)([Object(m.b)({type:Lt.a})],jn.prototype,"graphic",void 0),Object(h.a)([Object(m.b)()],jn.prototype,"mode",void 0),Object(h.a)([Object(m.b)({dependsOn:["graphic"],readOnly:!0})],jn.prototype,"state",null),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["graphic","graphic.layer","graphic.layer.loaded","graphic.layer.capabilities.operations.supportsResizeAttachments"]})],jn.prototype,"supportsResizeAttachments",null);var _n=jn=Object(h.a)([Object(O.a)("esri.widgets.Attachments.AttachmentsViewModel")],jn),wn=n(59),kn=Object(wn.a)("esri/themes/base/images/files/");var Mn={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},In="esri-attachments__form-node",xn="esri-attachments__file-fieldset",Cn="esri-attachments__file-input",Tn="esri-button",Fn="esri-button--disabled",En="esri-button--tertiary",An="esri-button--third",Pn="esri-button--small",Sn="esri-button--half",Ln=window.CSS,Vn=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e,a){var i;return Object(l.a)(this,n),(i=t.call(this,e,a)).abilities=null,i.displayType="list",i.graphic=null,i.label=void 0,i.messages=null,i.messagesUnits=null,i.selectedFile=null,i.submitting=!1,i.viewModel=new _n,i.visibleElements=Object(c.a)({},Mn),i._supportsImageOrientation=Ln&&Ln.supports&&Ln.supports("image-orientation","from-image"),i._addAttachmentForm=null,i._updateAttachmentForm=null,i}return Object(u.a)(n,[{key:"initialize",value:function(){var e=this;this.own(Object(Ce.b)(this,"viewModel.attachmentInfos","change",(function(){return e.scheduleRender()})),Object(Ce.a)(this,"viewModel.mode",(function(){return e._modeChanged()})))}},{key:"castVisibleElements",value:function(e){return Object(c.a)(Object(c.a)({},Mn),e)}},{key:"addAttachment",value:function(){var e=this,t=this._addAttachmentForm,n=this.viewModel;return this._set("submitting",!0),this._set("error",null),n.addAttachment(t).then((function(t){return e._set("submitting",!1),e._set("error",null),n.mode="view",t})).catch((function(t){throw e._set("submitting",!1),e._set("error",new _.a("attachments:add-attachment",e.messages.addErrorMessage,t)),t}))}},{key:"deleteAttachment",value:function(e){var t=this,n=this.viewModel;return this._set("submitting",!0),this._set("error",null),n.deleteAttachment(e).then((function(e){return t._set("submitting",!1),t._set("error",null),n.mode="view",e})).catch((function(e){throw t._set("submitting",!1),t._set("error",new _.a("attachments:delete-attachment",t.messages.deleteErrorMessage,e)),e}))}},{key:"updateAttachment",value:function(){var e=this,t=this.viewModel,n=this._updateAttachmentForm;return this._set("submitting",!0),this._set("error",null),t.updateAttachment(n).then((function(n){return e._set("submitting",!1),e._set("error",null),t.mode="view",n})).catch((function(t){throw e._set("submitting",!1),e._set("error",new _.a("attachments:update-attachment",e.messages.updateErrorMessage,t)),t}))}},{key:"render",value:function(){var e=this.submitting,t=this.viewModel.state;return Object(Ct.a)("div",{class:this.classes("esri-attachments","esri-widget")},e?this.renderProgressBar():null,"loading"===t?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}},{key:"renderErrorMessage",value:function(){var e=this.error,t=this.visibleElements;return e&&t.errorMessage?Object(Ct.a)("div",{key:"error-message",class:"esri-attachments__error-message"},e.message):null}},{key:"renderAttachments",value:function(){var e=this.viewModel,t=e.mode,n=e.activeAttachmentInfo;return"add"===t?this.renderAddForm():"edit"===t?this.renderDetailsForm(n):this.renderAttachmentContainer()}},{key:"renderLoading",value:function(){return Object(Ct.a)("div",{class:"esri-attachments__loader-container",key:"loader"},Object(Ct.a)("div",{class:"esri-attachments__loader"}))}},{key:"renderProgressBar",value:function(){return this.visibleElements.progressBar?Object(Ct.a)("div",{class:"esri-attachments__progress-bar",key:"progress-bar"}):null}},{key:"renderAddForm",value:function(){var e=this.submitting,t=this.selectedFile,n=e||!t,a=this.visibleElements.cancelAddButton?Object(Ct.a)("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(Tn,En,Pn,Sn,e&&Fn)},this.messages.cancel):null,i=this.visibleElements.addSubmitButton?Object(Ct.a)("button",{type:"submit",disabled:n,class:this.classes(Tn,"esri-button--secondary",Pn,Sn,Object(gt.a)({},Fn,n))},this.messages.add):null,r=t?Object(Ct.a)("span",{key:"file-name",class:"esri-attachments__file-name"},t.name):null,o=Object(Ct.a)("form",{bind:this,afterCreate:wt.g,afterRemoved:wt.c,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},Object(Ct.a)("fieldset",{class:xn},r,Object(Ct.a)("label",{class:this.classes("esri-attachments__file-label",Tn,"esri-button--secondary")},t?this.messages.changeFile:this.messages.selectFile,Object(Ct.a)("input",{class:Cn,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),i,a);return Object(Ct.a)("div",{key:"add-form-container",class:In},o)}},{key:"renderDetailsForm",value:function(e){var t=this,n=this.visibleElements,a=this.viewModel,i=this.selectedFile,r=this.submitting,o=e.contentType,s=e.size,c=e.url,l=a.abilities,u=r||!i,d=l.editing&&l.operations.delete&&n.deleteButton?Object(Ct.a)("button",{key:"delete-button",type:"button",disabled:r,bind:this,onclick:function(n){return t._submitDeleteAttachment(n,e)},class:this.classes(Tn,Pn,En,"esri-attachments__delete-button",Object(gt.a)({},Fn,r))},this.messages.delete):null,p=l.editing&&l.operations.update&&n.updateButton?Object(Ct.a)("button",{disabled:u,key:"update-button",type:"submit",class:this.classes(Tn,Pn,An,Object(gt.a)({},Fn,u))},this.messages.update):null,h=this.visibleElements.cancelUpdateButton?Object(Ct.a)("button",{disabled:r,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(Tn,Pn,En,An,Object(gt.a)({},Fn,r))},this.messages.cancel):null,f=i?Object(Ct.a)("span",{key:"file-name",class:"esri-attachments__file-name"},i.name):null,b=l.editing&&l.operations.update?Object(Ct.a)("fieldset",{key:"file",class:xn},f,Object(Ct.a)("label",{class:this.classes("esri-attachments__file-label",Tn,"esri-button--secondary")},this.messages.changeFile,Object(Ct.a)("input",{class:Cn,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):null,v=Object(Ct.a)("fieldset",{key:"size",class:"esri-attachments__metadata-fieldset"},Object(Ct.a)("label",null,function(e,t){var n=0===t?0:Math.floor(Math.log(t)/Math.log(1024));n=Object(Ge.d)(n,0,St.length-1);var a=Object(Pt.b)(t/Math.pow(1024,n),{maximumFractionDigits:2});return Object(At.c)(e.units.bytes[St[n]],{fileSize:a})}(this.messagesUnits,s))),y=Object(Ct.a)("fieldset",{key:"content-type",class:"esri-attachments__metadata-fieldset"},Object(Ct.a)("label",null,o)),m=Object(Ct.a)("form",{bind:this,afterCreate:wt.g,afterRemoved:wt.c,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},Object(Ct.a)("div",{class:"esri-attachments__metadata"},v,y),b,Object(Ct.a)("div",{class:"esri-attachments__actions"},d,h,p));return Object(Ct.a)("div",{key:"edit-form-container",class:In},Object(Ct.a)("a",{class:"esri-attachments__item-link",href:c,rel:"noreferrer",target:"_blank",alt:name},this.renderImageMask({attachmentInfo:e,size:400}),Object(Ct.a)("div",{class:"esri-attachments__item-link-overlay"},Object(Ct.a)("span",{class:"esri-attachments__item-link-overlay-icon"},Object(Ct.a)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},Object(Ct.a)("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),Object(Ct.a)("path",{fill:"none",d:"M0 0h32v32H0z"}))))),m)}},{key:"renderImageMask",value:function(e){var t=e.attachmentInfo,n=e.size,a=this.viewModel.supportsResizeAttachments,i=t.contentType,r=t.url,o=a&&function(e){var t=e.toLowerCase();return"image/bmp"===t||"image/emf"===t||"image/exif"===t||"image/gif"===t||"image/x-icon"===t||"image/jpeg"===t||"image/png"===t||"image/tiff"===t||"image/x-wmf"===t}(i),s=this._getCSSTransform(t,o),c=s?{transform:s,"image-orientation":"none"}:{},l=-1===r.indexOf("?")?"?":"&",u=o?"".concat(r).concat(l,"w=").concat(n):function(e){return e?"text/plain"===e?"".concat(kn,"text-32.svg"):"application/pdf"===e?"".concat(kn,"pdf-32.svg"):"text/csv"===e?"".concat(kn,"csv-32.svg"):"application/gpx+xml"===e?"".concat(kn,"gpx-32.svg"):"application/x-dwf"===e?"".concat(kn,"cad-32.svg"):"application/postscript"===e||"application/json"===e||"text/xml"===e||"model/vrml"===e?"".concat(kn,"code-32.svg"):"application/x-zip-compressed"===e||"application/x-7z-compressed"===e||"application/x-gzip"===e||"application/x-tar"===e||"application/x-gtar"===e||"application/x-bzip2"===e||"application/gzip"===e||"application/x-compress"===e||"application/x-apple-diskimage"===e||"application/x-rar-compressed"===e||"application/zip"===e?"".concat(kn,"zip-32.svg"):-1!==e.indexOf("image/")?"".concat(kn,"image-32.svg"):-1!==e.indexOf("audio/")?"".concat(kn,"sound-32.svg"):-1!==e.indexOf("video/")?"".concat(kn,"video-32.svg"):-1!==e.indexOf("msexcel")||-1!==e.indexOf("ms-excel")||-1!==e.indexOf("spreadsheetml")?"".concat(kn,"excel-32.svg"):-1!==e.indexOf("msword")||-1!==e.indexOf("ms-word")||-1!==e.indexOf("wordprocessingml")?"".concat(kn,"word-32.svg"):-1!==e.indexOf("powerpoint")||-1!==e.indexOf("presentationml")?"".concat(kn,"report-32.svg"):"".concat(kn,"generic-32.svg"):"".concat(kn,"generic-32.svg")}(i),d=Object(gt.a)({},"esri-attachments__item-mask--icon",!o),p=Object(gt.a)({},"esri-attachments__image--resizable",a);return Object(Ct.a)("div",{class:this.classes(d,"esri-attachments__item-mask")},Object(Ct.a)("img",{styles:c,alt:"",src:u,class:this.classes(p,"esri-attachments__image")}))}},{key:"renderAttachmentInfo",value:function(e){var t=this,n=e.attachmentInfo,a=e.displayType,i=this.viewModel.abilities,r=n.name,o=n.url,s=this.renderImageMask({attachmentInfo:n,size:"list"===a?48:400}),c=i.editing?Object(Ct.a)("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",Object(wt.e)()?"esri-icon-left":"esri-icon-right")}):null,l=[s,Object(Ct.a)("label",{class:"esri-attachments__label"},Object(Ct.a)("span",{class:"esri-attachments__filename"},r||this.messages.noTitle),c)],u=i.editing?Object(Ct.a)("button",{key:"details-button",bind:this,class:"esri-attachments__item-button",title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":n.id,onclick:function(){return t._startEditAttachment(n)},type:"button"},l):Object(Ct.a)("a",{key:"details-link",class:"esri-attachments__item-button",href:o,target:"_blank"},l);return Object(Ct.a)("li",{class:"esri-attachments__item",key:n},u)}},{key:"renderAttachmentContainer",value:function(){var e,t=this,n=this.displayType,a=this.viewModel,i=this.visibleElements,r=a.attachmentInfos,o=a.abilities,s=r&&r.length,c=(e={},Object(gt.a)(e,"esri-attachments__container--list","preview"!==n),Object(gt.a)(e,"esri-attachments__container--preview","preview"===n),e),l=o.editing&&o.operations.add&&i.addButton?Object(Ct.a)("button",{bind:this,onclick:function(){return t._startAddAttachment()},class:this.classes(Tn,En,"esri-attachments__add-attachment-button"),type:"button"},Object(Ct.a)("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-add-icon","esri-icon-plus")}),this.messages.add):null,u=s?Object(Ct.a)("ul",{class:"esri-attachments__items"},r.toArray().map((function(e){return t.renderAttachmentInfo({attachmentInfo:e,displayType:n})}))):Object(Ct.a)("div",{class:"esri-widget__content--empty"},this.messages.noAttachments);return Object(Ct.a)("div",{key:"attachments-container",class:this.classes("esri-attachments__container",c)},u,l)}},{key:"_modeChanged",value:function(){this._set("error",null),this._set("selectedFile",null)}},{key:"_handleFileInputChange",value:function(e){var t=e.target,n=t&&t.files&&t.files.item(0);this._set("selectedFile",n)}},{key:"_submitDeleteAttachment",value:function(e,t){e.preventDefault(),this.deleteAttachment(t)}},{key:"_submitAddAttachment",value:function(e){e.preventDefault(),this.addAttachment()}},{key:"_submitUpdateAttachment",value:function(e){e.preventDefault(),this.updateAttachment()}},{key:"_startEditAttachment",value:function(e){var t=this.viewModel;t.activeAttachmentInfo=e,t.mode="edit"}},{key:"_startAddAttachment",value:function(){this.viewModel.mode="add"}},{key:"_cancelForm",value:function(e){e.preventDefault(),this.viewModel.mode="view"}},{key:"_getCSSTransform",value:function(e,t){var n=e.orientationInfo;return!this._supportsImageOrientation&&t&&n?[n.rotation?"rotate(".concat(n.rotation,"deg)"):"",n.mirrored?"scaleX(-1)":""].join(" "):""}}]),n}(Tt.a);Object(h.a)([Object(X.a)("viewModel.abilities")],Vn.prototype,"abilities",void 0),Object(h.a)([Object(m.b)(),Object(It.a)()],Vn.prototype,"displayType",void 0),Object(h.a)([Object(X.a)("viewModel.graphic")],Vn.prototype,"graphic",void 0),Object(h.a)([Object(m.b)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Vn.prototype,"label",void 0),Object(h.a)([Object(m.b)(),Object(It.a)(),Object(Mt.a)("esri/widgets/Attachments/t9n/Attachments")],Vn.prototype,"messages",void 0),Object(h.a)([Object(m.b)(),Object(It.a)(),Object(Mt.a)("esri/core/t9n/Units")],Vn.prototype,"messagesUnits",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Vn.prototype,"selectedFile",void 0),Object(h.a)([Object(It.a)(),Object(m.b)({readOnly:!0})],Vn.prototype,"submitting",void 0),Object(h.a)([Object(It.a)(),Object(m.b)({readOnly:!0})],Vn.prototype,"error",void 0),Object(h.a)([Object(m.b)({type:_n}),Object(It.a)(["viewModel.activeAttachmentInfo","viewModel.mode","viewModel.state","viewModel.supportsResizeAttachments","viewModel.attachmentInfos","viewModel.graphic","viewModel.abilities","viewModel.abilities.editing","viewModel.abilities.operations"])],Vn.prototype,"viewModel",void 0),Object(h.a)([Object(m.b)(),Object(It.a)()],Vn.prototype,"visibleElements",void 0),Object(h.a)([Object(re.a)("visibleElements")],Vn.prototype,"castVisibleElements",null);var Rn=Vn=Object(h.a)([Object(O.a)("esri.widgets.Attachments")],Vn),Nn=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e))._loadingPromise=null,a.created=null,a.creator=null,a.destroyer=null,a.graphic=null,a.handles.add(Object(Ce.a)(Object(K.a)(a),"creator",(function(e){a._destroyContent(),a._createContent(e)}))),a}return Object(u.a)(n,[{key:"destroy",value:function(){this._destroyContent()}},{key:"_destroyContent",value:function(){var e=this.created,t=this.graphic,n=this.destroyer;e&&(Zt(n,{graphic:t}).catch((function(){return null})),this._set("created",null))}},{key:"_createContent",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var n,a,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.graphic,a=Zt(t,{graphic:n}).catch((function(){return null})),this._loadingPromise=a,this.notifyChange("state"),e.next=4,a;case 4:i=e.sent,a===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",i));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"state",get:function(){return this._loadingPromise?"loading":"ready"}}]),n}(Object(B.b)(G.a));Object(h.a)([Object(m.b)({readOnly:!0})],Nn.prototype,"created",void 0),Object(h.a)([Object(m.b)()],Nn.prototype,"creator",void 0),Object(h.a)([Object(m.b)()],Nn.prototype,"destroyer",void 0),Object(h.a)([Object(m.b)({type:Lt.a})],Nn.prototype,"graphic",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Nn.prototype,"state",null);var Dn=Nn=Object(h.a)([Object(O.a)("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],Nn),Bn=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e,a){var i;return Object(l.a)(this,n),(i=t.call(this,e,a)).creator=null,i.graphic=null,i.viewModel=null,i._addTargetToAnchors=function(e){Array.from(e.querySelectorAll("a")).forEach((function(e){en(e.href)&&!e.hasAttribute("target")&&e.setAttribute("target","_blank")}))},i}return Object(u.a)(n,[{key:"renderLoading",value:function(){return Object(Ct.a)("div",{class:"esri-feature-content__loader-container",key:"loader"},Object(Ct.a)("div",{class:"esri-feature-content__loader"}))}},{key:"renderCreated",value:function(){var e,t=null==(e=this.viewModel)?void 0:e.created;return t?t instanceof HTMLElement?Object(Ct.a)("div",{key:t,bind:t,afterCreate:this._attachToNode}):Object(Ft.b)(t)?Object(Ct.a)("div",{key:t},!t.destroyed&&t.render()):Object(Ct.a)("div",{key:t,innerHTML:t,afterCreate:this._addTargetToAnchors}):null}},{key:"render",value:function(){var e,t=null==(e=this.viewModel)?void 0:e.state;return Object(Ct.a)("div",{class:"esri-feature-content"},"loading"===t?this.renderLoading():this.renderCreated())}},{key:"_attachToNode",value:function(e){e.appendChild(this)}}]),n}(Tt.a);Object(h.a)([Object(X.a)("viewModel.creator")],Bn.prototype,"creator",void 0),Object(h.a)([Object(X.a)("viewModel.graphic")],Bn.prototype,"graphic",void 0),Object(h.a)([Object(It.a)(["viewModel.created","viewModel.state"]),Object(m.b)({type:Dn})],Bn.prototype,"viewModel",void 0);var zn=Bn=Object(h.a)([Object(O.a)("esri.widgets.Feature.FeatureContent")],Bn),Un=n(239),Hn=n(418),Wn=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).attributes=null,a.expressionInfos=null,a.fieldInfos=null,a}return Object(u.a)(n,[{key:"formattedFieldInfos",get:function(){var e=this.expressionInfos,t=this.fieldInfos,n=[];return null==t||t.forEach((function(t){if(!t.hasOwnProperty("visible")||t.visible){var a=t.clone();a.label=tn(a,e),n.push(a)}})),n}}]),n}(G.a);Object(h.a)([Object(m.b)()],Wn.prototype,"attributes",void 0),Object(h.a)([Object(m.b)({type:[Hn.a]})],Wn.prototype,"expressionInfos",void 0),Object(h.a)([Object(m.b)({type:[Un.a]})],Wn.prototype,"fieldInfos",void 0),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["expressionInfos","fieldInfos"]})],Wn.prototype,"formattedFieldInfos",null);var qn=Wn=Object(h.a)([Object(O.a)("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],Wn),Gn=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];var Kn=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e,a){var i;return Object(l.a)(this,n),(i=t.call(this,e,a)).attributes=null,i.expressionInfos=null,i.fieldInfos=null,i.viewModel=new qn,i.messages=null,i.messagesURIUtils=null,i}return Object(u.a)(n,[{key:"renderFieldInfo",value:function(e,t){var n=this.viewModel.attributes,a=e.fieldName,i=e.label||a,r=n?null==n[a]?"":n[a]:"",o=!(!e.format||!e.format.dateFormat),s="number"!=typeof r||o?function(e,t){if("string"!=typeof t||!t)return t;var n=function(e){var t=null;return Gn.some((function(n){return n.pattern.test(e)&&(t=n),!!t})),t}(t);if(!n)return t;var a=t.match(n.pattern),i=a&&a[2],r=Object(At.c)(Object(At.c)(n.label,{messages:e,hierPart:i}),{appName:n.appName}),o=n.target?' target="'.concat(n.target,'"'):"",s="_blank"===n.target?' rel="noreferrer"':"";return t.replace(n.pattern,"<a".concat(o,' href="$1"').concat(s,">").concat(r,"</a>"))}(this.messagesURIUtils,r):this._forceLTR(r),c=Object(gt.a)({},"esri-feature-fields__field-data--date",o);return Object(Ct.a)("tr",{key:"fields-element-info-row-".concat(a,"-").concat(t)},Object(Ct.a)("th",{key:"fields-element-info-row-header-".concat(a,"-").concat(t),class:"esri-feature-fields__field-header",innerHTML:i}),Object(Ct.a)("td",{key:"fields-element-info-row-data-".concat(a,"-").concat(t),class:this.classes("esri-feature-fields__field-data",c),innerHTML:s}))}},{key:"renderFields",value:function(){var e=this,t=this.viewModel.formattedFieldInfos;return t.length?Object(Ct.a)("table",{class:"esri-widget__table",summary:this.messages.fieldsSummary},Object(Ct.a)("tbody",null,t.map((function(t,n){return e.renderFieldInfo(t,n)})))):null}},{key:"render",value:function(){return Object(Ct.a)("div",{class:"esri-feature-fields"},this.renderFields())}},{key:"_forceLTR",value:function(e){return"&lrm;".concat(e)}}]),n}(Tt.a);Object(h.a)([Object(X.a)("viewModel.attributes")],Kn.prototype,"attributes",void 0),Object(h.a)([Object(X.a)("viewModel.expressionInfos")],Kn.prototype,"expressionInfos",void 0),Object(h.a)([Object(X.a)("viewModel.fieldInfos")],Kn.prototype,"fieldInfos",void 0),Object(h.a)([Object(m.b)({type:qn}),Object(It.a)(["viewModel.attributes","viewModel.formattedFieldInfos"])],Kn.prototype,"viewModel",void 0),Object(h.a)([Object(m.b)(),Object(It.a)(),Object(Mt.a)("esri/widgets/Feature/t9n/Feature")],Kn.prototype,"messages",void 0),Object(h.a)([Object(m.b)(),Object(It.a)(),Object(Mt.a)("esri/widgets/support/t9n/uriUtils")],Kn.prototype,"messagesURIUtils",void 0);var Jn=Kn=Object(h.a)([Object(O.a)("esri.widgets.Feature.FeatureFields")],Kn),$n=n(506),Xn=n(410),Yn=n(349),Zn=n(803),Qn=v.a.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),ea=new Map;function ta(e){if(!yn(e))return null;var t=e.split("/").slice(1),n=Object(Ae.a)(t,2);return{layerId:n[0],fieldName:n[1]}}function na(e){var t,n=e.originRelationship,a=e.relationships,i=e.layerId;return a&&a.some((function(e){return"".concat(e.relatedTableId)===i&&e.id===n.id&&(t=e),!!t})),t}function aa(e,t){if(t&&e){var n=e.features,a=e.statsFeatures,i=n&&n.value;t.relatedFeatures=i?i.features:[];var r=a&&a.value;t.relatedStatsFeatures=r?r.features:[]}}function ia(e,t){var n=e.relatedInfos,a=e.layer,i={};return n.forEach((function(e,n){var r=e.relation;if(!r){var o=new _.a("relation-required","A relation is required on a layer to retrieve related records.");throw Qn.error(o),o}var s=r.relatedTableId;if("number"!=typeof s){var c=new _.a("A related table ID is required on a layer to retrieve related records.");throw Qn.error(c),c}var l="".concat(a.url,"/").concat(s),u=ea.get(l),d=u||function(e,t){return Object(I.default)(e,{query:{f:"json"},signal:t&&t.signal})}(l,t);u||ea.set(l,d),i[n]=d})),Object(k.i)(i)}function ra(e,t){var n=e.graphic,a=e.relatedInfos,i=e.layer,r={};return a.forEach((function(e,a){e.layerInfo&&(r[a]=function(){var e=Object(s.a)(o.a.mark((function e(t,n,a,i){var r,s,c,l,u,d,p,h,f,b,v,y;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=a.layerId.toString(),c=n.layerInfo,l=n.queryTask,u=n.relation,!(d=null==(r=na({originRelationship:u,relationships:c.relationships,layerId:s}))?void 0:r.keyField)){e.next=4;break}return p=Object(Nt.l)(Object(Nt.i)(c.fields,d)),h=function(e,t){var n=t.toLowerCase();for(var a in e)if(a.toLowerCase()===n)return e[a];return null}(t.attributes,u.keyField),f=p?"".concat(d,"=").concat(h):"".concat(d,"='").concat(h,"'"),b=l.execute(new Yn.a({where:f,outFields:n.relatedFields}),i),v=n.outStatistics&&n.outStatistics.length>0&&c.supportsStatistics?l.execute(new Yn.a({where:f,outFields:n.relatedFields,outStatistics:n.outStatistics}),i):null,y={features:b},e.abrupt("return",(v&&(y.statsFeatures=v),Object(k.i)(y)));case 4:return e.abrupt("return",null);case 5:case"end":return e.stop()}}),e)})));return function(t,n,a,i){return e.apply(this,arguments)}}()(n,e,i,t))})),Object(k.i)(r)}var oa=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).activeMediaInfoIndex=0,a.attributes=null,a.fieldInfoMap=null,a.formattedAttributes=null,a.layer=null,a.mediaInfos=null,a.popupTemplate=null,a.relatedInfos=null,a}return Object(u.a)(n,[{key:"setActiveMedia",value:function(e){this._setContentElementMedia(e)}},{key:"next",value:function(){this._pageContentElementMedia(1)}},{key:"previous",value:function(){this._pageContentElementMedia(-1)}},{key:"_setContentElementMedia",value:function(e){var t=this.formattedMediaInfoCount,n=(e+t)%t;this.activeMediaInfoIndex=n}},{key:"_pageContentElementMedia",value:function(e){var t=this.activeMediaInfoIndex+e;this._setContentElementMedia(t)}},{key:"_formatMediaInfos",value:function(){var e=this,t=this.attributes,n=this.mediaInfos,a=this.formattedAttributes,i=this.fieldInfoMap,r=this.layer,o=Object(c.a)(Object(c.a)({},a),t);return null==n?void 0:n.map((function(n){if(!n)return null;var s=n.title?cn(n.title,o,r):"";n.title=s?on({formattedAttributes:a,template:s,fieldInfoMap:i}):"";var c=n.caption?cn(n.caption,o,r):"";n.caption=c?on({formattedAttributes:a,template:c,fieldInfoMap:i}):"";var l=n.altText?cn(n.altText,o,r):"";if(n.altText=l?on({formattedAttributes:a,template:l,fieldInfoMap:i}):"","image"===n.type){var u=n.value;return e._setImageValue({value:u,formattedAttributes:a,layer:r}),n.value.sourceURL?n:void 0}if("pie-chart"===n.type||"line-chart"===n.type||"column-chart"===n.type||"bar-chart"===n.type){var d=n.value;return e._setChartValue({value:d,chartType:n.type,attributes:t,formattedAttributes:a,layer:r}),n}return null})).filter(Boolean)}},{key:"_setImageValue",value:function(e){var t=this.fieldInfoMap,n=e.value,a=e.formattedAttributes,i=e.layer,r=n.linkURL,o=n.sourceURL;if(o){var s=sn(o,i);n.sourceURL=on({formattedAttributes:a,template:s,fieldInfoMap:t})}if(r){var c=sn(r,i);n.linkURL=on({formattedAttributes:a,template:c,fieldInfoMap:t})}}},{key:"_setChartValue",value:function(e){var t=this,n=e.value,a=e.attributes,i=e.formattedAttributes,r=e.chartType,o=e.layer,s=this.popupTemplate,c=this.relatedInfos,l=n.fields,u=n.normalizeField;if(n.fields=function(e,t){return e&&e.map((function(e){return nn(e,t)}))}(l,o),u&&(n.normalizeField=nn(u,o)),l.some((function(e){return!!(null!=i[e]||yn(e)&&c.size)}))){var d=null==s?void 0:s.fieldInfos;l.forEach((function(e){if(yn(e))n.series=[].concat(Object(Pe.a)(n.series),Object(Pe.a)(t._getRelatedChartInfos({fieldInfos:d,fieldName:e,formattedAttributes:i,chartType:r,value:n})));else{var o=t._getChartOption({value:n,attributes:a,chartType:r,formattedAttributes:i,fieldName:e,fieldInfos:d});n.series.push(o)}}))}}},{key:"_getRelatedChartInfos",value:function(e){var t,n=this,a=e.fieldInfos,i=e.fieldName,r=e.formattedAttributes,o=e.chartType,s=e.value,c=[],l=ta(i),u=l.layerId,d=l.fieldName,p=null==(t=this.relatedInfos)?void 0:t.get(u.toString());if(!p)return c;var h=p.relatedFeatures,f=p.relation;if(!f||!h)return c;var b=f.cardinality;return h.forEach((function(e){var t=e.attributes;t&&Object.keys(t).forEach((function(e){e===d&&c.push(n._getChartOption({value:s,attributes:t,formattedAttributes:r,fieldName:i,chartType:o,relatedFieldName:e,fieldInfos:a}))}))})),"one-to-many"===b||"many-to-many"===b?c:[c[0]]}},{key:"_getTooltip",value:function(e){var t=e.label,n=e.value;return"pie-chart"===e.chartType?t:"".concat(t,": ").concat(n)}},{key:"_getChartOption",value:function(e){var t,n=e.value,a=e.attributes,i=e.formattedAttributes,r=e.fieldName,o=e.relatedFieldName,s=e.fieldInfos,c=e.chartType,l=this.layer,u=n.normalizeField,d=n.tooltipField,p=u?yn(u)?a[ta(u).fieldName]:a[u]:null,h=o&&void 0!==a[o]?a[o]:void 0!==a[r]?a[r]:i[r],f=void 0===h?null:h&&p?h/p:h,b=new $n.a({value:f});if(yn(r)){var v=ta(r),y=ta(d),m=y?y.fieldName:null,g=ln(f,{fieldInfos:s,fieldName:o,layer:l,preventPlacesFormatting:!!p}),O=v?v.label||v.fieldName:o,j=m&&void 0!==a[m]?a[m]:O;return b.tooltip=this._getTooltip({label:j,value:g,chartType:c}),b}var _=un(s,r),w=nn(r,l),k=d&&void 0!==i[d]?i[d]:tn(_||new Un.a({fieldName:w}),null==(t=this.popupTemplate)?void 0:t.expressionInfos),M=i[w];return b.tooltip=this._getTooltip({label:k,value:M,chartType:c}),b}},{key:"activeMediaInfo",get:function(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}},{key:"formattedMediaInfos",get:function(){return this._formatMediaInfos()||[]}},{key:"formattedMediaInfoCount",get:function(){return this.formattedMediaInfos.length}}]),n}(G.a);Object(h.a)([Object(m.b)()],oa.prototype,"activeMediaInfoIndex",void 0),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["formattedMediaInfos","activeMediaInfoIndex"]})],oa.prototype,"activeMediaInfo",null),Object(h.a)([Object(m.b)()],oa.prototype,"attributes",void 0),Object(h.a)([Object(m.b)()],oa.prototype,"fieldInfoMap",void 0),Object(h.a)([Object(m.b)()],oa.prototype,"formattedAttributes",void 0),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["attributes","fieldInfoMap","formattedAttributes","mediaInfos","popupTemplate","layer","relatedInfos"]})],oa.prototype,"formattedMediaInfos",null),Object(h.a)([Object(m.b)()],oa.prototype,"layer",void 0),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["formattedMediaInfos"]})],oa.prototype,"formattedMediaInfoCount",null),Object(h.a)([Object(m.b)()],oa.prototype,"mediaInfos",void 0),Object(h.a)([Object(m.b)()],oa.prototype,"popupTemplate",void 0),Object(h.a)([Object(m.b)()],oa.prototype,"relatedInfos",void 0);var sa,ca,la=oa=Object(h.a)([Object(O.a)("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],oa),ua=la,da=n(70),pa=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],ha=[].concat(pa.slice(30,39),pa.slice(28,30).reverse()),fa=[{name:"default",colors:ha},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}],ba=new Map([["ar",function(){return n.e(73).then(n.bind(null,995)).then((function(e){return e.a}))}],["bs-ba",function(){return n.e(74).then(n.bind(null,996)).then((function(e){return e.b}))}],["ca-es",function(){return n.e(75).then(n.bind(null,997)).then((function(e){return e.c}))}],["cs-cz",function(){return n.e(76).then(n.bind(null,998)).then((function(e){return e.c}))}],["da-dk",function(){return n.e(77).then(n.bind(null,999)).then((function(e){return e.d}))}],["de-de",function(){return n.e(79).then(n.bind(null,1e3)).then((function(e){return e.d}))}],["de-ch",function(){return n.e(78).then(n.bind(null,1001)).then((function(e){return e.d}))}],["el-gr",function(){return n.e(80).then(n.bind(null,1002)).then((function(e){return e.e}))}],["en-us",function(){return n.e(82).then(n.bind(null,1003)).then((function(e){return e.e}))}],["en-ca",function(){return n.e(81).then(n.bind(null,1004)).then((function(e){return e.e}))}],["es-es",function(){return n.e(83).then(n.bind(null,1005)).then((function(e){return e.e}))}],["et-ee",function(){return n.e(84).then(n.bind(null,1006)).then((function(e){return e.e}))}],["fi-fi",function(){return n.e(85).then(n.bind(null,1007)).then((function(e){return e.f}))}],["fr-fr",function(){return n.e(86).then(n.bind(null,1008)).then((function(e){return e.f}))}],["he-il",function(){return n.e(87).then(n.bind(null,1009)).then((function(e){return e.h}))}],["hr-hr",function(){return n.e(88).then(n.bind(null,1010)).then((function(e){return e.h}))}],["hu-hu",function(){return n.e(89).then(n.bind(null,1011)).then((function(e){return e.h}))}],["id-id",function(){return n.e(91).then(n.bind(null,1012)).then((function(e){return e.i}))}],["it-it",function(){return n.e(93).then(n.bind(null,1013)).then((function(e){return e.i}))}],["ja-jp",function(){return n.e(94).then(n.bind(null,1014)).then((function(e){return e.j}))}],["ko-kr",function(){return n.e(95).then(n.bind(null,1015)).then((function(e){return e.k}))}],["lt-lt",function(){return n.e(96).then(n.bind(null,1016)).then((function(e){return e.l}))}],["lv-lv",function(){return n.e(97).then(n.bind(null,1017)).then((function(e){return e.l}))}],["nb-no",function(){return n.e(98).then(n.bind(null,1018)).then((function(e){return e.n}))}],["nl-nl",function(){return n.e(99).then(n.bind(null,1019)).then((function(e){return e.n}))}],["pl-pl",function(){return n.e(101).then(n.bind(null,1020)).then((function(e){return e.p}))}],["pt-br",function(){return n.e(102).then(n.bind(null,1021)).then((function(e){return e.p}))}],["pt-pt",function(){return n.e(103).then(n.bind(null,1022)).then((function(e){return e.p}))}],["ro-ro",function(){return n.e(104).then(n.bind(null,1023)).then((function(e){return e.r}))}],["ru-ru",function(){return n.e(105).then(n.bind(null,1024)).then((function(e){return e.r}))}],["sl-sl",function(){return n.e(106).then(n.bind(null,1025)).then((function(e){return e.s}))}],["sr-rs",function(){return n.e(107).then(n.bind(null,1026)).then((function(e){return e.s}))}],["sv-se",function(){return n.e(108).then(n.bind(null,1027)).then((function(e){return e.s}))}],["th-th",function(){return n.e(109).then(n.bind(null,1028)).then((function(e){return e.t}))}],["tr-tr",function(){return n.e(110).then(n.bind(null,1029)).then((function(e){return e.t}))}],["uk-ua",function(){return n.e(111).then(n.bind(null,1030)).then((function(e){return e.u}))}],["vi-vn",function(){return n.e(112).then(n.bind(null,1031)).then((function(e){return e.v}))}],["zh-cn",function(){return n.e(113).then(n.bind(null,1032)).then((function(e){return e.z}))}],["zh-hk",function(){return n.e(26).then(n.bind(null,1033)).then((function(e){return e.z}))}],["zh-tw",function(){return n.e(26).then(n.bind(null,1033)).then((function(e){return e.z}))}]]);function va(e){return e?ba.has(e.toLowerCase())?e.toLowerCase():function(e){var t,n=e.split("-")[0].toLowerCase(),a=null,i=Object(se.a)(ba.keys());try{for(i.s();!(t=i.n()).done;){var r=t.value;if(r.startsWith(n)){a=r;break}}}catch(o){i.e(o)}finally{i.f()}return a}(e)||"en-us":"en-us"}function ya(){return ma.apply(this,arguments)}function ma(){return(ma=Object(s.a)(o.a.mark((function e(){var t,a,i,r,s,c=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=va(t=c.length>0&&void 0!==c[0]?c[0]:Object(da.b)()),!sa||t!==ca){e.next=3;break}return e.abrupt("return",sa);case 3:return sa=n.e(92).then(n.bind(null,1034)).then((function(e){return e.i})),ca=t,e.prev=4,e.next=7,Object(k.b)([sa,ba.get(ca)()]);case 7:a=e.sent,i=Object(Ae.a)(a,2),r=i[0],s=i[1],ca===t&&(r.am4core.options.defaultLocale=s.default),r.am4core.options.suppressWarnings=!0,r.am4core.options.autoDispose=!0,e.next=17;break;case 14:return e.prev=14,e.t0=e.catch(4),e.abrupt("return",(sa=null,ca=null,null));case 17:return e.abrupt("return",sa);case 18:case"end":return e.stop()}}),e,null,[[4,14]])})))).apply(this,arguments)}var ga="esri-feature-media__icon",Oa=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e,a){var i;return Object(l.a)(this,n),(i=t.call(this,e,a))._refreshTimer=null,i._refreshIntervalInfo=null,i.attributes=null,i.activeMediaInfoIndex=null,i.fieldInfoMap=null,i.layer=null,i.mediaInfos=null,i.popupTemplate=null,i.relatedInfos=null,i.viewModel=new ua,i.messages=null,i}return Object(u.a)(n,[{key:"initialize",value:function(){var e=this;this.own(Object(Ce.a)(this,["viewModel.activeMediaInfo","viewModel.activeMediaInfoIndex"],(function(){return e._setupMediaRefreshTimer()})))}},{key:"destroy",value:function(){this._clearMediaRefreshTimer()}},{key:"render",value:function(){return Object(Ct.a)("div",{bind:this,class:"esri-feature-media",onkeyup:this._handleMediaKeyup},this.renderMedia())}},{key:"renderMedia",value:function(){return this.viewModel.formattedMediaInfoCount?Object(Ct.a)("div",{key:"media-element-container",class:"esri-feature-media__container"},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}},{key:"renderImageMediaInfo",value:function(e){var t=this._refreshIntervalInfo,n=this.viewModel,a=n.activeMediaInfoIndex,i=n.formattedMediaInfoCount,r=e.value,o=e.refreshInterval,s=e.altText,c=e.title,l=e.type,u=r.sourceURL,d=r.linkURL,p=en(d)?"_blank":"_self",h="_blank"===p?"noreferrer":"",f=o?t:null,b=f?f.timestamp:0,v=f?f.sourceURL:u,y=Object(Ct.a)("img",{alt:s||c,key:"media-".concat(l,"-").concat(a,"-").concat(i,"-").concat(b),src:v});return(d?Object(Ct.a)("a",{title:c,href:d,rel:h,target:p},y):null)||y}},{key:"renderChartMediaInfo",value:function(e){var t=this.viewModel,n=t.activeMediaInfoIndex,a=t.formattedMediaInfoCount;return Object(Ct.a)("div",{key:"media-".concat(e.type,"-").concat(n,"-").concat(a),bind:this,class:"esri-feature-media__chart",afterCreate:this._getChartDependencies})}},{key:"renderMediaInfoType",value:function(){var e=this.viewModel.activeMediaInfo;return e?"image"===e.type?this.renderImageMediaInfo(e):-1!==e.type.indexOf("chart")?this.renderChartMediaInfo(e):null:null}},{key:"renderMediaInfo",value:function(){var e=this.viewModel.activeMediaInfo,t=e.title?Object(Ct.a)("div",{key:"media-title",class:"esri-feature-media__item-title",innerHTML:e.title}):null,n=e.caption?Object(Ct.a)("div",{key:"media-caption",class:"esri-feature-media__item-caption",innerHTML:e.caption}):null;return Object(Ct.a)("div",{key:"media-container",class:"esri-feature-media__item-container"},t,n,Object(Ct.a)("div",{key:"media-item-container",class:"esri-feature-media__item"},this.renderMediaInfoType()))}},{key:"renderMediaPageButton",value:function(e){if(this.viewModel.formattedMediaInfoCount<2)return null;var t="previous"===e,n=t?this.messages.previous:this.messages.next,a=t?this.classes("esri-feature-media__button","esri-feature-media__previous"):this.classes("esri-feature-media__button","esri-feature-media__next"),i=t?this.classes(ga,"esri-feature-media__previous-icon","esri-icon-left-triangle-arrow"):this.classes(ga,"esri-feature-media__next-icon","esri-icon-right-triangle-arrow"),r=t?this.classes(ga,"esri-feature-media__previous-icon--rtl","esri-icon-right-triangle-arrow"):this.classes(ga,"esri-feature-media__next-icon--rtl","esri-icon-left-triangle-arrow"),o=t?"media-previous":"media-next",s=t?this._previous:this._next;return Object(Ct.a)("button",{type:"button",key:o,title:n,"aria-label":n,tabIndex:0,class:a,bind:this,onclick:s},Object(Ct.a)("span",{"aria-hidden":"true",class:i}),Object(Ct.a)("span",{"aria-hidden":"true",class:r}))}},{key:"_next",value:function(){this.viewModel.next()}},{key:"_previous",value:function(){this.viewModel.previous()}},{key:"_getChartDependencies",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var n,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ya();case 2:n=e.sent,a=this.viewModel.activeMediaInfo,this._renderChart({chartDiv:t,mediaInfo:a,chartsModule:n});case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_handleMediaKeyup",value:function(e){var t=Object(et.a)(e);"ArrowLeft"===t&&(e.stopPropagation(),this.viewModel.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.viewModel.next())}},{key:"_renderChart",value:function(e){var t=e.chartsModule,n=e.chartDiv,a=e.mediaInfo,i=a.value,r=a.type,o=t.am4core,s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",n=fa.find((function(e){return e.name===t}));return n?n.colors.map((function(t){return e.color(t)})):null}(o);Object(wt.d)()&&o.useTheme(t.am4themes_dark),o.useTheme(t.am4themes_animated),o.useTheme((function(e){e instanceof o.ColorSet&&s&&(e.list=s)}));var c="pie-chart"===r?this._createPieChart(e):this._createXYChart(e);n.setAttribute("aria-label",a.altText||a.title),c.data=i.series.map((function(e){return{tooltip:e.tooltip,value:e.value}})).filter((function(e){return"pie-chart"!==r||e.value>0}))}},{key:"_customizeChartTooltip",value:function(e,t){e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=t.color("#ffffff"),e.background.fill=t.color({r:0,g:0,b:0,a:.7})}},{key:"_createPieChart",value:function(e){var t=e.chartDiv,n=e.chartsModule,a=n.am4core,i=n.am4charts,r=a.create(t,i.PieChart);r.rtl=Object(wt.e)();var o=r.series.push(new i.PieSeries);return o.labels.template.disabled=!0,o.ticks.template.disabled=!0,o.dataFields.value="value",o.dataFields.category="tooltip",this._customizeChartTooltip(o.tooltip,a),r}},{key:"_getMinSeriesValue",value:function(e){var t=0;return e.forEach((function(e){return t=Math.min(e.value,t)})),t}},{key:"_createColumnChart",value:function(e,t){var n=t.chartsModule,a=t.mediaInfo.value,i=n.am4core,r=n.am4charts,o=e.xAxes.push(new r.CategoryAxis);o.dataFields.category="tooltip",o.renderer.labels.template.disabled=!0,this._customizeChartTooltip(o.tooltip,i),o.tooltip.events.on("sizechanged",(function(){o.tooltip.dy=-o.tooltip.contentHeight}));var s=e.yAxes.push(new r.ValueAxis),c=s.renderer.labels.template;s.renderer.minLabelPosition=.05,s.renderer.maxLabelPosition=.95,s.min=this._getMinSeriesValue(a.series),this._customizeChartTooltip(s.tooltip,i),c.wrap=!0;var l=e.series.push(new r.ColumnSeries);l.dataFields.valueY="value",l.dataFields.categoryX="tooltip",e.cursor=new r.XYCursor,a.series.length>15&&(e.scrollbarX=new i.Scrollbar)}},{key:"_createBarChart",value:function(e,t){var n=t.chartsModule,a=t.mediaInfo.value,i=n.am4core,r=n.am4charts,o=e.yAxes.push(new r.CategoryAxis);o.dataFields.category="tooltip",o.renderer.inversed=!0,o.renderer.labels.template.disabled=!0,this._customizeChartTooltip(o.tooltip,i),o.tooltip.events.on("sizechanged",(function(){o.tooltip.dx=o.tooltip.contentWidth}));var s=e.xAxes.push(new r.ValueAxis),c=s.renderer.labels.template;s.renderer.minLabelPosition=.05,s.renderer.maxLabelPosition=.95,s.min=this._getMinSeriesValue(a.series),this._customizeChartTooltip(s.tooltip,i),c.wrap=!0;var l=e.series.push(new r.ColumnSeries);l.dataFields.valueX="value",l.dataFields.categoryY="tooltip",e.cursor=new r.XYCursor,a.series.length>15&&(e.scrollbarY=new i.Scrollbar)}},{key:"_createLineChart",value:function(e,t){var n=t.chartsModule,a=t.mediaInfo.value,i=n.am4core,r=n.am4charts,o=e.xAxes.push(new r.CategoryAxis);o.dataFields.category="tooltip",o.renderer.labels.template.disabled=!0,this._customizeChartTooltip(o.tooltip,i),o.tooltip.events.on("sizechanged",(function(){o.tooltip.dy=-o.tooltip.contentHeight}));var s=e.yAxes.push(new r.ValueAxis),c=s.renderer.labels.template;s.renderer.minLabelPosition=.05,s.renderer.maxLabelPosition=.95,s.min=this._getMinSeriesValue(a.series),this._customizeChartTooltip(s.tooltip,i),c.wrap=!0;var l=e.series.push(new r.LineSeries);l.dataFields.categoryX="tooltip",l.dataFields.valueY="value",e.cursor=new r.XYCursor,a.series.length>15&&(e.scrollbarX=new i.Scrollbar)}},{key:"_createXYChart",value:function(e){var t=e.chartDiv,n=e.chartsModule,a=e.mediaInfo.type,i=n.am4core,r=n.am4charts,o=i.create(t,r.XYChart);return o.rtl=Object(wt.e)(),"column-chart"===a&&this._createColumnChart(o,e),"bar-chart"===a&&this._createBarChart(o,e),"line-chart"===a&&this._createLineChart(o,e),o}},{key:"_clearMediaRefreshTimer",value:function(){var e=this._refreshTimer;e&&(clearTimeout(e),this._refreshTimer=null)}},{key:"_updateMediaInfoTimestamp",value:function(e){var t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:this._getImageSource(e,t)},this.scheduleRender()}},{key:"_setupMediaRefreshTimer",value:function(){this._clearMediaRefreshTimer();var e=this.viewModel.activeMediaInfo;e&&"image"===e.type&&e.refreshInterval&&this._setRefreshTimeout(e)}},{key:"_setRefreshTimeout",value:function(e){var t=this,n=e.refreshInterval,a=e.value;if(n){var i=6e4*n;this._updateMediaInfoTimestamp(a.sourceURL);var r=setInterval((function(){t._updateMediaInfoTimestamp(a.sourceURL)}),i);this._refreshTimer=r}}},{key:"_getImageSource",value:function(e,t){var n=-1!==e.indexOf("?")?"&":"?",a=e.split("#"),i=Object(Ae.a)(a,2),r=i[0],o=i[1],s=void 0===o?"":o;return"".concat(r).concat(n,"timestamp=").concat(t).concat(s?"#":"").concat(s)}}]),n}(Tt.a);Object(h.a)([Object(X.a)("viewModel.attributes")],Oa.prototype,"attributes",void 0),Object(h.a)([Object(X.a)("viewModel.activeMediaInfoIndex")],Oa.prototype,"activeMediaInfoIndex",void 0),Object(h.a)([Object(X.a)("viewModel.fieldInfoMap")],Oa.prototype,"fieldInfoMap",void 0),Object(h.a)([Object(X.a)("viewModel.layer")],Oa.prototype,"layer",void 0),Object(h.a)([Object(X.a)("viewModel.mediaInfos")],Oa.prototype,"mediaInfos",void 0),Object(h.a)([Object(X.a)("viewModel.popupTemplate")],Oa.prototype,"popupTemplate",void 0),Object(h.a)([Object(X.a)("viewModel.relatedInfos")],Oa.prototype,"relatedInfos",void 0),Object(h.a)([Object(m.b)({type:ua}),Object(It.a)(["viewModel.formattedMediaInfos","viewModel.activeMediaInfoIndex","viewModel.activeMediaInfo"])],Oa.prototype,"viewModel",void 0),Object(h.a)([Object(m.b)(),Object(It.a)(),Object(Mt.a)("esri/widgets/Feature/t9n/Feature")],Oa.prototype,"messages",void 0);var ja=Oa=Object(h.a)([Object(O.a)("esri.widgets.Feature.FeatureMedia")],Oa),_a=n(171),wa=["$datastore","$map","$layer"],ka=v.a.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");function Ma(e){return Ia.apply(this,arguments)}function Ia(){return(Ia=Object(s.a)(o.a.mark((function e(t){var n,a,i,r,s,c,l,u,d,p,h,f,b,v;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.expressionAttributes,a=t.info,i=t.arcadeUtils,r=t.spatialReference,s=t.map,c=t.graphic,l="expression/".concat(a.name),u=i.createSyntaxTree(a.expression),d=wa.filter((function(e){return i.hasVariable(u,e)})),e.next=4,i.loadScriptDependencies(u,!0,d);case 4:return p=i.getViewInfo({spatialReference:r}),(h=i.createExecContext(c,p)).useAsync=!0,function(e){var t=e.arcadeUtils,n=e.context,a=e.viewInfo,i=e.map,r=e.graphic;e.featureSetVars.forEach((function(e){var o=e.toLowerCase(),s={map:i,spatialReference:a.sr};"$map"===o&&(n.vars[o]=t.convertMapToFeatureSetCollection(s)),"$layer"===o&&(n.vars[o]=t.convertFeatureLayerToFeatureSet(r.sourceLayer,a.sr)),"$datastore"===o&&(n.vars[o]=t.convertServiceUrlToWorkspace(r.sourceLayer.url,a.sr))}))}({arcadeUtils:i,featureSetVars:d,context:h,viewInfo:p,map:s,graphic:c}),f=i.createFunction(u,h),e.next=9,i.executeAsyncFunction(f,h).catch((function(e){return ka.error("arcade-execution-error",{error:e,graphic:c,expressionInfo:a})}));case 9:b=e.sent,n[l]="string"==typeof b?hn(pn(b)):Array.isArray(b)?function(e){return'<ul class="esri-widget__list">'.concat(e.map((function(e){return"<li>".concat("string"==typeof e?hn(pn(e)):e,"</li>")})).join(""),"</ul>")}(b):b&&"esri.arcade.Dictionary"===b.declaredClass?'<table class="esri-widget__table">'.concat((v=b).keys().map((function(e){var t=v.field(e);return"<tr><th>".concat(e,"</th><td>").concat("string"==typeof t?hn(pn(t)):t,"</td></tr>")})).join(""),"</table>"):b;case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xa(e){return Ca.apply(this,arguments)}function Ca(){return(Ca=Object(s.a)(o.a.mark((function e(t){var a,i,r,s,c,l,u,d,p,h,f;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.popupTemplate,i=t.spatialReference,r=t.graphic,s=t.map,c=a.expressionInfos,l=[],u={},c&&c.length){e.next=4;break}return e.abrupt("return",u);case 4:return e.next=6,n.e(14).then(n.bind(null,749));case 6:d=e.sent,p=Object(se.a)(c);try{for(p.s();!(h=p.n()).done;)f=h.value,l.push(Ma({expressionAttributes:u,info:f,arcadeUtils:d,spatialReference:i,map:s,graphic:r}))}catch(o){p.e(o)}finally{p.f()}return e.next=11,Object(k.i)(l);case 11:return e.abrupt("return",u);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ta=v.a.getLogger("esri.widgets.FeatureViewModel"),Fa=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e))._handles=new Ue.a,a._featureAbortController=null,a.graphicChangedThrottled=_t(a.graphicChanged,1,Object(K.a)(a)),a.content=null,a.contentViewModels=[],a.defaultPopupTemplateEnabled=!1,a.formattedAttributes=null,a.lastEditInfo=null,a.relatedInfos=new Map,a.title="",a.view=null,a._handles.add(Object(Ce.a)(Object(K.a)(a),["graphic","_effectivePopupTemplate"],(function(){return a.graphicChangedThrottled()}))),a}return Object(u.a)(n,[{key:"destroy",value:function(){this._clear(),this._cancelFeatureQuery(),this._handles.destroy(),this._handles=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}},{key:"setActiveMedia",value:function(e,t){var n=this.contentViewModels[e];n instanceof ua&&n.setActiveMedia(t)}},{key:"nextMedia",value:function(e){var t=this.contentViewModels[e];t instanceof ua&&t.next()}},{key:"previousMedia",value:function(e){var t=this.contentViewModels[e];t instanceof ua&&t.previous()}},{key:"_clear",value:function(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}},{key:"graphicChanged",value:function(){var e=Object(s.a)(o.a.mark((function e(){var t,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._cancelFeatureQuery(),this._clear(),t=this.graphic){e.next=4;break}return e.abrupt("return");case 4:return n=Object(k.d)(),this._featureAbortController=n,e.prev=6,e.next=9,this._queryFeature({signal:n.signal});case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(6),Ta.error("error","error loading popupTemplate for graphic",{error:e.t0,graphic:t});case 14:this._featureAbortController===n&&(this._featureAbortController=null);case 15:case"end":return e.stop()}}),e,this,[[6,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"_cancelFeatureQuery",value:function(){var e=this._featureAbortController;e&&e.abort(),this._featureAbortController=null}},{key:"_compileContent",value:function(e){var t=this;if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.map((function(e,n){return"attachments"===e.type?t._compileAttachments(e,n):"custom"===e.type?t._compileCustom(e,n):"fields"===e.type?t._compileFields(e,n):"media"===e.type?t._compileMedia(e,n):"text"===e.type?t._compileText(e,n):void 0})):"string"==typeof e?this._compileText(new _a.a({text:e}),0).text:e}},{key:"_destroyContentViewModels",value:function(){this.contentViewModels.forEach((function(e){return e&&!e.destroyed&&e.destroy()})),this._set("contentViewModels",[])}},{key:"_compileAttachments",value:function(e,t){var n=this.graphic;return this.contentViewModels[t]=new _n({graphic:n}),e}},{key:"_compileCustom",value:function(e,t){var n=this.graphic,a=e.creator,i=e.destroyer;return this.contentViewModels[t]=new Dn({graphic:n,creator:a,destroyer:i}),e}},{key:"_compileFields",value:function(e,t){var n=this._effectivePopupTemplate,a=this.formattedAttributes,i=e.clone(),r=(null==e?void 0:e.fieldInfos)||(null==n?void 0:n.fieldInfos),o=null==n?void 0:n.expressionInfos,s=Object(c.a)(Object(c.a)({},a.global),a.content[t]),l=new qn({attributes:s,expressionInfos:o,fieldInfos:r});return this.contentViewModels[t]=l,i.fieldInfos=l.formattedFieldInfos.slice(0),i}},{key:"_compileMedia",value:function(e,t){var n=this.graphic,a=this._fieldInfoMap,i=this._effectivePopupTemplate,r=this.relatedInfos,o=this._sourceLayer,s=n.attributes,c=this.formattedAttributes.global,l=e.clone(),u=l.mediaInfos,d=new ua({activeMediaInfoIndex:l.activeMediaInfoIndex||0,attributes:s,layer:o,fieldInfoMap:a,formattedAttributes:c,mediaInfos:u,popupTemplate:i,relatedInfos:r});return l.mediaInfos=d.formattedMediaInfos.slice(0),this.contentViewModels[t]=d,l}},{key:"_compileText",value:function(e,t){var n=e.clone(),a=this.graphic,i=this._fieldInfoMap,r=this._sourceLayer;if(n&&n.text){var o=a.attributes,s=this.formattedAttributes.global,l=cn(n.text,Object(c.a)(Object(c.a)({},s),o),r);n.text=on({formattedAttributes:s,template:l,fieldInfoMap:i})}return this.contentViewModels[t]=new Dn({graphic:a,creator:n.text}),n}},{key:"_compileLastEditInfo",value:function(){var e=this._effectivePopupTemplate,t=this._sourceLayer,n=this.graphic;if(e){var a=e.lastEditInfoEnabled,i=null==t?void 0:t.editFieldsInfo;return a&&i?function(e,t){var n=e.creatorField,a=e.creationDateField,i=e.editorField,r=e.editDateField;if(t){var o=t[r];if("number"==typeof o){var s=t[i];return{type:"edit",date:Object(Dt.b)(o,Xt),user:s}}var c=t[a];if("number"==typeof c){var l=t[n];return{type:"create",date:Object(Dt.b)(c,Xt),user:l}}return null}}(i,n.attributes):void 0}}},{key:"_compileTitle",value:function(e){var t=this._fieldInfoMap,n=this._sourceLayer,a=this.graphic.attributes,i=this.formattedAttributes.global;return e?on({formattedAttributes:i,template:cn(e,Object(c.a)(Object(c.a)({},i),a),n),fieldInfoMap:t}):""}},{key:"_getTitle",value:function(){var e=Object(s.a)(o.a.mark((function e(){var t,n,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._effectivePopupTemplate,n=this.graphic,a=null==t?void 0:t.title,e.abrupt("return",Zt(a,{graphic:n}));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getContent",value:function(){var e=Object(s.a)(o.a.mark((function e(){var t,n,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._effectivePopupTemplate,n=this.graphic,a=null==t?void 0:t.content,e.abrupt("return",Zt(a,{graphic:n}));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_queryFeature",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var n,a,i,r,s,c,l,u,d,p,h;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._featureAbortController,a=this._sourceLayer,i=this.graphic,r=this._effectivePopupTemplate,s=this.spatialReference,c=this.map,e.next=8,Object(k.i)({content:this._getContent(),title:this._getTitle()});case 8:if(l=e.sent,u=l.content.value,d=l.title.value,n===this._featureAbortController&&i){e.next=13;break}return e.abrupt("return");case 13:return e.next=15,Object(k.i)({checkForRelatedFeatures:this._checkForRelatedFeatures(t),expressionAttributes:xa({popupTemplate:this._effectivePopupTemplate,spatialReference:s,graphic:i,map:c}),queryUpdatedFeature:bn({graphic:i,popupTemplate:r,layer:a},t)});case 15:p=e.sent,h=p.expressionAttributes.value,n===this._featureAbortController&&i&&(this._set("formattedAttributes",this._createFormattedAttributes(u,h)),this._set("title",this._compileTitle(d)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(u)||null));case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createFormattedAttributes",value:function(e,t){var n=this._effectivePopupTemplate,a=this.graphic,i=this.relatedInfos,r=this._sourceLayer,o=this._fieldInfoMap,s=null==n?void 0:n.fieldInfos,l=Object(c.a)(Object(c.a)({},a.attributes),t),u={global:fn({fieldInfos:s,graphic:a,attributes:l,layer:r,fieldInfoMap:o,relatedInfos:i}),content:[]};return Array.isArray(e)&&e.forEach((function(e,t){"fields"===e.type&&e.fieldInfos&&(u.content[t]=fn({fieldInfos:e.fieldInfos,graphic:a,attributes:l,layer:r,fieldInfoMap:o,relatedInfos:i}))})),u}},{key:"_checkForRelatedFeatures",value:function(e){var t=this.graphic,n=this._effectivePopupTemplate;return this._queryRelatedInfos(t,dn(n),e)}},{key:"_queryRelatedInfos",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n,a){var i,r,s,c,l,u,d=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.relatedInfos,r=this._sourceLayer,i.clear(),!Object(b.g)(r.associatedLayer)){e.next=8;break}return e.next=5,r.associatedLayer.load(a);case 5:e.t0=e.sent,e.next=9;break;case 8:e.t0=r;case 9:if(s=e.t0){e.next=12;break}return e.abrupt("return");case 12:if((c=n.filter((function(e){return e&&yn(e.fieldName)})))&&c.length){e.next=15;break}return e.abrupt("return");case 15:return n.forEach((function(e){return d._configureRelatedInfo(e,s)})),e.next=18,ia({relatedInfos:i,layer:s},a);case 18:return l=e.sent,Object.keys(l).forEach((function(e){var t,n=i.get(e.toString()),a=null==(t=l[e])?void 0:t.value;n&&a&&(n.layerInfo=a.data)})),e.next=22,ra({graphic:t,relatedInfos:i,layer:s},a);case 22:u=e.sent,Object.keys(u).forEach((function(e){var t;aa(null==(t=u[e])?void 0:t.value,i.get(e.toString()))}));case 24:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"_configureRelatedInfo",value:function(e,t){var n=this.relatedInfos,a=ta(e.fieldName);if(a){var i=a.layerId,r=a.fieldName;if(i){var o=n.get(i.toString())||function(e,t){var n=function(e,t){if(!t.relationships)return null;var n=null;return t.relationships.some((function(t){return t.id===parseInt(e,10)&&(n=t,!0)})),n}(e,t);if(n){var a="".concat(t.url,"/").concat(n.relatedTableId);return{url:a,queryTask:new Zn.a({url:a,sourceSpatialReference:t.spatialReference}),relation:n,relatedFields:[],outStatistics:[]}}}(i,t);o&&(function(e){var t=e.relatedInfo,n=e.fieldName,a=e.fieldInfo;if(t.relatedFields.push(n),a.statisticType){var i=new Xn.a({statisticType:a.statisticType,onStatisticField:n,outStatisticFieldName:n});t.outStatistics.push(i)}}({relatedInfo:o,fieldName:r,fieldInfo:e}),this.relatedInfos.set(i,o))}}}},{key:"_effectivePopupTemplate",get:function(){return Object(b.g)(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}},{key:"_fieldInfoMap",get:function(){return function(e,t){var n=new Map;return e&&e.forEach((function(e){var a=nn(e.fieldName,t);e.fieldName=a,n.set(a.toLowerCase(),e)})),n}(dn(this._effectivePopupTemplate),this._sourceLayer)}},{key:"_sourceLayer",get:function(){return Yt(this.graphic)}},{key:"graphic",set:function(e){this._set("graphic",e?e.clone():null)}},{key:"spatialReference",get:function(){return this.get("view.spatialReference")||null},set:function(e){void 0!==e?this._override("spatialReference",e):this._clearOverride("spatialReference")}},{key:"map",get:function(){return this.get("view.map")||null},set:function(e){void 0!==e?this._override("map",e):this._clearOverride("map")}},{key:"waitingForContent",get:function(){return!!this._featureAbortController}}]),n}(G.a);Object(h.a)([Object(m.b)()],Fa.prototype,"_featureAbortController",void 0),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["graphic","graphic.sourceLayer.popupTemplate.title","graphic.sourceLayer.popupTemplate.content","graphic.sourceLayer.popupTemplate.expressionInfos","graphic.sourceLayer.popupTemplate.fieldInfos","graphic.sourceLayer.popupTemplate.lastEditInfoEnabled","graphic.sourceLayer.popupTemplate.outFields","graphic.sourceLayer.popupTemplate.relatedRecordsInfo","graphic.popupTemplate.title","graphic.popupTemplate.content","graphic.popupTemplate.expressionInfos","graphic.popupTemplate.fieldInfos","graphic.popupTemplate.lastEditInfoEnabled","graphic.popupTemplate.outFields","graphic.popupTemplate.relatedRecordsInfo","defaultPopupTemplateEnabled"]})],Fa.prototype,"_effectivePopupTemplate",null),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["_effectivePopupTemplate","_sourceLayer"]})],Fa.prototype,"_fieldInfoMap",null),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["graphic.layer","graphic.sourceLayer"]})],Fa.prototype,"_sourceLayer",null),Object(h.a)([Object(m.b)({readOnly:!0})],Fa.prototype,"content",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Fa.prototype,"contentViewModels",void 0),Object(h.a)([Object(m.b)({type:Boolean})],Fa.prototype,"defaultPopupTemplateEnabled",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Fa.prototype,"formattedAttributes",void 0),Object(h.a)([Object(m.b)({type:Lt.a,value:null})],Fa.prototype,"graphic",null),Object(h.a)([Object(m.b)({readOnly:!0})],Fa.prototype,"lastEditInfo",void 0),Object(h.a)([Object(m.b)()],Fa.prototype,"relatedInfos",void 0),Object(h.a)([Object(m.b)({dependsOn:["view"]})],Fa.prototype,"spatialReference",null),Object(h.a)([Object(m.b)({readOnly:!0})],Fa.prototype,"title",void 0),Object(h.a)([Object(m.b)({dependsOn:["view"]})],Fa.prototype,"map",null),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["_featureAbortController"]})],Fa.prototype,"waitingForContent",null),Object(h.a)([Object(m.b)()],Fa.prototype,"view",void 0);var Ea=Fa=Object(h.a)([Object(O.a)("esri.widgets.FeatureViewModel")],Fa),Aa="esri-feature__content-element",Pa={title:!0,content:!0,lastEditedInfo:!0},Sa=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e,a){var i;return Object(l.a)(this,n),(i=t.call(this,e,a))._contentWidgets=[],i.graphic=null,i.defaultPopupTemplateEnabled=!1,i.label=void 0,i.messages=null,i.messagesURIUtils=null,i.spatialReference=null,i.title=null,i.visibleElements=Object(c.a)({},Pa),i.map=null,i.view=null,i.viewModel=new Ea,i}return Object(u.a)(n,[{key:"initialize",value:function(){var e=this;this.own(Object(Ce.a)(this,"viewModel.contentViewModels",(function(){return e._setupContentWidgets()})))}},{key:"destroy",value:function(){this._destroyContentWidgets()}},{key:"castVisibleElements",value:function(e){return Object(c.a)(Object(c.a)({},Pa),e)}},{key:"render",value:function(){var e=this.viewModel.waitingForContent;return Object(Ct.a)("div",{class:this.classes("esri-feature","esri-widget")},Object(Ct.a)("div",{class:"esri-feature__size-container"},this.renderTitle(),e?this.renderLoading():this.renderContentContainer()))}},{key:"setActiveMedia",value:function(e,t){this.viewModel.setActiveMedia(e,t)}},{key:"nextMedia",value:function(e){this.viewModel.nextMedia(e)}},{key:"previousMedia",value:function(e){this.viewModel.previousMedia(e)}},{key:"renderLoading",value:function(){return Object(Ct.a)("div",{key:"loading-container",class:"esri-feature__loading-container"},Object(Ct.a)("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")}))}},{key:"renderContentContainer",value:function(){return this.visibleElements.content?Object(Ct.a)("div",{class:"esri-feature__main-container"},[this.renderContent(),this.renderLastEditInfo()]):null}},{key:"renderTitle",value:function(){var e=this.visibleElements,t=this.title;return e.title?Object(Ct.a)("h4",{class:"esri-feature__title",innerHTML:t}):null}},{key:"renderContent",value:function(){var e=this.viewModel.content;if(!e)return null;if(Array.isArray(e))return e.length?Object(Ct.a)("div",{key:"content-content-elements"},e.map(this.renderContentElement,this)):null;if("string"==typeof e){var t=this._contentWidgets[0];return!t||t.destroyed?null:Object(Ct.a)("div",{key:"content-content"},t.render())}return this.renderNodeContent(e)}},{key:"renderContentElement",value:function(e,t){var n=this.visibleElements;if("boolean"!=typeof n.content&&!n.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);default:return null}}},{key:"renderAttachments",value:function(e){var t=this._contentWidgets[e];if(!t||t.destroyed)return null;var n=t.viewModel,a=n.state,i=n.attachmentInfos;return"loading"===a||i.length>0?Object(Ct.a)("div",{key:this._buildKey("attachments-element",e),class:this.classes("esri-feature__attachments",Aa)},Object(Ct.a)("h2",null,this.messages.attach),t.render()):null}},{key:"renderCustom",value:function(e,t){var n=e.creator,a=this._contentWidgets[t];return!a||a.destroyed?null:n?Object(Ct.a)("div",{key:this._buildKey("custom-element",t),class:Aa},a.render()):null}},{key:"renderFields",value:function(e){var t=this._contentWidgets[e];return!t||t.destroyed?null:Object(Ct.a)("div",{key:this._buildKey("fields-element",e),class:Aa},t.render())}},{key:"renderMedia",value:function(e){var t=this._contentWidgets[e];return!t||t.destroyed?null:Object(Ct.a)("div",{key:this._buildKey("media-element",e),class:Aa},t.render())}},{key:"renderLastEditInfo",value:function(){var e=this.visibleElements,t=this.messages,n=this.viewModel.lastEditInfo;if(!n||!e.lastEditedInfo)return null;var a=n.date,i=n.user,r="edit"===n.type?i?t.lastEditedByUser:t.lastEdited:i?t.lastCreatedByUser:t.lastCreated,o=Object(jt.a)(r,{date:a,user:i});return Object(Ct.a)("div",{key:"edit-info-element",class:this.classes("esri-feature__last-edited-info",Aa)},o)}},{key:"renderText",value:function(e,t){var n=e.text,a=this._contentWidgets[t];return!a||a.destroyed?null:n?Object(Ct.a)("div",{key:this._buildKey("text-element",t),class:this.classes(Aa,"esri-feature__text")},a.render()):null}},{key:"_buildKey",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];return"".concat(e,"__").concat(this.get("viewModel.graphic.uid")||"0","-").concat(n.join("-"))}},{key:"_destroyContentWidgets",value:function(){this._contentWidgets.forEach((function(e){e.viewModel=null,e&&!e.destroyed&&e.destroy()})),this._contentWidgets=[]}},{key:"_setupContentWidgets",value:function(){var e=this;this._destroyContentWidgets();var t=this.get("viewModel.content"),n=this.viewModel.contentViewModels;if(Array.isArray(t))t.forEach((function(t,a){"attachments"===t.type&&(e._contentWidgets[a]=new Rn({displayType:t.displayType,viewModel:n[a]})),"fields"===t.type&&(e._contentWidgets[a]=new Jn({viewModel:n[a]})),"media"===t.type&&(e._contentWidgets[a]=new ja({viewModel:n[a]})),"text"===t.type&&(e._contentWidgets[a]=new zn({viewModel:n[a]})),"custom"===t.type&&(e._contentWidgets[a]=new zn({viewModel:n[a]}))}),this);else{var a=n[0];a&&!a.destroyed&&(this._contentWidgets[0]=new zn({viewModel:a}))}this.scheduleRender()}}]),n}(Et(Tt.a));Object(h.a)([Object(X.a)("viewModel.graphic")],Sa.prototype,"graphic",void 0),Object(h.a)([Object(X.a)("viewModel.defaultPopupTemplateEnabled")],Sa.prototype,"defaultPopupTemplateEnabled",void 0),Object(h.a)([Object(m.b)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Sa.prototype,"label",void 0),Object(h.a)([Object(m.b)(),Object(It.a)(),Object(Mt.a)("esri/widgets/Feature/t9n/Feature")],Sa.prototype,"messages",void 0),Object(h.a)([Object(m.b)(),Object(It.a)(),Object(Mt.a)("esri/widgets/support/t9n/uriUtils")],Sa.prototype,"messagesURIUtils",void 0),Object(h.a)([Object(X.a)("viewModel.spatialReference")],Sa.prototype,"spatialReference",void 0),Object(h.a)([Object(X.a)("viewModel.title")],Sa.prototype,"title",void 0),Object(h.a)([Object(m.b)(),Object(It.a)()],Sa.prototype,"visibleElements",void 0),Object(h.a)([Object(re.a)("visibleElements")],Sa.prototype,"castVisibleElements",null),Object(h.a)([Object(X.a)("viewModel.map")],Sa.prototype,"map",void 0),Object(h.a)([Object(X.a)("viewModel.view")],Sa.prototype,"view",void 0),Object(h.a)([Object(m.b)({type:Ea}),Object(It.a)(["viewModel.waitingForContent","viewModel.content","viewModel.lastEditInfo","viewModel.contentViewModels"])],Sa.prototype,"viewModel",void 0);var La=Sa=Object(h.a)([Object(O.a)("esri.widgets.Feature")],Sa),Va=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i)))._anchorHandles=new Ue.a,e.location=null,e.screenLocation=null,e.screenLocationEnabled=!1,e.view=null,e._anchorHandles.add([Object(Ce.d)(Object(K.a)(e),["screenLocationEnabled","location","view.size","view.stationary"],(function(){return e._updateScreenPointAndHandle()})),Object(Ce.d)(Object(K.a)(e),["view","view.ready"],(function(){return e._wireUpView()}))]),e}return Object(u.a)(n,[{key:"destroy",value:function(){this.view=null,this._anchorHandles&&this._anchorHandles.destroy(),this._anchorHandles=null,this._viewpointHandle=null}},{key:"_wireUpView",value:function(){var e=this,t="view";if(this._anchorHandles.remove(t),this._viewpointHandle=null,this.get("view.ready")){this._setScreenLocation();var n=this.view,a="3d"===n.type?"camera":"viewpoint",i=Object(Ce.c)(n,a,(function(){return e._viewpointChange()}));this._anchorHandles.add(i,t),this._viewpointHandle=i,this._toggleWatchingViewpoint()}}},{key:"_viewpointChange",value:function(){this._setScreenLocation(),this.emit("view-change")}},{key:"_updateScreenPointAndHandle",value:function(){this._setScreenLocation(),this._toggleWatchingViewpoint()}},{key:"_toggleWatchingViewpoint",value:function(){var e=this._viewpointHandle,t=this.location,n=this.screenLocationEnabled;e&&(t&&n?e.resume():e.pause())}},{key:"_setScreenLocation",value:function(){var e=this.location,t=this.view,n=this.screenLocationEnabled,a=this.get("view.ready"),i=n&&e&&a?t.toScreen(e):null;this._set("screenLocation",i)}}]),n}(ee.a.EventedAccessor);Object(h.a)([Object(m.b)()],Va.prototype,"location",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Va.prototype,"screenLocation",void 0),Object(h.a)([Object(m.b)()],Va.prototype,"screenLocationEnabled",void 0),Object(h.a)([Object(m.b)()],Va.prototype,"view",void 0);var Ra=Va=Object(h.a)([Object(O.a)("esri.widgets.support.AnchorElementViewModel")],Va),Na=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).visible=!1,a}return n}(Ra);Object(h.a)([Object(m.b)()],Na.prototype,"visible",void 0);var Da=Na=Object(h.a)([Object(O.a)("esri.widgets.CompassViewModel")],Na),Ba=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e,a){var i;return Object(l.a)(this,n),(i=t.call(this,e,a))._animationDelay=500,i._animationPromise=null,i.location=null,i.view=null,i.viewModel=new Da,i.visible=!1,i}return Object(u.a)(n,[{key:"initialize",value:function(){var e=this;this.own([Object(Ce.d)(this,"visible",(function(t){return e._visibleChange(t)}))])}},{key:"destroy",value:function(){this._animationPromise=null}},{key:"show",value:function(e){var t=this,n=e.location,a=e.promise;n&&(this.viewModel.location=n),this.visible=!0;a&&a.catch((function(){})).then((function(){return t.hide()}))}},{key:"hide",value:function(){this.visible=!1}},{key:"render",value:function(){var e,t=this.visible,n=!!this.viewModel.screenLocation,a=(e={},Object(gt.a)(e,"esri-spinner--start",t&&n),Object(gt.a)(e,"esri-spinner--finish",!t&&n),e),i=this._getPositionStyles();return Object(Ct.a)("div",{class:this.classes("esri-spinner",a),styles:i})}},{key:"_visibleChange",value:function(e){var t=this;if(e)this.viewModel.screenLocationEnabled=!0;else{var n=Object(k.a)(this._animationDelay);this._animationPromise=n,n.catch((function(){})).then((function(){t._animationPromise===n&&(t.viewModel.screenLocationEnabled=!1,t._animationPromise=null)}))}}},{key:"_getPositionStyles",value:function(){var e=this.viewModel,t=e.screenLocation,n=e.view;if(!n||!t)return{};var a=n.padding;return{left:t.x-a.left+"px",top:t.y-a.top+"px"}}}]),n}(Tt.a);Object(h.a)([Object(X.a)("viewModel.location")],Ba.prototype,"location",void 0),Object(h.a)([Object(X.a)("viewModel.view")],Ba.prototype,"view",void 0),Object(h.a)([Object(m.b)({type:Da}),Object(It.a)(["viewModel.screenLocation","viewModel.screenLocationEnabled"])],Ba.prototype,"viewModel",void 0),Object(h.a)([Object(X.a)("viewModel.visible")],Ba.prototype,"visible",void 0);var za=Ba=Object(h.a)([Object(O.a)("esri.widgets.Spinner")],Ba),Ua=n(65),Ha=n(48),Wa=(n(86),n(244)),qa=n(419),Ga=n(507);function Ka(e){return e&&"function"==typeof e.highlight}var Ja=new qa.a({id:"zoom-to-feature",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"}),$a=new qa.a({id:"remove-selected-feature",title:"{messages.remove}",className:"esri-icon-trash"}),Xa=n(516),Ya=te.a.ofType({key:"type",defaultKeyValue:"button",base:Wa.a,typeMap:{button:qa.a,toggle:Ga.a}}),Za=v.a.getLogger("esri.widgets.Popup.PopupViewModel"),Qa=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e))._handles=new Ue.a,a._pendingPromises=new Set,a._zoomToLocation=null,a._fetchFeaturesController=null,a.actions=new Ya([Ja.clone()]),a.defaultPopupTemplateEnabled=!1,a.autoCloseEnabled=!1,a.autoOpenEnabled=!0,a.content=null,a.featureViewModels=[],a.highlightEnabled=!0,a.title=null,a.updateLocationEnabled=!1,a.view=null,a.visible=!1,a.zoomFactor=4,a}return Object(u.a)(n,[{key:"initialize",value:function(){var e=this;this._handles.add([Object(Ce.a)(this,["autoOpenEnabled","view"],(function(){return e._autoOpenEnabledChange()})),this.on("view-change",(function(){return e._autoClose()})),Object(Ce.d)(this,["highlightEnabled","selectedFeature","visible","view"],(function(){return e._highlightFeature()})),Object(Ce.d)(this,"view.animation.state",(function(t){return e._animationStateChange(t)})),Object(Ce.d)(this,"location",(function(t){return e._locationChange(t)})),Object(Ce.d)(this,"selectedFeature",(function(t){return e._selectedFeatureChange(t)})),this.on("trigger-action",(function(t){return function(e){var t=e.event,n=e.view,a=t.action,i=n&&n.popup;if(!a)return Object(k.r)(new _.a("trigger-action:missing-arguments","Event has no action"));if(!i)return Object(k.r)(new _.a("trigger-action:missing-arguments","view.popup is missing"));var r=a.disabled,o=a.id;if(!o)return Object(k.r)(new _.a("trigger-action:invalid-action","action.id is missing"));if(r)return Object(k.r)(new _.a("trigger-action:invalid-action","Action is disabled"));if(o===Ja.id)return i.viewModel.zoomToLocation();if(o===$a.id){i.close();var s=i.selectedFeature;if(!s)return Object(k.r)(new _.a("trigger-action:".concat($a.id),"selectedFeature is required",{selectedFeature:s}));var c=s.sourceLayer;return c?c.remove(s):n.graphics.remove(s),Object(k.s)()}return Object(k.s)()}({event:t,view:e.view})})),Object(Ce.f)(this,"waitingForResult",(function(){return e._waitingForResultChange()})),Object(Ce.d)(this,["features","view","view.map","view.spatialReference"],(function(){return e._updateFeatureVMs()}))])}},{key:"destroy",value:function(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.view=null}},{key:"centerAtLocation",value:function(){var e=this.view,t=this._getSelectedTarget();if(!t){var n=new _.a("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e});return Za.error(n),Object(k.r)(n)}return this.callGoTo({target:{target:t,scale:e.scale}})}},{key:"clear",value:function(){this.set({promises:[],features:[],content:null,title:null,location:null})}},{key:"fetchFeatures",value:function(e,t){var n=this.view;if(!n||!e){var a=new _.a("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:n});return Za.error(a),Object(k.r)(a)}return n.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}},{key:"open",value:function(e){var t=Object(c.a)(Object(c.a)({updateLocationEnabled:!1,promises:[],fetchFeatures:!1},e),{},{visible:!0}),n=t.fetchFeatures;delete t.fetchFeatures,n&&this._setFetchFeaturesPromises(t.location),this.set(t)}},{key:"triggerAction",value:function(e){var t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}},{key:"next",value:function(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}},{key:"previous",value:function(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}},{key:"zoomToLocation",value:function(){var e=this,t=this.location,n=this.selectedFeature,a=this.view,i=this.zoomFactor,r=this._getSelectedTarget();if(!r){var o=new _.a("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:r,view:a});return Za.error(o),Object(k.r)(o)}var s=a.scale/i,c=this.get("selectedFeature.geometry")||t,l=c&&"point"===c.type&&this._isZoomScreenSize(n);Ja.active=!0,Ja.disabled=!0;var u=this.callGoTo({target:{target:r,scale:l?s:void 0}}).catch((function(){Ja.active=!1,Ja.disabled=!1,e._zoomToLocation=null})).then((function(){l&&(e.location=c)}));return this._zoomToLocation=u,u}},{key:"_animationStateChange",value:function(e){this._zoomToLocation||(Ja.disabled="waiting-for-target"===e)}},{key:"_locationChange",value:function(e){var t=this.selectedFeature;this.updateLocationEnabled&&e&&(!t||t.geometry)&&this.centerAtLocation()}},{key:"_selectedFeatureChange",value:function(e){var t=this;if(e){var n=this.location,a=this.updateLocationEnabled,i=this.view;!a&&n||!e.geometry?a&&!e.geometry&&this.centerAtLocation().then((function(){t.location=i.center.clone()})):this.location=Object(b.m)(this._getPointFromGeometry(e.geometry))}}},{key:"_waitingForResultChange",value:function(){!this.featureCount&&this.promises&&(this.visible=!1)}},{key:"_setFetchFeaturesPromises",value:function(e){var t=this;return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then((function(e){var n=e.clientOnlyGraphics,a=e.promisesPerLayerView,i=Object(k.s)(n),r=a.map((function(e){return e.promise}));t.promises=[i].concat(Object(Pe.a)(r))}))}},{key:"_destroyFeatureVMs",value:function(){this.featureViewModels.forEach((function(e){return e&&!e.destroyed&&e.destroy()})),this._set("featureViewModels",[])}},{key:"_updateFeatureVMs",value:function(){var e=this,t=this.features,n=this.featureViewModels;if(this._destroyFeatureVMs(),t&&t.length){var a=n.slice(0),i=[];t.forEach((function(t,n){if(t){var r=null;if(a.some((function(e,n){return e&&e.graphic===t&&(r=e,a.splice(n,1)),!!r})),r)i[n]=r;else{var o,s,c=new Ea({defaultPopupTemplateEnabled:e.defaultPopupTemplateEnabled,graphic:t,spatialReference:null==(o=e.view)?void 0:o.spatialReference,map:null==(s=e.view)?void 0:s.map});i[n]=c}}})),a.forEach((function(e){return e&&!e.destroyed&&e.destroy()})),this._set("featureViewModels",i)}}},{key:"_getScreenPoint",value:function(e){var t=this.view;return t&&e&&"function"==typeof t.toScreen?t.toScreen(e):null}},{key:"_getSelectedTarget",value:function(){var e=this.selectedFeature,t=this.location,n=this.view;return n?"3d"===n.type?e||t:this.get("selectedFeature.geometry")||t:null}},{key:"_autoOpenEnabledChange",value:function(){var e=this,t="auto-fetch-features",n=this._handles,a=this.autoOpenEnabled;if(n.remove(t),a&&this.view){var i=this.view.on("click",(function(t){"mouse"===t.pointerType&&0!==t.button||e._fetchFeaturesAndOpen(t)}),dt.WIDGET);n.add(i,t)}}},{key:"_cancelFetchingFeatures",value:function(){var e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}},{key:"_fetchFeaturesWithController",value:function(e,t){var n=this;this._cancelFetchingFeatures();var a=Object(k.d)(),i=a.signal;this._fetchFeaturesController=a,this.notifyChange("waitingForResult");var r=this.fetchFeatures(e,{signal:i,event:t});return r.catch((function(){})).then((function(){n._fetchFeaturesController=null,n.notifyChange("waitingForResult")})),r}},{key:"_fetchFeaturesAndOpen",value:function(e){var t=e.screenPoint,n=e.mapPoint,a=this.view;this._fetchFeaturesWithController(t,e).then((function(e){var t=e.clientOnlyGraphics,i=e.promisesPerLayerView,r=e.location,o=[Object(k.s)(t)].concat(Object(Pe.a)(i.map((function(e){return e.promise}))));return a.popup.open({location:r||n,promises:o}),e}))}},{key:"_updatePendingPromises",value:function(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}},{key:"_autoClose",value:function(){this.autoCloseEnabled&&(this.visible=!1)}},{key:"_isZoomScreenSize",value:function(e){var t=this.view;if("3d"!==t.type||!e||"esri.Graphic"!==e.declaredClass)return!0;var n=t.getViewForGraphic(e);if(n&&"whenGraphicBounds"in n){var a=!1;return n.whenGraphicBounds(e,{useViewElevation:!0}).then((function(e){a=!e||!e.boundingBox||e.boundingBox[0]===e.boundingBox[3]&&e.boundingBox[1]===e.boundingBox[4]&&e.boundingBox[2]===e.boundingBox[5]})).catch((function(){var t=new _.a("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:e});Za.error(t)})),a}return!0}},{key:"_getPointFromGeometry",value:function(e){return Object(b.f)(e)?null:"point"===e.type?e:"extent"===e.type?e.center:"polygon"===e.type?e.centroid:"multipoint"===e.type||"polyline"===e.type?e.extent.center:null}},{key:"_getLayerView",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.when();case 2:return e.abrupt("return",t.whenLayerView(n));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_highlightFeature",value:function(){var e=Object(s.a)(o.a.mark((function e(){var t,n,a,i,r,s,c,l,u,d,p,h;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t="highlight",this._handles.remove(t),n=this.selectedFeature,a=this.highlightEnabled,i=this.view,r=this.visible,n&&i&&a&&r){e.next=5;break}return e.abrupt("return");case 5:if((s=n.layer)&&s instanceof C.a){e.next=8;break}return e.abrupt("return");case 8:return c=this._getLayerView(i,s),this._highlightPromise=c,e.next=12,c;case 12:if((l=e.sent)&&Ka(l)&&this._highlightPromise===c&&this.selectedFeature&&this.highlightEnabled&&this.visible){e.next=15;break}return e.abrupt("return");case 15:u="objectIdField"in s&&s.objectIdField,d=n.attributes,p=d&&u&&d[u],h=l.highlight(p||n),this._handles.add(h,t);case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_updateFeatures",value:function(e){var t=this.features;if(e&&e.length)if(t.length){var n=e.filter((function(e){return-1===t.indexOf(e)}));this.features=t.concat(n)}else this.features=e}},{key:"active",get:function(){return!(!this.visible||this.waitingForResult)}},{key:"allActions",get:function(){var e=this._get("allActions")||new Ya;e.removeAll();var t=this.selectedFeature&&("function"==typeof this.selectedFeature.getEffectivePopupTemplate&&this.selectedFeature.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled)||this.selectedFeature.popupTemplate),n=t&&t.actions,a=t&&t.overwriteActions?n:n?n.concat(this.actions):this.actions;return a&&a.filter(Boolean).forEach((function(t){return e.add(t)})),e}},{key:"featureCount",get:function(){return this.features.length}},{key:"features",get:function(){return this._get("features")||[]},set:function(e){var t=e||[];this._set("features",t);var n=this.pendingPromisesCount,a=this.promiseCount,i=this.selectedFeatureIndex,r=a&&t.length;r&&n&&-1===i?this.selectedFeatureIndex=0:r&&-1!==i||(this.selectedFeatureIndex=t.length?0:-1)}},{key:"location",get:function(){return this._get("location")||null},set:function(e){var t=this.get("view.spatialReference.isWebMercator");e&&e.get("spatialReference.isWGS84")&&t&&(e=Object(Ua.b)(e)),this._set("location",e)}},{key:"pendingPromisesCount",get:function(){return this._pendingPromises.size}},{key:"waitingForResult",get:function(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}},{key:"promiseCount",get:function(){return this.promises.length}},{key:"promises",get:function(){return this._get("promises")||[]},set:function(e){var t=this;if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach((function(e){t._pendingPromises.add(e),e.then((function(n){t._pendingPromises.has(e)&&t._updateFeatures(n),t._updatePendingPromises(e)}),(function(){return t._updatePendingPromises(e)}))})),this.notifyChange("pendingPromisesCount")}},{key:"selectedFeature",get:function(){var e=this.features,t=this.selectedFeatureIndex;return-1===t?null:e[t]||null}},{key:"selectedFeatureIndex",get:function(){var e=this._get("selectedFeatureIndex");return"number"==typeof e?e:-1},set:function(e){var t=this.featureCount;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this._set("selectedFeatureIndex",e)}},{key:"selectedFeatureViewModel",get:function(){return this.featureViewModels[this.selectedFeatureIndex]||null}},{key:"state",get:function(){return this.get("view.ready")?"ready":"disabled"}}]),n}(Object(Xa.a)(Ra));Object(h.a)([Object(m.b)({type:Ya})],Qa.prototype,"actions",void 0),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["visible","waitingForResult"]})],Qa.prototype,"active",null),Object(h.a)([Object(m.b)({dependsOn:["actions.length","selectedFeature.sourceLayer.popupTemplate.actions.length","selectedFeature.sourceLayer.popupTemplate.overwriteActions","selectedFeature.popupTemplate.actions.length","selectedFeature.popupTemplate.overwriteActions"],readOnly:!0})],Qa.prototype,"allActions",null),Object(h.a)([Object(m.b)({type:Boolean})],Qa.prototype,"defaultPopupTemplateEnabled",void 0),Object(h.a)([Object(m.b)()],Qa.prototype,"autoCloseEnabled",void 0),Object(h.a)([Object(m.b)()],Qa.prototype,"autoOpenEnabled",void 0),Object(h.a)([Object(m.b)()],Qa.prototype,"content",void 0),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["features"]})],Qa.prototype,"featureCount",null),Object(h.a)([Object(m.b)()],Qa.prototype,"features",null),Object(h.a)([Object(m.b)({readOnly:!0})],Qa.prototype,"featureViewModels",void 0),Object(h.a)([Object(m.b)()],Qa.prototype,"highlightEnabled",void 0),Object(h.a)([Object(m.b)({type:Ha.a})],Qa.prototype,"location",null),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["promises"]})],Qa.prototype,"pendingPromisesCount",null),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["featureCount","pendingPromisesCount"]})],Qa.prototype,"waitingForResult",null),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["promises"]})],Qa.prototype,"promiseCount",null),Object(h.a)([Object(m.b)()],Qa.prototype,"promises",null),Object(h.a)([Object(m.b)({value:null,readOnly:!0,dependsOn:["features","selectedFeatureIndex","updateLocationEnabled"]})],Qa.prototype,"selectedFeature",null),Object(h.a)([Object(m.b)({value:-1})],Qa.prototype,"selectedFeatureIndex",null),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["featureViewModels","selectedFeatureIndex"]})],Qa.prototype,"selectedFeatureViewModel",null),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["view.ready"]})],Qa.prototype,"state",null),Object(h.a)([Object(m.b)()],Qa.prototype,"title",void 0),Object(h.a)([Object(m.b)()],Qa.prototype,"updateLocationEnabled",void 0),Object(h.a)([Object(m.b)()],Qa.prototype,"view",void 0),Object(h.a)([Object(m.b)()],Qa.prototype,"visible",void 0),Object(h.a)([Object(m.b)()],Qa.prototype,"zoomFactor",void 0),Object(h.a)([Object(m.b)()],Qa.prototype,"centerAtLocation",null),Object(h.a)([Object(m.b)()],Qa.prototype,"zoomToLocation",null);var ei=Qa=Object(h.a)([Object(O.a)("esri.widgets.Popup.PopupViewModel")],Qa),ti="esri-icon-left-triangle-arrow",ni="esri-icon-right-triangle-arrow",ai="esri-icon-loading-indicator",ii="esri-popup--shadow",ri="esri-popup__header-container",oi="esri-popup__button",si="esri-popup__icon",ci={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};function li(e,t){return void 0===t?"esri-popup__".concat(e):"esri-popup__".concat(e,"-").concat(t)}var ui=v.a.getLogger("esri.widgets.Popup"),di={closeButton:!0,featureNavigation:!0},pi=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e,a){var i;return Object(l.a)(this,n),(i=t.call(this,e,a))._blurClose=!1,i._blurContainer=!1,i._containerNode=null,i._mainContainerNode=null,i._featureMenuNode=null,i._actionsMenuNode=null,i._focusClose=!1,i._focusContainer=!1,i._focusDockButton=!1,i._focusFeatureMenuButton=!1,i._focusActionsMenuButton=!1,i._focusFirstFeature=!1,i._focusFirstAction=!1,i._handles=new Ue.a,i._pointerOffsetInPx=16,i._spinner=null,i._feature=null,i._displaySpinnerThrottled=_t((function(){return i._displaySpinner()}),0),i.actions=null,i.alignment="auto",i.autoCloseEnabled=null,i.autoOpenEnabled=null,i.defaultPopupTemplateEnabled=null,i.content=null,i.collapsed=!1,i.collapseEnabled=!0,i.dockEnabled=!1,i.featureCount=null,i.featureMenuOpen=!1,i.features=null,i.goToOverride=null,i.highlightEnabled=null,i.location=null,i.label=void 0,i.maxInlineActions=3,i.messages=null,i.messagesCommon=null,i.promises=null,i.selectedFeature=null,i.selectedFeatureIndex=null,i.spinnerEnabled=!0,i.title=null,i.updateLocationEnabled=null,i.view=null,i.viewModel=new ei,i.visible=null,i.visibleElements=Object(c.a)({},di),i._addSelectedFeatureIndexHandle(),i.own([Object(Ce.d)(Object(K.a)(i),"viewModel.screenLocation",(function(){return i._positionContainer()})),Object(Ce.d)(Object(K.a)(i),["viewModel.active","dockEnabled"],(function(){return i._toggleScreenLocationEnabled()})),Object(Ce.d)(Object(K.a)(i),"viewModel.screenLocation",(function(e,t){!!e!=!!t&&i.reposition()})),Object(Ce.d)(Object(K.a)(i),["viewModel.view.padding","viewModel.view.size","viewModel.active","viewModel.location","alignment"],(function(){return i.reposition()})),Object(Ce.d)(Object(K.a)(i),"spinnerEnabled",(function(e){return i._spinnerEnabledChange(e)})),Object(Ce.d)(Object(K.a)(i),"viewModel.view.size",(function(e,t){return i._updateDockEnabledForViewSize(e,t)})),Object(Ce.d)(Object(K.a)(i),"viewModel.view",(function(e,t){return i._viewChange(e,t)})),Object(Ce.d)(Object(K.a)(i),"viewModel.view.ready",(function(e,t){return i._viewReadyChange(e,t)})),Object(Ce.d)(Object(K.a)(i),["viewModel.waitingForResult","viewModel.location"],(function(){i._hideSpinner(),i._displaySpinnerThrottled()})),Object(Ce.d)(Object(K.a)(i),"selectedFeatureWidget.viewModel.title",(function(e){return i._setTitleFromFeatureWidget(e)})),Object(Ce.d)(Object(K.a)(i),["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.waitingForContent"],(function(){return i._setContentFromFeatureWidget()})),Object(Ce.f)(Object(K.a)(i),"collapsed",(function(){var e,t;"xsmall"===(null==(e=i.viewModel)||null==(t=e.view)?void 0:t.widthBreakpoint)&&i.viewModel.active&&i.collapseEnabled&&i.viewModel.centerAtLocation()})),Object(Ce.b)(Object(K.a)(i),"viewModel.allActions","change",(function(){return i._watchActions()})),Object(Ce.a)(Object(K.a)(i),"viewModel.allActions",(function(){return i._watchActions()}))]),i}return Object(u.a)(n,[{key:"destroy",value:function(){this._destroySelectedFeatureWidget(),this._destroySpinner(),this._handles&&this._handles.destroy(),this._handles=null}},{key:"castVisibleElements",value:function(e){return Object(c.a)(Object(c.a)({},di),e)}},{key:"blur",value:function(){this.viewModel.active||ui.warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}},{key:"clear",value:function(){this.viewModel.clear()}},{key:"close",value:function(){this.visible=!1}},{key:"fetchFeatures",value:function(e,t){return this.viewModel.fetchFeatures(e,t)}},{key:"focus",value:function(){this.viewModel.active||ui.warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}},{key:"next",value:function(){return this.viewModel.next()}},{key:"open",value:function(e){var t,n;this._handles.remove("selected-index");var a=!!e&&!!e.featureMenuOpen,i=!!e&&!!e.actionsMenuOpen,r={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:i,featureMenuOpen:a};"xsmall"===(null==(t=this.viewModel)||null==(n=t.view)?void 0:n.widthBreakpoint)&&(r.collapsed=!0),this.set(r),this.viewModel.open(e),this._addSelectedFeatureIndexHandle()}},{key:"previous",value:function(){return this.viewModel.previous()}},{key:"reposition",value:function(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}},{key:"triggerAction",value:function(e){this.viewModel.triggerAction(e)}},{key:"render",value:function(){var e,t,n,a,i,r=this.actionsMenuOpen,o=this.dockEnabled,s=this.featureMenuVisible,c=this.dividedActions,l=this.currentAlignment,u=this.currentDockPosition,d=this.viewModel.active,p=c.menuActions,h=d&&p.length>1&&r,f=d&&o,b=d&&!o,v=null==(t=this.selectedFeature)||null==(n=t.layer)?void 0:n.title,y=null==(a=this.selectedFeature)||null==(i=a.layer)?void 0:i.id,m=(e={},Object(gt.a)(e,"esri-popup--aligned-top-center","top-center"===l),Object(gt.a)(e,"esri-popup--aligned-bottom-center","bottom-center"===l),Object(gt.a)(e,"esri-popup--aligned-top-left","top-left"===l),Object(gt.a)(e,"esri-popup--aligned-bottom-left","bottom-left"===l),Object(gt.a)(e,"esri-popup--aligned-top-right","top-right"===l),Object(gt.a)(e,"esri-popup--aligned-bottom-right","bottom-right"===l),Object(gt.a)(e,"esri-popup--is-docked",f),Object(gt.a)(e,ii,b),Object(gt.a)(e,"esri-popup--is-docked-top-left","top-left"===u),Object(gt.a)(e,"esri-popup--is-docked-top-center","top-center"===u),Object(gt.a)(e,"esri-popup--is-docked-top-right","top-right"===u),Object(gt.a)(e,"esri-popup--is-docked-bottom-left","bottom-left"===u),Object(gt.a)(e,"esri-popup--is-docked-bottom-center","bottom-center"===u),Object(gt.a)(e,"esri-popup--is-docked-bottom-right","bottom-right"===u),Object(gt.a)(e,"esri-popup--feature-menu-open",s),Object(gt.a)(e,"esri-popup--actions-menu-open",h),e);return Object(Ct.a)("div",{class:this.classes("esri-popup",m),role:"presentation","data-layer-title":v,"data-layer-id":y,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},d?[this.renderMainContainer(),this.renderPointer()]:null)}},{key:"renderLoadingIcon",value:function(){return Object(Ct.a)("span",{"aria-hidden":"true",class:this.classes(si,ai,"esri-rotating")})}},{key:"renderNavigationLoading",value:function(){var e=this.messagesCommon;return this.viewModel.pendingPromisesCount?Object(Ct.a)("div",{key:li("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}},{key:"renderPreviousIcon",value:function(){var e,t=Object(wt.e)(),n=(e={},Object(gt.a)(e,ni,t),Object(gt.a)(e,"esri-popup__pagination-previous-icon--rtl",t),Object(gt.a)(e,ti,!t),Object(gt.a)(e,"esri-popup__pagination-previous-icon",!t),e);return Object(Ct.a)("span",{"aria-hidden":"true",class:this.classes(si,n)})}},{key:"renderPreviousButton",value:function(){var e=this.messages;return Object(Ct.a)("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(oi,"esri-popup__pagination-previous"),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}},{key:"renderNextIcon",value:function(){var e,t=Object(wt.e)(),n=(e={},Object(gt.a)(e,ti,t),Object(gt.a)(e,"esri-popup__pagination-next-icon--rtl",t),Object(gt.a)(e,ni,!t),Object(gt.a)(e,"esri-popup__pagination-next-icon",!t),e);return Object(Ct.a)("span",{"aria-hidden":"true",class:this.classes(si,n)})}},{key:"renderNextButton",value:function(){var e=this.messages;return Object(Ct.a)("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(oi,"esri-popup__pagination-next"),"aria-label":e.next,title:e.next},this.renderNextIcon())}},{key:"renderFeatureMenuButton",value:function(){var e=this.featureMenuOpen,t=this.featureMenuId,n=this.messagesCommon,a=this.viewModel,i=a.featureCount,r=a.selectedFeatureIndex;return Object(Ct.a)("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(oi,"esri-popup__feature-menu-button"),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e,"aria-label":n.menu,title:n.menu},this._getPageText(i,r))}},{key:"renderNavigationButtons",value:function(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}},{key:"renderDockIcon",value:function(){var e,t=this.dockEnabled,n=this._wouldDockTo(),a=(e={},Object(gt.a)(e,"esri-icon-minimize",t),Object(gt.a)(e,"esri-popup__icon--dock-icon",!t),Object(gt.a)(e,"esri-icon-dock-right",!t&&("top-right"===n||"bottom-right"===n)),Object(gt.a)(e,"esri-icon-dock-left",!t&&("top-left"===n||"bottom-left"===n)),Object(gt.a)(e,"esri-icon-maximize",!t&&"top-center"===n),Object(gt.a)(e,"esri-icon-dock-bottom",!t&&"bottom-center"===n),e);return Object(Ct.a)("span",{"aria-hidden":"true",class:this.classes(a,si)})}},{key:"renderDockButton",value:function(){var e,t,n,a=this.dockEnabled,i=this.messages,r=null==(e=this.viewModel)||null==(t=e.view)?void 0:t.widthBreakpoint,o=a?i.undock:i.dock;return"xsmall"!==r&&null!=(n=this.dockOptions)&&n.buttonEnabled?Object(Ct.a)("div",{role:"button","aria-label":o,title:o,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(oi,"esri-popup__button--dock")},this.renderDockIcon()):null}},{key:"renderTitle",value:function(){var e=this.viewModel.title,t=this.titleId,n=this.collapsible,a=this.contentCollapsed,i=this.messagesCommon,r=Object(gt.a)({},"esri-popup__header-container--button",n),o=Object(Ct.a)("h2",{class:"esri-popup__header-title",innerHTML:e}),s=n?Object(Ct.a)("button",{key:"".concat(e,"--collapsible"),id:t,title:a?i.expand:i.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(ri,r),"aria-expanded":a?"false":"true",onclick:this._toggleCollapsed},o):Object(Ct.a)("div",{key:e,id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(ri,r)},o);return e?s:null}},{key:"renderCloseIcon",value:function(){return Object(Ct.a)("span",{"aria-hidden":"true",class:this.classes(si,"esri-icon-close")})}},{key:"renderCloseButton",value:function(){var e=this.visibleElements,t=this.messagesCommon;return e.closeButton?Object(Ct.a)("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:oi,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}},{key:"renderHeader",value:function(){return Object(Ct.a)("header",{class:"esri-popup__header"},this.renderTitle(),Object(Ct.a)("div",{class:"esri-popup__header-buttons"},this.renderDockButton(),this.renderCloseButton()))}},{key:"renderContentContainer",value:function(){var e=this.contentId,t=this.hasContent,n=this.contentCollapsed,a=this.viewModel.content;return t&&!n?Object(Ct.a)("article",{key:a,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:"esri-popup__content"},this.renderContent()):null}},{key:"renderActionsMenuButton",value:function(){var e=this.actionsMenuId,t=this.actionsMenuButtonId,n=this.actionsMenuOpen,a=this.dividedActions,i=this.messagesCommon,r=n?i.close:i.open;return a.menuActions.length?Object(Ct.a)("div",{key:li("actions-menu-button"),class:this.classes(oi,"esri-popup__actions-menu-button"),role:"button",id:t,"aria-haspopup":"true","aria-controls":n?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":r,title:r},Object(Ct.a)("span",{"aria-hidden":"true",class:"esri-icon-handle-horizontal"})):null}},{key:"renderMenuActions",value:function(){var e=this,t=this.actionsMenuId,n=this.actionsMenuButtonId,a=this.actionsMenuOpen,i=this.dividedActions,r=i.menuActions,o=i.inlineActions;return r.length&&a?Object(Ct.a)("ul",{id:t,role:"menu","aria-labelledby":n,key:li("actions"),class:"esri-popup__actions",bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},r.toArray().map((function(t,n){return e.renderAction({action:t,index:n+o.length,type:"menu-item"})}))):null}},{key:"renderInlineActions",value:function(){var e=this,t=this.dividedActions.inlineActions;return!!t.length&&t.toArray().map((function(t,n){return e.renderAction({action:t,index:n,type:"inline"})}))}},{key:"renderInlineActionsContainer",value:function(){var e=this.dividedActions,t=e.inlineActions,n=e.menuActions,a=!!t.length,i=!!n.length;return a||i?Object(Ct.a)("div",{key:"inline-actions-container","data-inline-actions":a.toString(),"data-menu-actions":i.toString(),class:"esri-popup__inline-actions-container"},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}},{key:"renderNavigation",value:function(){return this.featureNavigationVisible?Object(Ct.a)("section",{key:li("navigation"),class:this.classes("esri-popup__navigation")},this.renderNavigationButtons()):null}},{key:"renderFooter",value:function(){var e,t=this.featureNavigationVisible,n=this.dividedActions,a=n.inlineActions,i=n.menuActions,r=!!a.length,o=!!i.length,s=(e={},Object(gt.a)(e,"esri-popup__footer--has-pagination",t),Object(gt.a)(e,"esri-popup__footer--has-actions",r),Object(gt.a)(e,"esri-popup__footer--has-actions-menu",o),e);return t||r?Object(Ct.a)("div",{key:li("feature-buttons"),class:this.classes("esri-popup__footer",s)},this.renderInlineActionsContainer(),this.renderNavigation()):null}},{key:"renderFeatureMenuContainer",value:function(){var e=this.messages,t=this.viewModel.featureViewModels,n=Object(jt.a)(e.selectedFeatures,{total:t.length});return Object(Ct.a)("section",{key:li("menu"),class:"esri-popup__feature-menu"},Object(Ct.a)("h2",{class:"esri-popup__feature-menu-header"},n),Object(Ct.a)("nav",{class:"esri-popup__feature-menu-viewport",afterCreate:this._featureMenuViewportNodeUpdated,afterUpdate:this._featureMenuViewportNodeUpdated},this.renderFeatureMenu()))}},{key:"renderPointer",value:function(){return this.dockEnabled?null:Object(Ct.a)("div",{key:li("pointer"),class:"esri-popup__pointer",role:"presentation"},Object(Ct.a)("div",{class:this.classes("esri-popup__pointer-direction",ii)}))}},{key:"renderMainContainer",value:function(){var e,t=this.dockEnabled,n=this.currentAlignment,a=this.currentDockPosition,i=this.titleId,r=this.contentId,o=this.collapsible,s=this.hasContent,c=this.contentCollapsed,l=this.visibleElements,u=this.viewModel.title,d="bottom-left"===n||"bottom-center"===n||"bottom-right"===n||"top-left"===a||"top-center"===a||"top-right"===a,p="top-left"===n||"top-center"===n||"top-right"===n||"bottom-left"===a||"bottom-center"===a||"bottom-right"===a,h=(e={},Object(gt.a)(e,ii,t),Object(gt.a)(e,"esri-popup--is-collapsible",o),Object(gt.a)(e,"esri-popup--is-collapsed",c),e);return Object(Ct.a)("div",{class:this.classes("esri-popup__main-container","esri-widget",h),tabIndex:l.closeButton?null:-1,role:"dialog","aria-labelledby":u?i:"","aria-describedby":s&&!c?r:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},d?this.renderFooter():null,d?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),p?this.renderFooter():null,p?this.renderFeatureMenuContainer():null)}},{key:"renderContent",value:function(){var e,t=null==(e=this.viewModel)?void 0:e.content;return t?"string"==typeof t?Object(Ct.a)("div",{key:t,innerHTML:t}):this.renderNodeContent(t):null}},{key:"renderActionText",value:function(e){return Object(Ct.a)("span",{key:"text",class:"esri-popup__action-text"},e)}},{key:"renderActionIcon",value:function(e){var t,n=this._getActionClass(e),a=this._getActionImage(e),i=(t={},Object(gt.a)(t,ai,e.active),Object(gt.a)(t,"esri-rotating",e.active),Object(gt.a)(t,si,!!n),Object(gt.a)(t,"esri-popup__action-image",!e.active&&!!a),t);return n&&(i[n]=!e.active),Object(Ct.a)("span",{key:"icon","aria-hidden":"true",class:this.classes(si,i),styles:this._getIconStyles(a)})}},{key:"renderAction",value:function(e){var t,n=e.action,a=e.index,i=e.type,r=this._getActionTitle(n),o=(t={},Object(gt.a)(t,"esri-popup__action","toggle"!==n.type),Object(gt.a)(t,"esri-popup__action-toggle","toggle"===n.type),Object(gt.a)(t,"esri-popup__action-toggle--on","toggle"===n.type&&n.value),Object(gt.a)(t,"esri-popup__button--disabled",n.disabled),t),s=[this.renderActionIcon(n),this.renderActionText(r)],c="menu-item"===i?Object(Ct.a)("li",{key:n.uid,role:"menuitem",tabIndex:0,title:r,"aria-label":r,class:this.classes(oi,o),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":a,onclick:this._triggerAction,onkeydown:this._triggerAction},s):Object(Ct.a)("div",{key:n.uid,role:"button",tabIndex:0,title:r,"aria-label":r,class:this.classes(oi,o),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":a,onclick:this._triggerAction,onkeydown:this._triggerAction},s);return n.visible?c:null}},{key:"renderFeatureMenuItem",value:function(e,t){var n=this.messages,a=this.messagesCommon,i=this.viewModel,r=i.selectedFeatureIndex,o=e===i.selectedFeatureViewModel,s=Object(gt.a)({},"esri-popup__feature-menu-item--selected",o),c=o?Object(Ct.a)("span",{key:li("feature-menu-selected-feature-".concat(r)),title:n.selectedFeature,"aria-label":n.selectedFeature,class:"esri-icon-check-mark"}):null,l=Object(Ct.a)("span",{innerHTML:e.title||a.untitled});return Object(Ct.a)("li",{role:"menuitem",tabIndex:-1,key:li("feature-menu-feature-".concat(r)),class:this.classes(s,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":t,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},Object(Ct.a)("span",{class:"esri-popup__feature-menu-title"},l,c))}},{key:"renderFeatureMenu",value:function(){var e=this,t=this.featureMenuId,n=this.viewModel.featureViewModels;return n.length>1?Object(Ct.a)("ol",{class:"esri-popup__feature-menu-list",id:t,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},n.map((function(t,n){return e.renderFeatureMenuItem(t,n)}))):null}},{key:"_getActionTitle",value:function(e){var t=this.messages,n=this.selectedFeature,a=this.messagesCommon,i=e.id,r=null==n?void 0:n.attributes,o="zoom-to-feature"===i?Object(jt.a)(e.title,{messages:t}):"remove-selected-feature"===i?Object(jt.a)(e.title,{messages:a}):e.title;return o&&r?Object(jt.a)(o,r):o}},{key:"_getActionClass",value:function(e){var t=this.selectedFeature,n=null==t?void 0:t.attributes,a=e.className,i=e.image||a?a:"esri-icon-default-action";return i&&n?Object(jt.a)(i,n):i}},{key:"_getActionImage",value:function(e){var t=this.selectedFeature,n=null==t?void 0:t.attributes,a=e.image;return a&&n?Object(jt.a)(a,n):a}},{key:"_createFeatureUpdatedAnimation",value:function(){return Object(wt.b)("enter","esri-popup--feature-updated")}},{key:"_getInlineActionCount",value:function(){var e=this.maxInlineActions,t=this.featureNavigationVisible;if("number"!=typeof e)return null;var n=Math.round(e);return Math.max(t?n-1:n,0)}},{key:"_watchActions",value:function(){var e=this,t=this.viewModel.allActions;this.notifyChange("dividedActions");var n="actions";this._handles.remove(n),t&&t.forEach((function(t){e._handles.add(Object(Ce.d)(t,["active","className","disabled","id","title","image","visible"],(function(){return e.scheduleRender()})),n)}))}},{key:"_divideActions",value:function(){var e=this.viewModel.allActions,t=this._getInlineActionCount(),n=null===t,a=0===t;return{inlineActions:n?e.slice(0):a?new te.a:e.slice(0,t),menuActions:n?new te.a:a?e.slice(0):e.slice(t)}}},{key:"_featureMenuOpenChanged",value:function(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}},{key:"_actionsMenuOpenChanged",value:function(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}},{key:"_setTitleFromFeatureWidget",value:function(e){this.selectedFeatureWidget&&(this.viewModel.title=e||"")}},{key:"_setContentFromFeatureWidget",value:function(){var e=this.selectedFeatureWidget;e&&(this.viewModel.content=e)}},{key:"_handleFeatureMenuKeyup",value:function(e){"Escape"===Object(et.a)(e)&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}},{key:"_handleActionMenuKeyup",value:function(e){"Escape"===Object(et.a)(e)&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}},{key:"_handleFeatureMenuItemKeyup",value:function(e){var t=Object(et.a)(e),n=this._featureMenuNode,a=e.currentTarget["data-feature-index"];if(n){var i=n.querySelectorAll("li"),r=i.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),i[i.length-1].focus()):(e.stopPropagation(),i[0].focus()):(e.stopPropagation(),i[(a+1+r)%r].focus()):(e.stopPropagation(),i[(a-1+r)%r].focus())}}},{key:"_handleActionMenuItemKeyup",value:function(e){var t=Object(et.a)(e),n=this._actionsMenuNode,a=e.currentTarget["data-action-index"];if(n){var i=n.querySelectorAll("li"),r=i.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),i[i.length-1].focus()):(e.stopPropagation(),i[0].focus()):(e.stopPropagation(),i[(a+1+r)%r].focus()):(e.stopPropagation(),i[(a-1+r)%r].focus())}}},{key:"_handleMainKeyup",value:function(e){var t=Object(et.a)(e);"ArrowLeft"===t&&(e.stopPropagation(),this.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.next())}},{key:"_spinnerEnabledChange",value:function(e){if(this._destroySpinner(),e){var t=this.get("viewModel.view");this._createSpinner(t)}}},{key:"_hideSpinner",value:function(){var e=this._spinner;e&&(e.location=null,e.hide())}},{key:"_displaySpinner",value:function(){var e=this._spinner;if(e){var t=this.viewModel,n=t.location;t.waitingForResult?e.show({location:n}):e.hide()}}},{key:"_getIconStyles",value:function(e){return{"background-image":e?"url(".concat(e,")"):""}}},{key:"_addSelectedFeatureIndexHandle",value:function(){var e=this,t=Object(Ce.d)(this,"viewModel.selectedFeatureIndex",(function(t,n){return e._selectedFeatureIndexUpdated(t,n)}));this._handles.add(t,"selected-index")}},{key:"_selectedFeatureIndexUpdated",value:function(e,t){this.featureCount&&e!==t&&-1!==e&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}},{key:"_destroySelectedFeatureWidget",value:function(){var e=this._feature;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}},{key:"_isScreenLocationWithinView",value:function(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}},{key:"_isOutsideView",value:function(e){var t=e.popupHeight,n=e.popupWidth,a=e.screenLocation,i=e.side,r=e.view;if(isNaN(n)||isNaN(t)||!r||!a)return!1;var o=r.padding;return"right"===i&&a.x+n/2>r.width-o.right||"left"===i&&a.x-n/2<o.left||"top"===i&&a.y-t<o.top||"bottom"===i&&a.y+t>r.height-o.bottom}},{key:"_calculateAutoAlignment",value:function(e){if("auto"!==e)return e;var t=this._pointerOffsetInPx,n=this._containerNode,a=this._mainContainerNode,i=this.viewModel,r=i.screenLocation,o=i.view;if(!r||!o||!n)return"top-center";if(!this._isScreenLocationWithinView(r,o))return this._get("currentAlignment")||"top-center";function s(e){return parseInt(e.replace(/[^-\d\.]/g,""),10)}var c=a?window.getComputedStyle(a,null):null,l=c?s(c.getPropertyValue("max-height")):0,u=c?s(c.getPropertyValue("height")):0,d=n.getBoundingClientRect(),p=d.height,h=d.width+t,f=Math.max(p,l,u)+t,b=this._isOutsideView({popupHeight:f,popupWidth:h,screenLocation:r,side:"right",view:o}),v=this._isOutsideView({popupHeight:f,popupWidth:h,screenLocation:r,side:"left",view:o}),y=this._isOutsideView({popupHeight:f,popupWidth:h,screenLocation:r,side:"top",view:o}),m=this._isOutsideView({popupHeight:f,popupWidth:h,screenLocation:r,side:"bottom",view:o});return v?y?"bottom-right":"top-right":b?y?"bottom-left":"top-left":y?m?"top-center":"bottom-center":"top-center"}},{key:"_callCurrentAlignment",value:function(e){return"function"==typeof e?e.call(this):e}},{key:"_getCurrentAlignment",value:function(){var e=this.alignment;return this.dockEnabled||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}},{key:"_setCurrentAlignment",value:function(){this._set("currentAlignment",this._getCurrentAlignment())}},{key:"_setCurrentDockPosition",value:function(){this._set("currentDockPosition",this._getCurrentDockPosition())}},{key:"_calculatePositionResult",value:function(e){var t=["left","right"];return Object(wt.e)()&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}},{key:"_callDockPosition",value:function(e){return"function"==typeof e?e.call(this):e}},{key:"_getDockPosition",value:function(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(null==(e=this.dockOptions)?void 0:e.position)))}},{key:"_getCurrentDockPosition",value:function(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}},{key:"_wouldDockTo",value:function(){return this.dockEnabled?null:this._getDockPosition()}},{key:"_calculateAutoDockPosition",value:function(e){var t;if("auto"!==e)return e;var n=null==(t=this.viewModel)?void 0:t.view,a=Object(wt.e)()?"top-left":"top-right";if(!n)return a;var i=n.padding||{left:0,right:0,top:0,bottom:0},r=n.width-i.left-i.right,o=n.breakpoints;return o&&r<=o.xsmall?"bottom-center":a}},{key:"_positionContainer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._containerNode;if(e&&(this._containerNode=e),e){var t=this.viewModel.screenLocation,n=e.getBoundingClientRect(),a=n.width,i=this._calculatePositionStyle(t,a);i&&(e.style.top=i.top,e.style.left=i.left,e.style.bottom=i.bottom,e.style.right=i.right)}}},{key:"_calculateFullWidth",value:function(e){var t=this.currentAlignment,n=this._pointerOffsetInPx;return"top-left"===t||"bottom-left"===t||"top-right"===t||"bottom-right"===t?e+n:e}},{key:"_calculateAlignmentPosition",value:function(e,t,n,a){var i=this.currentAlignment,r=this._pointerOffsetInPx,o=a/2,s=n.height-t,c=n.width-e,l=this.view.padding;return"bottom-center"===i?{top:t+r-l.top,left:e-o-l.left}:"top-left"===i?{bottom:s+r-l.bottom,right:c+r-l.right}:"bottom-left"===i?{top:t+r-l.top,right:c+r-l.right}:"top-right"===i?{bottom:s+r-l.bottom,left:e+r-l.left}:"bottom-right"===i?{top:t+r-l.top,left:e+r-l.left}:"top-center"===i?{bottom:s+r-l.bottom,left:e-o-l.left}:void 0}},{key:"_calculatePositionStyle",value:function(e,t){var n=this.dockEnabled,a=this.view;if(a){if(n)return{left:"",top:"",right:"",bottom:""};if(e&&t){var i=this._calculateFullWidth(t),r=this._calculateAlignmentPosition(e.x,e.y,a,i);return r?{top:void 0!==r.top?"".concat(r.top,"px"):"auto",left:void 0!==r.left?"".concat(r.left,"px"):"auto",bottom:void 0!==r.bottom?"".concat(r.bottom,"px"):"auto",right:void 0!==r.right?"".concat(r.right,"px"):"auto"}:void 0}}}},{key:"_viewChange",value:function(e,t){e&&t&&(this.close(),this.clear())}},{key:"_viewReadyChange",value:function(e,t){if(e){var n=this.get("viewModel.view");this._wireUpView(n)}else t&&(this.close(),this.clear())}},{key:"_wireUpView",value:function(e){(this._destroySpinner(),e)&&(this.spinnerEnabled&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions))}},{key:"_dockingThresholdCrossed",value:function(e,t,n){var a=Object(Ae.a)(e,2),i=a[0],r=a[1],o=Object(Ae.a)(t,2),s=o[0],c=o[1],l=n.width,u=n.height;return i<=l&&s>l||i>l&&s<=l||r<=u&&c>u||r>u&&c<=u}},{key:"_updateDockEnabledForViewSize",value:function(e,t){if(e&&t){var n=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},a=n.left+n.right,i=n.top+n.bottom,r=[],o=[];r[0]=e[0]-a,r[1]=e[1]-i,o[0]=t[0]-a,o[1]=t[1]-i;var s=this.dockOptions,c=s.breakpoint;this._dockingThresholdCrossed(r,o,c)&&this._setDockEnabledForViewSize(s),this._setCurrentDockPosition()}}},{key:"_focusDockButtonNode",value:function(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}},{key:"_closeButtonNodeUpdated",value:function(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}},{key:"_mainContainerNodeUpdated",value:function(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}},{key:"_featureMenuNodeUpdated",value:function(e){if(this._featureMenuNode=e,e&&this._focusFirstFeature){this._focusFirstFeature=!1;var t=e.querySelectorAll("li");t.length&&t[0].focus()}}},{key:"_actionsMenuNodeUpdated",value:function(e){if(this._actionsMenuNode=e,e&&this._focusFirstAction){this._focusFirstAction=!1;var t=e.querySelectorAll("li");t.length&&t[0].focus()}}},{key:"_focusFeatureMenuButtonNode",value:function(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}},{key:"_focusActionsMenuButtonNode",value:function(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}},{key:"_featureMenuViewportNodeUpdated",value:function(e){e&&(e.scrollTop=0)}},{key:"_toggleScreenLocationEnabled",value:function(){var e=this.dockEnabled,t=this.viewModel;if(t){var n=t.active&&!e;t.screenLocationEnabled=n}}},{key:"_shouldDockAtCurrentViewSize",value:function(e){var t,n,a=e.breakpoint,i=null==(t=this.viewModel)||null==(n=t.view)?void 0:n.ui;if(!i)return!1;var r=i.width,o=i.height;if(isNaN(r)||isNaN(o))return!1;var s=a.hasOwnProperty("width")&&r<=a.width,c=a.hasOwnProperty("height")&&o<=a.height;return s||c}},{key:"_setDockEnabledForViewSize",value:function(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}},{key:"_getPageText",value:function(e,t){return this.featureNavigationVisible?Object(jt.a)(this.messages.pageText,{index:t+1,total:e}):null}},{key:"_destroySpinner",value:function(){var e=this._spinner,t=this.view;e&&(t&&t.ui&&t.ui.remove(this._spinner,"popup-spinner"),e.destroy(),this._spinner=null)}},{key:"_createSpinner",value:function(e){e&&(this._spinner=new za({view:e}),e.ui.add(this._spinner,{key:"popup-spinner",position:"manual"}))}},{key:"_toggleCollapsed",value:function(){this.collapsed=!this.collapsed}},{key:"_close",value:function(){this.close(),this.view&&this.view.focus()}},{key:"_toggleDockEnabled",value:function(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}},{key:"_toggleFeatureMenu",value:function(){var e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}},{key:"_toggleActionsMenu",value:function(){var e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}},{key:"_triggerAction",value:function(e){var t=e.currentTarget["data-action-index"],n=this.viewModel.allActions.getItemAt(t);n&&"toggle"===n.type&&(n.value=!n.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(t)}},{key:"_selectFeature",value:function(e){var t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}},{key:"_next",value:function(){this.next()}},{key:"_previous",value:function(){this.previous()}},{key:"actionsMenuId",get:function(){return"".concat(this.id,"-actions-menu")}},{key:"actionsMenuButtonId",get:function(){return"".concat(this.id,"-actions-menu-button")}},{key:"featureMenuId",get:function(){return"".concat(this.id,"-feature-menu")}},{key:"titleId",get:function(){return"".concat(this.id,"-popup-title")}},{key:"contentId",get:function(){return"".concat(this.id,"-popup-content")}},{key:"hasContent",get:function(){var e,t,n,a,i;return!!(this.selectedFeatureWidget?(null==(e=this.selectedFeatureWidget)||null==(t=e.viewModel)?void 0:t.waitingForContent)||(null==(n=this.selectedFeatureWidget)||null==(a=n.viewModel)?void 0:a.content):null==(i=this.viewModel)?void 0:i.content)}},{key:"featureNavigationVisible",get:function(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}},{key:"collapsible",get:function(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}},{key:"featureMenuVisible",get:function(){return this.featureNavigationVisible&&this.featureMenuOpen}},{key:"contentCollapsed",get:function(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}},{key:"dividedActions",get:function(){return this._divideActions()}},{key:"actionsMenuOpen",set:function(e){this._set("actionsMenuOpen",!!e)},get:function(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}},{key:"currentAlignment",get:function(){return this._getCurrentAlignment()}},{key:"currentDockPosition",get:function(){return this._getCurrentDockPosition()}},{key:"dockOptions",get:function(){return this._get("dockOptions")||ci},set:function(e){var t=Object(c.a)({},ci),n=this.get("viewModel.view.breakpoints"),a={};n&&(a.width=n.xsmall,a.height=n.xsmall);var i=Object(c.a)(Object(c.a)({},t),e),r=Object(c.a)(Object(c.a)({},t.breakpoint),a),o=i.breakpoint;!0===o?i.breakpoint=r:"object"==typeof o&&(i.breakpoint=Object(c.a)(Object(c.a)({},r),o)),this._set("dockOptions",i),this._setCurrentDockPosition(),this.reposition()}},{key:"featureNavigationEnabled",set:function(e){Object(Ot.b)(ui,"featureNavigationEnabled",{replacement:"visibleElements.featureNavigation",version:"4.15"}),this.visibleElements=Object(c.a)(Object(c.a)({},this.visibleElements),{},{featureNavigation:e})}},{key:"selectedFeatureWidget",get:function(){var e=this._feature,t=this.visibleElements,n=this.viewModel.selectedFeatureViewModel,a=Object(c.a)(Object(c.a)({},t),{},{title:!1});return n?(e?(e.viewModel=n,e.visibleElements=a):this._feature=new La({viewModel:n,visibleElements:a}),this._feature):null}}]),n}(Et(Tt.a));Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["id"]}),Object(It.a)()],pi.prototype,"actionsMenuId",null),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["id"]}),Object(It.a)()],pi.prototype,"actionsMenuButtonId",null),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["id"]}),Object(It.a)()],pi.prototype,"featureMenuId",null),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["id"]}),Object(It.a)()],pi.prototype,"titleId",null),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["id"]}),Object(It.a)()],pi.prototype,"contentId",null),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["selectedFeatureWidget","selectedFeatureWidget.viewModel","selectedFeatureWidget.viewModel.waitingForContent","selectedFeatureWidget.viewModel.content","viewModel.content"]}),Object(It.a)()],pi.prototype,"hasContent",null),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["viewModel.active","viewModel.featureCount","visibleElements.featureNavigation"]}),Object(It.a)()],pi.prototype,"featureNavigationVisible",null),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["collapseEnabled","viewModel.title","hasContent"]}),Object(It.a)()],pi.prototype,"collapsible",null),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["featureNavigationVisible","featureMenuOpen"]}),Object(It.a)()],pi.prototype,"featureMenuVisible",null),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["collapsible","featureMenuVisible","collapsed"]}),Object(It.a)()],pi.prototype,"contentCollapsed",null),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["featureNavigationVisible","maxInlineActions","viewModel.allActions","viewModel.allActions.length"]}),Object(It.a)()],pi.prototype,"dividedActions",null),Object(h.a)([Object(X.a)("viewModel.actions"),Object(It.a)()],pi.prototype,"actions",void 0),Object(h.a)([Object(m.b)({dependsOn:["viewModel.active"]}),Object(It.a)()],pi.prototype,"actionsMenuOpen",null),Object(h.a)([Object(m.b)()],pi.prototype,"alignment",void 0),Object(h.a)([Object(X.a)("viewModel.autoCloseEnabled")],pi.prototype,"autoCloseEnabled",void 0),Object(h.a)([Object(X.a)("viewModel.autoOpenEnabled")],pi.prototype,"autoOpenEnabled",void 0),Object(h.a)([Object(X.a)("viewModel.defaultPopupTemplateEnabled")],pi.prototype,"defaultPopupTemplateEnabled",void 0),Object(h.a)([Object(X.a)("viewModel.content"),Object(It.a)()],pi.prototype,"content",void 0),Object(h.a)([Object(m.b)(),Object(It.a)()],pi.prototype,"collapsed",void 0),Object(h.a)([Object(m.b)(),Object(It.a)()],pi.prototype,"collapseEnabled",void 0),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["dockEnabled","alignment","viewModel.active"]}),Object(It.a)()],pi.prototype,"currentAlignment",null),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["viewModel.view.ready","dockEnabled","dockOptions","viewModel.active"]}),Object(It.a)()],pi.prototype,"currentDockPosition",null),Object(h.a)([Object(m.b)(),Object(It.a)()],pi.prototype,"dockOptions",null),Object(h.a)([Object(m.b)(),Object(It.a)()],pi.prototype,"dockEnabled",void 0),Object(h.a)([Object(X.a)("viewModel.featureCount"),Object(It.a)()],pi.prototype,"featureCount",void 0),Object(h.a)([Object(m.b)(),Object(It.a)()],pi.prototype,"featureMenuOpen",void 0),Object(h.a)([Object(X.a)("viewModel.features"),Object(It.a)()],pi.prototype,"features",void 0),Object(h.a)([Object(m.b)(),Object(It.a)()],pi.prototype,"featureNavigationEnabled",null),Object(h.a)([Object(X.a)("viewModel.goToOverride")],pi.prototype,"goToOverride",void 0),Object(h.a)([Object(X.a)("viewModel.highlightEnabled")],pi.prototype,"highlightEnabled",void 0),Object(h.a)([Object(X.a)("viewModel.location"),Object(It.a)()],pi.prototype,"location",void 0),Object(h.a)([Object(m.b)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],pi.prototype,"label",void 0),Object(h.a)([Object(m.b)(),Object(It.a)()],pi.prototype,"maxInlineActions",void 0),Object(h.a)([Object(m.b)(),Object(It.a)(),Object(Mt.a)("esri/widgets/Popup/t9n/Popup")],pi.prototype,"messages",void 0),Object(h.a)([Object(m.b)(),Object(It.a)(),Object(Mt.a)("esri/t9n/common")],pi.prototype,"messagesCommon",void 0),Object(h.a)([Object(X.a)("viewModel.promises")],pi.prototype,"promises",void 0),Object(h.a)([Object(X.a)("viewModel.selectedFeature"),Object(It.a)()],pi.prototype,"selectedFeature",void 0),Object(h.a)([Object(X.a)("viewModel.selectedFeatureIndex"),Object(It.a)()],pi.prototype,"selectedFeatureIndex",void 0),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["viewModel.selectedFeatureViewModel","visibleElements"]}),Object(It.a)()],pi.prototype,"selectedFeatureWidget",null),Object(h.a)([Object(m.b)()],pi.prototype,"spinnerEnabled",void 0),Object(h.a)([Object(X.a)("viewModel.title"),Object(It.a)()],pi.prototype,"title",void 0),Object(h.a)([Object(X.a)("viewModel.updateLocationEnabled")],pi.prototype,"updateLocationEnabled",void 0),Object(h.a)([Object(X.a)("viewModel.view")],pi.prototype,"view",void 0),Object(h.a)([Object(m.b)({type:ei}),Object(It.a)(["viewModel.active","viewModel.view.widthBreakpoint","viewModel.allActions","viewModel.screenLocation","viewModel.screenLocationEnabled","viewModel.state","viewModel.pendingPromisesCount","viewModel.promiseCount","viewModel.waitingForResult"]),Object(xt.a)(["triggerAction","trigger-action"])],pi.prototype,"viewModel",void 0),Object(h.a)([Object(X.a)("viewModel.visible"),Object(It.a)()],pi.prototype,"visible",void 0),Object(h.a)([Object(m.b)(),Object(It.a)()],pi.prototype,"visibleElements",void 0),Object(h.a)([Object(re.a)("visibleElements")],pi.prototype,"castVisibleElements",null),Object(h.a)([Object(kt.a)()],pi.prototype,"_close",null),Object(h.a)([Object(kt.a)()],pi.prototype,"_toggleDockEnabled",null),Object(h.a)([Object(kt.a)()],pi.prototype,"_toggleFeatureMenu",null),Object(h.a)([Object(kt.a)()],pi.prototype,"_toggleActionsMenu",null),Object(h.a)([Object(kt.a)()],pi.prototype,"_triggerAction",null),Object(h.a)([Object(kt.a)()],pi.prototype,"_selectFeature",null),Object(h.a)([Object(kt.a)()],pi.prototype,"_next",null),Object(h.a)([Object(kt.a)()],pi.prototype,"_previous",null);pi=Object(h.a)([Object(O.a)("esri.widgets.Popup")],pi);function hi(e,t){var n=e.view;n&&(t&&n.ready&&n.activeTool!==e?(n.activeTool=e,function(e){return e&&"focus"in e}(n)&&n.focus()):t||n.activeTool!==e||(n.activeTool=null))}function fi(e){return!1!==e.visible&&!1!==e.editable&&(null==e.hasEditableFlag||e.hasEditableFlag(1))}function bi(e){return Object(b.f)(e)?{}:"function"==typeof e?e():e}function vi(e){return Object(Ke.b)(e.x,e.y)}function yi(e){return"mouse"===e}function mi(e){return"mouse"!==e.pointerType||0===e.button}function gi(e){return!!e.native.shiftKey}var Oi={manipulator:null,tool:null},ji=function(){function e(){Object(l.a)(this,e),this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToActiveTool=null,this._cursor=null}return Object(u.a)(e,[{key:"handleInputEvent",value:function(e,t){var n=function(){return e.stopPropagation()};switch(e.type){case"pointer-move":yi(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(n(),"end"===e.action&&(this._stopDrag=!1));break;case"pointer-down":if(!mi(e)||gi(e))break;var a=vi(e),i=this._intersect(a,e.pointerType,t.forEachTool);if(Object(b.f)(i))break;var r=this._findToolAndManipulatorByKey(i,t.forEachTool,Oi),o=Object(b.b)(r,(function(e){return e.manipulator})),s=Object(b.b)(r,(function(e){return e.tool}));!(Object(b.g)(o)&&Object(b.g)(s)&&o.interactive)||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,s,e),Object(b.g)(o)&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{key:i,start:a}),1===this._grabbedManipulators.size&&(this._revertToActiveTool=t.activeTool,t.setActiveTool(i.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",screenPoint:a}),n());break;case"pointer-up":this._handlePointerEnd(e,t);break;case"pointer-drag":if(!mi(e))break;var c=this._grabbedManipulators.get(e.pointerId),l=this._draggedManipulators.get(e.pointerId),u=Object(b.b)(c||l,(function(e){return e.key})),d=this._findManipulatorByKey(u,t.forEachTool);if(Object(b.f)(d))break;var p=vi(e);p.x=Object(Ge.d)(p.x,0,t.view.width),p.y=Object(Ge.d)(p.y,0,t.view.height);var h=Object(b.m)(c||l).start;switch(e.action){case"start":case"update":"update"!==e.action&&1!==this._grabbedManipulators.size||(d.dragging=!0,l?d.events.emit("drag",{action:"update",start:h,screenPoint:p}):d.events.emit("drag",{action:"start",start:h,screenPoint:p,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{key:Object(b.m)(u),start:h}));break;case"end":d.dragging=!1,l&&d.events.emit("drag",{action:"end",start:h,screenPoint:p}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,t)}n();break;case"immediate-click":var f=vi(e),v=this._intersect(f,e.pointerType,t.forEachTool),y=this._findToolAndManipulatorByKey(v,t.forEachTool,Oi);if(gi(e)||t.forEachTool((function(e){if((!Object(b.g)(y)||y.tool!==e||!e.selectionManagementDisabled)&&e.manipulators){var t=!1;e.manipulators.forEach((function(e){var n=e.manipulator;n.selected&&(n.selected=!1,t=!0)})),t&&e.manipulatorSelectionChanged&&e.manipulatorSelectionChanged()}})),Object(b.f)(y))break;var m=y.manipulator,g=y.tool;if(!m.interactive)break;m.selectable&&!g.selectionManagementDisabled&&(m.selected=!m.selected,g.manipulatorSelectionChanged&&g.manipulatorSelectionChanged());var O=e.native.shiftKey;m.events.emit("immediate-click",{screenPoint:f,button:e.button,pointerType:e.pointerType,shiftKey:O,stopPropagation:n});break;case"click":var j=vi(e),_=this._intersect(j,e.pointerType,t.forEachTool),w=this._findManipulatorByKey(_,t.forEachTool);if(Object(b.f)(w)||!w.interactive)break;var k=e.native.shiftKey;w.events.emit(e.type,{screenPoint:j,button:e.button,pointerType:e.pointerType,shiftKey:k}),n();break;case"double-click":var M=vi(e),I=this._intersect(M,e.pointerType,t.forEachTool),x=this._findManipulatorByKey(I,t.forEachTool);if(Object(b.f)(x)||!x.interactive)break;var C=e.native.shiftKey;x.events.emit("double-click",{screenPoint:M,button:e.button,pointerType:e.pointerType,shiftKey:C,stopPropagation:n});break;case"immediate-double-click":var T=vi(e),F=this._intersect(T,e.pointerType,t.forEachTool),E=this._findManipulatorByKey(F,t.forEachTool);if(Object(b.f)(E)||!E.interactive)break;var A=e.native.shiftKey;E.events.emit("immediate-double-click",{screenPoint:T,button:e.button,pointerType:e.pointerType,shiftKey:A,stopPropagation:n})}this._updateCursor(t.forEachTool)}},{key:"_ungrabManipulatorBeforeDragging",value:function(e,t,n){var a=this;e.grabbing=!1,e.events.emit("grab-changed",{action:"end",screenPoint:vi(n)}),this._grabbedManipulators.forEach((function(n,i){var r=n.key;r.tool===t&&t.manipulators.findById(r.manipulatorId)===e&&a._grabbedManipulators.delete(i)}))}},{key:"_handlePointerEnd",value:function(e,t){var n=Object(b.b)(this._grabbedManipulators.get(e.pointerId),(function(e){return e.key})),a=this._findManipulatorByKey(n,t.forEachTool);if(Object(b.g)(a)&&!a.dragging){var i=Object(b.g)(t.creatingTool)&&t.creatingTool===Object(b.m)(n).tool;1!==this._grabbedManipulators.size||0!==this._draggedManipulators.size||i||(t.setActiveTool(this._revertToActiveTool),this._revertToActiveTool=null),a.grabbing&&(a.grabbing=!1,a.events.emit("grab-changed",{action:"end",screenPoint:vi(e)})),this._grabbedManipulators.delete(e.pointerId)}}},{key:"_cursorFromMap",value:function(e,t){var n=this,a=null;return Le(e,(function(e){var i=e.key,r=n._findManipulatorByKey(i,t);return!!(Object(b.g)(r)&&r.interactive&&"cursor"in r&&r.cursor)&&(a=r.cursor,!0)})),a}},{key:"_updateCursor",value:function(e){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators,e)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators,e)||"pointer":this._cursor=null}},{key:"clearPointers",value:function(e,t){var n=this,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0,r=function(t){return t.tool===e&&(Object(b.f)(i)||t.manipulatorId===i)};this._grabbedManipulators.forEach((function(e,a){var i=e.key;if(r(i)){n._grabbedManipulators.delete(a);var o=n._findManipulatorByKey(i,t);Object(b.g)(o)&&(o.grabbing=!1,o.events.emit("grab-changed",{action:"end",screenPoint:null}))}})),this._draggedManipulators.forEach((function(e,a){var i=e.key;if(r(i)){n._draggedManipulators.delete(a);var o=n._findManipulatorByKey(i,t);Object(b.g)(o)&&(o.dragging=!1,o.events.emit("drag",{action:"cancel"}))}})),a&&this._hoveredManipulators.forEach((function(e,a){var i=e.key;if(r(i)){n._hoveredManipulators.delete(a);var o=n._findManipulatorByKey(i,t);Object(b.g)(o)&&(o.hovering=!1)}})),this._updateCursor(t)}},{key:"_intersect",value:function(e,t,n){var a=null;return n((function(n){if(null==n.manipulators||!fi(n))return!1;var i=n.manipulators.intersect(e,t);return!Object(b.f)(i)&&(a={manipulatorId:i,tool:n},!0)})),a}},{key:"updateHoveredStateFromKnownPointers",value:function(e){var t=this;this._pointerLocations.forEach((function(n,a){t._updateHoveredStateForPointerAtScreenPosition(Object(Ke.b)(n.x,n.y),a,n.pointerType,e)}))}},{key:"handleHoverEvent",value:function(e,t){"pointer-up"!==e.type&&"immediate-click"!==e.type&&"pointer-move"!==e.type||!yi(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(vi(e),e.pointerId,e.pointerType,t)}},{key:"_updateHoveredStateForPointerAtScreenPosition",value:function(e,t,n,a){var i=this._intersect(e,n,a),r=this._findManipulatorByKey(i,a),o=Object(b.b)(this._hoveredManipulators.get(t),(function(e){return e.key})),s=this._findManipulatorByKey(o,a);Object(b.g)(r)&&!r.interactive&&(r=null),s!==r&&(Object(b.g)(s)&&(s.hovering=!1),Object(b.g)(r)?(r.hovering=!0,this._hoveredManipulators.set(t,{key:Object(b.m)(i)})):this._hoveredManipulators.delete(t),this._updateCursor(a))}},{key:"_findManipulatorByKey",value:function(e,t){return this._findToolAndManipulatorByKey(e,t,Oi)?Oi.manipulator:null}},{key:"_findToolAndManipulatorByKey",value:function(e,t,n){return Object(b.f)(e)?null:(n.tool=null,n.manipulator=null,t((function(t){if(t!==e.tool||null==t.manipulators||!fi(t))return!1;var a=t.manipulators.findById(e.manipulatorId);return!!Object(b.g)(a)&&(n.manipulator=a,n.tool=t,!0)})),n.manipulator?n:null)}},{key:"cursor",get:function(){return this._cursor}}]),e}(),_i=v.a.getLogger("esri.views.ToolViewManager"),wi=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e))._handles=new Ue.a,a._creatingTool=null,a._manipulatorState=new ji,a.tools=function(){var e=new te.a;return e.on("after-add",(function(e){var t=e.item;t.view&&t.view.ready&&t.attach()})),e.on("after-remove",(function(e){var t=e.item;hi(t,!1),t.destroyed||t.detach()})),e}(),a.cursor=null,a._forEachTool=function(e){if(!Object(b.g)(a._creatingTool)||!e(a._creatingTool)){var t,n=Object(se.a)(a.tools.items);try{for(n.s();!(t=n.n()).done;){if(e(t.value))return}}catch(i){n.e(i)}finally{n.f()}}},a}return Object(u.a)(n,[{key:"initialize",value:function(){var e=this;this._handles.add([this.view.on(pt,(function(t){e._handleInputEvent(t)}),dt.TOOL),this.tools.on("before-add",(function(t){var n=t.item;null==n||e.tools.includes(n)?t.preventDefault():null==n.created||n.created||(_i.error("tools","Tool can not be added to view before it has been created"),t.preventDefault())})),this.tools.on("before-remove",(function(t){var n=t.item;e._manipulatorState.clearPointers(n,e._forEachTool)})),this.tools.on("change",(function(){e._refreshToolWatchers()}))])}},{key:"destroy",value:function(){this._forEachTool((function(e){return e.destroy()})),this._handles.destroy(),this._handles=null}},{key:"createTool",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n,a){var i,r,s,l=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.view.whenReady();case 2:if(i="Tool creation was interrupted by another tool being created",!Object(k.m)(a)){e.next=5;break}throw Object(k.e)(i);case 5:return r=new t(Object(c.a)(Object(c.a)({},bi(n)),{},{view:this.view})),s=Object(k.p)(a,(function(){return l.activeTool=null})),this._rejectCreatingTool(i),this._creatingTool=r,r.attach(),this._refreshToolWatchers(),hi(r,!0),e.next=13,r.when();case 13:return Object(b.g)(s)&&s.remove(),this._creatingTool=null,this.tools.add(r),r instanceof G.a&&null!=r.completed&&Object(Ce.h)(r,"completed").then((function(){hi(r,!1)})),e.abrupt("return",r);case 18:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"attach",value:function(){var e=this;this._forEachTool((function(e){return e.attach()})),"3d"===this.view.type?this._handles.add([this.view.state.watch("camera",(function(){e.forEachManipulator((function(e){null!=e.onViewChange&&e.onViewChange()}))})),this.view.elevationProvider.on("elevation-change",(function(t){e.forEachManipulator((function(e){null!=e.onElevationChange&&e.onElevationChange(t)}))}))],"manipulators"):this._handles.add(this.view.watch("extent",(function(){e.forEachManipulator((function(e){null!=e.onViewChange&&e.onViewChange()}))})))}},{key:"detach",value:function(){this.activeTool=null,this._forEachTool((function(e){e.detach(),e.destroy()})),this.tools.removeAll(),this._handles.remove("manipulators")}},{key:"forEachManipulator",value:function(e){this._forEachTool((function(t){t.manipulators&&t.manipulators.forEach((function(n){var a=n.manipulator;return e(a,t)}))}))}},{key:"_handleInputEvent",value:function(e){var t=this,n=!1,a=Object(c.a)(Object(c.a)({},e),{},{stopPropagation:function(){n=!0,e.stopPropagation()}});Object(b.g)(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(a):this._forEachTool((function(e){!n&&!1!==e.visible&&e.handleInputEvent&&e.handleInputEvent(a)})),!n&&"key-down"===e.type&&"Escape"===e.key&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(a,{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:function(e){t.activeTool=e},creatingTool:this._creatingTool,view:this.view}),!n&&Object(b.g)(this.activeTool)&&this.activeTool.handleInputEventAfter&&this.activeTool.handleInputEventAfter(a),this._manipulatorState.handleHoverEvent(a,this._forEachTool),this._updateCursor()}},{key:"_refreshToolWatchers",value:function(){var e=this;this._handles.remove("tools"),this._forEachTool((function(t){if(t instanceof G.a){var n=Object(Ce.d)(t,["cursor","visible","editable"],(function(){fi(t)||e._manipulatorState.clearPointers(t,e._forEachTool),e._updateCursor()}));e._handles.add(n,"tools")}t.manipulators&&e._handles.add(t.manipulators.on("change",(function(n){n.removed.forEach((function(n){var a=n.id;e._manipulatorState.clearPointers(t,e._forEachTool,!0,a)})),e._manipulatorState.updateHoveredStateFromKnownPointers(e._forEachTool),e._updateCursor()})),"tools")})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}},{key:"_updateCursor",value:function(){var e=null;this._forEachTool((function(t){return null!=t.cursor&&!1!==t.visible&&(e=t.cursor,!0)})),e||(e=this._manipulatorState.cursor),this._get("cursor")!==e&&this._set("cursor",e)}},{key:"_rejectCreatingTool",value:function(e){var t=this._creatingTool;Object(b.f)(t)||(this._manipulatorState.clearPointers(t,this._forEachTool),t.rejectCreation&&t.rejectCreation(Object(k.e)(e)),t.destroy(),this._creatingTool=null,this._refreshToolWatchers())}},{key:"_removeIncompleteTools",value:function(e){var t=this;this.tools.filter((function(t){return(Object(b.f)(e)||t!==e)&&null!=t.completed&&!t.completed})).forEach((function(e){t.tools.remove(e)}))}},{key:"activeTool",set:function(e){var t=this;!Object(b.g)(e)||this.view.ready?(function(e,t,n){var a=e.activeTool;t!==a&&(Object(b.g)(a)&&a.deactivate&&a.deactivate(),n(t),Object(b.g)(t)&&t.activate&&t.activate())}(this,e,(function(n){t._set("activeTool",n),t._removeIncompleteTools(e),t._forEachTool((function(e){var n=Object(b.f)(t.activeTool)||e===t.activeTool;e.setEditableFlag&&e.setEditableFlag(1,n);var a=fi(e);!Object(b.f)(t.activeTool)&&a||t._manipulatorState.clearPointers(e,t._forEachTool,!a)})),t._updateCursor()})),this._creatingTool!==e&&this._rejectCreatingTool()):_i.error("#activeTool=","cannot set active tool while view is not ready")}}]),n}(G.a);Object(h.a)([Object(m.b)({constructOnly:!0,nonNullable:!0})],wi.prototype,"view",void 0),Object(h.a)([Object(m.b)({value:null})],wi.prototype,"activeTool",null),Object(h.a)([Object(m.b)({readOnly:!0,type:te.a})],wi.prototype,"tools",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],wi.prototype,"cursor",void 0);var ki=wi=Object(h.a)([Object(O.a)("esri.views.ToolViewManager")],wi),Mi=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this)).nativeIndex=null,a._detectedDeviceType="unknown","standard"===e.mapping?a._detectedDeviceType="standard":Ii.test(e.id)?a._detectedDeviceType="spacemouse":a._detectedDeviceType="unknown",a.nativeIndex=e.index,a}return Object(u.a)(n,[{key:"native",get:function(){return(navigator.getGamepads?navigator.getGamepads():[])[this.nativeIndex]}},{key:"deviceType",get:function(){return this._detectedDeviceType}},{key:"axisThreshold",get:function(){return xi[this.deviceType]}}]),n}(G.a);Object(h.a)([Object(m.b)({nonNullable:!0,readOnly:!0})],Mi.prototype,"nativeIndex",void 0),Object(h.a)([Object(m.b)({type:String,readOnly:!0})],Mi.prototype,"deviceType",null),Object(h.a)([Object(m.b)({type:Number,readOnly:!0})],Mi.prototype,"axisThreshold",null),Mi=Object(h.a)([Object(O.a)("esri.views.input.gamepad.GamepadInputDevice")],Mi);var Ii=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),xi={standard:.15,spacemouse:.025,unknown:0},Ci=Mi,Ti=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).devices=new te.a,e.enabledFocusMode="document",e}return n}(G.a);Object(h.a)([Object(m.b)({type:te.a.ofType(Ci),readOnly:!0})],Ti.prototype,"devices",void 0),Object(h.a)([Object(m.b)({type:["document","view","none"]})],Ti.prototype,"enabledFocusMode",void 0);var Fi=Ti=Object(h.a)([Object(O.a)("esri.views.input.gamepad.GamepadSettings")],Ti),Ei=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(){var e;return Object(l.a)(this,n),(e=t.apply(this,arguments)).gamepad=new Fi,e}return n}(G.a);Object(h.a)([Object(m.b)({readOnly:!0})],Ei.prototype,"gamepad",void 0);var Ai=Ei=Object(h.a)([Object(O.a)("esri.views.input.Input")],Ei),Pi=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).enabled=!0,a.device=null,a.mode="pan",a.tiltDirection="forward-down",a.velocityFactor=1,a}return n}(G.a);Object(h.a)([Object(m.b)({type:Boolean,nonNullable:!0})],Pi.prototype,"enabled",void 0),Object(h.a)([Object(m.b)({type:Ci})],Pi.prototype,"device",void 0),Object(h.a)([Object(m.b)({type:["pan","zoom"],nonNullable:!0})],Pi.prototype,"mode",void 0),Object(h.a)([Object(m.b)({type:["forward-down","forward-up"],nonNullable:!0})],Pi.prototype,"tiltDirection",void 0),Object(h.a)([Object(m.b)({type:Number,nonNullable:!0})],Pi.prototype,"velocityFactor",void 0);var Si=Pi=Object(h.a)([Object(O.a)("esri.views.navigation.gamepad.GamepadSettings")],Pi),Li=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).browserTouchPanEnabled=!0,a.gamepad=new Si,a.momentumEnabled=!0,a.mouseWheelZoomEnabled=!0,a}return n}(G.a);Object(h.a)([Object(m.b)({type:Boolean})],Li.prototype,"browserTouchPanEnabled",void 0),Object(h.a)([Object(m.b)({type:Si,nonNullable:!0})],Li.prototype,"gamepad",void 0),Object(h.a)([Object(m.b)({type:Boolean})],Li.prototype,"momentumEnabled",void 0),Object(h.a)([Object(m.b)({type:Boolean})],Li.prototype,"mouseWheelZoomEnabled",void 0);var Vi=Li=Object(h.a)([Object(O.a)("esri.views.navigation.Navigation")],Li),Ri=n(119),Ni=n(208);function Di(e){var t=e.url&&Object(Ni.e)(e.url);return null==(e.spatialReference&&e.spatialReference.vcsWkid)&&Object(b.g)(t)&&"ImageServer"===t.serverType||!Bi(e)||!e.heightModelInfo?Ui(e)?Te.a.deriveUnitFromSR(qi,e.spatialReference):null:e.heightModelInfo}function Bi(e){return"heightModelInfo"in e}function zi(e){if("unknown"===e.type||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"ogc-feature":return!0;case"imagery":case"map-image":case"map-notes":case"tile":case"vector-tile":case"scene":case null:default:return!1}}function Ui(e){return zi(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):Hi(e)}function Hi(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"geojson":case"feature":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"map-image":case"map-notes":case"ogc-feature":case"open-street-map":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":case null:return!1}return!1}var Wi,qi=new Te.a({heightModel:"gravity-related-height"}),Gi=v.a.getLogger("esri.views.support.DefaultsFromMap"),Ki=Wi=function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(){var e;return Object(l.a)(this,a),(e=t.apply(this,arguments))._handles=new Ue.a,e._waitTask=null,e._extentProjectController=null,e._spatialReferenceCandidates=null,e._extentCandidates=null,e.logDebugInformation=!1,e.isSpatialReferenceDone=!1,e.isTileInfoDone=!1,e.isHeightModelInfoSearching=!1,e.spatialReference=null,e.extent=null,e.heightModelInfo=null,e.vcsWkid=null,e.latestVcsWkid=null,e.mapCollectionPaths=Wi.DefaultMapCollectionPaths.slice(),e.tileInfo=null,e}return Object(u.a)(a,[{key:"initialize",value:function(){var e=this;this.watch("mapCollectionPaths",(function(){e._running&&(e.reset(),e.start())}))}},{key:"destroy",value:function(){this._set("view",null),this._handles&&(this._handles.destroy(),this._handles=null),this._cancelLoading()}},{key:"reset",value:function(){this._handles.removeAll(),this._set("isSpatialReferenceDone",!1),this._set("isTileInfoDone",!1),this._set("isHeightModelInfoSearching",!1),this._set("spatialReference",null),this._set("extent",null),this._set("heightModelInfo",null),this._set("vcsWkid",null),this._set("latestVcsWkid",null),this._set("tileInfo",null),this._spatialReferenceCandidates=null,this._extentCandidates=null}},{key:"start",value:function(){var e=this;this._handles.removeAll();var t,n=this._updateLayerChange.bind(this),a=Object(se.a)(this.mapCollectionPaths);try{for(a.s();!(t=a.n()).done;){var i=t.value;this._handles.add(Object(Ce.b)(this.view,"map.".concat(i),"change",n,n,n,!0))}}catch(r){a.e(r)}finally{a.f()}this._handles.add(Object(Ce.e)(this,"isSpatialReferenceDone",(function(){return e._updateTileInfo()}),!0))}},{key:"_ownerNameFromCollectionName",value:function(e){var t=e.lastIndexOf(".");return-1===t?"view":"view."+e.slice(0,t)}},{key:"_ensureLoadedOwnersFromCollectionName",value:function(e){for(var t,n=this._ownerNameFromCollectionName(e).split("."),a=0;a<n.length&&(t=this.get(n.slice(0,a+1).join(".")));a++)if(t.load&&!t.isFulfilled())return{collectionName:e,owner:null,loading:t.load().catch((function(){}))};return{collectionName:e,owner:t}}},{key:"_cancelLoading",value:function(){this._waitTask=null,this._extentProjectController&&(this._extentProjectController.abort(),this._extentProjectController=null)}},{key:"_updateWhen",value:function(e){var t=this,n=!0,a=!1,i=e.catch((function(){})).then((function(){n?a=!0:i===t._waitTask&&t._update()}));return n=!1,a||(this._waitTask=i),a}},{key:"_updateLayerChange",value:function(){this.isSpatialReferenceDone&&!this.spatialReference&&this._set("isSpatialReferenceDone",!1),this._update()}},{key:"_update",value:function(){var e=this;if(this._cancelLoading(),this.view){if(!this.isSpatialReferenceDone){this._debugLog("Starting search for spatial reference...");var t=this._processMapCollections((function(t){return e._processSpatialReferenceSource(t)}));if(this._debugLog("Search ended with status '".concat($i(t),"'")),0!==t){var n=null,a=this._spatialReferenceCandidates;if(!a||a.length<1?(n=this.defaultSpatialReference,this._debugLog("No spatial reference found, locking to default (".concat(Ji(n),")"))):(this.defaultSpatialReference&&a.length>1&&a.findIndex((function(t){return t.equals(e.defaultSpatialReference)}))>-1&&(a=[this.defaultSpatialReference]),n=a[0],this._debugLog("Locking to ".concat(Ji(n)))),this._set("spatialReference",n),n)if(this.extent)this._set("isSpatialReferenceDone",!0);else{var i=this.logDebugInformation;this.logDebugInformation=!1,this._processMapCollections((function(t){return e._findExtent(t,n)})),this.logDebugInformation=i,this._projectExtentCandidate().catch((function(){})).then((function(){return e._set("isSpatialReferenceDone",!0)}))}else this._set("isSpatialReferenceDone",!0)}}if(null==this.heightModelInfo&&this.view.isHeightModelInfoRequired){this._debugLog("Starting search for height model info...");var r=this._processMapCollections((function(t){return e._processHeightModelInfoSource(t)}),(function(e){return function(e){return null!=e.layers||Hi(e)||zi(e)||Bi(e)}(e)}));this._debugLog("Search ended with status ".concat($i(r))),this._set("isHeightModelInfoSearching",0===r)}this._updateTileInfo()}}},{key:"_processMapCollections",value:function(e,t){var n=this;this._preloadMapCollections(t);var a=2;return this._forAllMapCollectionSources((function(e){if(2!==a)return!1;var t=e.collectionName;return n._debugLog("Processing collection ".concat(t,"...")),!(e.loading&&!n._updateWhen(e.loading))||(n._debugLog("Collection ".concat(e.collectionName," owner is loading -> wait")),a=0,!1)}),(function(i){return 2===a&&(null==t||t(i)?!i.load||i.isFulfilled()||n._updateWhen(i.load())?!((!i.load||i.isResolved())&&e(i))||(a=1,!1):(n._debugLog("Source ".concat(i.id," is loading -> wait")),a=0,!1):(n._debugLog("Source ".concat(i.id," is skipped due to predicate")),!1))})),a}},{key:"_preloadMapCollections",value:function(e){var t=this,n=10,a=this.logDebugInformation;this.logDebugInformation=!1,this._forAllMapCollectionSources((function(){return!0}),(function(i){return 0!==n&&(!(null!=e&&!e(i))&&(i.load&&!i.isFulfilled()&&(t.logDebugInformation=a,t._debugLog("Pre-loading source ".concat(i.id)),t.logDebugInformation=!1,i.load().catch((function(){})),n--),!0))})),this.logDebugInformation=a}},{key:"_forAllMapCollectionSources",value:function(e,t){var n,a=Object(se.a)(this.mapCollectionPaths);try{for(a.s();!(n=a.n()).done;){var i=n.value,r="map.".concat(i),o=this._ensureLoadedOwnersFromCollectionName(r);if(!1!==e(o)){var s=o.owner;if(!s||s.isRejected&&s.isRejected())this._debugLog("Collection ".concat(r," owner is invalid or rejected -> skip"));else{var c=this.view.get(r);c?this._forEachSource(c,t):this._debugLog("Collection ".concat(r," does not exist -> skip"))}}}}catch(l){a.e(l)}finally{a.f()}}},{key:"_forEachSource",value:function(e,t){var n,a=Object(se.a)(e.items);try{for(a.s();!(n=a.n()).done;){var i=n.value;!1!==t(i)&&"layers"in i&&i.layers&&this._forEachSource(i.layers,t)}}catch(r){a.e(r)}finally{a.f()}}},{key:"_processSpatialReferenceSource",value:function(e){var t=this._getSupportedSpatialReferences(e);return 0!==t.length&&(this._spatialReferenceCandidates?(t=Object(Ri.e)(t,this._spatialReferenceCandidates,(function(e,t){return e.equals(t)}))).length>0?this._spatialReferenceCandidates=t:this._debugLog("Layer ".concat(e.id," is ignored because its supported spatial\n          references are not compatible with the previous candidates")):this._spatialReferenceCandidates=t,1===this._spatialReferenceCandidates.length)}},{key:"_findExtent",value:function(e,t){var n="fullExtents"in e&&e.fullExtents||(e.fullExtent?[e.fullExtent]:[]),a=n.find((function(e){return e.spatialReference.equals(t)}));if(a)return this._set("extent",a),!0;if(this._getSupportedSpatialReferences(e).length>0){var i=n.map((function(t){return{extent:t,layer:e}})),r=this._extentCandidates||[];this._extentCandidates=r.concat(i)}return!1}},{key:"_projectExtentCandidate",value:function(){var e=Object(s.a)(o.a.mark((function e(){var t,a,i,r,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._extentCandidates&&this._extentCandidates.length){e.next=2;break}return e.abrupt("return");case 2:if(t=this.spatialReference,!(a=this._extentCandidates.find((function(e){return Object(Ua.a)(e.extent.spatialReference,t)})))){e.next=7;break}this._set("extent",Object(Ua.d)(a.extent,t)),e.next=22;break;case 7:return i=this._extentCandidates[0],this._extentProjectController=Object(k.d)(),e.next=11,Promise.resolve().then(n.bind(null,533));case 11:return r=e.sent,e.prev=12,e.next=15,r.projectGeometry(i.extent,t,i.layer.portalItem,this._extentProjectController.signal);case 15:s=e.sent,this._set("extent",s),e.next=21;break;case 19:e.prev=19,e.t0=e.catch(12);case 21:this._extentProjectController=null;case 22:case"end":return e.stop()}}),e,this,[[12,19]])})));return function(){return e.apply(this,arguments)}}()},{key:"_getSupportedSpatialReferences",value:function(e){var t=this,n="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(0===n.length)return this._debugLog("Layer ".concat(e.id," is ignored because it does not have any spatial references")),[];var a=n.filter((function(n){return t.view.isSpatialReferenceSupported(n,e,(function(e){return t._debugLog(e)}))}));return 0===a.length?this._debugLog("Layer ".concat(e.id," has spatial references but none of them are supported (or layer doesn't require locking)")):this._debugLog("Layer ".concat(e.id," has spatial references. Resulting candidate set: ").concat(a.map(Ji).join(", "))),a}},{key:"_processHeightModelInfoSource",value:function(e){var t=Di(e);return!!t&&(this._set("heightModelInfo",t),this._set("isHeightModelInfoSearching",!1),e.spatialReference&&(this._set("vcsWkid",e.spatialReference.vcsWkid),this._set("latestVcsWkid",e.spatialReference.latestVcsWkid)),!0)}},{key:"_updateTileInfo",value:function(){if(null==this.tileInfo)if(this.view.isTileInfoRequired()){if(this.isSpatialReferenceDone){var e=this.get("view.map");if(e){var t=e.basemap,n=e.get("layers.0"),a=null;if(t&&"failed"!==t.loadStatus){if(!t.loaded)return this._updateWhen(t.load()),void this._debugLog("updateTileInfo: basemap still loading");var i=t&&t.get("baseLayers.0");if(i&&"failed"!==i.loadStatus){if(!i.loaded)return this._updateWhen(i.load()),void this._debugLog("updateTileInfo: first basemap layer still loading");a="tileInfo"in i&&i.tileInfo}else{if(!n||"failed"===n.loadStatus)return this._debugLog("updateTileInfo: no tileInfo"),void this._set("isTileInfoDone",!0);if(!n.loaded)return this._updateWhen(n.load()),void this._debugLog("updateTileInfo: first operational layer still loading");a="tileInfo"in n&&n.tileInfo}}else if(n&&"failed"!==n.loadStatus){if(!n.loaded)return this._updateWhen(n.load()),void this._debugLog("updateTileInfo: first operational layer still loading");a="tileInfo"in n&&n.tileInfo}a&&!a.spatialReference.equals(this.spatialReference)&&(a=null),this._debugLog("updateTileInfo: setting ".concat(a)),this._set("tileInfo",a),this._set("isTileInfoDone",!0)}else this._debugLog("updateTileInfo: no map")}}else this._set("isTileInfoDone",!0)}},{key:"_debugLog",value:function(e){this.logDebugInformation&&Gi.info(e)}},{key:"_running",get:function(){return!!(this._handles&&this._handles.size>0)}}]),a}(G.a);function Ji(e){return e?JSON.stringify(e.toJSON()):"undefined"}function $i(e){switch(e){case 0:return"Waiting";case 1:return"Found";case 2:return"Exhausted"}}Ki.DefaultMapCollectionPaths=["basemap.baseLayers","layers","ground.layers","basemap.referenceLayers"],Object(h.a)([Object(m.b)()],Ki.prototype,"logDebugInformation",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Ki.prototype,"isSpatialReferenceDone",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Ki.prototype,"isTileInfoDone",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Ki.prototype,"isHeightModelInfoSearching",void 0),Object(h.a)([Object(m.b)({constructOnly:!0})],Ki.prototype,"view",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Ki.prototype,"spatialReference",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Ki.prototype,"extent",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Ki.prototype,"heightModelInfo",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Ki.prototype,"vcsWkid",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Ki.prototype,"latestVcsWkid",void 0),Object(h.a)([Object(m.b)()],Ki.prototype,"mapCollectionPaths",void 0),Object(h.a)([Object(m.b)()],Ki.prototype,"defaultSpatialReference",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Ki.prototype,"tileInfo",void 0);var Xi,Yi=Ki=Wi=Object(h.a)([Object(O.a)("esri.views.support.DefaultsFromMap")],Ki),Zi=v.a.getLogger("esri.views.View"),Qi=Xi=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e))._userSpatialReference=null,a._cursor=null,a.allLayerViews=new ie.a({root:Object(K.a)(a),rootCollectionNames:["basemapView.baseLayerViews","groundView?.layerViews","layerViews","basemapView.referenceLayerViews"],getChildrenFunction:function(e){return e.layerViews}}),a.animation=null,a.basemapView=null,a.defaultsFromMap=new Yi({view:Object(K.a)(a)}),a.fatalError=null,a.extent=null,a.graphics=new Fe.a,a.navigating=!1,a.layerViews=new te.a,a.magnifier=new ze,a.padding={left:0,top:0,right:0,bottom:0},a.ready=!1,a.spatialReferenceWarningDelay=1e3,a.supportsGround=!0,a.timeExtent=null,a.type=null,a.scale=null,a.updating=!1,a.initialExtentRequired=!0,a.renderContext=null,a.input=new Ai,a.navigation=new Vi,a.layerViewManager=null,a.refreshManager=null,a.isHeightModelInfoRequired=!1,a.width=null,a.height=null,a.resizing=!1,a.suspended=!1,a.viewEvents=new bt(Object(K.a)(a)),a.persistableViewModels=new te.a,a._isValid=!1,a._readyCycleForced=!1,a.handles.add(a.watch("preconditionsReady",(function(e){e?(a._currentSpatialReference=a.spatialReference,Xi.views.add(Object(K.a)(a))):(a._currentSpatialReference=null,Xi.views.remove(Object(K.a)(a))),a.notifyChange("spatialReference"),!e&&a.ready?(a.layerViewManager.clear(),a.toolViewManager.detach(),a._teardown()):e&&!a.ready&&(a._startup(),a.toolViewManager.attach())}),!0)),a}return Object(u.a)(n,[{key:"initialize",value:function(){var e,t=this;this.addResolvingPromise(this.validate().then((function(){return t._isValid=!0,Object(Ce.h)(t,"ready")}))),this.basemapView=new Ee({view:this}),this.layerViewManager=new De({view:this,layerViewImporter:{importLayerView:function(e){return t.importLayerView(e)},hasLayerViewModule:function(e){return t.hasLayerViewModule(e)}},supportsGround:this.supportsGround}),this.refreshManager=new qe({view:this}),this.toolViewManager=new ki({view:this}),this._resetInitialViewPropertiesFromContent(),Object(Ce.a)(this.defaultsFromMap,"isSpatialReferenceDone",(function(n){var a=!!(t.map&&t.map.allLayers.length>0);if(n&&!t.spatialReference&&a||!e){if(n&&!t.spatialReference&&a&&!e){var i=e=Object(k.a)(t.spatialReferenceWarningDelay);e.then((function(){i===e&&Zi.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")})).catch((function(){}))}}else e=null}),!0)}},{key:"destroy",value:function(){if(!this.destroyed){this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics.destroy(),this.graphics=null,this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),this.toolViewManager.destroy(),this.toolViewManager=null,this.refreshManager.destroy(),this.refreshManager=null,this.layerViewManager.destroy(),this.layerViewManager=null,this.basemapView.destroy(),this.basemapView=null,this.invalidate(),this._emitter.clear(),this.handles.removeAll();var e=this.map;this.map=null,null==e||e.destroy()}}},{key:"_startup",value:function(){this._set("ready",!0)}},{key:"_teardown",value:function(){this._set("ready",!1)}},{key:"whenReady",value:function(){return Object(k.s)()}},{key:"toMap",value:function(){return Zi.error("#toMap()","Not implemented on this instance of View"),null}},{key:"whenLayerView",value:function(e){return this.layerViewManager.whenLayerView(e)}},{key:"getDefaultSpatialReference",value:function(){return this.get("defaultsFromMap.spatialReference")}},{key:"getDefaultHeightModelInfo",value:function(){return this.get("map.supportsHeightModelInfo")&&this.get("map.heightModelInfo")||this.get("defaultsFromMap.heightModelInfo")||null}},{key:"importLayerView",value:function(e){throw new _.a("importLayerView() not implemented")}},{key:"hasLayerViewModule",value:function(e){return!1}},{key:"validate",value:function(){var e=Object(s.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"invalidate",value:function(){this._isValid=!1}},{key:"isSpatialReferenceSupported",value:function(e,t,n){return!0}},{key:"isTileInfoRequired",value:function(){return!1}},{key:"when",value:function(e,t){return this.isResolved()&&!this.ready&&Zi.warn("#when()",'Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use watchUtils.whenOnce(view, "ready").then(...) instead.'),Object(J.a)(Object($.a)(n.prototype),"when",this).call(this,e,t)}},{key:"forceReadyCycle",value:function(){var e=this;this.ready&&(this._readyCycleForced=!0,Object(Ce.g)(this,"preconditionsReady",(function(){return e._readyCycleForced=!1})))}},{key:"createTool",value:function(e,t,n){return this.toolViewManager.createTool(e,t,n)}},{key:"tryFatalErrorRecovery",value:function(){this.fatalError=null}},{key:"_resetInitialViewPropertiesFromContent",value:function(){var e=this;if(this.defaultsFromMap){var t=function(){return e.defaultsFromMap&&e.defaultsFromMap.start()};this.defaultsFromMap.reset(),this._currentSpatialReference=null,this.notifyChange("spatialReference"),this.handles.remove("defaultsFromMap"),this.handles.add([Object(Ce.d)(this,"spatialReference",(function(e,n){Object(Z.c)(e,n)||t()})),Object(Ce.d)(this,"initialExtentRequired",t),Object(Y.b)(t)],"defaultsFromMap")}}},{key:"heightModelInfo",get:function(){return this.getDefaultHeightModelInfo()}},{key:"interacting",get:function(){return this.navigating}},{key:"preconditionsReady",get:function(){return!!(!this.fatalError&&this._isValid&&!this._readyCycleForced&&this.map&&(!ae.a.isLoadable(this.map)||this.map.loaded)&&0!==this.width&&0!==this.height&&this.spatialReference&&this.isSpatialReferenceSupported(this.spatialReference)&&(this._currentSpatialReference||!this.initialExtentRequired||this.initialExtent||this.defaultsFromMap&&this.defaultsFromMap.isSpatialReferenceDone)&&this.defaultsFromMap&&this.defaultsFromMap.isTileInfoDone)}},{key:"map",set:function(e){var t;e!==this._get("map")&&(null!=(t=e)&&t.destroyed&&(Zi.warn("#map","The provided map is already destroyed",{map:e}),e=null),ae.a.isLoadable(e)&&e.load().catch((function(){})),this.initialized&&(this.forceReadyCycle(),this._resetInitialViewPropertiesFromContent()),this._set("map",e))}},{key:"spatialReference",get:function(){var e=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return e&&this.isHeightModelInfoRequired&&this.defaultsFromMap&&((e=e.clone()).vcsWkid=this.defaultsFromMap.vcsWkid,e.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),e},set:function(e){this._userSpatialReference=e,this._set("spatialReference",e)}},{key:"stationary",get:function(){return!this.animation&&!this.navigating&&!this.resizing}},{key:"initialExtent",get:function(){return this.defaultsFromMap&&this.defaultsFromMap.extent}},{key:"cursor",get:function(){var e=this.toolViewManager?this.toolViewManager.cursor:null;return Object(b.g)(e)?e:this._cursor||"default"},set:function(e){this._cursor=e,this.notifyChange("cursor")}},{key:"size",get:function(){return[this.width,this.height]}}]),n}(Object(B.b)(ee.a.EventedMixin(Object(ne.b)(G.a))));Qi.views=new te.a,Object(h.a)([Object(X.a)("toolViewManager.activeTool")],Qi.prototype,"activeTool",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Qi.prototype,"allLayerViews",void 0),Object(h.a)([Object(m.b)()],Qi.prototype,"animation",void 0),Object(h.a)([Object(m.b)()],Qi.prototype,"basemapView",void 0),Object(h.a)([Object(m.b)()],Qi.prototype,"defaultsFromMap",void 0),Object(h.a)([Object(m.b)()],Qi.prototype,"fatalError",void 0),Object(h.a)([Object(m.b)({type:M.a})],Qi.prototype,"extent",void 0),Object(h.a)([Object(m.b)(Object(Fe.b)())],Qi.prototype,"graphics",void 0),Object(h.a)([Object(m.b)({readOnly:!0,type:Te.a,dependsOn:["map.heightModelInfo?","defaultsFromMap.heightModelInfo"],autoTracked:!1})],Qi.prototype,"heightModelInfo",null),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["navigating"]})],Qi.prototype,"interacting",null),Object(h.a)([Object(m.b)({readOnly:!0})],Qi.prototype,"navigating",void 0),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","initialExtentRequired","initialExtent","defaultsFromMap.isSpatialReferenceDone","defaultsFromMap.isTileInfoDone"],autoTracked:!1})],Qi.prototype,"preconditionsReady",null),Object(h.a)([Object(m.b)({type:te.a,readOnly:!0})],Qi.prototype,"layerViews",void 0),Object(h.a)([Object(m.b)({type:ze})],Qi.prototype,"magnifier",void 0),Object(h.a)([Object(m.b)({value:null,type:xe})],Qi.prototype,"map",null),Object(h.a)([Object(m.b)()],Qi.prototype,"padding",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Qi.prototype,"ready",void 0),Object(h.a)([Object(m.b)({type:Q.a,dependsOn:["defaultsFromMap.spatialReference","defaultsFromMap.vcsWkid","defaultsFromMap.latestVcsWkid"]})],Qi.prototype,"spatialReference",null),Object(h.a)([Object(m.b)()],Qi.prototype,"spatialReferenceWarningDelay",void 0),Object(h.a)([Object(m.b)({dependsOn:["animation","navigating","resizing"]})],Qi.prototype,"stationary",null),Object(h.a)([Object(m.b)({readOnly:!0})],Qi.prototype,"supportsGround",void 0),Object(h.a)([Object(m.b)({type:T.a})],Qi.prototype,"timeExtent",void 0),Object(h.a)([Object(X.a)("toolViewManager.tools")],Qi.prototype,"tools",void 0),Object(h.a)([Object(m.b)()],Qi.prototype,"toolViewManager",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Qi.prototype,"type",void 0),Object(h.a)([Object(m.b)({type:Number})],Qi.prototype,"scale",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Qi.prototype,"updating",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Qi.prototype,"initialExtentRequired",void 0),Object(h.a)([Object(m.b)({readOnly:!0,type:M.a,dependsOn:["defaultsFromMap.extent"]})],Qi.prototype,"initialExtent",null),Object(h.a)([Object(m.b)({dependsOn:["toolViewManager.cursor"]})],Qi.prototype,"cursor",null),Object(h.a)([Object(m.b)()],Qi.prototype,"renderContext",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Qi.prototype,"input",void 0),Object(h.a)([Object(m.b)({type:Vi,nonNullable:!0})],Qi.prototype,"navigation",void 0),Object(h.a)([Object(m.b)()],Qi.prototype,"layerViewManager",void 0),Object(h.a)([Object(m.b)()],Qi.prototype,"width",void 0),Object(h.a)([Object(m.b)()],Qi.prototype,"height",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Qi.prototype,"resizing",void 0),Object(h.a)([Object(m.b)({value:null,dependsOn:["width","height"],readOnly:!0})],Qi.prototype,"size",null),Object(h.a)([Object(m.b)({readOnly:!0})],Qi.prototype,"suspended",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Qi.prototype,"viewEvents",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],Qi.prototype,"persistableViewModels",void 0),Object(h.a)([Object(m.b)()],Qi.prototype,"_isValid",void 0),Object(h.a)([Object(m.b)()],Qi.prototype,"_readyCycleForced",void 0),Object(h.a)([Object(m.b)()],Qi.prototype,"_currentSpatialReference",void 0);var er=Qi=Xi=Object(h.a)([Object(O.a)("esri.views.View")],Qi),tr={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"},nr=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(){var e;return Object(l.a)(this,n),(e=t.apply(this,arguments))._scale=null,e.view=null,e}return Object(u.a)(n,[{key:"destroy",value:function(){this.layer=this.view=null}},{key:"toJSON",value:function(){var e=this.layer,t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t=Object(c.a)(Object(c.a)({},t),{},{layers:this.layers,layerDefs:this.layerDefs}),t}},{key:"dynamicLayers",get:function(){if(!this.hasDynamicLayers)return null;var e=this.visibleSublayers.map((function(e){return e.toExportImageJSON()}));return e.length?JSON.stringify(e):null}},{key:"hasDynamicLayers",get:function(){return this.layer&&Object(W.a)(this.visibleSublayers,this.layer.serviceSublayers,this.layer)}},{key:"layer",set:function(e){var t=this;this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",(function(){return t.notifyChange("visibleSublayers")})),e.on("sublayer-update",(function(e){return t.notifyChange(tr[e.propertyName])}))],"layer"))}},{key:"layers",get:function(){var e=this.visibleSublayers;return e?e.length?"show:"+e.map((function(e){return e.id})).join(","):"show:-1":null}},{key:"layerDefs",get:function(){var e=this.visibleSublayers.filter((function(e){return null!=e.definitionExpression}));return e.length?JSON.stringify(e.reduce((function(e,t){return e[t.id]=t.definitionExpression,e}),{})):null}},{key:"scale",get:function(){return null!=this._scale?this._scale:this.view&&this.view.scale||0},set:function(e){this.view||(this._scale=e,this.notifyChange("scale"))}},{key:"version",get:function(){var e=this;e.layers,e.layerDefs,e.dynamicLayers,e.timeExtent;var t=e.layer;return t&&(t.dpi,t.imageFormat,t.imageTransparency,t.gdbVersion),(this._get("version")||0)+1},set:function(e){this._set("version",e)}},{key:"visibleSublayers",get:function(){var e=this,t=[];if(!this.layer)return t;var n=this.layer.sublayers;n&&n.forEach((function n(a){var i=e.scale,r=0===i,o=0===a.minScale||i<=a.minScale,s=0===a.maxScale||i>=a.maxScale;a.visible&&(r||o&&s)&&(a.sublayers?a.sublayers.forEach(n):t.unshift(a))}));var a=this._get("visibleSublayers");return!a||a.length!==t.length||a.some((function(e,n){return t[n]!==e}))?t:a}}]),n}(Object(B.b)(G.a));Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["hasDynamicLayers","visibleSublayers"]})],nr.prototype,"dynamicLayers",null),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["visibleSublayers","layer.serviceSublayers","layer.capabilities"]})],nr.prototype,"hasDynamicLayers",null),Object(h.a)([Object(m.b)()],nr.prototype,"layer",null),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["visibleSublayers"]})],nr.prototype,"layers",null),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["visibleSublayers"]})],nr.prototype,"layerDefs",null),Object(h.a)([Object(m.b)({type:Number,dependsOn:["view.scale"]})],nr.prototype,"scale",null),Object(h.a)([Object(m.b)(E.a)],nr.prototype,"timeExtent",void 0),Object(h.a)([Object(m.b)({dependsOn:["layers","layerDefs","dynamicLayers","layer.dpi","layer.imageFormat","layer.imageTransparency","layer.gdbVersion","timeExtent"]})],nr.prototype,"version",null),Object(h.a)([Object(m.b)({type:er})],nr.prototype,"view",void 0),Object(h.a)([Object(m.b)({readOnly:!0,dependsOn:["layer.sublayers","scale"]})],nr.prototype,"visibleSublayers",null),nr=Object(h.a)([Object(O.a)("esri.layers.mixins.ExportImageParameters")],nr);var ar=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).alwaysRefetch=!1,e.dpi=96,e.gdbVersion=null,e.imageFormat="png24",e.imageMaxHeight=2048,e.imageMaxWidth=2048,e.imageTransparency=!0,e.labelsVisible=!1,e.isReference=null,e.operationalLayerType="ArcGISMapServiceLayer",e.sourceJSON=null,e.sublayers=null,e.type="map-image",e.url=null,e}return Object(u.a)(n,[{key:"normalizeCtorArgs",value:function(e,t){return"string"==typeof e?Object(c.a)({url:e},t):e}},{key:"load",value:function(e){var t=this,n=Object(b.g)(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},e).then((function(){return t._fetchService(n)}),(function(){return t._fetchService(n)}))),Object(k.s)(this)}},{key:"readImageFormat",value:function(e,t){var n=t.supportedImageFormatTypes;return n&&n.indexOf("PNG32")>-1?"png32":"png24"}},{key:"writeSublayers",value:function(e,t,n,a){if(this.loaded&&e){var i=e.slice().reverse().flatten((function(e){var t=e.sublayers;return t&&t.toArray().reverse()})).toArray(),r=!1;if(this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap.supportsDynamicLayers){var o=Object(w.d)(a.origin);if(3===o){var s=this.createSublayersForOrigin("service").sublayers;r=Object(W.c)(i,s,2)}else if(o>3){var l=this.createSublayersForOrigin("portal-item");r=Object(W.c)(i,l.sublayers,Object(w.d)(l.origin))}}var u=[],d=Object(c.a)({writeSublayerStructure:r},a),p=r;i.forEach((function(e){var t=e.write({},d);u.push(t),p=p||"user"===e.originOf("visible")})),u.some((function(e){return Object.keys(e).length>1}))&&(t.layers=u),p&&(t.visibleLayers=i.filter((function(e){return e.visible})).map((function(e){return e.id})))}}},{key:"createExportImageParameters",value:function(e,t,n,a){var i=a&&a.pixelRatio||1;e&&this.version>=10&&(e=e.clone().shiftCentralMeridian());var r=new nr({layer:this,scale:Object(z.a)({extent:e,width:t})*i}),o=r.toJSON();r.destroy();var s=!a||!a.rotation||this.version<10.3?{}:{rotation:-a.rotation},l=e&&e.spatialReference,u=l.wkid||JSON.stringify(l.toJSON());o.dpi*=i;var d={};if(null!=a&&a.timeExtent){var p=a.timeExtent.toJSON(),h=p.start,f=p.end;d.time=h&&f&&h===f?""+h:"".concat(null==h?"null":h,",").concat(null==f?"null":f)}else this.timeInfo&&!this.timeInfo.hasLiveData&&(d.time="null,null");return Object(c.a)(Object(c.a)(Object(c.a)({bbox:e&&e.xmin+","+e.ymin+","+e.xmax+","+e.ymax,bboxSR:u,imageSR:u,size:t+","+n},o),s),d)}},{key:"fetchImage",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n,a,i){var r,s,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={responseType:"image"},i&&i.timestamp&&(r.query=Object(c.a)(Object(c.a)({},r.query),{},{_ts:i.timestamp})),i&&i.signal&&(r.signal=i.signal),this.customParameters&&Object.keys(this.customParameters).length&&(r.query=Object(c.a)(Object(c.a)({},this.customParameters),r.query)),s=this.parsedUrl.path+"/export",null==(l=Object(c.a)(Object(c.a)(Object(c.a)({},this.parsedUrl.query),this.createExportImageParameters(t,n,a,i)),{},{f:"image",_ts:this.alwaysRefetch?Date.now():null})).dynamicLayers||this.capabilities.exportMap.supportsDynamicLayers){e.next=5;break}return e.abrupt("return",Object(k.r)(new _.a("mapimagelayer:dynamiclayer-not-supported","service ".concat(this.url," doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source."),{query:l})));case 5:return r.query?r.query=Object(c.a)(Object(c.a)({},l),r.query):r.query=l,e.abrupt("return",Object(I.default)(s,r).then((function(e){return e.data})).catch((function(e){if(Object(k.l)(e))throw e;throw new _.a("mapimagelayer:image-fetch-error","Unable to load image: ".concat(s),{error:e})})));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,a,i){return e.apply(this,arguments)}}()},{key:"fetchRecomputedExtents",value:function(){var e=Object(s.a)(o.a.mark((function e(){var t,n,a,i,r,s,l,u,d=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=d.length>0&&void 0!==d[0]?d[0]:{},n=Object(c.a)(Object(c.a)({},t),{},{query:{returnUpdates:!0,f:"json"}}),e.next=4,Object(I.default)(this.url,n);case 4:return a=e.sent,i=a.data,r=i.extent,s=i.fullExtent,l=i.timeExtent,u=r||s,e.abrupt("return",{fullExtent:u&&M.a.fromJSON(u),timeExtent:l&&T.a.fromJSON({start:l[0],end:l[1]})});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadAll",value:function(){var e=this;return Object(x.a)(this,(function(t){t(e.allSublayers)}))}},{key:"_fetchService",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var n,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.sourceJSON){e.next=2;break}return e.abrupt("return",void this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl}));case 2:return e.next=4,Object(I.default)(this.parsedUrl.path,{query:Object(c.a)(Object(c.a)({f:"json"},this.parsedUrl.query),this.customParameters),signal:t});case 4:n=e.sent,a=n.data,n.ssl&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=a,this.read(a,{origin:"service",url:this.parsedUrl});case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(Object(S.a)(Object(D.a)(Object(N.a)(Object(R.a)(Object(q.a)(Object(U.a)(Object(P.a)(Object(A.a)(Object(V.a)(Object(F.a)(Object(L.a)(Object(B.b)(C.a)))))))))))));Object(h.a)([Object(m.b)()],ar.prototype,"alwaysRefetch",void 0),Object(h.a)([Object(m.b)()],ar.prototype,"dpi",void 0),Object(h.a)([Object(m.b)()],ar.prototype,"gdbVersion",void 0),Object(h.a)([Object(m.b)({json:{read:!1,write:!1}})],ar.prototype,"popupEnabled",void 0),Object(h.a)([Object(m.b)()],ar.prototype,"imageFormat",void 0),Object(h.a)([Object(g.a)("imageFormat",["supportedImageFormatTypes"])],ar.prototype,"readImageFormat",null),Object(h.a)([Object(m.b)({json:{origins:{service:{read:{source:"maxImageHeight"}}}}})],ar.prototype,"imageMaxHeight",void 0),Object(h.a)([Object(m.b)({json:{origins:{service:{read:{source:"maxImageWidth"}}}}})],ar.prototype,"imageMaxWidth",void 0),Object(h.a)([Object(m.b)()],ar.prototype,"imageTransparency",void 0),Object(h.a)([Object(m.b)({json:{read:!1,write:!1}})],ar.prototype,"labelsVisible",void 0),Object(h.a)([Object(m.b)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}}})],ar.prototype,"isReference",void 0),Object(h.a)([Object(m.b)({type:["ArcGISMapServiceLayer"]})],ar.prototype,"operationalLayerType",void 0),Object(h.a)([Object(m.b)()],ar.prototype,"sourceJSON",void 0),Object(h.a)([Object(m.b)({json:{write:{ignoreOrigin:!0}}})],ar.prototype,"sublayers",void 0),Object(h.a)([Object(j.a)("sublayers",{layers:{type:[H.a]},visibleLayers:{type:[y.a]}})],ar.prototype,"writeSublayers",null),Object(h.a)([Object(m.b)({type:["show","hide","hide-children"]})],ar.prototype,"listMode",void 0),Object(h.a)([Object(m.b)({json:{read:!1},readOnly:!0,value:"map-image"})],ar.prototype,"type",void 0),Object(h.a)([Object(m.b)(E.j)],ar.prototype,"url",void 0);var ir=ar=Object(h.a)([Object(O.a)("esri.layers.MapImageLayer")],ar);t.default=ir},923:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(2),i=n(3),r=n(10),o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e.values().next().value};Object(a.a)(this,e),this._peeker=t,this._items=new Set}return Object(i.a)(e,[{key:"clear",value:function(){this._items.clear()}},{key:"peek",value:function(){if(0!==this._items.size)return this._peeker(this._items)}},{key:"push",value:function(e){this.contains(e)||this._items.add(e)}},{key:"contains",value:function(e){return this._items.has(e)}},{key:"pop",value:function(){if(0!==this.length){var e=this.peek();return this._items.delete(Object(r.c)(e)),e}}},{key:"remove",value:function(e){this._items.delete(e)}},{key:"filter",value:function(e){var t=this;return this._items.forEach((function(n){e(n)||t._items.delete(n)})),this}},{key:"length",get:function(){return this._items.size}}]),e}()},929:function(e,t,n){"use strict";n.d(t,"a",(function(){return O}));var a=n(16),i=n(2),r=n(3),o=n(51),s=n(4),c=n(5),l=n(0),u=(n(13),n(12)),d=(n(14),n(1)),p=n(6),h=(n(9),n(19),n(20),n(15)),f=n(42),b=n(169),v=n(183);function y(e){return e&&"group"===e.type}function m(e,t,n){var a,i;if(e)for(var r=0,o=e.length;r<o;r++){if((a=e.getItemAt(r))[t]===n)return a;if(y(a)&&(i=m(a.layers,t,n)))return i}}var g=u.a.getLogger("esri.support.LayersMixin"),O=function(e){var t=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];(e=t.call.apply(t,[this].concat(r))).layers=new f.a;var c=function(t){t.parent=Object(o.a)(e),e.layerAdded(t),"elevation"!==t.type&&"base-elevation"!==t.type||g.error("Layer 'title:".concat(t.title,", id:").concat(t.id,"' of type '").concat(t.type,"' is not supported as an operational layer and will therefore be ignored."))},l=function(t){t.parent=null,e.layerRemoved(t)};return e.layers.on("before-add",(function(e){var t;(t=e.item).parent&&"remove"in t.parent&&t.parent.remove(t)})),e.layers.on("after-add",(function(e){return c(e.item)})),e.layers.on("after-remove",(function(e){return l(e.item)})),e}return Object(r.a)(n,[{key:"destroy",value:function(){var e,t=this.layers.removeAll(),n=Object(a.a)(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;this.layerRemoved(i),i.destroy()}}catch(r){n.e(r)}finally{n.f()}this.layers.destroy()}},{key:"add",value:function(e,t){var n=this,a=this.layers;t=a.getNextIndex(t),e instanceof v.a?e.parent===this?this.reorder(e,t):a.add(e,t):Object(h.n)(e)?e.then((function(e){n.destroyed||n.add(e,t)})):g.error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}},{key:"addMany",value:function(e,t){var n=this,a=this.layers;t=a.getNextIndex(t),e.slice().forEach((function(e){e.parent!==n?(a.add(e,t),t+=1):n.reorder(e,t)}))}},{key:"findLayerById",value:function(e){return m(this.layers,"id",e)}},{key:"findLayerByUid",value:function(e){return m(this.layers,"uid",e)}},{key:"remove",value:function(e){return this.layers.remove(e)}},{key:"removeMany",value:function(e){return this.layers.removeMany(e)}},{key:"removeAll",value:function(){return this.layers.removeAll()}},{key:"reorder",value:function(e,t){return this.layers.reorder(e,t)}},{key:"layerAdded",value:function(e){}},{key:"layerRemoved",value:function(e){}},{key:"layers",set:function(e){this._set("layers",Object(b.b)(e,this._get("layers")))}}]),n}(e);return Object(l.a)([Object(d.b)()],t.prototype,"layers",null),t=Object(l.a)([Object(p.a)("esri.support.LayersMixin")],t)}},930:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var a=n(16),i=n(2),r=n(3),o=n(51),s=n(4),c=n(5),l=n(0),u=(n(13),n(12)),d=(n(14),n(1)),p=n(6),h=(n(9),n(19),n(20),n(42)),f=n(169),b=u.a.getLogger("esri.support.TablesMixin");function v(e){return e&&"group"===e.type}function y(e,t,n){if(e)for(var a=0,i=e.length;a<i;a++){var r=e.getItemAt(a);if(r[t]===n)return r;if(v(r)){var o=y(r.tables,t,n);if(o)return o}}}var m=function(e){var t=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).tables=new h.a,e.tables.on("after-add",(function(t){var n=t.item;n.parent&&n.parent!==Object(o.a)(e)&&"tables"in n.parent&&n.parent.tables.remove(n),n.parent=Object(o.a)(e),"feature"!==n.type&&b.error("Layer 'title:".concat(n.title,", id:").concat(n.id,"' of type '").concat(n.type,"' is not supported as a table and will therefore be ignored."))})),e.tables.on("after-remove",(function(e){e.item.parent=null})),e}return Object(r.a)(n,[{key:"destroy",value:function(){var e,t=this.tables.removeAll(),n=Object(a.a)(t);try{for(n.s();!(e=n.n()).done;){e.value.destroy()}}catch(i){n.e(i)}finally{n.f()}this.tables.destroy()}},{key:"findTableById",value:function(e){return y(this.tables,"id",e)}},{key:"findTableByUid",value:function(e){return y(this.tables,"uid",e)}},{key:"tables",set:function(e){this._set("tables",Object(f.b)(e,this._get("tables")))}}]),n}(e);return Object(l.a)([Object(d.b)()],t.prototype,"tables",null),t=Object(l.a)([Object(p.a)("esri.support.TablesMixin")],t)}},932:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(78);function i(e,t){var n=t||e.extent,i=e.width,r=Object(a.b)(n&&n.spatialReference);return n&&i?n.width/i*r*a.f*96:0}}}]);
//# sourceMappingURL=15.6cfbf0d9.chunk.js.map