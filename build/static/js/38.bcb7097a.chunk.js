(this["webpackJsonpqp-ampd-app"]=this["webpackJsonpqp-ampd-app"]||[]).push([[38],{1036:function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return n}));var n={Base64:0,Hex:1,String:2,Raw:3};function i(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function a(e,t,r,n,a,s){return i((o=i(i(t,e),i(n,s)))<<(c=a)|o>>>32-c,r);var o,c}function s(e,t,r,n,i,s,o){return a(t&r|~t&n,e,t,i,s,o)}function o(e,t,r,n,i,s,o){return a(t&n|r&~n,e,t,i,s,o)}function c(e,t,r,n,i,s,o){return a(t^r^n,e,t,i,s,o)}function u(e,t,r,n,i,s,o){return a(r^(t|~n),e,t,i,s,o)}function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.Hex,r=t||n.Base64,a=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var r=1732584193,n=-271733879,a=-1732584194,h=271733878,l=0;l<e.length;l+=16){var f=r,d=n,y=a,v=h;r=s(r,n,a,h,e[l+0],7,-680876936),h=s(h,r,n,a,e[l+1],12,-389564586),a=s(a,h,r,n,e[l+2],17,606105819),n=s(n,a,h,r,e[l+3],22,-1044525330),r=s(r,n,a,h,e[l+4],7,-176418897),h=s(h,r,n,a,e[l+5],12,1200080426),a=s(a,h,r,n,e[l+6],17,-1473231341),n=s(n,a,h,r,e[l+7],22,-45705983),r=s(r,n,a,h,e[l+8],7,1770035416),h=s(h,r,n,a,e[l+9],12,-1958414417),a=s(a,h,r,n,e[l+10],17,-42063),n=s(n,a,h,r,e[l+11],22,-1990404162),r=s(r,n,a,h,e[l+12],7,1804603682),h=s(h,r,n,a,e[l+13],12,-40341101),a=s(a,h,r,n,e[l+14],17,-1502002290),r=o(r,n=s(n,a,h,r,e[l+15],22,1236535329),a,h,e[l+1],5,-165796510),h=o(h,r,n,a,e[l+6],9,-1069501632),a=o(a,h,r,n,e[l+11],14,643717713),n=o(n,a,h,r,e[l+0],20,-373897302),r=o(r,n,a,h,e[l+5],5,-701558691),h=o(h,r,n,a,e[l+10],9,38016083),a=o(a,h,r,n,e[l+15],14,-660478335),n=o(n,a,h,r,e[l+4],20,-405537848),r=o(r,n,a,h,e[l+9],5,568446438),h=o(h,r,n,a,e[l+14],9,-1019803690),a=o(a,h,r,n,e[l+3],14,-187363961),n=o(n,a,h,r,e[l+8],20,1163531501),r=o(r,n,a,h,e[l+13],5,-1444681467),h=o(h,r,n,a,e[l+2],9,-51403784),a=o(a,h,r,n,e[l+7],14,1735328473),r=c(r,n=o(n,a,h,r,e[l+12],20,-1926607734),a,h,e[l+5],4,-378558),h=c(h,r,n,a,e[l+8],11,-2022574463),a=c(a,h,r,n,e[l+11],16,1839030562),n=c(n,a,h,r,e[l+14],23,-35309556),r=c(r,n,a,h,e[l+1],4,-1530992060),h=c(h,r,n,a,e[l+4],11,1272893353),a=c(a,h,r,n,e[l+7],16,-155497632),n=c(n,a,h,r,e[l+10],23,-1094730640),r=c(r,n,a,h,e[l+13],4,681279174),h=c(h,r,n,a,e[l+0],11,-358537222),a=c(a,h,r,n,e[l+3],16,-722521979),n=c(n,a,h,r,e[l+6],23,76029189),r=c(r,n,a,h,e[l+9],4,-640364487),h=c(h,r,n,a,e[l+12],11,-421815835),a=c(a,h,r,n,e[l+15],16,530742520),r=u(r,n=c(n,a,h,r,e[l+2],23,-995338651),a,h,e[l+0],6,-198630844),h=u(h,r,n,a,e[l+7],10,1126891415),a=u(a,h,r,n,e[l+14],15,-1416354905),n=u(n,a,h,r,e[l+5],21,-57434055),r=u(r,n,a,h,e[l+12],6,1700485571),h=u(h,r,n,a,e[l+3],10,-1894986606),a=u(a,h,r,n,e[l+10],15,-1051523),n=u(n,a,h,r,e[l+1],21,-2054922799),r=u(r,n,a,h,e[l+8],6,1873313359),h=u(h,r,n,a,e[l+15],10,-30611744),a=u(a,h,r,n,e[l+6],15,-1560198380),n=u(n,a,h,r,e[l+13],21,1309151649),r=u(r,n,a,h,e[l+4],6,-145523070),h=u(h,r,n,a,e[l+11],10,-1120210379),a=u(a,h,r,n,e[l+2],15,718787259),n=u(n,a,h,r,e[l+9],21,-343485551),r=i(r,f),n=i(n,d),a=i(a,y),h=i(h,v)}return[r,n,a,h]}(function(e){for(var t=[],r=0,n=8*e.length;r<n;r+=8)t[r>>5]|=(255&e.charCodeAt(r/8))<<r%32;return t}(e),8*e.length);switch(r){case n.Raw:return a;case n.Hex:return function(e){for(var t="0123456789abcdef",r=[],n=0,i=4*e.length;n<i;n++)r.push(t.charAt(e[n>>2]>>n%4*8+4&15)+t.charAt(e[n>>2]>>n%4*8&15));return r.join("")}(a);case n.String:return function(e){for(var t=[],r=0,n=32*e.length;r<n;r+=8)t.push(String.fromCharCode(e[r>>5]>>>r%32&255));return t.join("")}(a);case n.Base64:return function(e){for(var t=[],r=0,n=4*e.length;r<n;r+=3)for(var i=(e[r>>2]>>r%4*8&255)<<16|(e[r+1>>2]>>(r+1)%4*8&255)<<8|e[r+2>>2]>>(r+2)%4*8&255,a=0;a<4;a++)8*r+6*a>32*e.length?t.push("="):t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>6*(3-a)&63));return t.join("")}(a)}}},1109:function(e,t,r){"use strict";var n=r(2),i=r(3),a=r(5),s=r(6),o=r(0),c=(r(15),r(14),r(18),r(1)),u=r(8),h=(r(12),r(21),r(22),function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(){return Object(n.a)(this,r),t.apply(this,arguments)}return Object(i.a)(r,[{key:"initialize",value:function(){}},{key:"destroy",value:function(){}},{key:"supportsTileUpdates",get:function(){return!1}},{key:"spatialReference",get:function(){var e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null}}]),r}(r(105).a));Object(o.a)([Object(c.b)({readOnly:!0})],h.prototype,"supportsTileUpdates",null),Object(o.a)([Object(c.b)({constructOnly:!0})],h.prototype,"remoteClient",void 0),Object(o.a)([Object(c.b)({constructOnly:!0})],h.prototype,"service",void 0),Object(o.a)([Object(c.b)({dependsOn:["tileStore.tileScheme.spatialReference"]})],h.prototype,"spatialReference",null),Object(o.a)([Object(c.b)({constructOnly:!0})],h.prototype,"tileInfo",void 0),Object(o.a)([Object(c.b)({constructOnly:!0})],h.prototype,"tileStore",void 0);var l=h=Object(o.a)([Object(u.a)("esri.views.2d.layers.features.processors.BaseProcessor")],h);t.a=l},1225:function(e,t,r){"use strict";r.r(t);var n=r(13),i=r(7),a=r.n(i),s=r(16),o=r(2),c=r(3),u=r(5),h=r(6),l=r(0),f=r(15),d=r(4),y=r(14),v=(r(18),r(1)),p=r(8),b=r(20),m=(r(12),r(21),r(22),r(17)),_=r(48),g=r(426),x=r(558),O=new(r(1153).a);function j(e){return O.hasBidiChar(e)?(t="rtl"===O.checkContextual(e)?"IDNNN":"ICNNN",[O.bidiTransform(e,t,"VLYSN"),!0]):[e,!1];var t}var k=r(10),M=r(61),w=r(57),S=r(144),T=r(148),L=r(458),C=r(1119),z=r(280),I=r(66),R=r(1080),V=r(980);function P(e){switch(e){case"above-along":case"below-along":case"center-along":return 1;default:return 0}}function D(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=V.c.SIZE_FIELD_STOPS|V.c.SIZE_MINMAX_VALUE|V.c.SIZE_SCALE_STOPS|V.c.SIZE_UNIT_VALUE,n=(e&(V.d.FIELD_TARGETS_OUTLINE|V.d.MINMAX_TARGETS_OUTLINE|V.d.SCALE_TARGETS_OUTLINE|V.d.UNIT_TARGETS_OUTLINE))>>>4;return t?r&n:r&~n}function A(e,t,r,n,i){switch(e){case V.b.FILL:return U.from(t,n);case V.b.LINE:return N.from(t,r);case V.b.MARKER:return Z.from(t);case V.b.TEXT:return X.from(t);case V.b.LABEL:return W.from(t,i);default:throw new Error("Unable to createMaterialKey for unknown geometryType ".concat(e))}}var F=function(){function e(t){Object(o.a)(this,e),this._data=0,this._data=t}return Object(c.a)(e,[{key:"data",get:function(){return this._data},set:function(e){this._data=e}},{key:"geometryType",get:function(){return this.bits(8,11)},set:function(e){this.setBits(e,8,11)}},{key:"mapAligned",get:function(){return!!this.bit(20)},set:function(e){this.setBit(20,e)}},{key:"sdf",get:function(){return!!this.bit(11)},set:function(e){this.setBit(11,e)}},{key:"pattern",get:function(){return!!this.bit(12)},set:function(e){this.setBit(12,e)}},{key:"textureBinding",get:function(){return this.bits(0,8)},set:function(e){this.setBits(e,0,8)}},{key:"geometryTypeString",get:function(){switch(this.geometryType){case V.b.FILL:return"fill";case V.b.MARKER:return"marker";case V.b.LINE:return"line";case V.b.TEXT:return"text";case V.b.LABEL:return"label";default:throw new b.a("Unable to handle unknown geometryType: ".concat(this.geometryType))}}},{key:"setBit",value:function(e,t){var r=1<<e;t?this._data|=r:this._data&=~r}},{key:"bit",value:function(e){return(this._data&1<<e)>>e}},{key:"setBits",value:function(e,t,r){for(var n=t,i=0;n<r;n++,i++)this.setBit(n,0!=(e&1<<i))}},{key:"bits",value:function(e,t){for(var r=0,n=e,i=0;n<t;n++,i++)r|=this.bit(n)<<i;return r}},{key:"hasVV",value:function(){return!1}},{key:"setVV",value:function(e,t){}},{key:"getVariation",value:function(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf}}},{key:"getVariationHash",value:function(){return this._data&~(7&this.textureBinding)}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}}]),e}();F.shared=new F(0);var B=function(e){return function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(c.a)(r,[{key:"vvSizeMinMaxValue",get:function(){return 0!==this.bit(16)},set:function(e){this.setBit(16,e)}},{key:"vvSizeScaleStops",get:function(){return 0!==this.bit(17)},set:function(e){this.setBit(17,e)}},{key:"vvSizeFieldStops",get:function(){return 0!==this.bit(18)},set:function(e){this.setBit(18,e)}},{key:"vvSizeUnitValue",get:function(){return 0!==this.bit(19)},set:function(e){this.setBit(19,e)}},{key:"hasVV",value:function(){return Object(M.a)(Object(w.a)(r.prototype),"hasVV",this).call(this)||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}},{key:"setVV",value:function(e,t){Object(M.a)(Object(w.a)(r.prototype),"setVV",this).call(this,e,t);var n=D(e,t)&e;this.vvSizeMinMaxValue=!!(n&V.c.SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(n&V.c.SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(n&V.c.SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(n&V.c.SIZE_SCALE_STOPS)}}]),r}(e)},E=function(e){return function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(c.a)(r,[{key:"vvRotation",get:function(){return 0!==this.bit(15)},set:function(e){this.setBit(15,e)}},{key:"hasVV",value:function(){return Object(M.a)(Object(w.a)(r.prototype),"hasVV",this).call(this)||this.vvRotation}},{key:"setVV",value:function(e,t){Object(M.a)(Object(w.a)(r.prototype),"setVV",this).call(this,e,t),this.vvRotation=!t&&!!(e&V.c.ROTATION)}}]),r}(e)},G=function(e){return function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(c.a)(r,[{key:"vvColor",get:function(){return 0!==this.bit(13)},set:function(e){this.setBit(13,e)}},{key:"hasVV",value:function(){return Object(M.a)(Object(w.a)(r.prototype),"hasVV",this).call(this)||this.vvColor}},{key:"setVV",value:function(e,t){Object(M.a)(Object(w.a)(r.prototype),"setVV",this).call(this,e,t),this.vvColor=!t&&!!(e&V.c.COLOR)}}]),r}(e)},K=function(e){return function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(c.a)(r,[{key:"vvOpacity",get:function(){return 0!==this.bit(14)},set:function(e){this.setBit(14,e)}},{key:"hasVV",value:function(){return Object(M.a)(Object(w.a)(r.prototype),"hasVV",this).call(this)||this.vvOpacity}},{key:"setVV",value:function(e,t){Object(M.a)(Object(w.a)(r.prototype),"setVV",this).call(this,e,t),this.vvOpacity=!t&&!!(e&V.c.OPACITY)}}]),r}(e)},U=function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(c.a)(r,[{key:"getVariation",value:function(){return Object(k.a)(Object(k.a)({},Object(M.a)(Object(w.a)(r.prototype),"getVariation",this).call(this)),{},{dotDensity:this.dotDensity,vvColor:this.vvColor,vvOpacity:this.vvOpacity})}},{key:"dotDensity",get:function(){return!!this.bit(15)},set:function(e){this.setBit(15,e)}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}},{key:"from",value:function(e,t){var r=this.load(0);return r.geometryType=V.b.FILL,t?r.dotDensity=!0:r.setVV(e,!1),r.data}}]),r}(G(K(F)));U.shared=new U(0);var Z=function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(c.a)(r,[{key:"getVariation",value:function(){return Object(k.a)(Object(k.a)({},Object(M.a)(Object(w.a)(r.prototype),"getVariation",this).call(this)),{},{vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue})}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}},{key:"from",value:function(e){var t=this.load(0);return t.geometryType=V.b.MARKER,t.setVV(e,!1),t.data}}]),r}(G(K(E(B(F)))));Z.shared=new Z(0);var N=function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(c.a)(r,[{key:"getVariation",value:function(){return Object(k.a)(Object(k.a)({},Object(M.a)(Object(w.a)(r.prototype),"getVariation",this).call(this)),{},{vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue})}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}},{key:"from",value:function(e,t){var r=this.load(0);return r.geometryType=V.b.LINE,r.setVV(e,t),r.data}}]),r}(G(K(B(F))));N.shared=new N(0);var X=function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(c.a)(r,[{key:"getVariation",value:function(){return Object(k.a)(Object(k.a)({},Object(M.a)(Object(w.a)(r.prototype),"getVariation",this).call(this)),{},{vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue})}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}},{key:"from",value:function(e){var t=this.load(e);return t.geometryType=V.b.TEXT,t.setVV(e,!1),t.data}}]),r}(G(K(E(B(F)))));X.shared=new X(0);var W=function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(c.a)(r,[{key:"getVariation",value:function(){return Object(k.a)(Object(k.a)({},Object(M.a)(Object(w.a)(r.prototype),"getVariation",this).call(this)),{},{vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue})}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}},{key:"from",value:function(e,t){var r=this.load(0);return r.geometryType=V.b.LABEL,r.setVV(e,!1),r.mapAligned=!!P(t),r.data}}]),r}(B(F));W.shared=new W(0);var H,Y={marker:V.b.MARKER,fill:V.b.FILL,line:V.b.LINE,text:V.b.TEXT},q=function(){function e(t,r,i){Object(o.a)(this,e),this.layers=t,this.data=r,this.hash=this._createHash(),this.rendererKey=i;var a,s=Object(n.a)(t);try{for(s.s();!(a=s.n()).done;){var c=a.value,u=Y[c.type];c.materialKey=A(u,this.rendererKey,!1,!1)}}catch(h){s.e(h)}finally{s.f()}}return Object(c.a)(e,[{key:"type",get:function(){return"expanded-cim"}},{key:"_createHash",value:function(){var e,t="",r=Object(n.a)(this.layers);try{for(r.s();!(e=r.n()).done;){t+=e.value.templateHash}}catch(i){r.e(i)}finally{r.f()}return t}}]),e}(),J=function(){var e=Object(s.a)(a.a.mark((function e(t,r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=q,e.next=3,Object(R.b)(t.data,r);case 3:return e.t1=e.sent,e.t2=t.data,e.t3=t.rendererKey,e.abrupt("return",new e.t0(e.t1,e.t2,e.t3));case 7:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),Q=function(){var e=Object(s.a)(a.a.mark((function e(t,r,n){var i,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:if("cim"!==t.type){e.next=4;break}return e.abrupt("return",J(t,r));case 4:if("web-style"!==t.type){e.next=12;break}return i=z.a.fromJSON(t),e.next=8,i.fetchCIMSymbol(n);case 8:return e.t0=e.sent.data,e.t1=t.rendererKey,s={type:"cim",data:e.t0,rendererKey:e.t1},e.abrupt("return",J(s,r));case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),$=r(38),ee=r(23),te=r(36),re=(r(28),r(622),r(346)),ne=(r(1036),r(35)),ie=r(163),ae=H=function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(c.a)(r,[{key:"writeLevels",value:function(e,t,r){for(var n in e){var i=this.levels[n];return void(t.stops=i)}}},{key:"clone",value:function(){return new H({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:Object(ie.c)(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:Object(ie.c)(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map((function(e){return e.clone()})),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:Object(ee.a)(this.levels)})}}]),r}(re.a);Object(l.a)([Object(v.b)()],ae.prototype,"levels",void 0),Object(l.a)([Object(ne.a)("levels")],ae.prototype,"writeLevels",null),ae=H=Object(l.a)([Object(p.a)("esri.views.2d.engine.LevelDependentSizeVariable")],ae);y.a.getLogger("esri.views.2d.layers.support.clusterUtils");f.a.add("esri-cluster-arcade-enabled",1);Object(f.a)("esri-cluster-arcade-enabled");var se=r(1002),oe=r(1126);r(605),r(595),r(356),r(606);y.a.getLogger("esri.renderers.visualVariables.support.utils");new(r(50).a)({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});y.a.getLogger("esri.views.2d.layers.features.schemaUtils");function ce(e){return function(e){switch(F.load(e).geometryType){case V.b.MARKER:return new Z(e);case V.b.FILL:return new U(e);case V.b.LINE:return new N(e);case V.b.TEXT:return new X(e);case V.b.LABEL:return new W(e)}}(e)}function ue(e){switch(e.type){case"line-marker":var t;return{type:"line-marker",color:null==(t=e.color)?void 0:t.toJSON(),placement:e.placement,style:e.style};default:return Object(I.f)(e.toJSON()).toJSON()}}function he(e,t,r){if(!e)return null;var i=0,a=!1;switch(Object(d.h)(t)&&"visualVariables"in t&&(i=function(e){if(!e)return V.c.NONE;var t,r=0,i=Object(n.a)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;if("size"===a.type){var s=Object(oe.a)(a);r|=s,"outline"===a.target&&(r|=s<<4)}else"color"===a.type?r|=V.c.COLOR:"opacity"===a.type?r|=V.c.OPACITY:"rotation"===a.type&&(r|=V.c.ROTATION)}}catch(o){i.e(o)}finally{i.f()}return r}(t.visualVariables||[]),a="dot-density"===t.type),e.type){case"simple-fill":case"picture-fill":return function(e,t,r,n){var i=A(V.b.FILL,t,!1,r),a=n?ce(i):i,s=e.clone(),o=s.outline;s.outline=null;var c=[],u=Object(k.a)({materialKey:a,hash:s.hash()},ue(s));if(c.push(u),o){var h=A(V.b.LINE,t,!0,!1),l=Object(k.a)({materialKey:n?ce(h):h,hash:o.hash()},ue(o));c.push(l)}return{type:"composite-symbol",layers:c,hash:c.reduce((function(e,t){return t.hash+e}),"")}}(e,i,a,r);case"simple-marker":case"picture-marker":return function(e,t,r){var n=A(V.b.MARKER,t,!1,!1),i=r?ce(n):n,a=ue(e);return Object(k.a)(Object(k.a)({materialKey:i,hash:e.hash()},a),{},{angle:e.angle})}(e,i,r);case"simple-line":return function(e,t,r){var n=A(V.b.LINE,t,!1,!1),i=r?ce(n):n,a=e.clone(),s=a.marker;a.marker=null;var o=[];if(o.push(Object(k.a)({materialKey:i,hash:a.hash()},ue(a))),s){var c,u=A(V.b.MARKER,t,!1,!1),h=r?ce(u):u;s.color=null!=(c=s.color)?c:a.color,o.push(Object(k.a)({materialKey:h,hash:s.hash(),lineWidth:a.width},ue(s)))}return{type:"composite-symbol",layers:o,hash:o.reduce((function(e,t){return t.hash+e}),"")}}(e,i,r);case"text":return function(e,t,r){var n=A(V.b.TEXT,t,!1,!1),i=r?ce(n):n,a=ue(e);return Object(k.a)(Object(k.a)({materialKey:i,hash:e.hash()},a),{},{angle:e.angle})}(e,i,r);case"label":return function(e,t,r){var n=A(V.b.LABEL,t,!1,!1,e.labelPlacement);return Object(k.a)(Object(k.a)({materialKey:r?ce(n):n,hash:e.hash()},e.toJSON()),{},{labelPlacement:e.labelPlacement})}(e,i,r);case"cim":return{type:"cim",rendererKey:i,data:e.data};case"web-style":return Object(k.a)(Object(k.a)({},ue(e)),{},{type:"web-style",hash:e.hash(),rendererKey:i});default:throw new Error("symbol not supported ".concat(e.type))}}var le=y.a.getLogger("esri/views/2d/engine/webgl/util/Matcher"),fe=function(){function e(){Object(o.a)(this,e),this.type="feature",this._defaultResult=null}return Object(c.a)(e,[{key:"size",value:function(){return 1}},{key:"getDefault",value:function(){return this._defaultResult}},{key:"setDefault",value:function(e){this._defaultResult=e}},{key:"match",value:function(e,t,r,n,i){return this.getDefault()}},{key:"analyze",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r,n,i,s){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}()}],[{key:"fromBasicRenderer",value:function(){var t=Object(s.a)(a.a.mark((function t(r,n,i){var s,o,c;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=new e,!r.symbol){t.next=7;break}return t.next=4,Q(r.symbol,i);case 4:o=t.sent,c=n.createTemplateGroup(o,null),s.setDefault(c);case 7:return t.abrupt("return",s);case 8:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}()}]),e}(),de=function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(e,n,i,a){var s;return Object(o.a)(this,r),(s=t.call(this)).type="interval",s._intervals=[],s._isMaxInclusive=n,s._fieldIndex=a,s._field=e,s._normalizationInfo=i,s}return Object(c.a)(r,[{key:"add",value:function(e,t){this._intervals.push({interval:e,result:t}),this._intervals.sort((function(e,t){return e.interval.min-t.interval.min}))}},{key:"size",value:function(){return Object(M.a)(Object(w.a)(r.prototype),"size",this).call(this)+this._intervals.length}},{key:"match",value:function(e,t,r,n,i){if(null==this._fieldIndex&&!this._field)return this.getDefault();var a=null!=this._fieldIndex?t.getComputedNumericAtIndex(this._fieldIndex):this._getValueFromField(t);if(!a&&(null==a||isNaN(a)))return this.getDefault();for(var s=0;s<this._intervals.length;s++){var o=this._intervals[s],c=o.interval,u=o.result,h=a>=c.min,l=this._isMaxInclusive?a<=c.max:a<c.max;if(h&&l)return u}return this.getDefault()}},{key:"_needsNormalization",value:function(){var e=this._normalizationInfo;return e&&(e.normalizationField||e.normalizationTotal||e.normalizationType)}},{key:"_getValueFromField",value:function(e){var t=e.readAttribute(this._field);if(!this._needsNormalization())return t;var r=this._normalizationInfo,n=r.normalizationField,i=r.normalizationTotal,a=r.normalizationType,s=!!n&&e.readAttribute(n);if(a)switch(a){case"esriNormalizeByField":return s?t/s:void 0;case"esriNormalizeByLog":return Math.log(t)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return t/i*100;default:return void le.error("Found unknown normalization type: ".concat(a))}else le.error("Normalization is required, but no type was set!")}}],[{key:"fromCBRenderer",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n,i){var o,c,u,h,l,f,d,y,v;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.isMaxInclusive,c=t.normalizationField,u=t.normalizationTotal,h=t.normalizationType,l=t.field,f=new r(l,o,{normalizationField:c,normalizationTotal:u,normalizationType:h},t.fieldIndex),e.next=8,Q(t.backgroundFillSymbol,i);case 8:return d=e.sent,e.next=11,Object(m.b)(t.intervals.map(function(){var e=Object(s.a)(a.a.mark((function e(t){var r,s,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Q(t.symbol,i);case 2:return r=e.sent,e.next=5,n.createTemplateGroup(r,d);case 5:s=e.sent,o={min:t.min,max:t.max},f.add(o,s);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:return e.next=13,Q(t.defaultSymbol,i);case 13:if(!(y=e.sent)){e.next=19;break}return e.next=17,n.createTemplateGroup(y,d);case 17:v=e.sent,f.setDefault(v);case 19:return e.abrupt("return",f);case 20:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()}]),r}(fe),ye=function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(e,n,i){var a;return Object(o.a)(this,r),(a=t.call(this)).type="map",a._nullResult=null,a._resultsMap=new Map,a._fieldsIndex=i,a._fields=e,a._seperator=n||"",a}return Object(c.a)(r,[{key:"setNullResult",value:function(e){this._nullResult=e}},{key:"add",value:function(e,t){this._resultsMap.set(e.toString(),t)}},{key:"size",value:function(){return Object(M.a)(Object(w.a)(r.prototype),"size",this).call(this)+this._resultsMap.size}},{key:"match",value:function(e,t,r,n,i){if(null==this._fieldsIndex&&!this._fields)return this.getDefault();var a=null!=this._fieldsIndex?t.getComputedStringAtIndex(this._fieldsIndex):this._getValueFromFields(t);if(null!==this._nullResult&&(null==a||""===a||"<Null>"===a))return this._nullResult;if(!a&&null==a)return this.getDefault();var s=a.toString();return this._resultsMap.has(s)?this._resultsMap.get(s):this.getDefault()}},{key:"_getValueFromFields",value:function(e){var t,r=[],i=Object(n.a)(this._fields);try{for(i.s();!(t=i.n()).done;){var a=t.value,s=e.readAttribute(a);r.push(s)}}catch(o){i.e(o)}finally{i.f()}return r.join(this._seperator)}}],[{key:"fromUVRenderer",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n,i){var o,c,u,h,l,f;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.fieldDelimiter,c=[t.field],t.field2&&c.push(t.field2),t.field3&&c.push(t.field3),e.next=4,Q(t.backgroundFillSymbol,i);case 4:return u=e.sent,h=new r(c,o,t.fieldIndex),e.next=8,Object(m.b)(t.map.map(function(){var e=Object(s.a)(a.a.mark((function e(t){var r,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Q(t.symbol,i);case 2:return r=e.sent,e.next=5,n.createTemplateGroup(r,u);case 5:s=e.sent,"<Null>"===t.value?h.setNullResult(s):h.add(t.value,s);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:return e.next=10,Q(t.defaultSymbol,i);case 10:if(!(l=e.sent)){e.next=16;break}return e.next=14,n.createTemplateGroup(l,u);case 14:f=e.sent,h.setDefault(f);case 16:return e.abrupt("return",h);case 17:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()}]),r}(fe),ve=function(e){Object(u.a)(i,e);var t=Object(h.a)(i);function i(e,r,n,a){var s;return Object(o.a)(this,i),(s=t.call(this)).type="dictionary",s._groupIdCache=new L.a(100),s._renderer=e,s._fieldMap=e.fieldMap,s._symbolFields=e.getSymbolFields(),s._templates=r,s._info=n,s._scaleFn=a,s}return Object(c.a)(i,[{key:"_analyzeFeature",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r,i,s){var o,c,u,h,l,f,d,y,v=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.readLegacyFeature(),c=this._scaleFn(o,r,i),u=this._attributeHash(o)+"-"+c,!(h=this._groupIdCache.get(u))){e.next=3;break}return e.abrupt("return",h);case 3:return l=Object(k.a)(Object(k.a)({},i),{},{spatialReference:this._info.spatialReference,abortOptions:s,fields:this._info.fields}),e.next=6,this._renderer.getSymbolAsync(o,l);case 6:return f=e.sent,d=he(f,this._renderer),y=Q(d,this._info,s).then((function(e){if("expanded-cim"!==e.type)return le.error(new b.a("mapview-bad-type","Found unexpected type ".concat(e.type," in dictionary response"))),null;e.hash+="-"+c;var t,r=Object(n.a)(e.layers);try{for(r.s();!(t=r.n()).done;){var i=t.value;i.scaleFactor=c,i.templateHash+="-"+c,"text"===i.type&&"string"==typeof i.text&&i.text.indexOf("[")>-1&&(i.text=Object(T.c)(v._fieldMap,i.text,i.cim.textCase))}}catch(a){r.e(a)}finally{r.f()}return v._templates.createTemplateGroup(e,null)})),e.abrupt("return",(this._groupIdCache.put(u,y,1),y));case 10:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"analyze",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r,n,i,s){var o,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=r.getCursor(),c=[];o.next();)c.push(this._analyzeFeature(o,n,i,s));return e.abrupt("return",Object(m.b)(c));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}()},{key:"match",value:function(e,t,r,n,i){return null}},{key:"_attributeHash",value:function(e){var t,r="",i=Object(n.a)(this._symbolFields);try{for(i.s();!(t=i.n()).done;){var a=t.value,s=this._fieldMap[a];s&&(r+=e.attributes[s]+"-")}}catch(o){i.e(o)}finally{i.f()}return r}}],[{key:"fromDictionaryRenderer",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n,o){var c,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(r.bind(null,432));case 2:return c=e.sent.default.fromJSON(t.renderer),e.next=5,c.fetchResources({spatialReference:o.spatialReference,fields:o.fields});case 5:return e.next=7,function(){var e=Object(s.a)(a.a.mark((function e(t,r){var n,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("number"!=typeof(n=t||1)){e.next=3;break}return e.abrupt("return",(function(e,t,r){return n}));case 3:return e.next=5,Object(S.d)(n,r.spatialReference,r.fields);case 5:return i=e.sent,e.abrupt("return",(function(e,t,n){return Object(C.a)(i,e,{$view:n},r.geometryType,t)||1}));case 7:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()(c.scaleExpression,o);case 7:return u=e.sent,e.abrupt("return",new i(c,n,o,u));case 9:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()}]),i}(fe),pe=y.a.getLogger("esri/views/2d/engine/webgl/mesh/factories/matcherUtils");function be(){return(be=Object(s.a)(a.a.mark((function e(t,r,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.type,e.next="simple"===e.t0?3:"map"===e.t0?4:"interval"===e.t0?5:"dictionary"===e.t0?6:7;break;case 3:return e.abrupt("return",fe.fromBasicRenderer(t,r,n));case 4:return e.abrupt("return",ye.fromUVRenderer(t,r,n));case 5:return e.abrupt("return",de.fromCBRenderer(t,r,n));case 6:return e.abrupt("return",ve.fromDictionaryRenderer(t,r,n));case 7:return e.abrupt("return",(pe.error(new b.a("mapview-mesh:invalid-renderer","Unable to handle unknown renderer type")),null));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function me(e){for(var t=new Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}var _e=r(564);function ge(e,t){if(e&&"name"in e){var r=e;return t&&t.error(new b.a(r.name,r.message,r.details)),!1}return!0}var xe,Oe,je,ke=r(32);function Me(e){switch(e){case"left":return xe.Left;case"right":return xe.Right;case"center":case"justify":return xe.Center}}function we(e){switch(e){case"top":return Oe.Top;case"middle":return Oe.Center;case"baseline":return Oe.Baseline;case"bottom":return Oe.Bottom}}function Se(e){switch(e){case"left":return xe.Left;case"right":return xe.Right;case"center":case"justify":return xe.Center}}(je=xe||(xe={}))[je.Left=-1]="Left",je[je.Center=0]="Center",je[je.Right=1]="Right",function(e){e[e.Top=1]="Top",e[e.Center=0]="Center",e[e.Bottom=-1]="Bottom",e[e.Baseline=2]="Baseline"}(Oe||(Oe={}));var Te=r(983),Le=r(515),Ce=r(982),ze=r(53),Ie=r(188),Re=r(517),Ve=r(1001),Pe=r(1131),De=r(44),Ae=function(){function e(t,r,n,i){Object(o.a)(this,e),this.center=Object(Ve.b)(t,r),this.centerT=Object(Ve.a)(),this.halfWidth=n/2,this.halfHeight=i/2,this.width=n,this.height=i}return Object(c.a)(e,[{key:"x",get:function(){return this.center[0]},set:function(e){this.center[0]=e}},{key:"y",get:function(){return this.center[1]},set:function(e){this.center[1]=e}},{key:"blX",get:function(){return this.center[0]+this.halfWidth}},{key:"blY",get:function(){return this.center[1]+this.halfHeight}},{key:"trX",get:function(){return this.center[0]-this.halfWidth}},{key:"trY",get:function(){return this.center[1]-this.halfHeight}},{key:"xmin",get:function(){return this.x-this.halfWidth}},{key:"xmax",get:function(){return this.x+this.halfWidth}},{key:"ymin",get:function(){return this.y-this.halfHeight}},{key:"ymax",get:function(){return this.y+this.halfHeight}},{key:"clone",value:function(){return new e(this.x,this.y,this.width,this.height)}},{key:"serialize",value:function(e){return e.writeF32(this.center[0]),e.writeF32(this.center[1]),e.push(this.width),e.push(this.height),e}},{key:"findCollisionDelta",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,r=Math.abs(e.centerT[0]-this.centerT[0]),n=Math.abs(e.centerT[1]-this.centerT[1]),i=(e.halfWidth+this.halfWidth+t)/r,a=(e.halfHeight+this.halfHeight+t)/n,s=Math.min(i,a);return Object(De.m)(s)}},{key:"extend",value:function(e){var t=Math.min(this.xmin,e.xmin),r=Math.min(this.ymin,e.ymin),n=Math.max(this.xmax,e.xmax)-t,i=Math.max(this.ymax,e.ymax)-r,a=t+n/2,s=r+i/2;this.width=n,this.height=i,this.halfWidth=n/2,this.halfHeight=i/2,this.x=a,this.y=s}}],[{key:"deserialize",value:function(t){return new e(t.readF32(),t.readF32(),t.readInt32(),t.readInt32())}}]),e}(),Fe=Math.PI/180,Be=function(){function e(t,r,n,i){Object(o.a)(this,e),this._rotationT=Object(Re.a)(),this._xBounds=0,this._yBounds=0,this.minZoom=0,this.maxZoom=255;var a=n.rect,s=new Float32Array(8);t*=i,r*=i;var c=n.code?a.width*i:n.metrics.width,u=n.code?a.height*i:n.metrics.height;s[0]=t,s[1]=r,s[2]=t+c,s[3]=r,s[4]=t,s[5]=r+u,s[6]=t+c,s[7]=r+u,this._data=s,this._setTextureCoords(a),this._scale=i,this._mosaic=n,this.x=t,this.y=r}return Object(c.a)(e,[{key:"width",get:function(){return this._mosaic.metrics.width*this._scale}},{key:"mosaic",get:function(){return this._mosaic}},{key:"angle",get:function(){return this._angle},set:function(e){this._angle=e,Object(Ie.d)(this._rotationT),Object(Ie.f)(this._rotationT,this._rotationT,-e),this._setOffsets(this._data)}},{key:"xTopLeft",get:function(){return this._data[0]}},{key:"yTopLeft",get:function(){return this._data[1]}},{key:"xBottomRight",get:function(){return this._data[6]}},{key:"yBottomRight",get:function(){return this._data[7]}},{key:"texcoords",get:function(){return this._texcoords}},{key:"textureBinding",get:function(){return this._mosaic.textureBinding}},{key:"offsets",get:function(){return this._offsets||this._setOffsets(this._data),this._offsets}},{key:"char",get:function(){return String.fromCharCode(this._mosaic.code)}},{key:"code",get:function(){return this._mosaic.code}},{key:"bounds",get:function(){var e=this._mosaic.metrics,t=e.height,r=e.width*this._scale,n=Math.abs(t)*this._scale,i=new Float32Array(8);i[0]=this.x,i[1]=this.y,i[2]=this.x+r,i[3]=this.y,i[4]=this.x,i[5]=this.y+n,i[6]=this.x+r,i[7]=this.y+n;var a=Object(Ie.e)(Object(Re.a)(),this._rotationT,this._T);Object(Re.b)(i,i,a);for(var s=1/0,o=1/0,c=0,u=0,h=0;h<4;h++){var l=i[2*h],f=i[2*h+1];s=Math.min(s,l),o=Math.min(o,f),c=Math.max(c,l),u=Math.max(u,f)}var d=c-s,y=u-o;return new Ae(s+d/2,o+y/2,d,y)}},{key:"setTransform",value:function(e){this._T=e,this._offsets=null}},{key:"_setOffsets",value:function(e){this._offsets||(this._offsets={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0});var t=this._offsets,r=new Float32Array(8),n=Object(Ie.e)(Object(Re.a)(),this._rotationT,this._T);Object(Re.b)(r,e,n),t.upperLeft=Object(Ce.a)(8*r[0],8*r[1]),t.upperRight=Object(Ce.a)(8*r[2],8*r[3]),t.lowerLeft=Object(Ce.a)(8*r[4],8*r[5]),t.lowerRight=Object(Ce.a)(8*r[6],8*r[7])}},{key:"_setTextureCoords",value:function(e){var t=e.x,r=e.y,n=e.width,i=e.height;this._texcoords={upperLeft:Object(Ce.a)(t,r),upperRight:Object(Ce.a)(t+n,r),lowerLeft:Object(Ce.a)(t,r+i),lowerRight:Object(Ce.a)(t+n,r+i)}}}]),e}(),Ee=function(e,t){return{code:0,page:0,sdf:!0,rect:new Pe.a(0,0,11,8),textureBinding:t,metrics:{advance:0,height:4,width:e,left:0,top:0}}},Ge=function(){function e(t,r,i){Object(o.a)(this,e),this._rotation=0,this._decorate(t,r,i),this.glyphs=t,this.bounds=this._createBounds(t),this.isMultiline=r.length>1,this._hasRotation=0!==i.angle,this._T=this._createGlyphTransform(this.bounds,i);var a,s=Object(n.a)(t);try{for(s.s();!(a=s.n()).done;){a.value.setTransform(this._T)}}catch(c){s.e(c)}finally{s.f()}}return Object(c.a)(e,[{key:"setRotation",value:function(e){if(0!==e||0!==this._rotation){this._rotation=e;var t=this._T,r=Object(Ie.b)(Object(Re.a)(),e);Object(Ie.e)(t,r,t);var i,a=Object(n.a)(this.glyphs);try{for(a.s();!(i=a.n()).done;){i.value.setTransform(this._T)}}catch(s){a.e(s)}finally{a.f()}}}},{key:"_decorate",value:function(e,t,r){if(r.decoration&&"none"!==r.decoration&&e.length){var i,a=r.scale,s="underline"===r.decoration?30:20,o=e[0].textureBinding,c=Object(n.a)(t);try{for(c.s();!(i=c.n()).done;){var u=i.value,h=u.startX*a,l=u.startY*a,f=(u.width+u.glyphWidthEnd)*a;e.push(new Be(h,l+s*a,Ee(f,o),1))}}catch(d){c.e(d)}finally{c.f()}}}},{key:"boundsT",get:function(){var e=this.bounds,t=Object(ze.r)(Object(Ve.a)(),e.x,e.y);if(Object(ze.s)(t,t,this._T),this._hasRotation){var r=Math.max(e.width,e.height);return new Ae(t[0],t[1],r,r)}return new Ae(t[0],t[1],e.width,e.height)}},{key:"_createBounds",value:function(e){var t,r=1/0,i=1/0,a=0,s=0,o=Object(n.a)(e);try{for(o.s();!(t=o.n()).done;){var c=t.value;r=Math.min(r,c.xTopLeft),i=Math.min(i,c.yTopLeft),a=Math.max(a,c.xTopLeft+c.width),s=Math.max(s,c.yBottomRight)}}catch(l){o.e(l)}finally{o.f()}var u=a-r,h=s-i;return new Ae(r+u/2,i+h/2,u,h)}},{key:"_createGlyphTransform",value:function(e,t){var r=Fe*t.angle,n=Object(Re.a)(),i=Object(Ve.a)();return Object(Ie.h)(n,n,Object(ze.r)(i,t.xOffset,-t.yOffset)),t.isCIM?Object(Ie.f)(n,n,r):(Object(Ie.h)(n,n,Object(ze.r)(i,e.x,e.y)),Object(Ie.f)(n,n,r),Object(Ie.h)(n,n,Object(ze.r)(i,-e.x,-e.y))),n}}]),e}(),Ke=function e(t,r,n,i,a,s){Object(o.a)(this,e),this.glyphWidthEnd=0,this.startX=0,this.startY=0,this.start=Math.max(0,Math.min(r,n)),this.end=Math.max(0,Math.max(r,n)),this.end<t.length&&(this.glyphWidthEnd=t[this.end].metrics.width),this.width=i,this.yMin=a,this.yMax=s},Ue=function(e){return 10===e},Ze=function(e){return 32===e};var Ne=r(979),Xe=r(1110),We=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"getPlacement",value:function(e,t,r){var n=Object(Xe.b)(t);if(!n)return null;var i=Object(Ne.c)(e);return n.execute(i,t,r)}}]),e}(),He=function(e){return function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(){var e;Object(o.a)(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i)))._isCIM=!1,e.geometryType=V.b.TEXT,e._aux=Object(Ce.b)(0,0,e._referenceSize,e._bitset),e}return Object(c.a)(r,[{key:"bindTextInfo",value:function(e,t){var r=this;e&&e.length?this._shapingInfo=Object(d.a)(e,(function(e){return function(e,t,r){for(var n=r.scale,i=new Array,a=function(e,t,r){for(var n=new Array,i=1/r.scale,a=r.maxLineWidth*i,s=t?e.length-1:0,o=t?-1:e.length,c=t?-1:1,u=s,h=0,l=0,f=u,d=f,y=0,v=1/0,p=0;u!==o;){var b=e[u],m=b.code,_=b.metrics,g=Math.abs(_.top);if(Ue(m)||Ze(m)||(v=Math.min(v,g),p=Math.max(p,g+_.height)),Ue(m))u!==s&&(n.push(new Ke(e,f,u-c,h,v,p)),v=1/0,p=0),h=0,f=u+c,d=u+c,l=0;else if(Ze(m))d=u+c,l=0,y=_.advance,h+=_.advance;else if(h>a){if(d!==f){var x=d-2*c;h-=y,n.push(new Ke(e,f,x,h-l,v,p)),v=1/0,p=0,f=d,h=l}else n.push(new Ke(e,f,u-c,h,v,p)),v=1/0,p=0,f=u,d=u,h=0;h+=_.advance,l+=_.advance}else h+=_.advance,l+=_.advance;u+=c}var O=new Ke(e,f,u-c,h,v,p);return O.start>=0&&O.end<e.length&&n.push(O),n}(e,t,r),s=function(e,t){for(var r=0,n=0;n<e.length;n++){var i=e[n].width;r=Math.max(i,r)}var a="underline"===t.decoration?4:0,s=e[0].yMin;return{x:0,y:s,height:e[e.length-1].yMax+t.lineHeight*(e.length-1)+a-s,width:r}}(a,r),o=r.vAlign,c=r.hAlign,u=o===Oe.Baseline?1:0,h=u?0:o-1,l=(1-u)*-s.y+h*(s.height/2)+-26*(u?1:0),f=0;f<a.length;f++){var d=a[f],y=d.start,v=d.end,p=-1*(c+1)*(d.width/2)-3,b=f*r.lineHeight+l-3;a[f].startX=p,a[f].startY=b;for(var m=y;m<=v;m++){var _=e[m];if(!Ue(_.code)){var g=new Be(p+_.metrics.left,b-_.metrics.top,_,n);p+=_.metrics.advance,i.push(g)}}}return new Ge(i,a,r)}(e,t,{scale:r._scale,angle:r._angle,xOffset:r._xOffset,yOffset:r._yOffset,hAlign:r._xAlignD,vAlign:r._yAlignD,maxLineWidth:Math.max(32,Math.min(r._lineWidth,512)),lineHeight:x.i*Math.max(.25,Math.min(r._lineHeight,4)),decoration:r._decoration,isCIM:r._isCIM})})):this._shapingInfo=null}},{key:"writeMeshWithGeometry",value:function(e,t,r,n,i,a){var s=this;if(Object(d.h)(this._textPlacement)){var o=null!=a?a:r.readLegacyGeometry();return this._writePlacedText(e,t,i,o)}var c=a?Object(Le.m)(Object(Le.d)(a),2):"esriGeometryPolygon"===n?r.readCentroid():r.readUnquantizedGeometry();if(c){if(c.isPoint){var u=Object(ke.a)(c.coords,2),h=u[0],l=u[1];return this._writeGlyphs(e,t,i,{x:h,y:l})}c.forEachVertex((function(r,n){return s._writeGlyphs(e,t,i,{x:r,y:n})}))}}},{key:"_writePlacedText",value:function(e,t,r,i){var a=this._shapingInfo;if(!Object(d.g)(a)){var s=F.load(this._materialKey),o=Object(d.n)(this._textPlacement),c=We.getPlacement(i,o,Object(te.g)(1));if(c)for(var u,h,l=c.next();null!=l;){h=Object(Ce.a)(Math.round(8*l.tx),Math.round(8*l.ty)),u=l.getAngle(),a.setRotation(u);var f,y=Object(n.a)(a.glyphs);try{for(y.s();!(f=y.n()).done;){var v=f.value;s.textureBinding=v.textureBinding;var p=t.getVector("geometry").vertexCount,b=t.indexVector.length,m=this._writeIndices(t),_=this._writeVertex(t,r,h,v);e.writeDisplayRecord(this.geometryType,s.data,p,_,b,m)}}catch(g){y.e(g)}finally{y.f()}a.setRotation(-u),l=c.next()}}}},{key:"_writeGlyphs",value:function(e,t,r,i){var a=this._shapingInfo;if(!Object(d.g)(a)){var s,o=F.load(this._materialKey),c=Object(Ce.a)(Math.round(8*i.x),Math.round(8*i.y)),u=Object(n.a)(a.glyphs);try{for(u.s();!(s=u.n()).done;){var h=s.value;o.textureBinding=h.textureBinding;var l=t.getVector("geometry").vertexCount,f=t.indexVector.length,y=this._writeIndices(t),v=this._writeVertex(t,r,c,h);e.writeDisplayRecord(this.geometryType,o.data,l,v,f,y)}}catch(p){u.e(p)}finally{u.f()}}}},{key:"_writeVertexCommon",value:function(e,t,r,n){var i=this._color,a=this._haloColor,s=Object(Ce.b)(0,0,this._referenceSize,this._bitset),o=Object(Ce.b)(0,0,this._size,this._haloSize);e.push(r),e.push(t),e.push(i),e.push(a),e.push(o),e.push(s)}},{key:"_writeVertex",value:function(e,t,r,n){var i=e.get("geometry");return this._writeVertexCommon(i,t,r,n),i.push(n.offsets.upperLeft),i.push(n.texcoords.upperLeft),this._writeVertexCommon(i,t,r,n),i.push(n.offsets.upperRight),i.push(n.texcoords.upperRight),this._writeVertexCommon(i,t,r,n),i.push(n.offsets.lowerLeft),i.push(n.texcoords.lowerLeft),this._writeVertexCommon(i,t,r,n),i.push(n.offsets.lowerRight),i.push(n.texcoords.lowerRight),4}},{key:"_writeIndices",value:function(e){var t=e.getVector("geometry").vertexCount,r=e.indexVector;return r.push(t+0),r.push(t+1),r.push(t+2),r.push(t+1),r.push(t+3),r.push(t+2),6}}]),r}(e)},Ye=r(97),qe=r(1120),Je=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"executeEffects",value:function(e,t){var r,i=Object(Ne.c)(t),a=new qe.a(i),s=Object(n.a)(e);try{for(s.s();!(r=s.n()).done;){var o=r.value,c=Object(Xe.a)(o);c&&(a=c.execute(a,o,1.3333333333333333))}}catch(u){s.e(u)}finally{s.f()}return a}},{key:"next",value:function(e){var t=e.next();return Object(Ne.d)(t),t}}]),e}(),Qe=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,[{key:"needsPixelBuffer",get:function(){return!!this.effects||this.geometryType===V.b.MARKER||this.geometryType===V.b.TEXT||this.geometryType===V.b.LABEL}},{key:"writeMesh",value:function(e,t,r,n,i){if(Object(d.g)(this.effects))return this.writeMeshWithGeometry(e,t,r,n,i);for(var a=Je.executeEffects(this.effects,r.readLegacyGeometry()),s=Je.next(a);s;)this.writeMeshWithGeometry(e,t,r,Object(Ye.c)(s),i,s),s=Je.next(a)}},{key:"writeMeshWithGeometry",value:function(e,t,r,n,i,a){}},{key:"bindFeature",value:function(e,t,r){}}]),e}(),$e=function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(e,n,i,a,s,c,u,h,l,f,d,y,v,p,b,m,_){var g,x=arguments.length>17&&void 0!==arguments[17]&&arguments[17];Object(o.a)(this,r),(g=t.call(this))._xOffset=Object(te.g)(y),g._yOffset=Object(te.g)(v),g._decoration=l||"none",g._color=a,g._haloColor=s,g._haloSize=Math.min(Math.floor(5*Object(te.g)(Object(te.j)(i))),127),g._size=Math.min(Math.round(Object(te.g)(n)),127);var O=Math.min(Math.round(Object(te.g)(n)),127);g._referenceSize=Math.round(Math.sqrt(256*O)),g._scale=g._size/24,g._angle=d,g._justify=Se(c||"center"),g._xAlignD=Me(c||"center"),g._yAlignD=we(u||"baseline"),g._baseline="baseline"===(u||"baseline"),g._bitset=(1===h?1:0)|(f?1:0)<<1;var j=F.load(e);return j.sdf=!0,g._materialKey=j.data,g._lineWidth=Object(te.g)(p)||512,g._lineHeight=b||1,g._textPlacement=m,g.effects=_,g._isCIM=x,g}return Object(c.a)(r,null,[{key:"fromText",value:function(e,t){var n=new r(e.materialKey,e.font.size,e.haloSize||0,e.color&&Object(Te.d)(e.color)||0,e.haloColor&&Object(Te.d)(e.haloColor)||0,e.horizontalAlignment,e.verticalAlignment,0,e.font.decoration,!1,e.angle||0,e.xoffset,e.yoffset,e.lineWidth,e.lineHeight,null,null,!1),i=j(e.text),a=Object(ke.a)(i,2)[1];return n.bindTextInfo(t,a),n}},{key:"fromCIMText",value:function(e,t){var n=e.scaleFactor||1,i=new r(e.materialKey,e.size*e.sizeRatio*n,e.outlineSize*e.sizeRatio,Object(Te.c)(e.color),Object(Te.c)(e.outlineColor),e.horizontalAlignment,e.verticalAlignment,e.alignment,e.decoration,e.colorLocked,e.angle,e.offsetX*e.sizeRatio*n,e.offsetY*e.sizeRatio*n,512,1,e.markerPlacement,e.effects,!0),a=j(e.text),s=Object(ke.a)(a,2)[1];return i.bindTextInfo(t,s),i}}]),r}(He(Qe)),et=function(e){return function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(){var e;Object(o.a)(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).angle=0,e.xOffset=0,e.yOffset=0,e.width=0,e.height=0,e.boundsType="square",e._anchorX=0,e._anchorY=0,e._computedWidth=0,e._computedHeight=0,e.geometryType=V.b.MARKER,e}return Object(c.a)(r,[{key:"writeMeshWithGeometry",value:function(e,t,r,n,i,a){var s=this,o=t.indexVector,c=t.get("geometry"),u=t.getVector("geometry"),h=u.vertexCount,l=h,f=o.length;if(Object(d.h)(this._markerPlacement)){var y=null!=a?a:r.readLegacyGeometry();this._writePlacedMarkers(c,o,h,i,y)}else{var v=a?Object(Le.m)(Object(Le.d)(a),2):"esriGeometryPolygon"===n?r.readCentroid():r.readUnquantizedGeometry();if(!v)return;if(v.isPoint){var p=Object(ke.a)(v.coords,2),b=p[0],m=p[1];this._writeVertices(c,i,this._getPos(b,m)),this._writeIndices(o,h)}else v.forEachVertex((function(e,t){var r=u.vertexCount;s._writeVertices(c,i,s._getPos(e,t)),s._writeIndices(o,r)}))}var _=t.getVector("geometry").vertexCount-l,g=o.length-f;e.writeDisplayRecord(this.geometryType,this._materialKey,l,_,f,g)}},{key:"_applyTransformation",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(Ie.d)(e),Object(Ie.h)(e,e,Object(Ve.b)(this.xOffset,-this.yOffset)),this.angle+r!==0&&Object(Ie.f)(e,e,.017453292519944444*(this.angle+r));var n=this._computedWidth,i=this._computedHeight,a=(this._anchorX-.5)*n,s=(this._anchorY-.5)*i;Object(ze.r)(t,a,s),Object(ze.s)(t,t,e),this._offsetUpperLeft=Object(Ce.a)(16*t[0],16*t[1]),Object(ze.r)(t,a+n,s),Object(ze.s)(t,t,e),this._offsetUpperRight=Object(Ce.a)(16*t[0],16*t[1]),Object(ze.r)(t,a,s+i),Object(ze.s)(t,t,e),this._offsetBottomLeft=Object(Ce.a)(16*t[0],16*t[1]),Object(ze.r)(t,a+n,s+i),Object(ze.s)(t,t,e),this._offsetBottomRight=Object(Ce.a)(16*t[0],16*t[1])}},{key:"_writePlacedMarkers",value:function(e,t,r,n,i){var a=We.getPlacement(i,Object(d.n)(this._markerPlacement),Object(te.g)(1));if(a)for(var s=Object(Ve.a)(),o=Object(Re.a)(),c=0,u=a.next();null!=u;)u.tx>=-128&&u.tx<=640&&u.ty>=-128&&u.ty<=640&&(this._applyTransformation(o,s,u.getAngle()/.017453292519944444),this._writeVertices(e,n,this._getPos(u.tx,u.ty)),this._writeIndices(t,r+c),c+=4),u=a.next()}},{key:"_getPos",value:function(e,t){return Object(Ce.a)(Math.round(8*e),Math.round(8*t))}},{key:"_writeVertices",value:function(e,t,r){e.push(r),e.push(this._offsetUpperLeft),e.push(this._texUpperLeft),e.push(this._bitestAndDistRatio),e.push(t),e.push(this._fillColor),e.push(this._outlineColor),e.push(this._sizeOutlineWidth),e.push(r),e.push(this._offsetUpperRight),e.push(this._texUpperRight),e.push(this._bitestAndDistRatio),e.push(t),e.push(this._fillColor),e.push(this._outlineColor),e.push(this._sizeOutlineWidth),e.push(r),e.push(this._offsetBottomLeft),e.push(this._texBottomLeft),e.push(this._bitestAndDistRatio),e.push(t),e.push(this._fillColor),e.push(this._outlineColor),e.push(this._sizeOutlineWidth),e.push(r),e.push(this._offsetBottomRight),e.push(this._texBottomRight),e.push(this._bitestAndDistRatio),e.push(t),e.push(this._fillColor),e.push(this._outlineColor),e.push(this._sizeOutlineWidth)}},{key:"_writeIndices",value:function(e,t){var r=t;e.push(r+0),e.push(r+1),e.push(r+2),e.push(r+1),e.push(r+3),e.push(r+2)}}]),r}(e)},tt=function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(e,n,i,a,s,c,u,h,l,f,d,y,v,p,b,m,_,g,O,j,k){var M;Object(o.a)(this,r),(M=t.call(this)).angle=a,M.height=u,M.width=c,M.xOffset=n*O,M.yOffset=i*O,M._markerPlacement=j,M.effects=k,M._anchorX=.5-(.5+m)*b.width/b.width,M._anchorY=.5-(.5+_)*b.height/b.height;var w=(1===p?1:0)|(d?1:0)<<1|(v?1:0)<<2|(y?1:0)<<3,S=b&&b.sdf,T=Z.load(e);T.sdf=S,T.pattern=!0,T.textureBinding=b.textureBinding,M._materialKey=T.data,M._fillColor=s,M._outlineColor=l,M._sizeOutlineWidth=Object(Ce.b)(Math.round(Math.min(Math.sqrt(128*c),255)),Math.round(Math.min(Math.sqrt(128*u),255)),Math.round(Math.min(Math.sqrt(128*f),255)),Math.round(Math.min(Math.sqrt(128*h),255)));var L=b.rect.x+x.m,C=b.rect.y+x.m,z=L+b.width,I=C+b.height;M._texUpperLeft=Object(Ce.a)(L,C),M._texUpperRight=Object(Ce.a)(z,C),M._texBottomLeft=Object(Ce.a)(L,I),M._texBottomRight=Object(Ce.a)(z,I),c*=g,u*=g,c*=O,u*=O;var R=Math.round(Math.min(64*g,255));M._bitestAndDistRatio=Object(Ce.b)(0,0,w,R),M._computedWidth=c,M._computedHeight=u;var V=Object(Ve.a)(),P=Object(Re.a)();return M._applyTransformation(P,V),M}return Object(c.a)(r,null,[{key:"fromCIMMarker",value:function(e,t){var n=t&&t.width||1,i=t&&t.height||1,a=e.size,s=n/i*e.scaleX,o=e.scaleSymbolsProportionally&&e.frameHeight?a/e.frameHeight:1,c=Object(Te.c)(e.color),u=Object(Te.c)(e.outlineColor),h=Object(te.g)(a),l=h*s,f=Object(te.g)(e.offsetX||0),y=Object(te.g)(e.offsetY||0),v=Object(te.g)(e.outlineWidth||0)*o,p=e.alignment||0,b=Object(te.g)(e.referenceSize),m=e.rotation||0;e.rotateClockwise||(m=-m);var _=0,g=0,x=e.anchorPoint;return x&&(e.isAbsoluteAnchorPoint?a&&(_=-x.x/(a*s),g=x.y/a):(_=x.x,g=x.y)),new r(e.materialKey,f,y,m,c,l,h,b,u,v,e.colorLocked,e.scaleSymbolsProportionally,!1,p,t,_,g,e.sizeRatio,Object(d.o)(e.scaleFactor,1),e.markerPlacement,e.effects)}},{key:"fromPictureMarker",value:function(e,t){var n=Math.round(Object(te.g)(e.width)),i=Math.round(Object(te.g)(e.height)),a=x.l,s=Math.round(Object(te.g)(e.xoffset||0)),o=Math.round(Object(te.g)(e.yoffset||0));return new r(e.materialKey,s,o,e.angle,a,n,i,i,0,0,!1,!1,!1,0,t,0,0,1,1,null,null)}},{key:"fromSimpleMarker",value:function(e,t){var n=Object(Te.d)(e.color),i=Math.round(Object(te.g)(e.size)),a=i,s=Math.round(Object(te.g)(e.xoffset||0)),o=Math.round(Object(te.g)(e.yoffset||0)),c=e.style,u=e.outline,h=0|(u&&u.color&&Object(Te.d)(u.color)),l=0|(u&&u.width&&Math.round(Object(te.g)(u.width))),f=new r(e.materialKey,s,o,e.angle,n,i,a,a,h,l,!1,!1,"esriSMSCross"===c||"esriSMSX"===c,0,t,0,0,126/64,1,null,null);return f.boundsType="esriSMSCircle"===c?"circle":"square",f}},{key:"fromLineSymbolMarker",value:function(e,t){var n,i=Object(Te.d)(e.color),a=Math.round(Object(te.g)(6*e.lineWidth)),s=a,o="cross"===e.style||"x"===e.style;switch(e.placement){case"begin-end":n="Both";break;case"begin":n="JustBegin";break;case"end":n="JustEnd";break;default:n="None"}var c={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:n,offsetAlongLine:0},u=new r(e.materialKey,0,0,0,i,a,s,s/6,i,o?Math.round(Object(te.g)(e.lineWidth)):0,!1,!1,o,1,t,0,0,126/64,1,c,null);return u.boundsType="circle"===e.style?"circle":"square",u}}]),r}(et(Qe)),rt=r(246),nt=r(1097),it=r(995),at=r(185),st=(r(1033),r(1096));function ot(e,t,r,n,i,a,s){zt=0;var o,c,u,h,l,f=(n-r)*a,d=i&&i.length,y=d?(i[0]-r)*a:f,v=ct(t,r,n,0,y,a,!0);if(v&&v.next!==v.prev){if(d&&(v=function(e,t,r,n,i,a){for(var s=new Array,o=0,c=n.length;o<c;o++){var u=ct(e,t,r,n[o]*a,o<c-1?n[o+1]*a:r*a,a,!1);u===u.next&&(u.steiner=!0),s.push(vt(u))}s.sort(kt);for(var h=0,l=s;h<l.length;h++){pt(l[h],i),i=ut(i,i.next)}return i}(t,r,n,i,v,a)),f>80*a){o=u=t[0+r*a],c=h=t[1+r*a];for(var p=a;p<y;p+=a){var b=t[p+r*a],m=t[p+1+r*a];o=Math.min(o,b),c=Math.min(c,m),u=Math.max(u,b),h=Math.max(h,m)}l=0!==(l=Math.max(u-o,h-c))?1/l:0}ht(v,e,a,o,c,l,s,0)}}function ct(e,t,r,n,i,a,s){var o;if(s===function(e,t,r,n,i,a){for(var s=0,o=n,c=i-a;o<i;o+=a)s+=(e[c+t*a]-e[o+t*a])*(e[o+1+t*a]+e[c+1+t*a]),c=o;return s}(e,t,0,n,i,a)>0)for(var c=n;c<i;c+=a)o=dt(c+t*a,e[c+t*a],e[c+1+t*a],o);else for(var u=i-a;u>=n;u-=a)o=dt(u+t*a,e[u+t*a],e[u+1+t*a],o);return o&&jt(o,o.next)&&(yt(o),o=o.next),o}function ut(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;if(!e)return e;var r,n=e;do{if(r=!1,n.steiner||!jt(n,n.next)&&0!==mt(n.prev,n,n.next))n=n.next;else{if(yt(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function ht(e,t,r,n,i,a,s,o){if(e){!o&&a&&(e=bt(e,n,i,a));for(var c=e;e.prev!==e.next;){var u=e.prev,h=e.next;if(a?ft(e,n,i,a):lt(e))t.push(u.index/r+s),t.push(e.index/r+s),t.push(h.index/r+s),yt(e),e=h.next,c=h.next;else if((e=h)===c){o?1===o?ht(e=Mt(e,t,r,s),t,r,n,i,a,s,2):2===o&&wt(e,t,r,n,i,a,s):ht(ut(e),t,r,n,i,a,s,1);break}}}}function lt(e){var t=e.prev,r=e,n=e.next;if(mt(t,r,n)>=0)return!1;for(var i=e.next.next,a=i,s=0;i!==e.prev&&(0===s||i!==a);){if(s++,gt(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&mt(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function ft(e,t,r,n){var i=e.prev,a=e,s=e.next;if(mt(i,a,s)>=0)return!1;for(var o=i.x<a.x?i.x<s.x?i.x:s.x:a.x<s.x?a.x:s.x,c=i.y<a.y?i.y<s.y?i.y:s.y:a.y<s.y?a.y:s.y,u=i.x>a.x?i.x>s.x?i.x:s.x:a.x>s.x?a.x:s.x,h=i.y>a.y?i.y>s.y?i.y:s.y:a.y>s.y?a.y:s.y,l=Ot(o,c,t,r,n),f=Ot(u,h,t,r,n),d=e.prevZ,y=e.nextZ;d&&d.z>=l&&y&&y.z<=f;){if(d!==e.prev&&d!==e.next&&gt(i.x,i.y,a.x,a.y,s.x,s.y,d.x,d.y)&&mt(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,y!==e.prev&&y!==e.next&&gt(i.x,i.y,a.x,a.y,s.x,s.y,y.x,y.y)&&mt(y.prev,y,y.next)>=0)return!1;y=y.nextZ}for(;d&&d.z>=l;){if(d!==e.prev&&d!==e.next&&gt(i.x,i.y,a.x,a.y,s.x,s.y,d.x,d.y)&&mt(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;y&&y.z<=f;){if(y!==e.prev&&y!==e.next&&gt(i.x,i.y,a.x,a.y,s.x,s.y,y.x,y.y)&&mt(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function dt(e,t,r,n){var i=Lt.create(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function yt(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function vt(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function pt(e,t){if(t=function(e,t){var r,n=t,i=e.x,a=e.y,s=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var o=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(o<=i&&o>s){if(s=o,o===i){if(a===n.y)return n;if(a===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===s)return r.prev;var c,u=r,h=r.x,l=r.y,f=1/0;for(n=r.next;n!==u;)i>=n.x&&n.x>=h&&i!==n.x&&gt(a<l?i:s,a,h,l,a<l?s:i,a,n.x,n.y)&&(((c=Math.abs(a-n.y)/(i-n.x))<f||c===f&&n.x>r.x)&&xt(n,e)&&(r=n,f=c)),n=n.next;return r}(e,t)){var r=Tt(t,e);ut(r,r.next)}}function bt(e,t,r,n){for(var i;i!==e;i=i.next){if(null===(i=i||e).z&&(i.z=Ot(i.x,i.y,t,r,n)),i.prev.next!==i||i.next.prev!==i)return i.prev.next=i,i.next.prev=i,bt(e,t,r,n);i.prevZ=i.prev,i.nextZ=i.next}return e.prevZ.nextZ=null,e.prevZ=null,function(e){for(var t,r=1;;){var n=void 0,i=e;e=null,t=null;for(var a=0;i;){a++,n=i;for(var s=0;s<r&&n;s++)n=n.nextZ;for(var o=r;s>0||o>0&&n;){var c=void 0;0===s?(c=n,n=n.nextZ,o--):0!==o&&n?i.z<=n.z?(c=i,i=i.nextZ,s--):(c=n,n=n.nextZ,o--):(c=i,i=i.nextZ,s--),t?t.nextZ=c:e=c,c.prevZ=t,t=c}i=n}if(t.nextZ=null,r*=2,a<2)return e}}(e)}function mt(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function _t(e,t,r,n){return!!(jt(e,t)&&jt(r,n)||jt(e,n)&&jt(r,t))||mt(e,t,r)>0!=mt(e,t,n)>0&&mt(r,n,e)>0!=mt(r,n,t)>0}function gt(e,t,r,n,i,a,s,o){return(i-s)*(t-o)-(e-s)*(a-o)>=0&&(e-s)*(n-o)-(r-s)*(t-o)>=0&&(r-s)*(a-o)-(i-s)*(n-o)>=0}function xt(e,t){return mt(e.prev,e,e.next)<0?mt(e,t,e.next)>=0&&mt(e,e.prev,t)>=0:mt(e,t,e.prev)<0||mt(e,e.next,t)<0}function Ot(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function jt(e,t){return e.x===t.x&&e.y===t.y}function kt(e,t){return e.x-t.x}function Mt(e,t,r,n){var i=e;do{var a=i.prev,s=i.next.next;!jt(a,s)&&_t(a,i,i.next,s)&&xt(a,s)&&xt(s,a)&&(t.push(a.index/r+n),t.push(i.index/r+n),t.push(s.index/r+n),yt(i),yt(i.next),i=e=s),i=i.next}while(i!==e);return i}function wt(e,t,r,n,i,a,s){var o=e;do{for(var c=o.next.next;c!==o.prev;){if(o.index!==c.index&&St(o,c)){var u=Tt(o,c);return o=ut(o,o.next),u=ut(u,u.next),ht(o,t,r,n,i,a,s,0),void ht(u,t,r,n,i,a,s,0)}c=c.next}o=o.next}while(o!==e)}function St(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!function(e,t){var r=e;do{if(r.index!==e.index&&r.next.index!==e.index&&r.index!==t.index&&r.next.index!==t.index&&_t(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&xt(e,t)&&xt(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)}function Tt(e,t){var r=Lt.create(e.index,e.x,e.y),n=Lt.create(t.index,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}for(var Lt=function(){function e(){Object(o.a)(this,e),this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return Object(c.a)(e,null,[{key:"create",value:function(e,t,r){var n=Ct[zt++];return n.index=e,n.x=t,n.y=r,n.prev=null,n.next=null,n.z=null,n.prevZ=null,n.nextZ=null,n.steiner=!1,n}}]),e}(),Ct=new Array,zt=0,It=0;It<8096;It++)Ct.push(new Lt);var Rt=new(r(1132).a),Vt=new st.b(0,0,0,1,128);function Pt(e,t,r){for(var n=0,i=1;i<r;i++){var a=e[2*(t+i-1)],s=e[2*(t+i-1)+1];n+=(e[2*(t+i)]-a)*(e[2*(t+i)+1]+s)}return n}function Dt(e,t,r,n,i){for(var a=0,s=r;s<n;s+=3){var o=2*(e.getValue(s)-i),c=2*(e.getValue(s+1)-i),u=2*(e.getValue(s+2)-i);a+=Math.abs((t[o]-t[u])*(t[c+1]-t[o+1])-(t[o]-t[c])*(t[u+1]-t[o+1]))}return a}Vt.setExtent(x.p);var At=function(e){return function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(){var e;Object(o.a)(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).forceLibtess=!1,e.geometryType=V.b.FILL,e}return Object(c.a)(r,[{key:"writeMeshWithGeometry",value:function(e,t,r,i,a,s){var o=U.load(this._materialKey),c=t.indexVector,u=t.getVector("geometry"),h=u.vertexCount,l=c.length,f=s?Object(Le.m)(Object(Le.d)(s),2):r.readUnquantizedGeometry();if(f&&(f=function(e){if(!function(e,t,r){for(var n=0,i=0;i<e.lengths.length;i++){for(var a=e.lengths[i],s=0;s<a;s++){var o=e.coords[2*(s+n)],c=e.coords[2*(s+n)+1];if(o<-128||o>r||c<-128||c>r)return!0}n+=a}return!1}(e,0,x.p+128))return e;Vt.reset(3);for(var t=0,r=0;r<e.lengths.length;r++){var i=e.lengths[r],a=e.coords[2*(0+t)],s=e.coords[2*(0+t)+1];Vt.moveTo(a,s);for(var o=1;o<i;o++)a=e.coords[2*(o+t)],s=e.coords[2*(o+t)+1],Vt.lineTo(a,s);Vt.close(),t+=i}var c=Vt.result(!1);if(!c)return null;var u,h=[],l=[],f=Object(n.a)(c);try{for(f.s();!(u=f.n()).done;){var d,y=u.value,v=0,p=Object(n.a)(y);try{for(p.s();!(d=p.n()).done;){var b=d.value;l.push(b.x),l.push(b.y),v++}}catch(m){p.e(m)}finally{p.f()}h.push(v)}}catch(m){f.e(m)}finally{f.f()}return new at.a(h,l)}(f))){var d=f.coords;!this.forceLibtess&&function(e,t,r){var n=t.coords,i=t.lengths;if(t.hasIndeterminateRingOrder)return!1;for(var a=e.length,s=0,o=0;o<i.length;){for(var c=o,u=i[o],h=Pt(n,s,u),l=[];++c<i.length;){var f=i[c],d=Pt(n,s+u,f);if(!(d>0))break;h+=d,l.push(s+u),u+=f}var y=e.length;ot(e,n,s,s+u,l,2,r);var v=Dt(e,n,y,e.length,r),p=Math.abs(h);if(Math.abs((v-p)/Math.max(1e-7,p))>1e-5)return e.seek(a),!1;o=c,s+=u}return!0}(c,f,h)||function(e,t,r,n){var i=[],a=r.coords,s=r.lengths;Rt.beginPolygon(e,i);for(var o=0,c=0;c<s.length;c++){var u=r.lengths[c];Rt.beginContour();for(var h=0;h<u;h++){var l=[a[2*(o+h)],a[2*(o+h)+1],0];Rt.addVertex(l,l)}Rt.endContour(),o+=u}Rt.endPolygon();for(var f=0;f<i.length;f++)t.push(i[f]+n)}(d=[],c,f,h),this._write(u,r,a,d,o);var y=u.vertexCount-h,v=c.length-l;e.writeDisplayRecord(this.geometryType,this._materialKey,h,y,l,v)}}},{key:"_write",value:function(e,t,r,n,i){for(var a=0;a<n.length;a+=2){var s=Object(Ce.a)(1*n[a],1*n[a+1]);e.data.push(s),e.data.push(r),i.dotDensity?e.data.writeF32(1/Math.abs(t.readGeometryArea())):(e.data.push(this.fillColor),e.data.push(this.tl),e.data.push(this.br),e.data.push(this.aux1),e.data.push(this.aux2),e.data.push(this.aux3))}}}]),r}(e)},Ft=y.a.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate"),Bt=function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this))._ongoingMaterialRequestMap=new Map,n._materialCache=new Map,n._dynamicPropertyMap=new Map,n._cimLayer=e,n}return Object(c.a)(r,[{key:"analyze",value:function(e,t,r,n){var i=this,a=t.readLegacyFeature(),s=this._materialCache,o=this._cimLayer.materialHash;if(!o)return Ft.error("A Dynamic mesh template must have a material hash value or function!"),Object(m.r)(null);var c="function"==typeof o?o(a,r,n):o;if(s.has(c)){var u=s.get(c);return Object(m.s)(u)}if(this._ongoingMaterialRequestMap.has(c))return this._ongoingMaterialRequestMap.get(c);var h=Object(R.a)(this._cimLayer.cim,this._cimLayer.materialOverrides);h.mosaicHash=c;var l=e.getMosaicItem(h).then((function(e){return i._ongoingMaterialRequestMap.delete(c),s.set(c,e),e})).catch((function(e){return i._ongoingMaterialRequestMap.delete(c),Ft.error(".analyze()",e.message),null}));return this._ongoingMaterialRequestMap.set(c,l),l}}]),r}(Qe),Et=function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(e){var n;if(Object(o.a)(this,r),n=t.call(this,e),Object(it.c)(e.color)){n._dynamicPropertyMap.set("_fillColor",(function(t,r,n){var i=e.color(t,r,n);return i&&Object(Te.c)(i)||0}))}else{var i=e.color;n.fillColor=i&&Object(Te.c)(i)||0}var a=0;Object(it.c)(e.height)||(a=e.height||0),n._dynamicPropertyMap.set("_height",(function(t,r,n){return Object(it.c)(e.height)?e.height(t,r,n):a}));var s=0;Object(it.c)(e.offsetX)||(s=Object(te.g)(e.offsetX||0)+128)>255&&(s=255),n._dynamicPropertyMap.set("_offsetX",(function(t,r,n){if(Object(it.c)(e.offsetX)){var i=Object(te.g)(e.offsetX(t,r,n))+128;return i>255&&(i=255),i}return s}));var c=1;Object(it.c)(e.scaleX)||(c=e.scaleX||1),n._dynamicPropertyMap.set("_scaleX",(function(t,r,n){return Object(it.c)(e.scaleX)?e.scaleX(t,r,n):c}));var u=0;Object(it.c)(e.offsetY)||(u=Object(te.g)(-e.offsetY||0)+128)>255&&(u=255),n._dynamicPropertyMap.set("_offsetY",(function(t,r,n){if(Object(it.c)(e.offsetY)){var i=Object(te.g)(-e.offsetY(t,r,n))+128;return i>255&&(i=255),i}return u}));var h=0;return Object(it.c)(e.angle)||(h=Object(nt.c)(e.angle)||0),n._dynamicPropertyMap.set("_angle",(function(t,r,n){return Object(it.c)(e.angle)?Object(nt.c)(e.angle(t,r,n)):h})),n.effects=e.effects,n._cimFillLayer=e,n._fillMaterialKey=U.load(e.materialKey),Object(rt.a)(n)}return Object(c.a)(r,[{key:"bindFeature",value:function(e,t,r){var n=this,i=e.readLegacyFeature();this._dynamicPropertyMap.forEach((function(e,a){n[a]=e(i,t,r)}));var a=this._fillMaterialKey,s=this._materialCache,o=this._cimFillLayer;this.aux3=Object(Ce.b)(0,0,this._angle,o.colorLocked?1:0);var c=(0,o.materialHash)(i,t,r),u=s.get(c),h=null;if(u&&ge(u.spriteMosaicItem)&&(h=u.spriteMosaicItem),h){var l=h,f=l.rect,d=l.width,y=l.height,v=f.x+x.m,p=f.y+x.m,b=v+d,m=p+y,_=Object(De.n)(Object(te.g)(this._height));_>255?_=255:_<=0&&(_=Object(De.n)(m-p));var g=Object(De.n)(Object(te.g)(this._height/y*d||0));g>255?g=255:g<=0&&(g=Object(De.n)(b-v));var O=this._scaleX;this.tl=Object(Ce.a)(v,p),this.br=Object(Ce.a)(b,m),this.aux1=Object(Ce.b)(g,_,this._offsetX,this._offsetY),this.aux2=Object(Ce.a)(128*O,128),a.sdf=h.sdf,a.pattern=!0,a.textureBinding=h.textureBinding}else this.tl=0,this.br=0,this.aux1=0,this.aux2=0,a.sdf=!1,a.pattern=!1,a.textureBinding=0;this._materialKey=a.data}}],[{key:"fromCIMFill",value:function(e){return new r(e)}}]),r}(At(Bt)),Gt=r(1133),Kt=x.p+16,Ut=new st.b(0,0,0,1,16);Ut.setExtent(x.p);var Zt=new Uint32Array(9),Nt=new Uint32Array(36),Xt=new Uint32Array(3),Wt=new Uint32Array(6),Ht=function(e){return function(t){Wt[0]=t.leftExit0,Wt[1]=t.rightEntry0,Wt[2]=t.leftExit2,Wt[3]=t.rightEntry0,Wt[4]=t.rightEntry2,Wt[5]=t.leftExit2,e.indexCount+=6,e.indexBuf.writeRegion(Wt)}},Yt=function(e){return function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(){var e;Object(o.a)(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).tessellationProperties={_fillColor:null,_tl:null,_br:null,_halfWidth:null,_bitset:null,_halfReferenceWidth:null,id:null,indexBuf:null,indexCount:null,geometryBuf:null,vertexCount:null,offset:null},e._tessellationOptions={},e.geometryType=V.b.LINE,e}return Object(c.a)(r,[{key:"writeMeshWithGeometry",value:function(e,t,r,n,i,a){var s=t.indexVector,o=t.get("geometry"),c=t.getVector("geometry").vertexCount,u=s.length,h=null!=a?a:r.readLegacyGeometry();if(h){switch(n){case"esriGeometryPolyline":var l=this._clipLines(h.paths);if(0===l.length)return;this._write(s,o,c,i,l);break;case"esriGeometryPolygon":var f=this._clipLines(h.rings);if(0===f.length)return;this._write(s,o,c,i,f)}var d=this.tessellationProperties.vertexCount,y=this.tessellationProperties.indexCount;e.writeDisplayRecord(this.geometryType,this._materialKey,c,d,u,y)}}},{key:"_clipLines",value:function(e){for(var t=[],r=!1,i=0;i<e.length;){var a=[],s=e[i];Ut.reset(2);var o=Object(ke.a)(s[0],2),c=o[0],u=o[1];if(r)Ut.moveTo(c,u);else{if(c<-16||c>Kt||u<-16||u>Kt){r=!0;continue}a.push({x:c,y:u})}for(var h=!1,l=s.length,f=1;f<l;++f)if(c+=s[f][0],u+=s[f][1],r)Ut.lineTo(c,u);else{if(c<-16||c>Kt||u<-16||u>Kt){h=!0;break}a.push({x:c,y:u})}if(h)r=!0;else{if(r){var d=Ut.resultWithStarts();if(d){var y,v=Object(n.a)(d);try{for(v.s();!(y=v.n()).done;){var p=y.value;t.push(p)}}catch(b){v.e(b)}finally{v.f()}}}else t.push({line:a,start:0});i++,r=!1}}return t}},{key:"_write",value:function(e,t,r,i,a){this.tessellationProperties.id=i,this.tessellationProperties.indexBuf=e,this.tessellationProperties.indexCount=0,this.tessellationProperties.geometryBuf=t,this.tessellationProperties.vertexCount=0,this.tessellationProperties.offset=r;var s,o=Object(n.a)(a);try{for(o.s();!(s=o.n()).done;){var c=s.value,u=c.line;u.length<2||(this._tessellationOptions.initialDistance=c.start%65535,this._tessellationCallbacks instanceof Gt.a&&(this._tessellationCallbacks.capType=this._capType,this._tessellationCallbacks.joinType=this._joinType),Object(Gt.d)(u,this._tessellationOptions,this._tessellationCallbacks),Object(Gt.b)())}}catch(h){o.e(h)}finally{o.f()}}},{key:"_initializeTessellator",value:function(e){var t,r=N.load(this._materialKey);if(this._tessellationOptions.trackDistance=this._isDashed||this._hasPattern,this._tessellationOptions.thin=!e&&this.tessellationProperties._halfWidth<x.o/2&&!(r.vvSizeFieldStops||r.vvSizeMinMaxValue||r.vvSizeScaleStops||r.vvSizeUnitValue),this._tessellationOptions.wrapDistance=65535,this._tessellationOptions.outerBisectorAutoSplitThreshold=.2631578947368421,this._tessellationOptions.enableOuterBisectorSplit=this._isDashed||this._hasPattern,this._tessellationOptions.innerBisectorAutoSplitThreshold=.2631578947368421,this._tessellationOptions.enableInnerBisectorSplit=this._isDashed||this._hasPattern,this._tessellationOptions.thin)this._tessellationCallbacks={vertex:(t=this.tessellationProperties,function(e){var r=Math.ceil(1024*t._halfWidth),n=Math.ceil(1024*t._halfReferenceWidth);e.entry0=t.offset+t.vertexCount++;var i=Object(Ce.a)(e.distance,r),a=Object(Ce.b)(Math.round(31*e.prevNormal.x),Math.round(31*e.prevNormal.y),Math.round(0),Math.round(-31)),s=Object(Ce.b)(0,0,0,t._bitset);Nt[0]=Object(Ce.a)(8*e.currentVertex.x,8*e.currentVertex.y),Nt[1]=t.id,Nt[2]=t._fillColor,Nt[3]=a,Nt[4]=i,Nt[5]=t._tl,Nt[6]=t._br,Nt[7]=s,Nt[8]=Object(Ce.a)(n,0),e.entry2=t.offset+t.vertexCount++;var o=Object(Ce.a)(e.distance,r),c=Object(Ce.b)(Math.round(31*-e.prevNormal.x),Math.round(31*-e.prevNormal.y),Math.round(0),Math.round(31)),u=Object(Ce.b)(0,0,0,t._bitset);Nt[9]=Object(Ce.a)(8*e.currentVertex.x,8*e.currentVertex.y),Nt[10]=t.id,Nt[11]=t._fillColor,Nt[12]=c,Nt[13]=o,Nt[14]=t._tl,Nt[15]=t._br,Nt[16]=u,Nt[17]=Object(Ce.a)(n,0),e.exit0=t.offset+t.vertexCount++;var h=Object(Ce.a)(e.distance,r),l=Object(Ce.b)(Math.round(31*e.nextNormal.x),Math.round(31*e.nextNormal.y),Math.round(0),Math.round(-31)),f=Object(Ce.b)(0,0,0,t._bitset);Nt[18]=Object(Ce.a)(8*e.currentVertex.x,8*e.currentVertex.y),Nt[19]=t.id,Nt[20]=t._fillColor,Nt[21]=l,Nt[22]=h,Nt[23]=t._tl,Nt[24]=t._br,Nt[25]=f,Nt[26]=Object(Ce.a)(n,0),e.exit2=t.offset+t.vertexCount++;var d=Object(Ce.a)(e.distance,r),y=Object(Ce.b)(Math.round(31*-e.nextNormal.x),Math.round(31*-e.nextNormal.y),Math.round(0),Math.round(31)),v=Object(Ce.b)(0,0,0,t._bitset);Nt[27]=Object(Ce.a)(8*e.currentVertex.x,8*e.currentVertex.y),Nt[28]=t.id,Nt[29]=t._fillColor,Nt[30]=y,Nt[31]=d,Nt[32]=t._tl,Nt[33]=t._br,Nt[34]=v,Nt[35]=Object(Ce.a)(n,0),t.geometryBuf.writeRegion(Nt)}),bridge:Ht(this.tessellationProperties)};else{var n=new Gt.a(function(e){return function(t,r,n,i,a,s,o,c,u){var h=Object(Ce.a)(u,Math.ceil(1024*e._halfWidth)),l=Object(Ce.b)(Math.round(31*a),Math.round(31*s),Math.round(31*o),Math.round(31*c)),f=Object(Ce.b)(31*n,31*i,0,e._bitset);return Zt[0]=Object(Ce.a)(8*t,8*r),Zt[1]=e.id,Zt[2]=e._fillColor,Zt[3]=l,Zt[4]=h,Zt[5]=e._tl,Zt[6]=e._br,Zt[7]=f,Zt[8]=Object(Ce.a)(Math.ceil(1024*e._halfReferenceWidth),0),e.geometryBuf.writeRegion(Zt),e.offset+e.vertexCount++}}(this.tessellationProperties),function(e){return function(t,r,n){Xt[0]=t,Xt[1]=r,Xt[2]=n,e.indexCount+=3,e.indexBuf.writeRegion(Xt)}}(this.tessellationProperties));n.miterLimitCosine=this._miterLimitCosine,n.textured=this._isDashed||this._hasPattern,n.joinOnUTurn=this._joinOnUTurn,this._tessellationCallbacks=n}}}]),r}(e)},qt=function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(e){var n;Object(o.a)(this,r),(n=t.call(this,e))._cimLineLayer=e;var i=0;if(Object(it.c)(e.width)||(i=.5*Object(te.g)(e.width)),n._dynamicPropertyMap.set("_halfWidth",(function(t,r,n){return Object(it.c)(e.width)?.5*Object(te.g)(e.width(t,r,n)):i})),Object(it.c)(e.cap)?n._dynamicPropertyMap.set("_capType",e.cap):n._capType=e.cap,Object(it.c)(e.join)?n._dynamicPropertyMap.set("_joinType",e.join):n._joinType=e.join,Object(it.c)(e.color)){n._dynamicPropertyMap.set("_fillColor",(function(t,r,n){var i=e.color(t,r,n);return i&&Object(Te.c)(i)||0}))}else{var a=e.color;n._fillColor=a&&Object(Te.c)(a)||0}if(Object(it.c)(e.miterLimit)){n._dynamicPropertyMap.set("_miterLimitCosine",(function(t,r,n){return Object(it.b)(e.miterLimit(t,r,n))}))}else n._miterLimitCosine=Object(it.b)(e.miterLimit);return n._scaleFactor=e.scaleFactor||1,n._isDashed=e.isDashed,n.effects=e.effects,n.tessellationProperties._bitset=e.colorLocked?1:0,n._materialKey=e.materialKey,n._initializeTessellator(!0),n}return Object(c.a)(r,[{key:"bindFeature",value:function(e,t,r){var n=this,i=e.readLegacyFeature();this._dynamicPropertyMap.forEach((function(e,a){n[a]=e(i,t,r)})),this._halfWidth*=this._scaleFactor;var a=this._materialCache,s=(0,this._cimLineLayer.materialHash)(i,t,r),o=a.get(s),c=null;if(o&&ge(o.spriteMosaicItem)&&(c=o.spriteMosaicItem),c){this._hasPattern=!0;var u=c,h=u.rect,l=u.width,f=u.height,d=h.x+x.m,y=h.y+x.m,v=d+l,p=y+f;this.tessellationProperties._tl=Object(Ce.a)(d,y),this.tessellationProperties._br=Object(Ce.a)(v,p)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=0;this.tessellationProperties._fillColor=this._fillColor,this.tessellationProperties._halfWidth=this._halfWidth,this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;var b=N.load(this._materialKey);c&&(b.sdf=c.sdf,b.pattern=!0,b.textureBinding=c.textureBinding),this._materialKey=b.data}}],[{key:"fromCIMLine",value:function(e){return new r(e)}}]),r}(Yt(Bt)),Jt=Object(Ve.a)(),Qt=Object(Re.a)(),$t=y.a.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate"),er=function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(e){var n;if(Object(o.a)(this,r),(n=t.call(this,e))._cimMarkerLayer=e,Object(it.c)(e.color)){n._dynamicPropertyMap.set("_fillColor",(function(t,r,n){return Object(Te.c)(e.color(t,r,n))}))}else n._fillColor=Object(Te.c)(e.color);if(Object(it.c)(e.outlineColor)){n._dynamicPropertyMap.set("_outlineColor",(function(t,r,n){return Object(Te.c)(e.outlineColor(t,r,n))}))}else n._outlineColor=Object(Te.c)(e.outlineColor);if(Object(it.c)(e.size)){n._dynamicPropertyMap.set("_size",(function(t,r,n){return Object(te.g)(e.size(t,r,n))}))}else n._size=Object(te.g)(e.size);if(Object(it.c)(e.scaleX)?n._dynamicPropertyMap.set("_scaleX",e.scaleX):n._scaleX=e.scaleX,Object(it.c)(e.offsetX)){n._dynamicPropertyMap.set("xOffset",(function(t,r,n){return Object(te.g)(e.offsetX(t,r,n))}))}else n.xOffset=Object(te.g)(e.offsetX);if(Object(it.c)(e.offsetY)){n._dynamicPropertyMap.set("yOffset",(function(t,r,n){return Object(te.g)(e.offsetY(t,r,n))}))}else n.yOffset=Object(te.g)(e.offsetY);if(Object(it.c)(e.outlineWidth)){n._dynamicPropertyMap.set("_outlineWidth",(function(t,r,n){return Object(te.g)(e.outlineWidth(t,r,n))}))}else n._outlineWidth=Object(te.g)(e.outlineWidth);return Object(it.c)(e.rotation)?n._dynamicPropertyMap.set("_angle",e.rotation):n._angle=e.rotation,n._scaleFactor=Object(d.o)(e.scaleFactor,1),n._markerPlacement=e.markerPlacement,n.effects=e.effects,n._bitSet=(1===e.alignment?1:0)|(e.colorLocked?1:0)<<1|(e.scaleSymbolsProportionally?1:0)<<3,n._materialKey=e.materialKey,Object(rt.a)(n)}return Object(c.a)(r,[{key:"bindFeature",value:function(e,t,r){var n=this,i=e.readLegacyFeature();this._dynamicPropertyMap.forEach((function(e,a){n[a]=e(i,t,r)}));var a=this._cimMarkerLayer.materialHash,s="function"==typeof a?a(i,t,r):a,o=this._materialCache.get(s);if(o&&ge(o.spriteMosaicItem)&&o.spriteMosaicItem){var c=o.spriteMosaicItem,u=this._cimMarkerLayer.sizeRatio,h=c.width/c.height*this._scaleX,l=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle,f=this._size,d=f*h,y=this.xOffset,v=this.yOffset;this.xOffset*=this._scaleFactor,this.yOffset*=this._scaleFactor;var p=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/Object(te.g)(this._cimMarkerLayer.frameHeight):1,m=this._outlineWidth*p,_=Object(te.g)(this._cimMarkerLayer.referenceSize),g=0,O=0,j=this._cimMarkerLayer.anchorPoint;j&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(g=-j.x/(this._size*h),O=j.y/this._size):(g=j.x,O=j.y)),this._sizeOutlineWidth=Object(Ce.b)(Math.round(Math.min(Math.sqrt(128*d),255)),Math.round(Math.min(Math.sqrt(128*f),255)),Math.round(Math.min(Math.sqrt(128*m),255)),Math.round(Math.min(Math.sqrt(128*_),255))),this.angle=l;var k=Math.round(Math.min(64*u,255));this._bitestAndDistRatio=Object(Ce.b)(0,0,this._bitSet,k);var M=c.rect.x+x.m,w=c.rect.y+x.m,S=M+c.width,T=w+c.height;this._texUpperLeft=Object(Ce.a)(M,w),this._texUpperRight=Object(Ce.a)(S,w),this._texBottomLeft=Object(Ce.a)(M,T),this._texBottomRight=Object(Ce.a)(S,T);var L=Z.load(this._materialKey);L.sdf=c.sdf,L.pattern=!0,L.textureBinding=c.textureBinding,this._materialKey=L.data,this._anchorX=.5-(.5+g)*c.width/c.width,this._anchorY=.5-(.5+O)*c.height/c.height,d*=u,f*=u,d*=this._scaleFactor,f*=this._scaleFactor,d*=c.rect.width/c.width,f*=c.rect.height/c.height,this._computedWidth=d,this._computedHeight=f,this._applyTransformation(Qt,Jt),this.xOffset=y,this.yOffset=v}else $t.error(new b.a("mapview-cim","Encountered an error when binding feature"))}}],[{key:"fromCIMMarker",value:function(e){return new r(e)}}]),r}(et(Bt)),tr=function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(e){var n;Object(o.a)(this,r),(n=t.call(this,e))._horizontalAlignment="center",n._verticalAlignment="middle",n._textToGlyphs=new Map;var i,a,s,c=e.scaleFactor||1;if(n._cimTextLayer=e,Object(it.c)(e.color)){n._dynamicPropertyMap.set("_color",(function(t,r,n){return Object(Te.c)(e.color(t,r,n))}))}else n._color=Object(Te.c)(e.color);if(Object(it.c)(e.color)){n._dynamicPropertyMap.set("_haloColor",(function(t,r,n){return Object(Te.c)(e.outlineColor(t,r,n))}))}else n._haloColor=Object(Te.c)(e.outlineColor);if(Object(it.c)(e.size)||(i=Math.min(Math.round(Object(te.g)(e.size*e.sizeRatio)),127)),n._dynamicPropertyMap.set("_size",(function(t,r,n){return Object(it.c)(e.size)?Math.min(Math.round(Object(te.g)(e.size(t,r,n)*e.sizeRatio)),127):i})),Object(it.c)(e.outlineSize)){n._dynamicPropertyMap.set("_haloSize",(function(t,r,n){return Math.min(Math.floor(5*Object(te.g)(e.outlineSize(t,r,n)*e.sizeRatio)),127)}))}else n._haloSize=Math.min(Math.floor(5*Object(te.g)(e.outlineSize*e.sizeRatio)),127);Object(it.c)(e.offsetX)||(a=Math.round(Object(te.g)(e.offsetX*e.sizeRatio))),n._dynamicPropertyMap.set("_xOffset",(function(t,r,n){return Object(it.c)(e.offsetX)?Math.round(Object(te.g)(e.offsetX(t,r,n)*e.sizeRatio)):a})),Object(it.c)(e.offsetY)||(s=Math.round(Object(te.g)(e.offsetY*e.sizeRatio))),n._dynamicPropertyMap.set("_yOffset",(function(t,r,n){return Object(it.c)(e.offsetY)?Math.round(Object(te.g)(e.offsetY(t,r,n)*e.sizeRatio)):s})),Object(it.c)(e.angle)?n._dynamicPropertyMap.set("_angle",e.angle):n._angle=e.angle,Object(it.c)(e.horizontalAlignment)?n._dynamicPropertyMap.set("_horizontalAlignment",e.horizontalAlignment):n._horizontalAlignment=e.horizontalAlignment,Object(it.c)(e.verticalAlignment)?n._dynamicPropertyMap.set("_verticalAlignment",e.verticalAlignment):n._verticalAlignment=e.verticalAlignment,n._scaleFactor=c,Object(it.c)(e.text)?n._dynamicPropertyMap.set("_text",e.text):n._text=e.text;var u=Math.min(Math.round(Object(te.g)(e.referenceSize*e.sizeRatio)),127);n._referenceSize=Math.round(Math.sqrt(256*u)),n._materialKey=e.materialKey;var h=X.load(n._materialKey);return h.sdf=!0,n._bitset=(1===e.alignment?1:0)|(e.colorLocked?1:0)<<1,n._materialKey=h.data,n._decoration="none",n._lineHeight=1,n._lineWidth=512,n._textPlacement=e.markerPlacement,n.effects=e.effects,n._isCIM=!0,n}return Object(c.a)(r,[{key:"analyze",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r,n,i){var s,o,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.readLegacyFeature(),o=function(e,t,r,n){return"string"==typeof e.text?e.text:"function"==typeof e.text?e.text(t,r,n):""}(this._cimTextLayer,s,n,i),e.next=4,t.getMosaicItem(this._cimTextLayer.cim,me(o));case 4:return c=e.sent,e.abrupt("return",(this._textToGlyphs.set(o,c.glyphMosaicItems),c));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"bindFeature",value:function(e,t,r){var n=this,i=e.readLegacyFeature();if(this._dynamicPropertyMap.forEach((function(e,a){n[a]=e(i,t,r)})),this._text&&0!==this._text.length){this._size*=this._scaleFactor,this._scale=this._size/24,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=Me(this._horizontalAlignment||"center"),this._yAlignD=we(this._verticalAlignment||"baseline");var a=this._textToGlyphs.get(this._text);this.bindTextInfo(a,!1)}else this._shapingInfo=null}}],[{key:"fromCIMText",value:function(e){return new r(e)}}]),r}(He(Bt)),rr=function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(e,n,i,a,s,c,u,h,l){var f;Object(o.a)(this,r),(f=t.call(this)).effects=l;var d=U.load(e);return n&&(d.sdf=n.sdf,d.pattern=!0,d.textureBinding=n.textureBinding),f.fillColor=i,f.tl=a,f.br=s,f.aux1=c,f.aux2=u,f.aux3=h,f._materialKey=d.data,f}return Object(c.a)(r,null,[{key:"fromCIMFill",value:function(e,t){var n=e.color,i=n&&Object(Te.c)(n)||0,a=e.materialKey;if(!t)return new r(a,null,i,0,0,0,0,Object(Ce.b)(0,0,0,e.colorLocked?1:0),e.effects);var s=t.rect,o=t.width,c=t.height,u=s.x+x.m,h=s.y+x.m,l=u+o,f=h+c,d=Object(De.n)(Object(te.g)(e.height||0));d>255?d=255:d<=0&&(d=Object(De.n)(f-h));var y=Object(De.n)(Object(te.g)(e.height/c*o||0));y>255?y=255:y<=0&&(y=Object(De.n)(l-u));var v=Object(te.g)(e.offsetX||0)+128;v>255&&(v=255);var p=Object(te.g)(-e.offsetY||0)+128;p>255&&(p=255);var b=e.scaleX||1;return new r(a,t,i,Object(Ce.a)(u,h),Object(Ce.a)(l,f),Object(Ce.b)(y,d,v,p),Object(Ce.a)(128*b,128),Object(Ce.b)(0,0,Object(nt.b)(e.angle),e.colorLocked?1:0),e.effects)}},{key:"fromSimpleFill",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.color,a=i&&"esriSFSNull"!==e.style&&Object(Te.d)(i)||0,s=Object(Ce.b)(0,0,0,n?255:0),o=e.materialKey;if(!t)return new r(o,null,a,0,0,0,0,s,null);var c=t.rect,u=t.width,h=t.height,l=c.x+x.m,f=c.y+x.m,d=l+u,y=f+h,v=Object(Ce.a)(l,f),p=Object(Ce.a)(d,y),b=Object(Ce.b)(Object(De.n)(d-l),Object(De.n)(y-f),0,0),m=Object(Ce.a)(128,128);return new r(o,t,a,v,p,b,m,s,null)}},{key:"fromPictureFill",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=x.l,a=t.rect,s=t.width,o=t.height,c=a.x+x.m,u=a.y+x.m,h=c+s,l=u+o,f=Object(Ce.a)(c,u),d=Object(Ce.a)(h,l),y=Object(De.n)(Object(te.g)(e.width));y>255&&(y=255);var v=Object(De.n)(Object(te.g)(e.height));v>255&&(v=255);var p=Object(te.g)(e.xoffset)+128;p>255&&(p=255);var b=Object(te.g)(-e.yoffset)+128;b>255&&(b=255);var m=Object(Ce.b)(y,v,p,b),_=Object(Ce.a)(128*e.xscale,128*e.yscale),g=Object(Ce.b)(0,0,0,n?255:0),O=e.materialKey;return new r(O,t,i,f,d,m,_,g,null)}}]),r}(At(Qe)),nr=y.a.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate"),ir=function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(e,n,i,a,s,c,u,h,l,f,d,y,v,p,b,m){var _;Object(o.a)(this,r),_=t.call(this);var g=N.load(e);return n&&(g.sdf=n.sdf,g.pattern=!0,g.textureBinding=n.textureBinding),_._capType=a,_._joinType=s,_._miterLimitCosine=Object(it.b)(c),_.tessellationProperties._fillColor=u,_.tessellationProperties._tl=h,_.tessellationProperties._br=l,_._hasPattern=f,_._isDashed=d,_._joinOnUTurn=b,_._isColorLocked=y,_._zOrder=p,_.effects=m,_._materialKey=g.data,_.tessellationProperties._bitset=y?1:0,_.tessellationProperties._halfWidth=.5*i,_.tessellationProperties._halfReferenceWidth=.5*v,_._initializeTessellator(!1),_}return Object(c.a)(r,null,[{key:"fromCIMLine",value:function(e,t,n){var i=e.color,a=e.scaleFactor||1,s=e.isDashed,o=e.cap;s&&1===o&&(o=2);var c=e.join,u=Object(te.g)(e.width)*a,h=Object(te.g)(e.referenceWidth),l=Object(te.g)(e.miterLimit),f=i&&Object(Te.c)(i)||0;if(!t)return new r(e.materialKey,t,u,o,c,l,f,0,0,!1,s,e.colorLocked,h,e.zOrder,n,e.effects);var d=t.rect,y=t.width,v=t.height,p=d.x+x.m,b=d.y+x.m,m=p+y,_=b+v,g=Object(Ce.a)(p,b),O=Object(Ce.a)(m,_);return new r(e.materialKey,t,u,o,c,l,f,g,O,!0,s,e.colorLocked,h,e.zOrder,n,e.effects)}},{key:"fromSimpleLine",value:function(e,t,n){var i=e.color,a="esriSLSSolid"!==e.style&&"esriSLSNull"!==e.style,s=Object(se.b)(e.cap||"round",a),o=Object(se.c)(e.join||"round"),c=i&&"esriSLSNull"!==e.style&&Object(Te.d)(i)||0;"esriSLSNull"===e.style&&(c=0);var u=Object(te.g)(e.width),h=e.miterLimit;if(!t)return new r(e.materialKey,t,u,s,o,h,c,0,0,!1,a,!1,u,0,n,null);var l=t.rect,f=t.width,d=t.height,y=l.x+x.m,v=l.y+x.m,p=y+f,b=v+d,m=Object(Ce.a)(y,v),_=Object(Ce.a)(p,b);return new r(e.materialKey,t,u,s,o,h,c,m,_,!0,a,!1,u,0,n,null)}},{key:"fromPictureLineSymbol",value:function(e,t,r,n){return nr.error("PictureLineSymbol support does not exist!"),null}}]),r}(Yt(Qe));var ar=function(){function e(){Object(o.a)(this,e),this._resolver=null}return Object(c.a)(e,[{key:"isHeld",value:function(){return!!this._resolver}},{key:"acquire",value:function(){var e=this;return this._resolver?this._resolver.promise.then((function(){return e.acquire()})):(this._resolver=Object(m.g)(),Object(m.s)())}},{key:"release",value:function(){var e=this._resolver;this._resolver=null,e.resolve()}}]),e}(),sr=y.a.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),or=new Array;function cr(e,t){var r=e.length;return e.push(null),t.then((function(t){return e[r]=t})),e}function ur(e){return!!(1&e)}var hr=function(){function e(t,r){Object(o.a)(this,e),this._idCounter=1,this._templateIdCounter=1,this._idToTemplateGroup=new Map,this._symbolToTemplate=new Map,this._fetchQueue=[],this._idToResolver=new Map,this._cimTemplateCache=new Map,this._cimAnalyses=[],this._lock=new ar,this._fetchResource=t,this._joinOnUTurn=r}return Object(c.a)(e,[{key:"_markerError",get:function(){return this._errorTemplates.marker[0]}},{key:"_fillError",get:function(){return this._errorTemplates.fill[0]}},{key:"_lineError",get:function(){return this._errorTemplates.line[0]}},{key:"_textError",get:function(){return this._errorTemplates.line[0]}},{key:"createTemplateGroup",value:function(e,t){this._initErrorTemplates();var r=e.hash;if(this._symbolToTemplate.has(r))return this._symbolToTemplate.get(r);var n=new Array;t&&this._createMeshTemplates(n,t,!0),this._createMeshTemplates(n,e,!1);var i=this._createGroupId("expanded-cim"===e.type);return this._idToTemplateGroup.set(i,n),this._symbolToTemplate.set(r,i),i}},{key:"getTemplateGroup",value:function(e){return this._idToTemplateGroup.has(e)?this._idToTemplateGroup.get(e):or}},{key:"getDynamicTemplateGroup",value:function(e){return this._idToTemplateGroup.has(e)?(ur(e)||sr.error("mapview-template-store","Id ".concat(e," does not refer to a dynamic template")),this._idToTemplateGroup.get(e)):or}},{key:"getMosaicItem",value:function(e,t){var r=this,n=this._createTemplateId(),i=Object(m.c)((function(e){return r._idToResolver.set(n,e)}));return this._fetchQueue.push({symbol:e,id:n,glyphIds:t}),i}},{key:"finalize",value:function(e){return this._fetchQueue.length||this._lock.isHeld()?function(e,t,r){return e.acquire().then((function(){return t(r)})).then((function(){return e.release()})).catch((function(t){throw e.release(),t}))}(this._lock,this._fetchAllQueuedResources.bind(this),e):Object(m.s)()}},{key:"_initErrorTemplates",value:function(){this._errorTemplates||(this._errorTemplates={fill:this._createMeshTemplates([],he(_e.c),!1),marker:this._createMeshTemplates([],he(_e.b),!1),line:this._createMeshTemplates([],he(_e.d),!1)})}},{key:"_fetchAllQueuedResources",value:function(e){var t=this;if(!this._fetchQueue.length)return Object(m.s)();var r=this._fetchQueue,i=this._cimAnalyses;return this._fetchQueue=[],this._cimAnalyses=[],Object(m.b)(i).then((function(){return t._fetchResource(r,e).then((function(e){var r,i=Object(n.a)(e);try{for(i.s();!(r=i.n()).done;){var a=r.value,s=a.id,o=a.mosaicItem;t._idToResolver.get(s)(o),t._idToResolver.delete(s)}}catch(c){i.e(c)}finally{i.f()}}))})).catch((function(e){Object(m.l)(e)?t._fetchQueue=t._fetchQueue.concat(r):function(e){return"worker:port-closed"===e.name}(e)||sr.error(new b.a("mapview-template-store","Unable to fetch requested texture resources",e))}))}},{key:"_createGroupId",value:function(e){return this._idCounter++<<1|(e?1:0)}},{key:"_createTemplateId",value:function(){return this._templateIdCounter++}},{key:"_createSMS",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var r,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return r=e.sent,n=r.spriteMosaicItem,e.abrupt("return",ge(n,sr)?tt.fromSimpleMarker(t,n):this._markerError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createPMS",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var r,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return r=e.sent,n=r.spriteMosaicItem,e.abrupt("return",ge(n,sr)?tt.fromPictureMarker(t,n):this._markerError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createSFS",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r){var n,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return n=e.sent,i=n.spriteMosaicItem,e.abrupt("return",ge(i,sr)?rr.fromSimpleFill(t,i,r):this._fillError);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createPFS",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r){var n,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return n=e.sent,i=n.spriteMosaicItem,e.abrupt("return",ge(i,sr)?rr.fromPictureFill(t,i,r):this._fillError);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createSLS",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r){var n,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return n=e.sent,i=n.spriteMosaicItem,e.abrupt("return",ge(i,sr)?ir.fromSimpleLine(t,i,this._joinOnUTurn):this._lineError);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createLMS",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var r,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return r=e.sent,n=r.spriteMosaicItem,e.abrupt("return",ge(n,sr)?tt.fromLineSymbolMarker(t,n):this._markerError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createTS",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var r,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return r=e.sent,n=r.glyphMosaicItems,e.abrupt("return",$e.fromText(t,n));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIMText",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var r,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t.cim,me(t.text));case 2:return r=e.sent,n=r.glyphMosaicItems,e.abrupt("return",(t.cim.mosaicHash=t.materialHash,ge(n,sr)?$e.fromCIMText(t,n):this._textError));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIMFill",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var r,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.cim.mosaicHash=t.materialHash,e.next=3,this.getMosaicItem(t.cim);case 3:return r=e.sent,n=r.spriteMosaicItem,e.abrupt("return",ge(n,sr)?rr.fromCIMFill(t,n):this._fillError);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIMLine",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var r,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.cim.mosaicHash=t.materialHash,e.next=3,this.getMosaicItem(t.cim);case 3:return r=e.sent,n=r.spriteMosaicItem,e.abrupt("return",ge(n,sr)?ir.fromCIMLine(t,n,this._joinOnUTurn):this._lineError);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIMMarker",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var r,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.cim.mosaicHash=t.materialHash,e.next=3,this.getMosaicItem(t.cim);case 3:return r=e.sent,n=r.spriteMosaicItem,e.abrupt("return",ge(n,sr)?tt.fromCIMMarker(t,n):this._markerError);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIM",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var r,n,i=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.templateHash,!this._cimTemplateCache.has(r)){e.next=3;break}return e.abrupt("return",this._cimTemplateCache.get(r));case 3:e.t0=t.type,e.next="marker"===e.t0?6:"line"===e.t0?8:"fill"===e.t0?10:"text"===e.t0?12:13;break;case 6:return n=this._createCIMMarker(t),e.abrupt("break",13);case 8:return n=this._createCIMLine(t),e.abrupt("break",13);case 10:return n=this._createCIMFill(t),e.abrupt("break",13);case 12:n=this._createCIMText(t);case 13:return e.abrupt("return",(n.then((function(e){return i._cimTemplateCache.set(r,e)})),n));case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createDynamicCIM",value:function(e){var t,r=e.templateHash;if(this._cimTemplateCache.has(r))return this._cimTemplateCache.get(r);switch(e.type){case"marker":t=er.fromCIMMarker(e);break;case"line":t=qt.fromCIMLine(e);break;case"fill":t=Et.fromCIMFill(e);break;case"text":t=tr.fromCIMText(e)}return this._cimTemplateCache.set(r,t),t}},{key:"_createPrimitiveMeshTemplates",value:function(e,t,r){switch(t.type){case"esriSMS":return cr(e,this._createSMS(t));case"esriPMS":return cr(e,this._createPMS(t));case"esriSFS":return cr(e,this._createSFS(t,r));case"line-marker":return cr(e,this._createLMS(t));case"esriPFS":return cr(e,this._createPFS(t,r));case"esriSLS":return cr(e,this._createSLS(t,!1));case"esriTS":return cr(e,this._createTS(t));default:return sr.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),e}}},{key:"_createMeshTemplates",value:function(e,t,r){if(-1!==t.type.indexOf("3d"))return sr.error("3D symbols are not supported with MapView"),e;if("expanded-cim"===t.type){var i,a=Object(n.a)(t.layers);try{for(a.s();!(i=a.n()).done;){var s=i.value;"function"==typeof s.materialHash?e.push(this._createDynamicCIM(s)):cr(e,this._createCIM(s))}}catch(h){a.e(h)}finally{a.f()}return e}if("composite-symbol"===t.type){var o,c=Object(n.a)(t.layers);try{for(c.s();!(o=c.n()).done;){var u=o.value;this._createPrimitiveMeshTemplates(e,u,r)}}catch(h){c.e(h)}finally{c.f()}return e}return"cim"===t.type||"label"===t.type||"web-style"===t.type?e:this._createPrimitiveMeshTemplates(e,t,r)}}]),e}(),lr=function(){function e(){Object(o.a)(this,e),this.vertexData=new Map,this.vertexCount=0,this.indexData=[]}return Object(c.a)(e,[{key:"clear",value:function(){this.vertexData.clear(),this.vertexCount=0,this.indexData=[]}},{key:"update",value:function(e,t,r){for(var n in e)this.vertexData.set(n,e[n]);for(var i in this.vertexData)null===e[i]&&this.vertexData.delete(i);this.vertexCount=t,this.indexData=r}}]),e}(),fr=function(){function e(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;Object(o.a)(this,e),this.id=t,this.geometryType=r,this.materialKey=n,this.minZoom=i,this.maxZoom=a,this.meshData=null,this.symbolLevel=0,this.zOrder=0,this.vertexFrom=0,this.vertexCount=0,this.indexFrom=0,this.indexCount=0}return Object(c.a)(e,[{key:"sortKey",get:function(){return void 0===this._sortKey&&this._computeSortKey(),this._sortKey}},{key:"clone",value:function(){return this.copy()}},{key:"copy",value:function(){var t=new e(this.id,this.geometryType,this.materialKey);return t.vertexFrom=this.vertexFrom,t.vertexCount=this.vertexCount,t.indexFrom=this.indexFrom,t.indexCount=this.indexCount,t.zOrder=this.zOrder,t.symbolLevel=this.symbolLevel,t.meshData=this.meshData,t.minZoom=this.minZoom,t.maxZoom=this.maxZoom,t}},{key:"setMeshDataFromBuffers",value:function(e,t,r){var n=new lr;for(var i in t){for(var a=t[i].stride,s=t[i].data,o=[],c=Object(se.h)(a),u=0;u<a*e.vertexCount/c;++u)o[u]=s[u+a*e.vertexFrom/c];n.vertexData.set(i,o)}n.indexData.length=0;for(var h=0;h<e.indexCount;++h)n.indexData[h]=r[h+e.indexFrom]-e.vertexFrom;n.vertexCount=e.vertexCount,this.meshData=n}},{key:"readMeshDataFromBuffers",value:function(e,t){for(var r in this.meshData?this.meshData.clear():this.meshData=new lr,e){for(var n=e[r].stride,i=e[r].data,a=[],s=Object(se.h)(n),o=0;o<n*this.vertexCount/s;++o)a[o]=i[o+n*this.vertexFrom/s];this.meshData.vertexData.set(r,a)}this.meshData.indexData.length=0;for(var c=0;c<this.indexCount;++c)this.meshData.indexData[c]=t[c+this.indexFrom]-this.vertexFrom;this.meshData.vertexCount=this.vertexCount}},{key:"writeMeshDataToBuffers",value:function(e,t,r,n){for(var i in t)for(var a=t[i].stride,s=this.meshData.vertexData.get(i),o=t[i].data,c=Object(se.h)(a),u=0;u<a*this.meshData.vertexCount/c;++u)o[u+a*e/c]=s[u];for(var h=0;h<this.meshData.indexData.length;++h)n[h+r]=this.meshData.indexData[h]+e;this.vertexFrom=e,this.vertexCount=this.meshData.vertexCount,this.indexFrom=r,this.indexCount=this.meshData.indexData.length}},{key:"_computeSortKey",value:function(){this._sortKey=(31&this.symbolLevel)<<12|(127&this.zOrder)<<4|7&this.geometryType}},{key:"serialize",value:function(e){return e.push(this.geometryType),e.push(this.materialKey),e.push(this.vertexFrom),e.push(this.vertexCount),e.push(this.indexFrom),e.push(this.indexCount),e.push(this.minZoom),e.push(this.maxZoom),e}}],[{key:"writeAllMeshDataToBuffers",value:function(e,t,r){var i,a=0,s=0,o=Object(n.a)(e);try{for(o.s();!(i=o.n()).done;){var c=i.value;c.writeMeshDataToBuffers(a,t,s,r),a+=c.vertexCount,s+=c.indexCount}}catch(u){o.e(u)}finally{o.f()}}},{key:"deserialize",value:function(t,r){var n=t.readInt32(),i=t.readInt32(),a=new e(r.id,n,i);return a.vertexFrom=t.readInt32(),a.vertexCount=t.readInt32(),a.indexFrom=t.readInt32(),a.indexCount=t.readInt32(),a.minZoom=t.readInt32(),a.maxZoom=t.readInt32(),a}}]),e}();function dr(e,t){if(null!==t){e.push(t.length);var r,i=Object(n.a)(t);try{for(i.s();!(r=i.n()).done;){r.value.serialize(e)}}catch(a){i.e(a)}finally{i.f()}return e}e.push(0)}function yr(e,t,r){for(var n=e.readInt32(),i=new Array(n),a=0;a<i.length;a++)i[a]=t.deserialize(e,r);return i}var vr=y.a.getLogger("esri/views/2d/engine/webgl/collisions/Metric"),pr=function(){function e(t,r,n,i,a){Object(o.a)(this,e),this.id=t,this.range=r,this.boxes=null,this.minZoom=-1,this.size=0,this.directionX=0,this.directionY=0,this.offsetX=0,this.offsetY=0,this.placementPadding=0,this.anchor=Object(Ve.b)(n,i),this.baseZoom=a}return Object(c.a)(e,[{key:"add",value:function(e,t,r){e.x=e.x+t,e.y=e.y+r,this.bounds?this.boxes?(this.boxes.push(e),this.bounds.extend(e)):(this.boxes=[this.bounds,e],this.bounds=this.bounds.clone(),this.bounds.extend(e)):this.bounds=e}},{key:"computeIndex",value:function(){var e=this.anchor[0],t=this.anchor[1],r=Math.floor(e/x.c),n=Math.floor(t/x.c);this.xBucket=r,this.yBucket=n;var i=x.p/x.c;if(this.hasVV)return this.xOverflow=i,void(this.yOverflow=i);this.xOverflow=Math.min(i,Math.ceil(2*this.bounds.width/x.c)),this.yOverflow=Math.min(i,Math.ceil(2*this.bounds.height/x.c))}},{key:"findCollisionDelta",value:function(e){var t=this.bounds.findCollisionDelta(e.bounds),r=this.boxes&&this.boxes.length,n=e.boxes&&e.boxes.length;return Math.abs(t)>x.e||!r&&!n?t:r&&n?this._boxesToBoxes(e):r?this._boxesToBox(e):this._boxToBoxes(e)}},{key:"computeVVOffset",value:function(e,t){t||vr.error("mapview-labeling","Unable to compute label offset. Expected an evaluator function but found ".concat(t));var r=this.size;if(this.hasVV){var n=t(e);r=isNaN(n)||null==n||n===1/0?this.size:n}this._computeOffset(r)}},{key:"setPlacementOffset",value:function(e,t,r,n,i){this.hasVV=e,this.size=t,this.placementPadding=Math.round(r),this.directionX=n,this.directionY=i}},{key:"clone",value:function(){var t=new e(this.id,this.range,this.anchor[0],this.anchor[1],this.baseZoom);return t.minZoom=this.minZoom,this.bounds&&(t.bounds=this.bounds.clone()),this.boxes&&(t.boxes=this.boxes.map((function(e){return e.clone()}))),t.xBucket=this.xBucket,t.yBucket=this.yBucket,t.xOverflow=this.xOverflow,t.yOverflow=this.yOverflow,t.hasVV=this.hasVV,t.size=this.size,t.directionX=this.directionX,t.directionY=this.directionY,t.offsetX=this.offsetX,t.offsetY=this.offsetY,t}},{key:"_boxToBoxes",value:function(e){var t,r=-1/0,i=Object(n.a)(e.boxes);try{for(i.s();!(t=i.n()).done;){var a=t.value,s=this.bounds.findCollisionDelta(a);r=Math.max(s,r)}}catch(o){i.e(o)}finally{i.f()}return r}},{key:"_boxesToBox",value:function(e){for(var t=this.boxes[0].findCollisionDelta(e.bounds),r=1;r<this.boxes.length;r++){var n=this.boxes[r].findCollisionDelta(e.bounds);t=Math.max(n,t)}return t}},{key:"_boxesToBoxes",value:function(e){for(var t=-1/0,r=0;r<this.boxes.length;r++){var i,a=this.boxes[r],s=Object(n.a)(e.boxes);try{for(s.s();!(i=s.n()).done;){var o=i.value,c=a.findCollisionDelta(o);t=Math.max(c,t)}}catch(u){s.e(u)}finally{s.f()}}return t}},{key:"_computeOffset",value:function(e){this.offsetX=this.directionX*(e/2+this.placementPadding),this.offsetY=this.directionY*(e/2+this.placementPadding)}},{key:"serialize",value:function(e){return e.push(this.id),this.bounds.serialize(e),e.push(this.range.from),e.push(this.range.count),e.push(this.anchor[0]),e.push(this.anchor[1]),e.push(this.baseZoom),e.push(this.hasVV?1:0),e.push(this.size),e.writeF32(this.directionX),e.writeF32(this.directionY),e.push(this.offsetX),e.push(this.offsetY),e.push(this.placementPadding),dr(e,this.boxes),e}}],[{key:"deserialize",value:function(t){var r=t.readInt32(),n=Ae.deserialize(t),i={from:t.readInt32(),count:t.readInt32()},a=t.readInt32(),s=t.readInt32(),o=t.readInt32(),c=t.readInt32(),u=t.readInt32(),h=t.readF32(),l=t.readF32(),f=t.readInt32(),d=t.readInt32(),y=t.readInt32(),v=yr(t,Ae),p=new e(r,i,a,s,o);return p.bounds=n,p.boxes=v,p.setPlacementOffset(!!c,u,y,h,l),p.offsetX=f,p.offsetY=d,p.computeIndex(),c||p._computeOffset(u),p}}]),e}(),br=function(){function e(t){Object(o.a)(this,e),this.insertAfter=null,this.id=t,this.displayRecords=[],this.metrics=[]}return Object(c.a)(e,[{key:"copy",value:function(){var t=new e(this.id);return t.set(this),t}},{key:"clone",value:function(){var t=new e(this.id);return t.displayRecords=this.displayRecords.map((function(e){return e.clone()})),t.metrics=this.metrics.map((function(e){return e.clone()})),t.insertAfter=this.insertAfter,t}},{key:"set",value:function(e){this.id=e.id,this.displayRecords=e.displayRecords,this.metrics=e.metrics,this.insertAfter=e.insertAfter}},{key:"serialize",value:function(e){return e.push(this.id),dr(e,this.metrics),dr(e,this.displayRecords),e}}],[{key:"deserialize",value:function(t){var r=t.readInt32(),n=new e(r),i={id:r},a=yr(t,pr);return a.length&&(n.metrics=a),n.displayRecords=yr(t,fr,i),n}}]),e}(),mr=function(){function e(t){Object(o.a)(this,e),this._pos=0,this._buffer=t,this._i32View=new Int32Array(this._buffer),this._f32View=new Float32Array(this._buffer)}return Object(c.a)(e,[{key:"readInt32",value:function(){return this._i32View[this._pos++]}},{key:"readF32",value:function(){return this._f32View[this._pos++]}}]),e}(),_r=function(){function e(t,r){Object(o.a)(this,e),this._pos=0;var n=r?this._roundToNearest(r,t.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(n),this._buffer=new t(this._array),this._ctor=t}return Object(c.a)(e,[{key:"length",get:function(){return this._pos}},{key:"_roundToNearest",value:function(e,t){var r=Math.round(e);return r+(t-r%t)}},{key:"_ensureSize",value:function(e){if(this._pos+e>=this._buffer.length){var t=this._roundToNearest(1.5*(this._array.byteLength+e*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),r=new ArrayBuffer(t),n=new this._ctor(r);n.set(this._buffer,0),this._array=r,this._buffer=n}}},{key:"writeF32",value:function(e){this._ensureSize(1);var t=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=e,this._pos++,t}},{key:"push",value:function(e){this._ensureSize(1);var t=this._pos;return this._buffer[this._pos++]=e,t}},{key:"writeFixed",value:function(e){this._buffer[this._pos++]=e}},{key:"setValue",value:function(e,t){this._buffer[e]=t}},{key:"getValue",value:function(e){return this._buffer[e]}},{key:"incr",value:function(e){this._buffer[e]++}},{key:"decr",value:function(e){this._buffer[e]--}},{key:"writeRegion",value:function(e){this._ensureSize(e.length);var t=this._pos;return this._buffer.set(e,this._pos),this._pos+=e.length,t}},{key:"buffer",value:function(){var e=this._array.slice(0,4*this._pos);return this.destroy(),e}},{key:"toArray",value:function(){for(var e=this._array,t=[],r=0;r<e.byteLength/4;r++)t.push(e[r]);return t}},{key:"seek",value:function(e){this._pos=e}},{key:"destroy",value:function(){this._array=null,this._buffer=null}}]),e}(),gr=function(){function e(t,r){Object(o.a)(this,e),this.vertexVectorsMap=t,this._currentIndex=-1,this._currentRecordOffset=0,this._currentMetricOffset=0,this._currentMetrics=[];var n=4*(4*r.features+1),i=4*(8*r.records+1),a=4*(20*r.metrics+1);this._bufDisplayObjects=new _r(Uint32Array,n+4),this._bufDisplayRecords=new _r(Uint32Array,i+4),this._bufMetrics=new _r(Uint32Array,a+4),this._bufDisplayObjects.push(0),this._bufDisplayRecords.push(0),this._bufMetrics.push(0)}return Object(c.a)(e,[{key:"vertexBuffersMap",get:function(){if(!this._vertexBuffersMap){this._vertexBuffersMap={};for(var e=0;e<this.vertexVectorsMap.length;e++)this._vertexBuffersMap[e]=this.vertexVectorsMap[e].intoBuffers();this.vertexVectorsMap=null}return this._vertexBuffersMap}},{key:"get",value:function(e){return this.vertexVectorsMap[e]}},{key:"currentDisplayRecordCount",value:function(){return this._bufDisplayRecords[this._currentRecordOffset]}},{key:"writeDisplayObject",value:function(e,t){this._bufDisplayObjects.incr(0),this._currentIndex=this._bufDisplayObjects.push(e),this._bufDisplayObjects.push(t),this._bufDisplayObjects.push(0),this._bufDisplayObjects.push(0),this._currentRecordOffset=0,this._currentMetricOffset=0,this._currentMetrics=[]}},{key:"hasDisplayRecords",value:function(){return!(0===this._currentRecordOffset)}},{key:"endDisplayObject",value:function(){this.hasDisplayRecords()?this._currentMetrics&&(0===this._currentMetricOffset&&(this._bufDisplayObjects.setValue(this._currentIndex+3,this._bufMetrics.length),this._currentMetricOffset=this._bufMetrics.length),dr(this._bufMetrics,this._currentMetrics)):this._rollbackDisplayObject()}},{key:"writeDisplayRecord",value:function(e,t,r,n,i,a){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;0===this._currentRecordOffset&&(this._currentRecordOffset=this._bufDisplayRecords.push(0),this._bufDisplayObjects.setValue(this._currentIndex+2,this._currentRecordOffset)),this._bufDisplayRecords.incr(this._currentRecordOffset),this._bufDisplayRecords.push(e),this._bufDisplayRecords.push(t),this._bufDisplayRecords.push(r),this._bufDisplayRecords.push(n),this._bufDisplayRecords.push(i),this._bufDisplayRecords.push(a),this._bufDisplayRecords.push(s),this._bufDisplayRecords.push(o)}},{key:"writeMetrics",value:function(e){var t;e&&(t=this._currentMetrics).push.apply(t,Object($.a)(e))}},{key:"encode",value:function(e,t){for(var r={},n=0;n<this.vertexVectorsMap.length;n++){var i=this.vertexVectorsMap[n];r[n]={},i.transfer(r[n],t)}e.bufDisplayObjects=this._bufDisplayObjects.buffer(),e.bufRecords=this._bufDisplayRecords.buffer(),e.bufMetrics=this._bufMetrics.buffer(),t.push(e.bufDisplayObjects),t.push(e.bufMetrics),t.push(e.bufRecords),e.vertexBuffersMap=r,this.destroy()}},{key:"destroy",value:function(){this.vertexVectorsMap=null,this._bufDisplayObjects=null,this._bufDisplayRecords=null,this._bufMetrics=null}},{key:"_rollbackDisplayObject",value:function(){this._bufDisplayObjects.decr(0),this._bufDisplayObjects.seek(this._bufDisplayObjects.length-4),this._currentIndex=this._bufDisplayObjects.length}}],[{key:"deserializeDisplayObjects",value:function(e){var t=e.bufDisplayObjects,r=e.bufMetrics,n=e.bufRecords,i=new mr(t),a=new mr(n),s=new mr(r),o=[],c=i.readInt32();for(a.readInt32(),s.readInt32();c--;){var u=i.readInt32(),h=i.readInt32(),l=i.readInt32(),f=i.readInt32(),d=new br(u);0!==h&&(d.insertAfter=h),0!==l&&(d.displayRecords=yr(a,fr,{id:u})),0!==f&&(d.metrics=yr(s,pr)),o.push(d)}return o}}]),e}(),xr=function(){function e(t,r,n){Object(o.a)(this,e),this.data=t,this.stride=r,this.vertexCount=n}return Object(c.a)(e,null,[{key:"decode",value:function(t){return new e(Object(se.a)(t.data,t.stride),t.stride,t.vertexCount)}},{key:"fromVertexVector",value:function(t){return new e(Object(se.a)(t.data.buffer(),t.stride),t.stride,t.vertexCount)}}]),e}(),Or=function(){function e(t,r,n){Object(o.a)(this,e),this.geometryType=t,this.indexBuffer=new Uint32Array(r),this.namedBuffers=n}return Object(c.a)(e,null,[{key:"decode",value:function(t){var r=t.geometryType,n=t.indexBuffer,i={};for(var a in t.namedBuffers)i[a]=xr.decode(t.namedBuffers[a]);return new e(r,n,i)}},{key:"fromVertexVectors",value:function(t){var r=t.geometryType,n=t.indexVector.buffer(),i={};for(var a in t.namedVectors)i[a]=xr.fromVertexVector(t.namedVectors[a]);return new e(r,n,i)}}]),e}(),jr=function(){function e(t,r){Object(o.a)(this,e),this.data=t,this.stride=r}return Object(c.a)(e,[{key:"vertexCount",get:function(){var e=this.stride/4,t=this.data.length/e;return t!==(0|t)&&console.debug("Corrupted stride"),t}},{key:"transfer",value:function(e,t){var r=this.data.buffer();e.vertexCount=this.vertexCount,e.data=r,e.stride=this.stride,t.push(r)}}]),e}(),kr=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Object(o.a)(this,e),this.geometryType=t,this.indexVector=new _r(Uint32Array,6*r),this.namedVectors={};var i=Object(se.e)(t,n);for(var a in i){var s=i[a],c=void 0;switch(s%4){case 0:case 2:c=new _r(Uint32Array,s*r);break;case 1:case 3:c=new _r(Uint8Array,s*r)}this.namedVectors[a]=new jr(c,s)}}return Object(c.a)(e,[{key:"get",value:function(e){return this.namedVectors[e].data}},{key:"getVector",value:function(e){return this.namedVectors[e]}},{key:"transfer",value:function(e,t){var r=this.indexVector.buffer(),n={};for(var i in t.push(r),this.namedVectors){var a=this.namedVectors[i];n[i]={},a.transfer(n[i],t)}e.geometryType=this.geometryType,e.indexBuffer=r,e.namedBuffers=n,this.destroy()}},{key:"intoBuffers",value:function(){var e=Or.fromVertexVectors(this);return this.destroy(),e}},{key:"destroy",value:function(){this.indexVector=null,this.namedVectors=null}}]),e}();function Mr(e,t){return e[t+1]}function wr(e){return e.length-1}function Sr(e){for(var t=0,r=0;r<wr(e);r++)t+=Tr(e,r);return t}function Tr(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=Mr(e,t),i=Object(ke.a)(n,2),a=i[0],s=i[1];return Math.sqrt(a*a+s*s)*r}var Lr=function(){function e(t,r,n,i,a){Object(o.a)(this,e),this._segments=t,this._index=r,this._distance=n,this._xStart=i,this._yStart=a,this._done=!1}return Object(c.a)(e,[{key:"clone",value:function(){return new e(this._segments,this._index,this._distance,this.xStart,this.yStart)}},{key:"equals",value:function(e){return this._index===e._index||e._index===this._index-1&&(0===this._distance||1===e._distance)||e._index===this._index+1&&(1===this._distance||0===e._distance)}},{key:"leq",value:function(e){return this._index<e._index||this._index===e._index&&this._distance<=e._distance}},{key:"geq",value:function(e){return this._index>e._index||this._index===e._index&&this._distance>=e._distance}},{key:"_segment",get:function(){return this._segments[this._index+1]}},{key:"angle",get:function(){var e=this.dy,t=(0*e+-1*-this.dx)/(1*this.length),r=Math.acos(t);return e>0&&(r=2*Math.PI-r),r}},{key:"xStart",get:function(){return this._xStart}},{key:"yStart",get:function(){return this._yStart}},{key:"x",get:function(){return this.xStart+this.distance*this.dx}},{key:"y",get:function(){return this.yStart+this.distance*this.dy}},{key:"dx",get:function(){return this._segment[0]}},{key:"dy",get:function(){return this._segment[1]}},{key:"xMidpoint",get:function(){return this.xStart+.5*this.dx}},{key:"yMidpoint",get:function(){return this.yStart+.5*this.dy}},{key:"xEnd",get:function(){return this.xStart+this.dx}},{key:"yEnd",get:function(){return this.yStart+this.dy}},{key:"length",get:function(){var e=this.dx,t=this.dy;return Math.sqrt(e*e+t*t)}},{key:"remainingLength",get:function(){return this.length*(1-this._distance)}},{key:"backwardLength",get:function(){return this.length*this._distance}},{key:"distance",get:function(){return this._distance}},{key:"done",get:function(){return this._done}},{key:"hasPrev",value:function(){return this._index-1>=0}},{key:"hasNext",value:function(){return this._index+1<wr(this._segments)}},{key:"next",value:function(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}},{key:"prev",value:function(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}},{key:"_seekBackwards",value:function(e,t){var r=this.backwardLength;if(e<=r)return this._distance=(r-e)/this.length,this;for(var n=this.backwardLength;this.prev();){if(n+this.length>e)return this._seekBackwards(e-n);n+=this.length}return this._distance=0,t?this:null}},{key:"seek",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e<0)return this._seekBackwards(Math.abs(e),t);if(e<=this.remainingLength)return this._distance=(this.backwardLength+e)/this.length,this;for(var r=this.remainingLength;this.next();){if(r+this.length>e)return this.seek(e-r,t);r+=this.length}return this._distance=1,t?this:null}}],[{key:"create",value:function(t){return new e(t,0,0,t[0][0],t[0][1])}}]),e}();function Cr(e,t,r){var n=Sr(e),i=Lr.create(e),a=n/2,s=(n-t)/2,o=Math.floor(s/t),c=a-o*t;i.seek(c);for(var u=-o;u<=o;u++)i.x<512&&i.x>=0&&i.y<512&&i.y>=0&&r(i.clone(),u,a+u*t,n),i.seek(t)}function zr(e,t){var r=1e-6;if(!(t<=0)){var n=e.length;if(!(n<3)){var i=[],a=0;i.push(0);for(var s=1;s<n;s++)a+=Object(it.a)(e[s],e[s-1]),i.push(a);t=Math.min(t,.2*a);var o=[];o.push(e[0][0]),o.push(e[0][1]);var c=e[n-1][0],u=e[n-1][1],h=Object(it.e)([0,0],e[0],e[1]);Object(it.d)(h),e[0][0]+=t*h[0],e[0][1]+=t*h[1],Object(it.e)(h,e[n-1],e[n-2]),Object(it.d)(h),e[n-1][0]+=t*h[0],e[n-1][1]+=t*h[1];for(var l=1;l<n;l++)i[l]+=t;i[n-1]+=t;for(var f=.5*t,d=1;d<n-1;d++){for(var y=0,v=0,p=0,b=d-1;b>=0&&!(i[b+1]<i[d]-f);b--){var m=f+i[b+1]-i[d],_=i[b+1]-i[b],g=i[d]-i[b]<f?1:m/_;if(Math.abs(g)<r)break;var x=g*g,O=g*m-.5*x*_,j=g*_/t,k=e[b+1],M=e[b][0]-k[0],w=e[b][1]-k[1];y+=j/O*(k[0]*g*m+.5*x*(m*M-_*k[0])-x*g*_*M/3),v+=j/O*(k[1]*g*m+.5*x*(m*w-_*k[1])-x*g*_*w/3),p+=j}for(var S=d+1;S<n&&!(i[S-1]>i[d]+f);S++){var T=f-i[S-1]+i[d],L=i[S]-i[S-1],C=i[S]-i[d]<f?1:T/L;if(Math.abs(C)<r)break;var z=C*C,I=C*T-.5*z*L,R=C*L/t,V=e[S-1],P=e[S][0]-V[0],D=e[S][1]-V[1];y+=R/I*(V[0]*C*T+.5*z*(T*P-L*V[0])-z*C*L*P/3),v+=R/I*(V[1]*C*T+.5*z*(T*D-L*V[1])-z*C*L*D/3),p+=R}o.push(y/p),o.push(v/p)}o.push(c),o.push(u);for(var A=0,F=0;A<n;A++)e[A][0]=o[F++],e[A][1]=o[F++]}}}var Ir=y.a.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate"),Rr=function(e){var t=new Map;return function(e){return t.has(e)||t.set(e,function(e){var t=0;if(0===e)return 1/0;for(;!(e%2);)t++,e/=2;return t}(e)),t.get(e)}}(),Vr=function(e){return Math.floor(127*e+127)},Pr=function(e){return Math.floor(10*e)},Dr=function(e){return Math.round(e*(254/360))},Ar=function(e,t){return Object(Ce.a)(Math.round(8*e),Math.round(8*t))},Fr=function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(e,n,i,a){var s;Object(o.a)(this,r),(s=t.call(this,e,i.font.size,i.haloSize||0,i.color&&Object(Te.d)(i.color)||0,i.haloColor&&Object(Te.d)(i.haloColor)||0,i.horizontalAlignment,i.verticalAlignment,P(n.labelPlacement)?1:0,i.font.decoration,!1,i.angle||0,i.xoffset,i.yoffset,i.lineWidth,i.lineHeight,null,null))._outLineLabelAngle=0,s._refPlacementPadding=0,s._refPlacementDirX=0,s._refPlacementDirY=0,s._refOffsetX=0,s._refOffsetY=0,s.geometryType=V.b.LABEL;var c=function(e,t){var r=!!e.minScale&&t.scaleToZoom(e.minScale)||0;return Object(De.d)(r,0,25.5)}(n,a),u=function(e,t){var r=!!e.maxScale&&t.scaleToZoom(e.maxScale)||255;return Object(De.d)(r,0,25.5)}(n,a),h=function(e){switch(e){case"above-left":return[xe.Right,Oe.Bottom];case"above-center":case"above-along":return[xe.Center,Oe.Bottom];case"above-right":return[xe.Left,Oe.Bottom];case"center-left":return[xe.Right,Oe.Center];case"center-center":case"center-along":return[xe.Center,Oe.Center];case"center-right":return[xe.Left,Oe.Center];case"below-left":return[xe.Right,Oe.Top];case"below-center":case"below-along":return[xe.Center,Oe.Top];case"below-right":return[xe.Left,Oe.Top];case"always-horizontal":return[xe.Center,Oe.Baseline];default:return console.debug("Found invalid placement type ".concat(e)),[xe.Center,Oe.Center]}}(n.labelPlacement),l=Object(ke.a)(h,2),f=l[0],d=l[1];s._xAlignD=f,s._yAlignD=d,s._minZoom=c,s._maxZoom=u,s._refPlacementPadding=Object(te.g)(i.haloSize)+x.n;var y=W.load(e);return y.sdf=!0,s._materialKey=y.data,s}return Object(c.a)(r,[{key:"_shapedBox",get:function(){return Object(d.n)(this._shapingInfo).bounds}},{key:"bindReferenceTemplate",value:function(e){var t=function(e){switch(e){case xe.Right:return-1;case xe.Center:return 0;case xe.Left:return 1;default:return console.debug("Found invalid horizontal alignment ".concat(e)),0}}(this._xAlignD),r=function(e){switch(e){case Oe.Top:return 1;case Oe.Center:return 0;case Oe.Bottom:case Oe.Baseline:return-1;default:return console.debug("Found invalid vertical alignment ".concat(e)),0}}(this._yAlignD);if(this._refOffsetX=0,this._refOffsetY=0,Object(d.g)(e))this._refSymbolAndPlacementOffset=Object(Ce.b)(0,0,Vr(t),Vr(r));else{if("circle"===e.boundsType&&(t||r)){var n=Math.sqrt(t*t+r*r);t/=n,r/=n}var i=Math.max(e.height,e.width),a=4*this._refPlacementPadding;this._refSymbolAndPlacementOffset=Object(Ce.b)(a,i,Vr(t),Vr(r)),this._referenceSize=i,this._refPlacementDirX=t,this._refPlacementDirY=r,this._refOffsetX=e.xOffset,this._refOffsetY=e.yOffset}}},{key:"writeMesh",value:function(e,t,r,n,i,a){if(!Object(d.g)(this._shapingInfo)){var s=new Array,o=this._shapingInfo,c="esriGeometryPolygon"===r.geometryType?r.readLegacyCentroid():r.readLegacyGeometry();if(c){switch(this.current={out:e,outVecs:t,outMetrics:s,inId:i,inShaping:o,zoomLevel:a},n){case"esriGeometryPolyline":this._placeLineLabels(c);break;case"esriGeometryPoint":case"esriGeometryPolygon":this._placePointLabels(c);break;default:!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"mapview-labeling";Ir.error(new b.a(t,e))}("mapview-labeling","Geometry of type ".concat(n," is not supported"))}e.writeMetrics(this.current.outMetrics)}}}},{key:"_isVisible",value:function(e,t){var r=Pr(this.current.zoomLevel);return Pr(e)<=r&&r<=Pr(t)}},{key:"_placePointLabels",value:function(e){var t=this.current,r=t.out,n=t.outVecs,i=t.outMetrics,a=t.inId;this._writeGlyphs(r,n,a,e,i)}},{key:"_placeLineLabels",value:function(e){var t,r=function(e,t){for(var r=t,n=0;n<e.length;n++){var i=e[n],a=[];a.push(i[0]);for(var s=1;s<i.length;s++){var o=Object(ke.a)(a[s-1],2),c=o[0],u=o[1];c+=i[s][0],u+=i[s][1],a.push([c,u])}zr(a,r);var h=[];h.push(a[0]);for(var l=1;l<a.length;l++){var f=Object(ke.a)(a[l-1],2),d=f[0],y=f[1],v=Object(ke.a)(a[l],2),p=v[0],b=v[1],m=Math.round(p-d),_=Math.round(b-y);h.push([m,_])}e[n]=h,i=h}return e}(e.paths,this.current.inShaping.bounds.width),i=this._placeSubdivGlyphs.bind(this),a=(this._shapedBox.width+128)/4,s=Object(n.a)(r);try{for(s.s();!(t=s.n()).done;){Cr(t.value,a,i)}}catch(o){s.e(o)}finally{s.f()}}},{key:"_placeSubdivGlyphs",value:function(e,t,r,n){var i=Rr(t),a=this._shapedBox.width/4,s=Math.min(r,n-r),o=Object(De.m)(s/(4+a/2)),c=0===t?o:Math.min(i,o),u=Math.max(this._minZoom,this.current.zoomLevel+2-c),h=this.current.zoomLevel-u,l=this._shapedBox.width/2*Math.pow(2,h);this.current.inShaping.isMultiline?0===t&&this._placeStraight(e,u):this._placeCurved(e,u,l)}},{key:"_placeStraight",value:function(e,t){var r=this.current,n=r.out,i=r.outVecs,a=r.outMetrics,s=r.inId;this._writeGlyphs(n,i,s,e,a,t)}},{key:"_placeCurved",value:function(e,t,r){var n={from:this.current.out.currentDisplayRecordCount(),count:-1},i=new pr(this.current.inId,n,e.x,e.y,t),a=e.clone(),s=e.angle*(180/Math.PI)%360,o=(e.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=Dr(s),this._placeFirst(a,i,t,1),this._placeBack(e,a,i,t,r,1),this._placeForward(e,a,i,t,r,1),this._outLineLabelAngle=Dr(o),this._placeFirst(a,i,t,0),this._placeBack(e,a,i,t,r,0),this._placeForward(e,a,i,t,r,0),i.range.count=this.current.out.currentDisplayRecordCount()-i.range.from,i.bounds&&this.current.outMetrics.push(i)}},{key:"_placeBack",value:function(e,t,r,n,i,a){for(var s=e.clone(),o=e.backwardLength+0;s.prev()&&!(o>=i);)this._placeOnSegment(s,t,r,o,n,-1,a),o+=s.length+0}},{key:"_placeForward",value:function(e,t,r,n,i,a){for(var s=e.clone(),o=e.remainingLength+0;s.next()&&!(o>=i);)this._placeOnSegment(s,t,r,o,n,1,a),o+=s.length+0}},{key:"_placeFirst",value:function(e,t,r,i){var a,s=e,o=this.current.inShaping,c=o.glyphs,u=this.current.zoomLevel,h=this.current,l=h.out,f=h.outVecs,d=h.inId,y=Ar(s.x,s.y),v=Object(n.a)(c);try{for(v.s();!(a=v.n()).done;){var p=a.value,b=p.x>o.bounds.x?i:1-i,m=b*e.remainingLength+(1-b)*e.backwardLength,_=Math.abs(p.x+p.width/2-o.bounds.x),g=Math.max(0,u+Object(De.m)(_/(m+0))),x=Math.max(r,g);p.maxZoom=25,p.angle=e.angle+(1-i)*Math.PI,p.minZoom=x,this._writeGlyph(l,f,p,d,y),i&&this._isVisible(p.minZoom,p.maxZoom)&&t.add(p.bounds,0,0)}}catch(O){v.e(O)}finally{v.f()}}},{key:"_placeOnSegment",value:function(e,t,r,i,a,s,o){var c,u=this.current.inShaping.glyphs,h=this.current,l=h.out,f=h.outVecs,d=h.inId,y=this.current.inShaping,v=this.current.zoomLevel,p=e.dx/e.length,b=e.dy/e.length,m={x:e.x+i*-s*p,y:e.y+i*-s*b},_=Ar(m.x,m.y),g=Object(n.a)(u);try{for(g.s();!(c=g.n()).done;){var x=c.value,O=x.x>y.bounds.x?o:1-o;if(O&&1===s||!O&&-1===s){var j=Math.abs(x.x+x.width/2-y.bounds.x),k=Math.max(0,v+Object(De.m)(j/i)-.1),M=Math.max(a,v+Object(De.m)(j/(i+e.length+0)));0!==k&&(x.angle=e.angle+(1-o)*Math.PI,x.minZoom=M,x.maxZoom=k,this._writeGlyph(l,f,x,d,_),o&&this._isVisible(x.minZoom,x.maxZoom)&&r.add(x.bounds,e.x-t.x,e.y-t.y))}}}catch(w){g.e(w)}finally{g.f()}}},{key:"_writeGlyphs",value:function(e,t,r,i,a){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this._minZoom,o=this._shapingInfo;if(!Object(d.g)(o)&&!(i.x<0||i.x>=512||i.y<0||i.y>=512)){var c,u=e.currentDisplayRecordCount(),h=Ar(i.x+this._refOffsetX,i.y-this._refOffsetY),l=new pr(r,{from:u,count:-1},i.x+this._refOffsetX,i.y-this._refOffsetY,s),f=Object(n.a)(o.glyphs);try{for(f.s();!(c=f.n()).done;){var y=c.value;y.minZoom=s,y.maxZoom=this._maxZoom,this._writeGlyph(e,t,y,r,h)}}catch(_){f.e(_)}finally{f.f()}l.range.count=e.currentDisplayRecordCount()-l.range.from,l.bounds=o.boundsT;var v=W.load(this._materialKey),p=this._refPlacementDirX,b=this._refPlacementDirY,m=v.vvSizeFieldStops||v.vvSizeMinMaxValue||v.vvSizeScaleStops||v.vvSizeUnitValue;l.setPlacementOffset(m,this._referenceSize,this._refPlacementPadding,p,b),a.push(l)}}},{key:"_writeGlyph",value:function(e,t,r,n,i){var a=F.load(this._materialKey);a.textureBinding=r.textureBinding;var s=t.indexVector.length,o=t.getVector("geometry").vertexCount,c=this._writeIndices(t),u=this._writeVertex(t,n,i,r);e.writeDisplayRecord(this.geometryType,a.data,o,u,s,c)}},{key:"_writeVertexCommon",value:function(e,t,r,n){var i=this._color,a=this._haloColor,s=Object(Ce.b)(0,0,this._size,this._haloSize),o=Math.max(n.minZoom,this._minZoom),c=Math.min(n.maxZoom,this._maxZoom),u=Object(Ce.b)(Pr(o),Pr(c),this._outLineLabelAngle,0);e.push(r),e.push(t),e.push(i),e.push(a),e.push(s),e.push(this._refSymbolAndPlacementOffset),e.push(u)}}],[{key:"fromLabelClass",value:function(e,t){if("center-along"===e.labelPlacement){var n=e.symbol;n.xoffset=0,n.yoffset=0,n.angle=0,n.font.decoration="none"}return new r(e.materialKey,e,e.symbol,t)}}]),r}($e),Br=function(){function e(t,r,n){Object(o.a)(this,e),this._isDD=!1,this._geometryType=t,this._idField=r,this._templateStore=n}return Object(c.a)(e,[{key:"update",value:function(e,t){this._isDD="simple"===e.mesh.matcher.type&&e.mesh.matcher.isDotDensity,Object(d.h)(e.mesh.labels)&&this._setLabelTemplates(e.mesh.labels,t)}},{key:"_setLabelTemplates",value:function(e,t){this._labelTemplates=e.map((function(e){return Fr.fromLabelClass(e,t)}))}},{key:"templates",get:function(){return this._templateStore}},{key:"createMeshData",value:function(e){var t=new Array(5),r=this._labelTemplates&&this._labelTemplates.length>0,n="esriGeometryPolyline"===this._geometryType?x.g:x.f;return t[V.b.MARKER]=new kr(V.b.MARKER,4*e),t[V.b.FILL]=new kr(V.b.FILL,e,this._isDD),t[V.b.LINE]=new kr(V.b.LINE,e),t[V.b.TEXT]=new kr(V.b.TEXT,4*e),t[V.b.LABEL]=new kr(V.b.LABEL,r?4*n:0),new gr(t,{features:e,records:e,metrics:0})}},{key:"analyze",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r,i,s,o){var c,u,h,l,f,d,y;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(m.m)(o)){e.next=2;break}return e.abrupt("return");case 2:if(e.t0="dictionary"===r.type,!e.t0){e.next=7;break}return e.next=6,r.analyze(this._idField,t.copy(),i,s,o);case 6:c=e.sent;case 7:for(u=0;t.next();)if(void 0,h=c?c[u++]:r.match(this._idField,t,this._geometryType,i,s),t.setGroupId(h),ur(h)){l=this._templateStore.getDynamicTemplateGroup(h),f=Object(n.a)(l);try{for(f.s();!(d=f.n()).done;)(y=d.value)&&y.analyze&&y.analyze(this._templateStore,t,i,s)}catch(a){f.e(a)}finally{f.f()}}return e.abrupt("return",this._templateStore.finalize(o));case 10:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}()},{key:"analyzeGraphics",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r,i,s,o){var c,u,h,l,f,d;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(m.m)(o)){e.next=2;break}return e.abrupt("return");case 2:if(c=t.getCursor(),e.t0=r,!e.t0){e.next=7;break}return e.next=7,r.analyze(this._idField,c.copy(),i,s,o);case 7:if(!c.next()){e.next=13;break}if(null!=(u=c.getGroupId())&&-1!==u||(u=r.match(this._idField,c,c.geometryType,i,s),c.setGroupId(u)),ur(u)){h=this._templateStore.getDynamicTemplateGroup(u),l=Object(n.a)(h);try{for(l.s();!(f=l.n()).done;)(d=f.value)&&d.analyze&&d.analyze(this._templateStore,c,i,s)}catch(a){l.e(a)}finally{l.f()}}c.setGroupId(u);case 11:e.next=7;break;case 13:return e.abrupt("return",this._templateStore.finalize(o));case 14:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}()},{key:"writeGraphic",value:function(e,t){var r=t.getGroupId(),i=t.getDisplayId(),a=this._templateStore.getTemplateGroup(r),s=t.geometryType;if(null!=i){if(ur(r)){var o,c=Object(n.a)(a);try{for(c.s();!(o=c.n()).done;){o.value.bindFeature(t,null,null)}}catch(d){c.e(d)}finally{c.f()}}if(a){e.writeDisplayObject(i,t.readGraphic().insertAfter);var u,h=Object(n.a)(a);try{for(h.s();!(u=h.n()).done;){var l=u.value;if(l){var f=e.get(l.geometryType);l.writeMesh(e,f,t,s,i)}}}catch(d){h.e(d)}finally{h.f()}}}}},{key:"writeCursor",value:function(e,t,r,i,a,s){var o=t.getGroupId(),c=t.getDisplayId(),u=this._templateStore.getTemplateGroup(o);if(null!=c&&u){if(e.writeDisplayObject(c,0),ur(o)){var h,l=Object(n.a)(u);try{for(l.s();!(h=l.n()).done;){h.value.bindFeature(t,r,i)}}catch(_){l.e(_)}finally{l.f()}}var f,y=Object(n.a)(u);try{for(y.s();!(f=y.n()).done;){var v=f.value,p=e.get(v.geometryType);!v.needsPixelBuffer&&t.hasFilter()||v.writeMesh(e,p,t,this._geometryType,c)}}catch(_){y.e(_)}finally{y.f()}var b=e.hasDisplayRecords();if(Object(d.h)(s)&&b){var m=s&&this._findLabelRef(u);this._writeLabels(e,t,c,s,m,a)}e.endDisplayObject()}}},{key:"_findLabelRef",value:function(e){var t,r=Object(n.a)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i instanceof tt)return i}}catch(a){r.e(a)}finally{r.f()}return null}},{key:"_writeLabels",value:function(e,t,r,i,a,s){var o,c=Object(n.a)(i);try{for(c.s();!(o=c.n()).done;){var u=o.value;if(Object(d.h)(u)&&u){var h=u.glyphs,l=u.rtl,f=u.index,y=this._labelTemplates[f],v=e.get(y.geometryType);y.bindReferenceTemplate(a),y.bindTextInfo(h,l),y.writeMesh(e,v,t,this._geometryType,r,s)}}}catch(p){c.e(p)}finally{c.f()}}}]),e}(),Er=r(1149),Gr=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;Object(o.a)(this,e),this._bucketSize=t,this._rowsLength=x.p/t,this._colsLength=x.p/t,this._elementsPerBucket=r,this._grid=this._initGrid()}return Object(c.a)(e,[{key:"checkOverlap",value:function(e,t){var r=Math.floor(e/this._bucketSize),n=Math.floor(t/this._bucketSize);return r<0||r>=this._rowsLength||n<0||n>=this._colsLength||this._grid[n*this._colsLength+r]>=this._elementsPerBucket}},{key:"markUsed",value:function(e,t){var r=Math.floor(e/this._bucketSize),n=Math.floor(t/this._bucketSize);this._grid[n*this._colsLength+r]+=1}},{key:"reset",value:function(){this._grid=this._initGrid()}},{key:"_initGrid",value:function(){return new Uint8Array(this._rowsLength*this._colsLength)}}]),e}(),Kr=r(1109);y.a.getLogger("esri.views.2d.layers.features.processors.SymbolProcessor");var Ur=function(e){Object(u.a)(r,e);var t=Object(h.a)(r);function r(){var e;return Object(o.a)(this,r),(e=t.apply(this,arguments)).type="symbol",e}return Object(c.a)(r,[{key:"destroy",value:function(){}},{key:"supportsTileUpdates",get:function(){return!0}},{key:"update",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r){var n,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("symbol"===(n=r.schema.processors[0]).type){e.next=3;break}return e.abrupt("return");case 3:i=Object(g.a)(this._schema,n),Object(g.b)(i,"mesh")&&(Object(f.a)("esri-2d-update-debug")&&console.debug("Applying Update - Processor:",i),t.mesh=!0,t.why.mesh.push("Symbology changed"),this._schema=n,this._factory=this._createFactory(n),this._factory.update(n,this.tileStore.tileScheme.tileInfo));case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"onTileData",value:function(e,t,r){return Object(m.u)(r),this._onTileData(e,t,r)}},{key:"onTileError",value:function(e,t,r){var n=r.signal,i={tileKey:e.id,error:t};return this.remoteClient.invoke("tileRenderer.onTileError",i,{signal:n})}},{key:"_createFactory",value:function(e){var t=this,r=this.service,n=r.geometryType,i=r.objectIdField,a={geometryType:n,fields:r.fields,spatialReference:_.a.fromJSON(this.spatialReference)},s=new hr((function(e,r){return t.remoteClient.invoke("tileRenderer.getMaterialItems",e,r)}),!1);return this._store=s,this._matcher=function(e,t,r){return be.apply(this,arguments)}(e.mesh.matcher,s,a),new Br(n,i,s)}},{key:"_onTileData",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r,n){var i,s,o,c,u,h,l,f,y,v,p,b;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.type,s=r.addOrUpdate,o=r.remove,c=r.end,s){e.next=4;break}return u={type:i,addOrUpdate:null,remove:o,clear:!1,end:c},e.abrupt("return",this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:t.id,data:u},n));case 4:return h=this._processFeatures(t,s,n),l=n.signal,e.prev=5,e.next=8,h;case 8:return f=e.sent,y=Object(d.a)(f,(function(e){return e.message})),v=Object(d.a)(f,(function(e){return e.transferList}))||[],p={type:i,addOrUpdate:y,remove:o,clear:!1,end:c},b={transferList:Object(d.n)(v)||[],signal:l},e.abrupt("return",(Object(m.u)(b),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:t.id,data:p},b)));case 16:e.prev=16,e.t0=e.catch(5),this._handleError(t,e.t0,n);case 19:case"end":return e.stop()}}),e,this,[[5,16]])})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_processFeatures",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r,n){var i,s,o,c,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(d.g)(r)&&r.hasFeatures){e.next=2;break}return e.abrupt("return",null);case 2:return i={transform:t.transform,hasZ:!1,hasM:!1},s=this._factory,o={viewingMode:"",scale:t.scale},e.next=7,this._matcher;case 7:return c=e.sent,Object(m.u)(n),u=this._getLabelInfos(t,r),e.next=12,s.analyze(r.getCursor(),c,i,o);case 12:return Object(m.u)(n),e.abrupt("return",this._writeFeatureSet(t,r,i,u,s));case 14:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_writeFeatureSet",value:function(e,t,r,n,i){for(var a=i.createMeshData(t.getApproximateSize()),s={viewingMode:"",scale:e.scale},o=t.getCursor();o.next();)try{var c=o.getDisplayId(),u=Object(d.h)(n)?n.get(c):null;i.writeCursor(a,o,r,s,e.level,u)}catch(e){}return this._encodeDisplayData(a)}},{key:"_encodeDisplayData",value:function(e){var t={},r=new Array;return e.encode(t,r),{message:t,transferList:r}}},{key:"_handleError",value:function(e,t,r){if(!Object(m.l)(t)){var n={tileKey:e.id,error:t.message};return this.remoteClient.invoke("tileRenderer.onTileError",n,{signal:r.signal})}}},{key:"_shouldDiscard",value:function(e,t){switch(this.service.geometryType){case"esriGeometryPoint":var r=t.readLegacyPointGeometry();return!r||e.checkOverlap(r.x,r.y);case"esriGeometryPolygon":var n=t.readLegacyCentroid();return!n||e.checkOverlap(n.x,n.y);default:return!1}}},{key:"_markUsed",value:function(e,t){switch(this.service.geometryType){case"esriGeometryPoint":var r=t.readLegacyPointGeometry(),n=r.x,i=r.y;return e.markUsed(n,i);case"esriGeometryPolygon":var a=t.readLegacyCentroid(),s=a.x,o=a.y;return e.markUsed(s,o)}}},{key:"_getLabelInfos",value:function(e,t){var r=this,i=this._schema.mesh.labels,a=Object(d.a)(i,(function(t){return t.filter((function(t){return function(e,t){return(!e.minScale||e.minScale>=t)&&(!e.maxScale||e.maxScale<=t)}(t,e.scale)}))}));if(Object(d.g)(a)||0===a.length)return null;for(var s=new Map,o=new Gr(x.d),c=t.getCursor(),u=function(){var e=c.getDisplayId();if(r._shouldDiscard(o,c))return s.has(e)||s.set(e,null),"continue";var t,i=!1,u=[],h=Object(Er.b)(e),l=h&&1!==c.readAttribute("cluster_count")?"aggregate":"feature",f=Object(n.a)(a);try{var d=function(){var n=t.value;if(n.target!==l)return"continue";var a=c.getStorage(),s=h&&"feature"===l?a.getComputedStringAtIndex(c.readAttribute("referenceId"),n.fieldIndex):a.getComputedStringAtIndex(e,n.fieldIndex);if(!s)return"continue";var o=j(s.toString()),f=o[0],d=o[1];r._store.getMosaicItem(n.symbol,me(f)).then((function(e){u[n.index]={glyphs:e.glyphMosaicItems,rtl:d,index:n.index}})),i=!0};for(f.s();!(t=f.n()).done;)d()}catch(y){f.e(y)}finally{f.f()}s.set(e,u),i&&r._markUsed(o,c)};c.next();)u();return s}}]),r}(Kr.a),Zr=Ur=Object(l.a)([Object(p.a)("esri.views.2d.layers.features.processors.SymbolProcessor")],Ur);t.default=Zr}}]);
//# sourceMappingURL=38.bcb7097a.chunk.js.map