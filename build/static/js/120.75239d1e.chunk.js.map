{"version":3,"sources":["../node_modules/@arcgis/core/symbols/cim/TextRasterizer.js","../node_modules/@arcgis/core/symbols/cim/Rasterizer.js","../node_modules/@arcgis/core/symbols/cim/CIMSymbolRasterizer.js","../node_modules/@arcgis/core/symbols/support/previewCIMSymbol.js"],"names":["this","_rasterizationCanvas","e","s","o","document","createElement","type","t","rasterizeSimpleFill","style","r","size","image","Uint32Array","buffer","sdf","simplePattern","anchorX","anchorY","rasterizeSimpleLine","cap","m","l","f","a","fromSimpleMarker","n","fromCIMHatchFill","frame","xmin","ymax","xmax","ymin","markerPlacement","fromCIMInsidePolygon","i","rasterize","c","h","p","y","u","width","height","getContext","ImageData","putImageData","setAttribute","drawImage","getImageData","Uint8Array","data","oldColor","length","newColor","Math","round","Uint8ClampedArray","_textRasterizationCanvas","setFontProperties","parameters","textLines","split","lineHeight","computeLineHeight","computeTextWidth","renderedLineHeight","pixelRatio","renderedHaloSize","halo","renderedWidth","renderedHeight","fillStyle","color","slice","toString","haloStyle","textAlign","d","g","renderHalo","globalCompositeOperation","fillText","premultiplyColors","_haloRasterizationCanvas","clearRect","strokeStyle","lineJoin","renderHaloEmulated","renderHaloNative","globalAlpha","lineWidth","strokeText","font","weight","family","textBaseline","horizontalAlignment","max","measureText","push","cos","PI","sin","Legend","Preview","M","targetSize","referenceSize","scaleFactor","C","fill","legend","geometry","rings","canvasPaths","preview","stroke","paths","z","materialHash","cim","materialOverrides","analyzedCIM","hash","_spatialReference","_avoidSDF","_resourceCache","Map","_rasterizer","_textRasterizer","_pictureMarkerCache","centroid","symbol","analyzeCIMSymbol","Object","keys","map","name","alias","attributes","rasterizeCIMSymbol","geometryType","spatialReference","fields","fetchPictureMarkerResource","text","indexOf","textCase","get","url","responseType","signal","set","_getRasterizedResource","offsetX","offsetY","rotation","rotateClockwise","angle","verticalAlignment","rotateClockWise","rasterizedResource","getSymbolImage","I","min","x","createImageData","P","rasterizedImage","_imageDataToCanvas","save","translate","rotate","restore","imageData","anchorPosition","_imageDataCanvas","_getPictureResource","_rasterizePictureResource","_embedCIMLayerInVectorMarker","JSON","stringify","rasterizeJSONResource","_rasterizeTextResource","anchorPoint","preserveOutlineWidth","has","window","devicePixelRatio","fontName","decoration","outlineColor","outlineSize","rasterizeText","abs","createPattern","setTransform","m11","m12","m21","m22","m41","m42","beginPath","moveTo","lineTo","closePath","apply","_imageTo32Array","markerGraphics","symbolLayers","maxSize","feature","fieldMap","node","opacity","clone","rasterizeCIMSymbolAsync","b","w","scale","ceil","Image","src","toDataURL","appendChild"],"mappings":"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","file":"static/js/120.75239d1e.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{pt2px as t}from\"../../core/screenUtils.js\";class e{constructor(){}rasterizeText(t,e){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement(\"canvas\"));const i=this._textRasterizationCanvas,s=i.getContext(\"2d\");this.setFontProperties(s,e),this.parameters=e,this.textLines=t.split(/\\r?\\n/),this.lineHeight=this.computeLineHeight();const r=this.computeTextWidth(s,e),o=this.lineHeight*this.textLines.length;var n;i.width=r,i.height=o,this.renderedLineHeight=Math.round(this.lineHeight*e.pixelRatio),this.renderedHaloSize=e.halo.size*e.pixelRatio,this.renderedWidth=r*e.pixelRatio,this.renderedHeight=o*e.pixelRatio,this.fillStyle=`rgba(${(n=e.color).slice(0,3).toString()},${n[3]})`,this.haloStyle=function(t){return`rgb(${t.slice(0,3).toString()})`}(e.halo.color);const a=this.renderedLineHeight,h=this.renderedHaloSize;this.setFontProperties(s,e);const l=function(t,e){return\"center\"===t?.5*e:\"right\"===t?e:0}(s.textAlign,this.renderedWidth)+h,d=h;let c=0,g=0;h>0&&this.renderHalo(s,l,d,c,g,e),g+=d,c+=l;for(const t of this.textLines)s.globalCompositeOperation=\"destination-out\",s.fillStyle=\"rgb(0, 0, 0)\",s.fillText(t,c,g),s.globalCompositeOperation=\"source-over\",s.fillStyle=this.fillStyle,s.fillText(t,c,g),g+=a;const f=s.getImageData(0,0,this.renderedWidth,this.renderedHeight),p=new Uint8Array(f.data);if(e.premultiplyColors){let t;for(let e=0;e<p.length;e+=4)t=p[e+3]/255,p[e]=p[e]*t,p[e+1]=p[e+1]*t,p[e+2]=p[e+2]*t}return{size:[this.renderedWidth,this.renderedHeight],image:new Uint32Array(p.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}renderHalo(t,e,i,s,r,o){const n=this.renderedWidth,a=this.renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement(\"canvas\")),this._haloRasterizationCanvas.width=n,this._haloRasterizationCanvas.height=a;const h=this._haloRasterizationCanvas,l=h.getContext(\"2d\");l.clearRect(0,0,n,a),this.setFontProperties(l,o),l.fillStyle=this.haloStyle,l.strokeStyle=this.haloStyle;const d=this.renderedHaloSize<3;l.lineJoin=d?\"miter\":\"round\",d?this.renderHaloEmulated(l,e,i):this.renderHaloNative(l,e,i),t.globalAlpha=this.parameters.halo.color[3],t.drawImage(h,0,0,n,a,s,r,n,a),t.globalAlpha=1}renderHaloEmulated(t,e,s){const r=this.renderedLineHeight,o=this.renderedHaloSize;for(const n of this.textLines){for(const[r,a]of i)t.fillText(n,e+o*r,s+o*a);s+=r}}renderHaloNative(t,e,i){const s=this.renderedLineHeight,r=this.renderedHaloSize;for(const o of this.textLines){const n=2*r,a=5,h=.1;for(let s=0;s<a;s++){const r=1-(a-1)*h+s*h;t.lineWidth=r*n,t.strokeText(o,e,i)}i+=s}}setFontProperties(e,i){const s=i.font,r=`${s.style} ${s.weight} ${t(i.size*i.pixelRatio)}px ${s.family}, sans-serif`;let o;switch(e.font=r,e.textBaseline=\"top\",i.horizontalAlignment){case\"left\":o=\"left\";break;case\"right\":o=\"right\";break;case\"center\":o=\"center\";break;default:o=\"left\"}e.textAlign=o}computeTextWidth(t,e){let i=0;for(const e of this.textLines)i=Math.max(i,t.measureText(e).width);const s=e.font;return(\"italic\"===s.style||\"oblique\"===s.style||\"string\"==typeof s.weight&&(\"bold\"===s.weight||\"bolder\"===s.weight)||\"number\"==typeof s.weight&&s.weight>600)&&(i+=.3*t.measureText(\"A\").width),i+=2*this.parameters.halo.size,Math.round(i)}computeLineHeight(){const t=1.275*this.parameters.size;return Math.round(t+2*this.parameters.halo.size)}}const i=[];{const t=16;for(let e=0;e<360;e+=360/t)i.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)])}export default e;export{e as TextRasterizer};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{resampleHermite as e}from\"./utils.js\";import r from\"./Rect.js\";import{SymbolHelper as t,CIMSymbolHelper as a}from\"./CIMSymbolHelper.js\";import{getSDFInfo as n,buildSDF as i}from\"./SDFHelper.js\";export default class{dispose(){this._rasterizationCanvas=null}rasterizeJSONResource(e,s,o){if(this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement(\"canvas\")),\"simple-fill\"===e.type||\"esriSFS\"===e.type){const[r,a,n]=t.rasterizeSimpleFill(this._rasterizationCanvas,e.style,s);return{size:[a,n],image:new Uint32Array(r.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0}}if(\"simple-line\"===e.type||\"esriSLS\"===e.type){const[r,a,n]=t.rasterizeSimpleLine(e.style,e.cap);return{size:[a,n],image:new Uint32Array(r.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}let m,l,f;if(\"simple-marker\"===e.type||\"esriSMS\"===e.type||\"line-marker\"===e.type?(m=a.fromSimpleMarker(e),f=n(m)):\"CIMHatchFill\"===e.type?(m=a.fromCIMHatchFill(e),l=new r(m.frame.xmin,-m.frame.ymax,m.frame.xmax-m.frame.xmin,m.frame.ymax-m.frame.ymin)):e.markerPlacement&&\"CIMMarkerPlacementInsidePolygon\"===e.markerPlacement.type?(m=a.fromCIMInsidePolygon(e),l=new r(m.frame.xmin,-m.frame.ymax,m.frame.xmax-m.frame.xmin,m.frame.ymax-m.frame.ymin)):(m=e,f=n(m)),f&&!o){const[e,r,t]=i(f);return e?{size:[r,t],image:new Uint32Array(e.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null}const[c,h,p,y,u]=a.rasterize(this._rasterizationCanvas,m,l,!o);return c?{size:[h,p],image:new Uint32Array(c.buffer),sdf:!1,simplePattern:!1,anchorX:y,anchorY:u}:null}rasterizeImageResource(r,t,a,n){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement(\"canvas\")),this._rasterizationCanvas.width=r,this._rasterizationCanvas.height=t;const i=this._rasterizationCanvas.getContext(\"2d\");a instanceof ImageData?i.putImageData(a,0,0):(a.setAttribute(\"width\",`${r}px`),a.setAttribute(\"height\",`${t}px`),i.drawImage(a,0,0,r,t));const s=i.getImageData(0,0,r,t),o=new Uint8Array(s.data);if(n)for(const e of n)if(e&&e.oldColor&&4===e.oldColor.length&&e.newColor&&4===e.newColor.length){const[r,t,a,n]=e.oldColor,[i,s,m,l]=e.newColor;if(r===i&&t===s&&a===m&&n===l)continue;for(let e=0;e<o.length;e+=4)r===o[e]&&t===o[e+1]&&a===o[e+2]&&n===o[e+3]&&(o[e]=i,o[e+1]=s,o[e+2]=m,o[e+3]=l)}let m;for(let e=0;e<o.length;e+=4)m=o[e+3]/255,o[e]=o[e]*m,o[e+1]=o[e+1]*m,o[e+2]=o[e+2]*m;let l=o,f=r,c=t;const h=512;if(f>=h||c>=h){const a=f/c;a>1?(f=h,c=Math.round(h/a)):(c=h,f=Math.round(h*a)),l=new Uint8Array(4*f*c);const n=new Uint8ClampedArray(l.buffer);e(o,r,t,n,f,c,!1)}return{size:[r,t],image:new Uint32Array(l.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{numericHash as e}from\"../../core/string.js\";import{throwIfAborted as t,all as r}from\"../../core/promiseUtils.js\";import{getJsonType as a,isPolygon as i,isPolyline as s}from\"../../geometry/support/jsonUtils.js\";import{pt2px as o}from\"../../core/screenUtils.js\";import n from\"../support/Symbol3DAnchorPosition2D.js\";import c from\"../../request.js\";import{createLabelOverrideFunction as l,evaluateValueOrFunction as m,colorToArray as h}from\"./utils.js\";import{scaleCIMMarker as f}from\"../support/cimSymbolUtils.js\";import{analyzeCIMSymbol as g,analyzeCIMResource as y}from\"./cimAnalyzer.js\";import u from\"./Rasterizer.js\";import{TextRasterizer as p}from\"./TextRasterizer.js\";var d;!function(e){e.Legend=\"legend\",e.Preview=\"preview\"}(d||(d={}));const M=(e,t,r)=>{if(e&&e.targetSize){let a;if(r){const t=Math.max(r.frame.xmax-r.frame.xmin,r.frame.ymax-r.frame.ymin);a=e.targetSize/o(t)}else a=e.targetSize/t.referenceSize;return a}return e&&e.scaleFactor?e.scaleFactor:1},C={fill:{legend:{frame:{xmax:15,xmin:0,ymax:15,ymin:0},geometry:{rings:[[[0,15],[15,7.5],[15,0],[0,0],[0,15]]]},canvasPaths:{rings:[[[0,15],[0,0],[15,7.5],[15,15],[0,15]]]}},preview:{frame:{xmax:100,xmin:0,ymax:100,ymin:0},geometry:{rings:[[[0,100],[100,100],[100,0],[0,0],[0,100]]]},canvasPaths:{rings:[[[0,100],[0,0],[100,0],[100,100],[0,100]]]}}},stroke:{legend:{frame:{xmax:24,xmin:0,ymax:-2,ymin:2},geometry:{paths:[[[0,0],[12,0],[24,0]]]},canvasPaths:{paths:[[[0,2],[12,2],[24,2]]]}},preview:{frame:{xmax:100,xmin:0,ymax:-2,ymin:2},geometry:{paths:[[[0,0],[50,0],[100,0]]]},canvasPaths:{paths:[[[0,2],[50,2],[100,2]]]}}}};class I{constructor(e,t){this._spatialReference=e,this._avoidSDF=t,this._resourceCache=new Map,this._rasterizer=new u,this._textRasterizer=new p,this._pictureMarkerCache=new Map}async rasterizeCIMSymbolAsync(e,t,r,i,s,o,n,c){i=i||(t?null!=t.centroid?\"esriGeometryPolygon\":a(t.geometry):null)||function(e){if(!(e&&e.data&&e.data.symbol))return null;switch(e.data.symbol.type){case\"CIMPointSymbol\":case\"CIMTextSymbol\":return\"esriGeometryPoint\";case\"CIMLineSymbol\":return\"esriGeometryPolyline\";case\"CIMPolygonSymbol\":return\"esriGeometryPolygon\";default:return null}}(e);const l=await this.analyzeCIMSymbol(e,t?function(e){const t=e?Object.keys(e):[];return t.map((t=>({name:t,alias:t,type:\"string\"==typeof e[t]?\"esriFieldTypeString\":\"esriFieldTypeDouble\"})))}(t.attributes):null,r,i,c);return this.rasterizeCIMSymbol(l,t,i,s,o,n)}async analyzeCIMSymbol(e,a,i,s,o){const n=[],c=a?{geometryType:s,spatialReference:this._spatialReference,fields:a}:null;let m;await g(e.data,c,n,this._avoidSDF),t(o);for(const e of n)\"CIMPictureMarker\"!==e.cim.type&&\"CIMPictureFill\"!==e.cim.type&&\"CIMPictureStroke\"!==e.cim.type||(m||(m=[]),m.push(this.fetchPictureMarkerResource(e,o))),i&&\"text\"===e.type&&\"string\"==typeof e.text&&e.text.indexOf(\"[\")>-1&&(e.text=l(i,e.text,e.cim.textCase));return m&&await r(m),n}async fetchPictureMarkerResource(e,t){const r=e.materialHash;if(!this._pictureMarkerCache.get(r)){const a=(await c(e.cim.url,{responseType:\"image\",signal:t&&t.signal})).data;this._pictureMarkerCache.set(r,a)}}rasterizeCIMSymbol(e,t,r,a,i,s){const o=[];for(const n of e){a&&\"function\"==typeof a.scaleFactor&&(a.scaleFactor=a.scaleFactor(t,i,s));const e=this._getRasterizedResource(n,t,r,a,i,s);if(!e)continue;let c=0,l=e.anchorX||0,h=e.anchorY||0,f=!1,g=0,y=0;if(\"esriGeometryPoint\"===r){const e=M(a,n,null);if(g=m(n.offsetX,t,i,s)*e||0,y=m(n.offsetY,t,i,s)*e||0,\"marker\"===n.type)c=m(n.rotation,t,i,s)||0,f=!!n.rotateClockwise&&n.rotateClockwise;else if(\"text\"===n.type){if(c=m(n.angle,t,i,s)||0,void 0!==n.horizontalAlignment)switch(n.horizontalAlignment){case\"left\":l=-.5;break;case\"right\":l=.5;break;default:l=0}if(void 0!==n.verticalAlignment)switch(n.verticalAlignment){case\"top\":h=.5;break;case\"bottom\":h=-.5;break;case\"baseline\":h=-.25;break;default:h=0}}}null!=e&&o.push({angle:c,rotateClockWise:f,anchorX:l,anchorY:h,offsetX:g,offsetY:y,rasterizedResource:e})}return this.getSymbolImage(o)}getSymbolImage(e){const t=document.createElement(\"canvas\"),r=t.getContext(\"2d\");let a=0,i=0,s=0,c=0;const l=[];for(let t=0;t<e.length;t++){const n=e[t],m=n.rasterizedResource;if(!m)continue;const h=m.size,f=n.offsetX,g=n.offsetY,y=n.anchorX,u=n.anchorY,p=n.rotateClockWise||!1;let d=n.angle,M=o(f)-h[0]*(.5+y),C=o(g)-h[1]*(.5+u),I=M+h[0],z=C+h[1];if(d){p&&(d=-d);const e=Math.sin(d*Math.PI/180),t=Math.cos(d*Math.PI/180),r=M*t-C*e,a=M*e+C*t,i=M*t-z*e,s=M*e+z*t,o=I*t-z*e,n=I*e+z*t,c=I*t-C*e,l=I*e+C*t;M=Math.min(r,i,o,c),C=Math.min(a,s,n,l),I=Math.max(r,i,o,c),z=Math.max(a,s,n,l)}a=M<a?M:a,i=C<i?C:i,s=I>s?I:s,c=z>c?z:c;const x=r.createImageData(m.size[0],m.size[1]);x.data.set(new Uint8ClampedArray(m.image.buffer));const P={offsetX:f,offsetY:g,rotateClockwise:p,angle:d,rasterizedImage:x,anchorX:y,anchorY:u};l.push(P)}t.width=s-a,t.height=c-i;const m=-a,h=c;for(let e=0;e<l.length;e++){const t=l[e],a=this._imageDataToCanvas(t.rasterizedImage),i=t.rasterizedImage.width,s=t.rasterizedImage.height,n=m-i*(.5+t.anchorX),c=h-s*(.5-t.anchorY);if(t.angle){const e=(360-t.angle)*Math.PI/180;r.save(),r.translate(o(t.offsetX),-o(t.offsetY)),r.translate(m,h),r.rotate(e),r.translate(-m,-h),r.drawImage(a,n,c),r.restore()}else r.drawImage(a,n+o(t.offsetX),c-o(t.offsetY))}const f=new n({x:m/t.width-.5,y:h/t.height-.5});return{imageData:0!==t.width&&0!==t.height?r.getImageData(0,0,t.width,t.height):r.createImageData(1,1),anchorPosition:f}}_imageDataToCanvas(e){this._imageDataCanvas||(this._imageDataCanvas=document.createElement(\"canvas\"));const t=this._imageDataCanvas,r=t.getContext(\"2d\");return t.width=e.width,t.height=e.height,r.putImageData(e,0,0),t}_imageTo32Array(e,t,r){this._imageDataCanvas||(this._imageDataCanvas=document.createElement(\"canvas\"));const a=this._imageDataCanvas,i=a.getContext(\"2d\");return a.width=t,a.height=r,i.drawImage(e,0,0,t,r),new Uint32Array(i.getImageData(0,0,t,r).data.buffer)}_getRasterizedResource(t,r,a,i,s,o){let n,c,l,h;if(\"esriGeometryPolyline\"===a||\"esriGeometryPolygon\"===a){const h=i&&i.style?i.style:d.Legend,f=\"esriGeometryPolyline\"===a?C.stroke[h]:C.fill[h];if(\"line\"===t.type){if(\"CIMSolidStroke\"!==t.cim.type){if(\"CIMPictureStroke\"===t.cim.type){const e=m(t.width,r,s,o);let a,i,n;return({image:a,width:i,height:n}=this._getPictureResource(t,e)),this._rasterizePictureResource(t,a,i,n,f,e)}return null}({analyzedCIM:n,hash:l}=z(t,r,s,o)),c=this._embedCIMLayerInVectorMarker(n,f)}else if(\"marker\"===t.type){if(\"CIMPictureMarker\"===t.cim.type)return null;if(\"CIMVectorMarker\"!==t.cim.type)return null;t.cim.offsetX=m(t.offsetX,r,s,o),t.cim.offsetY=m(t.offsetY,r,s,o),t.cim.rotation=m(t.rotation,r,s,o),t.cim.markerPlacement=t.markerPlacement,({analyzedCIM:n}=z(t,r,s,o)),l=e(JSON.stringify(n)).toString(),c=this._embedCIMLayerInVectorMarker(n,f)}else{if(\"text\"===t.type)return null;if(\"fill\"===t.type){if(\"CIMHatchFill\"===t.cim.type||\"CIMVectorMarker\"===t.cim.type||\"CIMPictureMarker\"===t.cim.type||\"CIMPictureFill\"===t.cim.type){const e=t.cim.size||t.cim.height;let a,i,c;if(\"CIMPictureMarker\"===t.cim.type||\"CIMPictureFill\"===t.cim.type)({image:a,width:i,height:c}=this._getPictureResource(t,e));else{({analyzedCIM:n,hash:l}=z(t,r,s,o));const e=this._rasterizer.rasterizeJSONResource(n,1,this._avoidSDF);a=e.image,i=e.size[0],c=e.size[1]}return this._rasterizePictureResource(t,a,i,c,f,null)}if(\"CIMSolidFill\"!==t.cim.type)return null;({analyzedCIM:n,hash:l}=z(t,r,s,o)),c=this._embedCIMLayerInVectorMarker(n,f)}}}else{if(\"text\"===t.type)return h=this._rasterizeTextResource(t,r,i,s,o),h;({analyzedCIM:n,hash:l}=z(t,r,s,o));const e=M(i,t,null);if(\"CIMPictureMarker\"===t.cim.type){const a=m(t.size,r,s,o)*e,{image:i,width:n,height:c}=this._getPictureResource(t,a);return h={image:i,size:[n,c],sdf:!1,simplePattern:!1,anchorX:t.anchorPoint?t.anchorPoint.x:0,anchorY:t.anchorPoint?t.anchorPoint.y:0},h}f(n,e,{preserveOutlineWidth:!1}),c=n}l+=a,i&&(l+=JSON.stringify(i));const g=this._resourceCache;return g.has(l)?g.get(l):(h=this._rasterizer.rasterizeJSONResource(c,window.devicePixelRatio||1,this._avoidSDF),g.set(l,h),h)}_rasterizeTextResource(e,t,r,a,i){const s=M(r,e,null),o=m(e.text,t,a,i);if(!o||0===o.length)return null;const n=m(e.fontName,t,a,i),c=m(e.style,t,a,i),l=m(e.weight,t,a,i),f=m(e.decoration,t,a,i),g=m(e.size,t,a,i)*s,y=m(e.horizontalAlignment,t,a,i),u=m(e.verticalAlignment,t,a,i),p=h(m(e.color,t,a,i)),d=h(m(e.outlineColor,t,a,i)),C={color:p,size:g,horizontalAlignment:y,verticalAlignment:u,font:{family:n,style:c,weight:l,decoration:f},halo:{size:m(e.outlineSize,t,a,i)||0,color:d,style:c},pixelRatio:1,premultiplyColors:!this._avoidSDF};return this._textRasterizer.rasterizeText(o,C)}_rasterizePictureResource(e,t,r,a,n,c){const l=document.createElement(\"canvas\"),m=l.getContext(\"2d\");l.height=o(Math.max(Math.abs(n.frame.ymax-n.frame.ymin),c)),l.width=o(Math.abs(n.frame.xmax-n.frame.xmin));const h=m.createImageData(r,a);h.data.set(new Uint8ClampedArray(t.buffer));const f=this._imageDataToCanvas(h),g=m.createPattern(f,\"repeat\"),y=Math.cos((-e.cim.rotation||0)*Math.PI/180),u=Math.sin((-e.cim.rotation||0)*Math.PI/180);g.setTransform({m11:y,m12:u,m21:-u,m22:y,m41:o(e.cim.offsetX)||0,m42:o(e.cim.offsetY)||0});const p=n.canvasPaths;let d,M,C;i(p)?(d=p.rings,m.fillStyle=g,M=m.fill,C=[\"evenodd\"]):s(p)&&(d=p.paths,m.strokeStyle=g,m.lineWidth=c,M=m.stroke,d[0][0][1]=l.height/2,d[0][1][1]=l.height/2),m.beginPath();for(const e of d){const t=e?e.length:0;if(t>1){let r=e[0];m.moveTo(o(r[0]),o(r[1]));for(let a=1;a<t;++a)r=e[a],m.lineTo(o(r[0]),o(r[1]));m.closePath()}}M.apply(m,C);const I=m.getImageData(0,0,l.width,l.height),z=new Uint8Array(I.data);return{size:[l.width,l.height],image:new Uint32Array(z.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}_getPictureResource(e,t){const r=this._pictureMarkerCache.get(e.materialHash);if(!r)return null;const a=r.height/r.width,i=t?a>1?o(t):o(t)/a:r.width,s=t?a>1?o(t)*a:o(t):r.height;return{image:this._imageTo32Array(r,i,s),width:i,height:s}}_embedCIMLayerInVectorMarker(e,t){const r=i(t.geometry)?\"CIMPolygonSymbol\":\"CIMLineSymbol\";return{type:\"CIMVectorMarker\",frame:t.frame,markerGraphics:[{type:\"CIMMarkerGraphic\",geometry:t.geometry,symbol:{type:r,symbolLayers:[e]}}]}}}function z(e,t,r,a){let i,s;if(\"function\"==typeof e.materialHash){i=(0,e.materialHash)(t,r,a),s=y(e.cim,e.materialOverrides)}else i=e.materialHash,s=e.cim;return{analyzedCIM:s,hash:i}}export{I as CIMSymbolRasterizer,d as GeometryStyle};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{px2pt as t}from\"../../core/screenUtils.js\";import{getCIMSymbolSize as e,scaleCIMSymbolTo as a}from\"./cimSymbolUtils.js\";import{CIMSymbolRasterizer as l}from\"../cim/CIMSymbolRasterizer.js\";const i=new l(null,!0);async function o(l,o={}){const{size:n,maxSize:s,feature:c,fieldMap:m,geometryType:r,style:y,node:d,opacity:h}=o,u=e(l),p=Math.min(null!=n?n:u,null!=s?s:t(120));p!==u&&(l=l.clone(),a(l,p,{preserveOutlineWidth:!0}));let g=3;l&&l.data&&l.data.symbol&&\"CIMPointSymbol\"!==l.data.symbol.type&&(g=1);const f=await i.rasterizeCIMSymbolAsync(l,c,m,r,{scaleFactor:g,style:y}),M=document.createElement(\"canvas\");M.width=f.imageData.width,M.height=f.imageData.height;M.getContext(\"2d\").putImageData(f.imageData,0,0);let b=M.width/g,w=M.height/g;if(null!=n&&(null==(null==o?void 0:o.scale)||(null==o?void 0:o.scale))){const t=b/w;b=t<=1?Math.ceil(p*t):p,w=t<=1?p:Math.ceil(p/t)}const C=new Image(b,w);return C.src=M.toDataURL(),null!=h&&(C.style.opacity=`${h}`),d&&d.appendChild(C),C}export{o as previewCIMSymbol};\n"],"sourceRoot":""}