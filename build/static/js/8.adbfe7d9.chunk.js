(this["webpackJsonpqp-ampd-app"]=this["webpackJsonpqp-ampd-app"]||[]).push([[8,96,119,192],{1117:function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return a}));var n=i(2);function a(e,t,i){var n,a,o,c,l,u=t&&t.length,h=u?t[0]*i:e.length,d=r(e,0,h,i,!0),f=new Array;if(!d||d.next===d.prev)return f;if(u&&(d=p(e,t,d,i)),e.length>80*i){n=o=e[0],a=c=e[1];for(var v=i;v<h;v+=i){var g=e[v],b=e[v+1];n=Math.min(n,g),a=Math.min(a,b),o=Math.max(o,g),c=Math.max(c,b)}l=0!==(l=Math.max(o-n,c-a))?1/l:0}return s(d,f,i,n,a,l),f}function r(e,t,i,n,a){var r;if(a===y(e,t,i,n)>0)for(var o=t;o<i;o+=n)r=u(o,e[o],e[o+1],r);else for(var s=i-n;s>=t;s-=n)r=u(s,e[s],e[s+1],r);return r&&w(r,r.next)&&(h(r),r=r.next),r}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;if(!e)return e;var i,n=e;do{if(i=!1,n.steiner||!w(n,n.next)&&0!==b(n.prev,n,n.next))n=n.next;else{if(h(n),(n=t=n.prev)===n.next)break;i=!0}}while(i||n!==t);return t}function s(e,t,i,n,a,r){var u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if(e){!u&&r&&(e=v(e,n,a,r));for(var d=e;e.prev!==e.next;){var p=e.prev,f=e.next;if(r?l(e,n,a,r):c(e))t.push(p.index/i),t.push(e.index/i),t.push(f.index/i),h(e),e=f.next,d=f.next;else if((e=f)===d){u?1===u?s(e=M(e,t,i),t,i,n,a,r,2):2===u&&S(e,t,i,n,a,r):s(o(e),t,i,n,a,r,1);break}}}}function c(e){var t=e.prev,i=e,n=e.next;if(b(t,i,n)>=0)return!1;for(var a=e.next.next,r=a,o=0;a!==e.prev&&(0===o||a!==r);){if(o++,O(t.x,t.y,i.x,i.y,n.x,n.y,a.x,a.y)&&b(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function l(e,t,i,n){var a=e.prev,r=e,o=e.next;if(b(a,r,o)>=0)return!1;for(var s=a.x<r.x?a.x<o.x?a.x:o.x:r.x<o.x?r.x:o.x,c=a.y<r.y?a.y<o.y?a.y:o.y:r.y<o.y?r.y:o.y,l=a.x>r.x?a.x>o.x?a.x:o.x:r.x>o.x?r.x:o.x,u=a.y>r.y?a.y>o.y?a.y:o.y:r.y>o.y?r.y:o.y,h=_(s,c,t,i,n),d=_(l,u,t,i,n),p=e.prevZ,f=e.nextZ;p&&p.z>=h&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&O(a.x,a.y,r.x,r.y,o.x,o.y,p.x,p.y)&&b(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&O(a.x,a.y,r.x,r.y,o.x,o.y,f.x,f.y)&&b(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&O(a.x,a.y,r.x,r.y,o.x,o.y,p.x,p.y)&&b(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&O(a.x,a.y,r.x,r.y,o.x,o.y,f.x,f.y)&&b(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function u(e,t,i,n){var a=new R(e,t,i);return n?(a.next=n.next,a.prev=n,n.next.prev=a,n.next=a):(a.prev=a,a.next=a),a}function h(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function d(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function p(e,t,i,n){for(var a=new Array,s=0,c=t.length;s<c;s++){var l=r(e,t[s]*n,s<c-1?t[s+1]*n:e.length,n,!1);l===l.next&&(l.steiner=!0),a.push(d(l))}a.sort(x);for(var u=0,h=a;u<h.length;u++){f(h[u],i),i=o(i,i.next)}return i}function f(e,t){if(t=function(e,t){var i,n=t,a=e.x,r=e.y,o=-1/0;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){var s=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=a&&s>o){if(o=s,s===a){if(r===n.y)return n;if(r===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!i)return null;if(a===o)return i.prev;var c,l=i,u=i.x,h=i.y,d=1/0;for(n=i.next;n!==l;)a>=n.x&&n.x>=u&&a!==n.x&&O(r<h?a:o,r,u,h,r<h?o:a,r,n.x,n.y)&&(((c=Math.abs(r-n.y)/(a-n.x))<d||c===d&&n.x>i.x)&&j(n,e)&&(i=n,d=c)),n=n.next;return i}(e,t)){var i=E(t,e);o(i,i.next)}}function v(e,t,i,n){for(var a;a!==e;a=a.next){if(null===(a=a||e).z&&(a.z=_(a.x,a.y,t,i,n)),a.prev.next!==a||a.next.prev!==a)return a.prev.next=a,a.next.prev=a,v(e,t,i,n);a.prevZ=a.prev,a.nextZ=a.next}return e.prevZ.nextZ=null,e.prevZ=null,function(e){for(var t,i=1;;){var n=void 0,a=e;e=null,t=null;for(var r=0;a;){r++,n=a;for(var o=0;o<i&&n;o++)n=n.nextZ;for(var s=i;o>0||s>0&&n;){var c=void 0;0===o?(c=n,n=n.nextZ,s--):0!==s&&n?a.z<=n.z?(c=a,a=a.nextZ,o--):(c=n,n=n.nextZ,s--):(c=a,a=a.nextZ,o--),t?t.nextZ=c:e=c,c.prevZ=t,t=c}a=n}if(t.nextZ=null,i*=2,r<2)return e}}(e)}function g(e,t,i,n){var a=t&&t.length,r=a?t[0]*i:e.length,o=Math.abs(y(e,0,r,i));if(a)for(var s=0,c=t.length;s<c;s++){var l=t[s]*i,u=s<c-1?t[s+1]*i:e.length;o-=Math.abs(y(e,l,u,i))}for(var h=0,d=0;d<n.length;d+=3){var p=n[d]*i,f=n[d+1]*i,v=n[d+2]*i;h+=Math.abs((e[p]-e[v])*(e[f+1]-e[p+1])-(e[p]-e[f])*(e[v+1]-e[p+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)}function b(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function m(e,t,i,n){return!!(w(e,t)&&w(i,n)||w(e,n)&&w(i,t))||b(e,t,i)>0!=b(e,t,n)>0&&b(i,n,e)>0!=b(i,n,t)>0}function y(e,t,i,n){for(var a=0,r=t,o=i-n;r<i;r+=n)a+=(e[o]-e[r])*(e[r+1]+e[o+1]),o=r;return a}function O(e,t,i,n,a,r,o,s){return(a-o)*(t-s)-(e-o)*(r-s)>=0&&(e-o)*(n-s)-(i-o)*(t-s)>=0&&(i-o)*(r-s)-(a-o)*(n-s)>=0}function j(e,t){return b(e.prev,e,e.next)<0?b(e,t,e.next)>=0&&b(e,e.prev,t)>=0:b(e,t,e.prev)<0||b(e,e.next,t)<0}function _(e,t,i,n,a){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*a)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*a)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function w(e,t){return e.x===t.x&&e.y===t.y}function x(e,t){return e.x-t.x}function M(e,t,i){var n=e;do{var a=n.prev,r=n.next.next;!w(a,r)&&m(a,n,n.next,r)&&j(a,r)&&j(r,a)&&(t.push(a.index/i),t.push(n.index/i),t.push(r.index/i),h(n),h(n.next),n=e=r),n=n.next}while(n!==e);return n}function S(e,t,i,n,a,r){var c=e;do{for(var l=c.next.next;l!==c.prev;){if(c.index!==l.index&&k(c,l)){var u=E(c,l);return c=o(c,c.next),u=o(u,u.next),s(c,t,i,n,a,r),void s(u,t,i,n,a,r)}l=l.next}c=c.next}while(c!==e)}function k(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!function(e,t){var i=e;do{if(i.index!==e.index&&i.next.index!==e.index&&i.index!==t.index&&i.next.index!==t.index&&m(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&j(e,t)&&j(t,e)&&function(e,t){var i=e,n=!1,a=(e.x+t.x)/2,r=(e.y+t.y)/2;do{i.y>r!=i.next.y>r&&i.next.y!==i.y&&a<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)}function E(e,t){var i=new R(e.index,e.x,e.y),n=new R(t.index,t.x,t.y),a=e.next,r=t.prev;return e.next=t,t.prev=e,i.next=a,a.prev=i,n.next=i,i.prev=n,r.next=n,n.prev=r,n}var R=function e(t,i,a){Object(n.a)(this,e),this.index=t,this.x=i,this.y=a,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}},1138:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var n,a,r=i(29),o=i(34),s=i(393);function c(e){e.fragment.include(s.a),e.fragment.uniforms.add("uShadowMapTex","sampler2D"),e.fragment.uniforms.add("uShadowMapNum","int"),e.fragment.uniforms.add("uShadowMapDistance","vec4"),e.fragment.uniforms.add("uShadowMapMatrix","mat4",4),e.fragment.uniforms.add("uDepthHalfPixelSz","float"),e.fragment.code.add(Object(o.a)(n||(n=Object(r.a)(["\n    int chooseCascade(float _linearDepth, out mat4 mat) {\n      vec4 distance = uShadowMapDistance;\n      float depth = _linearDepth;\n\n      //choose correct cascade\n      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;\n\n      mat = i == 0 ? uShadowMapMatrix[0] : i == 1 ? uShadowMapMatrix[1] : i == 2 ? uShadowMapMatrix[2] : uShadowMapMatrix[3];\n\n      return i;\n    }\n\n    vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {\n      vec4 lv = mat * vec4(_vpos, 1.0);\n      lv.xy /= lv.w;\n      return 0.5 * lv.xyz + vec3(0.5);\n    }\n\n    vec2 cascadeCoordinates(int i, vec3 lvpos) {\n      return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n    }\n\n    float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {\n      return rgba2float(texture2D(_depthTex, uv));\n    }\n\n    float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {\n      return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;\n    }\n\n    float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {\n      float texSize = 0.5 / halfPixelSize;\n\n      // filter, offset by half pixels\n      vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);\n\n      float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);\n      float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);\n      float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);\n      float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);\n\n      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n    }\n\n    float readShadowMap(const in vec3 _vpos, float _linearDepth) {\n      mat4 mat;\n      int i = chooseCascade(_linearDepth, mat);\n\n      if (i >= uShadowMapNum) { return 0.0; }\n\n      vec3 lvpos = lightSpacePosition(_vpos, mat);\n\n      // vertex completely outside? -> no shadow\n      if (lvpos.z >= 1.0) { return 0.0; }\n      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }\n\n      // calc coord in cascade texture\n      vec2 uv = cascadeCoordinates(i, lvpos);\n\n      return filterShadow(uv, lvpos, uDepthHalfPixelSz, uShadowMapTex);\n    }\n  "]))))}(a=c||(c={})).bindUniforms=function(e,t,i){t.shadowMappingEnabled&&(t.shadowMap.bind(e,i),t.shadowMap.bindView(e,t.origin))},a.bindViewCustomOrigin=function(e,t,i){t.shadowMappingEnabled&&t.shadowMap.bindView(e,i)},a.bindView=function(e,t){t.shadowMappingEnabled&&t.shadowMap.bindView(e,t.origin)}},1159:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var n,a,r,o=i(29),s=i(34);function c(e,t){0===t.output&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(Object(s.a)(n||(n=Object(o.a)(["\n      void forwardLinearDepth() { linearDepth = gl_Position.w; }\n    "]))))):1===t.output||3===t.output?(e.varyings.add("linearDepth","float"),e.vertex.uniforms.add("cameraNearFar","vec2"),e.vertex.code.add(Object(s.a)(a||(a=Object(o.a)(["\n      void forwardLinearDepth() {\n        linearDepth = (-position_view().z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);\n      }\n    "]))))):e.vertex.code.add(Object(s.a)(r||(r=Object(o.a)(["\n      void forwardLinearDepth() {}\n    "]))))}},1160:function(e,t,i){"use strict";i.d(t,"a",(function(){return x}));var n=i(2),a=i(3),r=i(5),o=i(6),s=i(0),c=(i(16),i(4)),l=i(13),u=(i(17),i(1)),h=i(8),d=(i(12),i(19),i(20),i(36)),p=i(78),f=i(38),v=i(27),g=i(11),b=i(141),m=i(476),y=i(600),O=i(33),j=i(163),_=i(606),w=l.a.getLogger("esri.views.interactive.GraphicManipulator"),x=function(e){Object(r.a)(i,e);var t=Object(o.a)(i);function i(e){var a;return Object(n.a)(this,i),(a=t.call(this,e)).layer=null,a.interactive=!0,a.selectable=!1,a.grabbable=!0,a.dragging=!1,a.cursor=null,a.events=new p.a.EventEmitter,a._circleCollisionCache=null,a._graphicSymbolChangedHandle=null,a._originalSymbol=null,a}return Object(a.a)(i,[{key:"graphic",set:function(e){"mesh"!==Object(c.i)(e.geometry,"type")?(this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()):w.error("Mesh geometries are not supported")}},{key:"elevationInfo",get:function(){var e="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,t=Object(j.e)(this.graphic),i=e?e.offset:0;return new m.a({mode:t,offset:i})}},{key:"focusedSymbol",set:function(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}},{key:"grabbableForEvent",value:function(){return!0}},{key:"grabbing",set:function(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}},{key:"hovering",set:function(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}},{key:"selected",set:function(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}},{key:"_focused",get:function(){return this._get("hovering")||this._get("grabbing")}},{key:"destroy",value:function(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}},{key:"intersectionDistance",value:function(e){var t=this.graphic;if(!1===t.visible)return null;var i=t.geometry;if(Object(c.j)(i))return null;var n=this._get("focusedSymbol"),a=Object(c.k)(n)?n:t.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,e,i,a):this._intersectDistance3D(this.view,e,t)}},{key:"attach",value:function(){this.attachSymbolChanged(),Object(c.k)(this.layer)&&this.layer.add(this.graphic)}},{key:"detach",value:function(){this.detachSymbolChanged(),this._resetGraphicSymbol(),Object(c.k)(this.layer)&&this.layer.remove(this.graphic)}},{key:"attachSymbolChanged",value:function(){var e=this;this.detachSymbolChanged(),this._graphicSymbolChangedHandle=this.graphic.watch("symbol",(function(t){Object(c.k)(t)&&t!==e.focusedSymbol&&t!==e._originalSymbol&&(e._originalSymbol=t,e._focused&&Object(c.k)(e.focusedSymbol)&&(e.graphic.symbol=e.focusedSymbol))}),!0)}},{key:"detachSymbolChanged",value:function(){Object(c.k)(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}},{key:"_updateGraphicSymbol",value:function(){this.graphic.symbol=this._focused&&Object(c.k)(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol}},{key:"_resetGraphicSymbol",value:function(){this.graphic.symbol=this._originalSymbol}},{key:"_intersectDistance2D",value:function(e,t,i,n){if(n=n||Object(y.e)(i),Object(c.j)(n))return null;var a=this._circleCollisionCache;if("point"!==i.type||"simple-marker"!==n.type)return Object(_.b)(t,i,e)?1:null;if(Object(c.j)(a)||!a.originalPoint.equals(i)){var r=i,o=e.spatialReference;if(Object(b.b)(r.spatialReference,o)){var s=Object(b.j)(r,o);a={originalPoint:r.clone(),mapPoint:s,radiusPx:Object(f.g)(n.size)},this._circleCollisionCache=a}}if(Object(c.k)(a)){var l=Object(f.i)(t,S),u=e.toScreen(a.mapPoint),h=a.radiusPx,d=u.x+Object(f.g)(n.xoffset),p=u.y-Object(f.g)(n.yoffset);return Object(O.j)(l,[d,p])<h*h?1:null}return null}},{key:"_intersectDistance3D",value:function(e,t,i){var n=e.toMap(t,{include:[i]});return n&&Object(b.n)(n,M,e.renderSpatialReference)?Object(g.n)(M,e.state.camera.eye):null}}]),i}(d.a);Object(s.a)([Object(u.b)({constructOnly:!0,nonNullable:!0})],x.prototype,"graphic",null),Object(s.a)([Object(u.b)({readOnly:!0})],x.prototype,"elevationInfo",null),Object(s.a)([Object(u.b)({constructOnly:!0,nonNullable:!0})],x.prototype,"view",void 0),Object(s.a)([Object(u.b)({value:null})],x.prototype,"focusedSymbol",null),Object(s.a)([Object(u.b)({constructOnly:!0})],x.prototype,"layer",void 0),Object(s.a)([Object(u.b)()],x.prototype,"interactive",void 0),Object(s.a)([Object(u.b)()],x.prototype,"selectable",void 0),Object(s.a)([Object(u.b)()],x.prototype,"grabbable",void 0),Object(s.a)([Object(u.b)({value:!1})],x.prototype,"grabbing",null),Object(s.a)([Object(u.b)()],x.prototype,"dragging",void 0),Object(s.a)([Object(u.b)()],x.prototype,"hovering",null),Object(s.a)([Object(u.b)({value:!1})],x.prototype,"selected",null),Object(s.a)([Object(u.b)()],x.prototype,"cursor",void 0),x=Object(s.a)([Object(h.a)("esri.views.interactive.GraphicManipulator")],x);var M=Object(v.e)(),S=Object(f.f)()},1164:function(e,t,i){"use strict";i.d(t,"a",(function(){return j}));var n,a,r,o,s,c,l,u,h,d,p,f,v,g,b=i(29),m=i(34),y=i(619);function O(e){var t=e.fragment.code;t.add(Object(m.a)(n||(n=Object(b.a)(["\n    vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n    {\n      return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;\n    }\n    "])))),t.add(Object(m.a)(a||(a=Object(b.a)(["\n    float integratedRadiance(float cosTheta2, float roughness)\n    {\n      return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n    }\n    "])))),t.add(Object(m.a)(r||(r=Object(b.a)(["\n    vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n    {\n      float cosTheta2 = 1.0 - RdotNG * RdotNG;\n      float intRadTheta = integratedRadiance(cosTheta2, roughness);\n\n      // Calculate the integrated directional radiance of the ground and the sky\n      float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\n      float sky = 2.0 - ground;\n      return (ground * ambientGround + sky * ambientSky) * 0.5;\n    }\n    "]))))}function j(e,t){var i=e.fragment.code;e.include(y.a),3===t.pbrMode||4===t.pbrMode?(i.add(Object(m.a)(o||(o=Object(b.a)(["\n    struct PBRShadingWater\n    {\n        float NdotL;   // cos angle between normal and light direction\n        float NdotV;   // cos angle between normal and view direction\n        float NdotH;   // cos angle between normal and half vector\n        float VdotH;   // cos angle between view direction and half vector\n        float LdotH;   // cos angle between light direction and half vector\n        float VdotN;   // cos angle between view direction and normal vector\n    };\n\n    float dtrExponent = ",";\n    "])),t.useCustomDTRExponentForWater?"2.2":"2.0")),i.add(Object(m.a)(s||(s=Object(b.a)(["\n    vec3 fresnelReflection(float angle, vec3 f0, float f90) {\n      return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n    }\n    "])))),i.add(Object(m.a)(c||(c=Object(b.a)(["\n    float normalDistributionWater(float NdotH, float roughness)\n    {\n      float r2 = roughness * roughness;\n      float NdotH2 = NdotH * NdotH;\n      float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\n      return r2 / denom;\n    }\n    "])))),i.add(Object(m.a)(l||(l=Object(b.a)(["\n    float geometricOcclusionKelemen(float LoH)\n    {\n        return 0.25 / (LoH * LoH);\n    }\n    "])))),i.add(Object(m.a)(u||(u=Object(b.a)(["\n    vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n    {\n      vec3  F = fresnelReflection(props.VdotH, F0, F0Max);\n      float dSun = normalDistributionWater(props.NdotH, roughness);\n      float V = geometricOcclusionKelemen(props.LdotH);\n\n      float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);\n      float strengthSunHaze  = 1.2;\n      float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;\n\n      return ((dSun + dSunHaze) * V) * F;\n    }\n\n    vec3 tonemapACES(const vec3 x) {\n      return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n    }\n    "]))))):1!==t.pbrMode&&2!==t.pbrMode||(e.include(O),i.add(Object(m.a)(h||(h=Object(b.a)(["\n    struct PBRShadingInfo\n    {\n        float NdotL;                  // cos angle between normal and light direction\n        float NdotV;                  // cos angle between normal and view direction\n        float NdotH;                  // cos angle between normal and half vector\n        float VdotH;                  // cos angle between view direction and half vector\n        float LdotH;                  // cos angle between view light direction and half vector\n        float NdotNG;                 // cos angle between normal and normal of the ground\n        float RdotNG;                 // cos angle between view direction reflected of the normal and normal of the ground\n        float NdotAmbDir;             // cos angle between view direction and the fill light in ambient illumination\n        float NdotH_Horizon;          // cos angle between normal and half vector defined with horizon illumination\n        vec3 skyRadianceToSurface;         // integrated radiance of the sky based on the surface roughness (used for specular reflection)\n        vec3 groundRadianceToSurface;      // integrated radiance of the ground based on the surface roughness (used for specular reflection)\n        vec3 skyIrradianceToSurface;       // irradiance of the sky (used for diffuse reflection)\n        vec3 groundIrradianceToSurface;    // irradiance of the ground (used for diffuse reflection)\n\n        float averageAmbientRadiance;      // average ambient radiance used to deduce black level in gamut mapping\n        float ssao;                   // ssao coefficient\n        vec3 albedoLinear;            // linear color of the albedo\n        vec3 f0;                      // fresnel value at normal incident light\n        vec3 f90;                     // fresnel value at 90o of incident light\n\n        vec3 diffuseColor;            // diffuse color of the material used in environment illumination\n        float metalness;              // metalness of the material\n        float roughness;              // roughness of the material\n    };\n    "])))),i.add(Object(m.a)(d||(d=Object(b.a)(["\n    float normalDistribution(float NdotH, float roughness)\n    {\n        float a = NdotH * roughness;\n        float b = roughness / (1.0 - NdotH * NdotH + a * a);\n        return b * b * INV_PI;\n    }\n    "])))),i.add(Object(m.a)(p||(p=Object(b.a)(["\n    const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);\n    const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);\n    const vec2 c2 = vec2(-1.04, 1.04);\n\n    vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {\n        vec4 r = roughness * c0 + c1;\n        float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\n        return c2 * a004 + r.zw;\n    }\n    "])))),i.add(Object(m.a)(f||(f=Object(b.a)(["\n    vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\n      vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\n      vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\n\n      // From diffuse illumination calculate reflected color\n      vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;\n\n      // From specular illumination calculate reflected color\n      vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);\n      vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;\n      vec3 specularComponent = specularColor * indirectSpecular;\n\n      return (diffuseComponent + specularComponent);\n    }\n    "])))),i.add(Object(m.a)(v||(v=Object(b.a)(["\n    float gamutMapChanel(float x, vec2 p){\n      return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n    }"])))),i.add(Object(m.a)(g||(g=Object(b.a)(["\n    vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\n      vec3 outColor;\n      vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));\n      outColor.x = gamutMapChanel(inColor.x, p) ;\n      outColor.y = gamutMapChanel(inColor.y, p) ;\n      outColor.z = gamutMapChanel(inColor.z, p) ;\n      return outColor;\n    }\n    "])))))}},1167:function(e,t,i){"use strict";i.r(t),i.d(t,"hydratedAdapter",(function(){return c}));var n=i(43),a=i(63),r=i(259),o=i(118),s=i(108),c={convertToGEGeometry:function(e,t){if(null==t)return null;var i="cache"in t?t.cache._geVersion:void 0;return null==i&&(i=e.convertJSONToGeometry(t),"cache"in t&&(t.cache._geVersion=i)),i},exportPoint:function(e,t,i){var a=e.hasZ(t),r=e.hasM(t),o=new n.a({x:e.getPointX(t),y:e.getPointY(t),spatialReference:i});return a&&(o.z=e.getPointZ(t)),r&&(o.m=e.getPointM(t)),o.cache._geVersion=t,o},exportPolygon:function(e,t,i){var n=new o.a({rings:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:i});return n.cache._geVersion=t,n},exportPolyline:function(e,t,i){var n=new s.a({paths:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:i});return n.cache._geVersion=t,n},exportMultipoint:function(e,t,i){var n=new r.a({hasZ:e.hasZ(t),hasM:e.hasM(t),points:e.exportPoints(t),spatialReference:i});return n.cache._geVersion=t,n},exportExtent:function(e,t,i){var n=e.hasZ(t),r=e.hasM(t),o=new a.a({xmin:e.getXMin(t),ymin:e.getYMin(t),xmax:e.getXMax(t),ymax:e.getYMax(t),spatialReference:i});if(n){var s=e.getZExtent(t);o.zmin=s.vmin,o.zmax=s.vmax}if(r){var c=e.getMExtent(t);o.mmin=c.vmin,o.mmax=c.vmax}return o.cache._geVersion=t,o}}},1181:function(e,t,i){"use strict";i.d(t,"a",(function(){return O})),i.d(t,"b",(function(){return x})),i.d(t,"c",(function(){return w})),i.d(t,"d",(function(){return j})),i.d(t,"e",(function(){return T})),i.d(t,"f",(function(){return P}));var n=i(3),a=i(2),r=i(4),o=i(27),s=i(11),c=i(88),l=i(298),u=i(119),h=i(321),d=i(97),p=i(158),f=i(89),v=i(563),g=i(83),b=i(326),m=(i(647),i(57)),y=i(480);var O=function e(){Object(a.a)(this,e),this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=2},j=function(){function e(){Object(a.a)(this,e),this._transform=Object(u.b)(),this._transformInverse=new _({value:this._transform},c.a,u.b),this._transformInverseTranspose=new _(this._transformInverse,c.b,u.b),this._transformTranspose=new _({value:this._transform},c.b,u.b),this._transformInverseRotation=new _({value:this._transform},p.b,l.a)}return Object(n.a)(e,[{key:"invalidateLazyTransforms",value:function(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}},{key:"transform",get:function(){return this._transform}},{key:"inverse",get:function(){return this._transformInverse.value}},{key:"inverseTranspose",get:function(){return this._transformInverseTranspose.value}},{key:"inverseRotation",get:function(){return this._transformInverseRotation.value}},{key:"transpose",get:function(){return this._transformTranspose.value}},{key:"setTransformMatrix",value:function(e){Object(c.c)(this._transform,e)}},{key:"multiplyTransform",value:function(e){Object(c.l)(this._transform,this._transform,e)}},{key:"set",value:function(e){Object(c.c)(this._transform,e),this.invalidateLazyTransforms()}},{key:"setAndInvalidateLazyTransforms",value:function(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this.invalidateLazyTransforms()}}]),e}(),_=function(){function e(t,i,n){Object(a.a)(this,e),this.original=t,this.update=i,this.dirty=!0,this.transform=n()}return Object(n.a)(e,[{key:"invalidate",value:function(){this.dirty=!0}},{key:"value",get:function(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}]),e}(),w=function(){function e(){Object(a.a)(this,e),this.min=new x,this.max=new x,this.hud=new x,this.ground=new x}return Object(n.a)(e,[{key:"init",value:function(e){this.min.init(e),this.max.init(e),this.hud.init(e),this.ground.init(e),this.all=[]}}]),e}(),x=function(){function e(t){Object(a.a)(this,e),this.normal=Object(o.e)(),this.transformation=Object(u.b)(),this._ray=m.f.create(),this.init(t)}return Object(n.a)(e,[{key:"ray",get:function(){return this._ray}},{key:"hasIntersectionPoint",get:function(){return null!=this.dist}},{key:"distanceInRenderSpace",get:function(){if(null!=this.dist)return Object(s.d)(D,this.ray.direction,this.dist),Object(s.o)(D)}},{key:"getIntersectionPoint",value:function(e){return!!this.hasIntersectionPoint&&(Object(s.d)(D,this.ray.direction,this.dist),Object(s.e)(e,this.ray.origin,D),!0)}},{key:"getTransformedNormal",value:function(e){return Object(s.j)(A,this.normal),A[3]=0,Object(f.m)(A,A,this.transformation),Object(s.j)(e,A),Object(s.q)(e,e),e}},{key:"init",value:function(e){this.dist=void 0,this.target=void 0,this.name=void 0,this.drapedLayerOrder=void 0,this.drapedLayerGraphicOrder=void 0,this.center=null,this.geometryId=null,this.triangleNr=null,this.intersector="Stage",e?m.f.copy(e,this._ray):this._ray=m.f.create()}},{key:"set",value:function(e,t,i,n,a,r,l,u,h,d){e instanceof y.a&&(e={type:"stage",obj:e}),this.dist=i,Object(s.j)(this.normal,n),Object(c.c)(this.transformation,a),this.target=e,this.name=t,this.drapedLayerOrder=r,this.center=l?Object(o.d)(l):null,this.geometryId=u,this.triangleNr=h,this.drapedLayerGraphicOrder=d}},{key:"copyFrom",value:function(e){m.f.copy(e._ray,this._ray),this.dist=e.dist,this.target=e.target,this.name=e.name,this.drapedLayerOrder=e.drapedLayerOrder,this.center=e.center?Object(o.d)(e.center):null,this.geometryId=e.geometryId,this.triangleNr=e.triangleNr,this.intersector=e.intersector,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,Object(s.j)(this.normal,e.normal),Object(c.c)(this.transformation,e.transformation)}},{key:"toOwner",value:function(e){if(!this.target)return null;switch(this.target.type){case"stage":return M(this.target.obj.metadata,e);case"external":switch(this.intersector){case"PointRenderer":return function(e,t){var i=e.metadata.layerUid;return null!=i?t.map.findLayerByUid(i):null}(this.target,e);case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return M(this.target.metadata,e);case"TerrainRenderer":return e.map&&e.map.ground}}return null}},{key:"toGraphic",value:function(e){if(!this.target)return null;switch(this.target.type){case"stage":return S(this.target.obj.metadata,e);case"external":switch(this.intersector){case"PointRenderer":return function(e){return e.metadata.createGraphic()}(this.target);case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return S(this.target.metadata,e)}}return null}}]),e}();function M(e,t){return Object(r.j)(e)||null==e.layerUid?null:Object(r.k)(t.graphicsView)&&e.layerUid===t.graphicsView.graphics3d.layer.id?t.graphics:t.map.findLayerByUid(e.layerUid)}function S(e,t){if(Object(r.j)(e))return null;var i=M(e,t);if(Object(r.j)(i))return null;if(i===t.graphics)return Object(r.k)(t.graphicsView)?Object(r.q)(t.graphicsView.getGraphicFromGraphicUid(e.graphicUid)):null;var n,a,o=t.allLayerViews.find((function(e){return e.layer===i}));return o?(a=e,!(n=o)||n.suspended?null:"getGraphicFromIntersectorMetadata"in n&&a?n.getGraphicFromIntersectorMetadata(a):"getGraphicFromGraphicUid"in n&&null!=a.graphicUid?n.getGraphicFromGraphicUid(a.graphicUid):null):null}var k=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(a.a)(this,e),this.offset=t,this.tmpVertex=Object(o.e)()}return Object(n.a)(e,[{key:"applyToVertex",value:function(e,t,i){var n=e+this.localOrigin[0],a=t+this.localOrigin[1],r=i+this.localOrigin[2],o=this.offset/Math.sqrt(n*n+a*a+r*r);return this.tmpVertex[0]=e+n*o,this.tmpVertex[1]=t+a*o,this.tmpVertex[2]=i+r*o,this.tmpVertex}},{key:"applyToAabb",value:function(e){var t=e[0]+this.localOrigin[0],i=e[1]+this.localOrigin[1],n=e[2]+this.localOrigin[2],a=e[3]+this.localOrigin[0],r=e[4]+this.localOrigin[1],o=e[5]+this.localOrigin[2],s=this.offset/Math.sqrt(t*t+i*i+n*n);e[0]+=t*s,e[1]+=i*s,e[2]+=n*s;var c=this.offset/Math.sqrt(a*a+r*r+o*o);return e[3]+=a*c,e[4]+=r*c,e[5]+=o*c,e}}]),e}(),E=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(a.a)(this,e),this.offset=t,this.componentLocalOriginLength=0,this.tmpVertex=Object(o.e)(),this.mbs=Object(d.c)(),this.obb={center:Object(o.e)(),halfSize:Object(g.b)(),quaternion:null}}return Object(n.a)(e,[{key:"localOrigin",set:function(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}},{key:"applyToVertex",value:function(e,t,i){var n=e,a=t,r=i+this.componentLocalOriginLength,o=this.offset/Math.sqrt(n*n+a*a+r*r);return this.tmpVertex[0]=e+n*o,this.tmpVertex[1]=t+a*o,this.tmpVertex[2]=i+r*o,this.tmpVertex}},{key:"applyToAabb",value:function(e){var t=e[0],i=e[1],n=e[2]+this.componentLocalOriginLength,a=e[3],r=e[4],o=e[5]+this.componentLocalOriginLength,s=this.offset/Math.sqrt(t*t+i*i+n*n);e[0]+=t*s,e[1]+=i*s,e[2]+=n*s;var c=this.offset/Math.sqrt(a*a+r*r+o*o);return e[3]+=a*c,e[4]+=r*c,e[5]+=o*c,e}},{key:"applyToMbs",value:function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/t;return this.mbs[0]=e[0]+e[0]*i,this.mbs[1]=e[1]+e[1]*i,this.mbs[2]=e[2]+e[2]*i,this.mbs[3]=e[3]+e[3]*this.offset/t,this.mbs}},{key:"applyToObb",value:function(e){var t=e.center,i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this.obb.center[0]=t[0]+t[0]*i,this.obb.center[1]=t[1]+t[1]*i,this.obb.center[2]=t[2]+t[2]*i,Object(s.t)(this.obb.halfSize,e.halfSize,e.quaternion),Object(s.e)(this.obb.halfSize,this.obb.halfSize,e.center);var n=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);return this.obb.halfSize[0]+=this.obb.halfSize[0]*n,this.obb.halfSize[1]+=this.obb.halfSize[1]*n,this.obb.halfSize[2]+=this.obb.halfSize[2]*n,Object(s.i)(this.obb.halfSize,this.obb.halfSize,e.center),Object(v.a)(C,e.quaternion),Object(s.t)(this.obb.halfSize,this.obb.halfSize,C),this.obb.halfSize[0]*=this.obb.halfSize[0]<0?-1:1,this.obb.halfSize[1]*=this.obb.halfSize[1]<0?-1:1,this.obb.halfSize[2]*=this.obb.halfSize[2]<0?-1:1,this.obb.quaternion=e.quaternion,this.obb}}]),e}(),R=new(function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(a.a)(this,e),this.offset=t,this.sphere=Object(b.b)(),this.tmpVertex=Object(o.e)()}return Object(n.a)(e,[{key:"applyToVertex",value:function(e,t,i){var n=this.objectTransform.transform,a=n[0]*e+n[4]*t+n[8]*i+n[12],r=n[1]*e+n[5]*t+n[9]*i+n[13],o=n[2]*e+n[6]*t+n[10]*i+n[14],s=this.offset/Math.sqrt(a*a+r*r+o*o);a+=a*s,r+=r*s,o+=o*s;var c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*a+c[4]*r+c[8]*o+c[12],this.tmpVertex[1]=c[1]*a+c[5]*r+c[9]*o+c[13],this.tmpVertex[2]=c[2]*a+c[6]*r+c[10]*o+c[14],this.tmpVertex}},{key:"applyToMinMax",value:function(e,t){var i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;var n=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*n,t[1]+=t[1]*n,t[2]+=t[2]*n}},{key:"applyToAabb",value:function(e){var t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;var i=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*i,e[4]+=e[4]*i,e[5]+=e[5]*i,e}},{key:"applyToBoundingSphere",value:function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/t;return this.sphere[0]=e[0]+e[0]*i,this.sphere[1]=e[1]+e[1]*i,this.sphere[2]=e[2]+e[2]*i,this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}}]),e}());function P(e){return Object(r.k)(e)?(R.offset=e,R):null}new E;new k;var T="terrain",D=(Object(o.e)(),Object(o.e)()),A=Object(d.c)(),C=Object(h.a)()},1200:function(e,t,i){"use strict";i.r(t),i.d(t,"buffer",(function(){return k})),i.d(t,"clip",(function(){return s})),i.d(t,"contains",(function(){return l})),i.d(t,"convexHull",(function(){return j})),i.d(t,"crosses",(function(){return u})),i.d(t,"cut",(function(){return c})),i.d(t,"densify",(function(){return z})),i.d(t,"difference",(function(){return _})),i.d(t,"disjoint",(function(){return g})),i.d(t,"distance",(function(){return h})),i.d(t,"equals",(function(){return d})),i.d(t,"extendedSpatialReferenceInfo",(function(){return o})),i.d(t,"flipHorizontal",(function(){return C})),i.d(t,"flipVertical",(function(){return I})),i.d(t,"generalize",(function(){return G})),i.d(t,"geodesicArea",(function(){return F})),i.d(t,"geodesicBuffer",(function(){return E})),i.d(t,"geodesicDensify",(function(){return L})),i.d(t,"geodesicLength",(function(){return U})),i.d(t,"intersect",(function(){return x})),i.d(t,"intersects",(function(){return p})),i.d(t,"isSimple",(function(){return y})),i.d(t,"nearestCoordinate",(function(){return R})),i.d(t,"nearestVertex",(function(){return P})),i.d(t,"nearestVertices",(function(){return T})),i.d(t,"offset",(function(){return S})),i.d(t,"overlaps",(function(){return b})),i.d(t,"planarArea",(function(){return V})),i.d(t,"planarLength",(function(){return H})),i.d(t,"relate",(function(){return m})),i.d(t,"rotate",(function(){return A})),i.d(t,"simplify",(function(){return O})),i.d(t,"symmetricDifference",(function(){return w})),i.d(t,"touches",(function(){return f})),i.d(t,"union",(function(){return M})),i.d(t,"within",(function(){return v}));var n=i(1149),a=i(1167);function r(e){return Array.isArray(e)?e[0].spatialReference:e&&e.spatialReference}function o(e){return n.a.extendedSpatialReferenceInfo(e)}function s(e,t){return n.a.clip(a.hydratedAdapter,r(e),e,t)}function c(e,t){return n.a.cut(a.hydratedAdapter,r(e),e,t)}function l(e,t){return n.a.contains(a.hydratedAdapter,r(e),e,t)}function u(e,t){return n.a.crosses(a.hydratedAdapter,r(e),e,t)}function h(e,t,i){return n.a.distance(a.hydratedAdapter,r(e),e,t,i)}function d(e,t){return n.a.equals(a.hydratedAdapter,r(e),e,t)}function p(e,t){return n.a.intersects(a.hydratedAdapter,r(e),e,t)}function f(e,t){return n.a.touches(a.hydratedAdapter,r(e),e,t)}function v(e,t){return n.a.within(a.hydratedAdapter,r(e),e,t)}function g(e,t){return n.a.disjoint(a.hydratedAdapter,r(e),e,t)}function b(e,t){return n.a.overlaps(a.hydratedAdapter,r(e),e,t)}function m(e,t,i){return n.a.relate(a.hydratedAdapter,r(e),e,t,i)}function y(e){return n.a.isSimple(a.hydratedAdapter,r(e),e)}function O(e){return n.a.simplify(a.hydratedAdapter,r(e),e)}function j(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return n.a.convexHull(a.hydratedAdapter,r(e),e,t)}function _(e,t){return n.a.difference(a.hydratedAdapter,r(e),e,t)}function w(e,t){return n.a.symmetricDifference(a.hydratedAdapter,r(e),e,t)}function x(e,t){return n.a.intersect(a.hydratedAdapter,r(e),e,t)}function M(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return n.a.union(a.hydratedAdapter,r(e),e,t)}function S(e,t,i,o,s,c){return n.a.offset(a.hydratedAdapter,r(e),e,t,i,o,s,c)}function k(e,t,i){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return n.a.buffer(a.hydratedAdapter,r(e),e,t,i,o)}function E(e,t,i,o,s,c){return n.a.geodesicBuffer(a.hydratedAdapter,r(e),e,t,i,o,s,c)}function R(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return n.a.nearestCoordinate(a.hydratedAdapter,r(e),e,t,i)}function P(e,t){return n.a.nearestVertex(a.hydratedAdapter,r(e),e,t)}function T(e,t,i,o){return n.a.nearestVertices(a.hydratedAdapter,r(e),e,t,i,o)}function D(e){return"xmin"in e?"center"in e?e.center:null:"x"in e?e:"extent"in e?e.extent.center:null}function A(e,t,i){var a;if(null==e)throw new Error("Illegal Argument Exception");var r=e.spatialReference;if(null==(i=null!=(a=i)?a:D(e)))throw new Error("Illegal Argument Exception");var o=e.constructor.fromJSON(n.a.rotate(e,t,i));return o.spatialReference=r,o}function C(e,t){var i;if(null==e)throw new Error("Illegal Argument Exception");var a=e.spatialReference;if(null==(t=null!=(i=t)?i:D(e)))throw new Error("Illegal Argument Exception");var r=e.constructor.fromJSON(n.a.flipHorizontal(e,t));return r.spatialReference=a,r}function I(e,t){var i;if(null==e)throw new Error("Illegal Argument Exception");var a=e.spatialReference;if(null==(t=null!=(i=t)?i:D(e)))throw new Error("Illegal Argument Exception");var r=e.constructor.fromJSON(n.a.flipVertical(e,t));return r.spatialReference=a,r}function G(e,t,i,o){return n.a.generalize(a.hydratedAdapter,r(e),e,t,i,o)}function z(e,t,i){return n.a.densify(a.hydratedAdapter,r(e),e,t,i)}function L(e,t,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return n.a.geodesicDensify(a.hydratedAdapter,r(e),e,t,i,o)}function V(e,t){return n.a.planarArea(a.hydratedAdapter,r(e),e,t)}function H(e,t){return n.a.planarLength(a.hydratedAdapter,r(e),e,t)}function F(e,t,i){return n.a.geodesicArea(a.hydratedAdapter,r(e),e,t,i)}function U(e,t,i){return n.a.geodesicLength(a.hydratedAdapter,r(e),e,t,i)}},1201:function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var n=i(7),a=i.n(n),r=i(15),o=i(10),s=i(14),c=i(4),l=i(187),u=i(1),h=i(1202),d=i(12),p=i(19),f=i(126),v=i(20),g=i(128);function b(e){var t=Object(c.k)(e)&&e.origins?e.origins:[void 0];return function(i,n){var a,r=function(e,t,i){if(Object(c.k)(e)&&"resource"===e.type)return function(e,t,i){var n=Object(l.b)(t,i);return{type:String,read:function(e,t,i){var a=Object(g.d)(e,t,i);return n.type===String?a:"function"==typeof n.type?new n.type({url:a}):void 0},write:{writer:function(t,a,r,s){if(!s||!s.resources)return"string"==typeof t?void(a[r]=Object(g.e)(t,s)):void(a[r]=t.write({},s));var l=function(e){return Object(c.j)(e)?null:"string"==typeof e?e:e.url}(t),u=l?Object(g.e)(l,Object(o.a)(Object(o.a)({},s),{},{verifyItemRelativeUrls:s&&s.verifyItemRelativeUrls?{writtenUrls:s.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null}),1):null,p=n.type!==String&&(!Object(h.a)(this)||s&&s.origin&&this.originIdOf(i)>Object(f.d)(s.origin));s&&s.portalItem&&Object(c.k)(u)&&!Object(d.s)(u)?p?function(e,t,i,n,a,r,o,s){var c=o.portalItem.resourceFromPath(n),l=O(i,n,o);Object(v.a)(l)===Object(d.n)(c.path)?(y(e,t,c,l,o.resources.toUpdate),a[r]=n):m(e,t,i,n,a,r,o,s)}(this,i,t,u,a,r,s,e):function(e,t,i,n){n.resources.toKeep.push({resource:n.portalItem.resourceFromPath(e)}),t[i]=e}(u,a,r,s):s&&s.portalItem&&(Object(c.j)(u)||Object(c.k)(Object(g.b)(u))||Object(d.t)(u)||p)?m(this,i,t,u,a,r,s,e):a[r]=u}}}}(e,t,i);switch(Object(c.k)(e)&&e.type?e.type:"other"){case"other":return{read:!0,write:!0};case"url":return{read:g.c.read,write:g.c.write}}}(e,i,n),p=Object(s.a)(t);try{for(p.s();!(a=p.n()).done;){var b=a.value,j=Object(u.c)(i,b,n);for(var _ in r)j[_]=r[_]}}catch(w){p.e(w)}finally{p.f()}}}function m(e,t,i,n,a,r,o,s){var l=Object(p.a)(),u=O(i,n,o),h=Object(d.y)(Object(c.i)(s,"prefix"),l),f="".concat(h,".").concat(Object(v.a)(u)),g=o.portalItem.resourceFromPath(f);Object(d.t)(n)&&o.resources.pendingOperations.push(function(e){return j.apply(this,arguments)}(n).then((function(e){g.path="".concat(h,".").concat(Object(v.a)(e)),a[r]=g.itemRelativeUrl})).catch((function(){}))),y(e,t,g,u,o.resources.toAdd),a[r]=g.itemRelativeUrl}function y(e,t,i,n,a){a.push({resource:i,content:n,finish:function(i){!function(e,t,i){"string"==typeof e[t]?e[t]=i.url:e[t].url=i.url}(e,t,i)}})}function O(e,t,i){return"string"==typeof e?{url:t}:new Blob([JSON.stringify(e.toJSON(i))],{type:"application/json"})}function j(){return(j=Object(r.a)(a.a.mark((function e(t){var n,r,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(i.bind(null,62));case 2:return n=e.sent.default,e.next=5,n(t,{responseType:"blob"});case 5:return r=e.sent,o=r.data,e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},1202:function(e,t,i){"use strict";function n(e){return e&&"getAtOrigin"in e&&"originOf"in e}i.d(t,"a",(function(){return n}))},1256:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var n=i(45);function a(e,t,i){var a,l=e.byteLength/(4*t),u=new Uint32Array(e,0,l*t),h=new Uint32Array(l),d=null!=(a=null==i?void 0:i.minReduction)?a:0,p=(null==i?void 0:i.originalIndices)||null,f=p?p.length:0,v=(null==i?void 0:i.componentOffsets)||null,g=0;if(v)for(var b=0;b<v.length-1;b++){var m=v[b+1]-v[b];m>g&&(g=m)}else g=l;var y=Math.floor(1.1*g)+1;(null==c||c.length<2*y)&&(c=new Uint32Array(Object(n.n)(2*y)));for(var O=0;O<2*y;O++)c[O]=0;for(var j=0,_=!!v&&!!p,w=_?f:l,x=_?new Uint32Array(f):null,M=1.96,S=0!==d?Math.ceil(4*M*M/(d*d)*d*(1-d)):w,k=1,E=v?v[1]:w,R=0;R<w;R++){if(R===S){var P=1-j/R;if(P+M*Math.sqrt(P*(1-P)/R)<d)return null;S*=2}if(R===E){for(var T=0;T<2*y;T++)c[T]=0;if(p)for(var D=v[k-1];D<v[k];D++)x[D]=h[p[D]];E=v[++k]}for(var A=_?p[R]:R,C=A*t,I=s(u,C,t),G=I%y,z=j;0!==c[2*G+1];){if(c[2*G]===I){var L=c[2*G+1]-1;if(r(u,C,L*t,t)){z=h[L];break}}++G>=y&&(G-=y)}z===j&&(c[2*G]=I,c[2*G+1]=A+1,j++),h[A]=z}if(0!==d&&1-j/l<d)return null;if(_){for(var V=v[k-1];V<x.length;V++)x[V]=h[p[V]];h=x}var H=new Uint32Array(t*j);j=0;for(var F=0;F<w;F++)h[F]===j&&(o(u,(_?p[F]:F)*t,H,j*t,t),j++);if(p&&!_){for(var U=new Uint32Array(f),N=0;N<U.length;N++)U[N]=h[p[N]];h=U}return{buffer:H.buffer,indices:h,uniqueCount:j}}function r(e,t,i,n){for(var a=0;a<n;a++)if(e[t+a]!==e[i+a])return!1;return!0}function o(e,t,i,n,a){for(var r=0;r<a;r++)i[n+r]=e[t+r]}function s(e,t,i){for(var n=0,a=0;a<i;a++)n=(n=e[t+a]+n|0)+(n<<11)+(n>>>2)|0;return n>>>0}var c=null},1265:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n,a=i(29),r=i(34),o=i(1312);function s(e){e.fragment.uniforms.add("texWaveNormal","sampler2D"),e.fragment.uniforms.add("texWavePerturbation","sampler2D"),e.fragment.uniforms.add("waveParams","vec4"),e.fragment.uniforms.add("waveDirection","vec2"),e.include(o.b),e.fragment.code.add(Object(r.a)(n||(n=Object(a.a)(["\n      const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);\n\n      vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rg - 1.0;\n      }\n\n      float sampleNoiseTexture(vec2 _uv) {\n        return texture2D(texWavePerturbation, _uv).b;\n      }\n\n      vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n      }\n\n      float computeProgress(vec2 uv, float time) {\n        return fract(time);\n      }\n\n      float computeWeight(vec2 uv, float time) {\n        float progress = computeProgress(uv, time);\n        return 1.0 - abs(1.0 - 2.0 * progress);\n      }\n\n      vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\n        float flowStrength = waveParams[2];\n        float flowOffset = waveParams[3];\n\n        vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;\n\n        float progress = computeProgress(uv, time + phaseOffset);\n        float weight = computeWeight(uv, time + phaseOffset);\n\n        vec2 result = uv;\n        result -= flowVector * (progress + flowOffset);\n        result += phaseOffset;\n        result += (time - progress) * FLOW_JUMP;\n\n        return vec3(result, weight);\n      }\n\n      const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;\n      const float TIME_NOISE_STRENGTH = 7.77;\n\n      vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\n        float waveStrength = waveParams[0];\n\n        // overall directional shift in uv's for directional wave movement for\n        // now we do a hard coded scale for wave speed such that a unit length\n        // direction is not too fast.\n        vec2 waveMovement = time * -_waveDir;\n\n        float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\n\n        // compute two perturbed uvs and blend weights\n        // then sample the wave normals at the two positions and blend\n        vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\n        vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\n\n        vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\n        vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\n\n        // logic to flatten the wave pattern\n        // scale xy components of the normal, then adjust z (up) component\n        vec3 mixNormal = normalize(normal_A + normal_B);\n        mixNormal.xy *= waveStrength;\n        mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\n\n        return mixNormal;\n      }\n\n      vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {\n        float waveTextureRepeat = waveParams[1];\n        vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\n        float foam  = normals2FoamIntensity(normal, waveParams[0]);\n        return vec4(normal, foam);\n      }\n    "]))))}(s||(s={})).bindUniforms=function(e,t){e.setUniform1i("texWaveNormal",0),e.setUniform1i("texWavePerturbation",1),e.setUniform4f("waveParams",t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset),e.setUniform2f("waveDirection",t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity)}},1266:function(e,t,i){"use strict";i.d(t,"a",(function(){return R})),i.d(t,"b",(function(){return E}));var n,a,r,o,s,c,l,u,h,d,p=i(29),f=i(34),v=i(602),g=i(256),b=i(378),m=i(217),y=i(317),O=i(267),j=i(263),_=i(316),w=i(1138),x=i(1265),M=i(1159),S=i(1313),k=i(1337);function E(e){var t=new g.a;return t.include(v.a,{linearDepth:!1}),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("localOrigin","vec3"),t.vertex.uniforms.add("waterColor","vec4"),0!==e.output&&7!==e.output||(t.include(S.a,e),t.include(M.a,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.code.add(Object(f.a)(n||(n=Object(p.a)(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vuv = uv0;\n        vpos = position;\n\n        vnormal = getLocalUp(vpos, localOrigin);\n        vtbnMatrix = getTBNMatrix(vnormal);\n\n        ","\n\n        gl_Position = transformPosition(proj, view, vpos);\n        ","\n      }\n    "])),f.a.float(j.c),e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"",0===e.output?"forwardLinearDepth();":""))),e.multipassTerrainEnabled&&(t.fragment.include(y.a),t.include(_.b,e)),7===e.output&&(t.include(m.a,e),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(Object(f.a)(a||(a=Object(p.a)(["\n        void main() {\n          discardBySlice(vpos);\n          ","\n\n          gl_FragColor = vec4(waterColor.a);\n        }\n      "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""))),0===e.output&&(t.include(x.a,e),t.include(m.a,e),e.receiveShadows&&t.include(w.a,e),t.include(k.a,e),t.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("camPos","vec3").add("timeElapsed","float").add("view","mat4"),t.fragment.include(b.a),t.fragment.code.add(Object(f.a)(r||(r=Object(p.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        vec3 localUp = vnormal;\n        // the created normal is in tangent space\n        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);\n        vec3 v = -normalize(vpos - camPos);\n        vec3 l = normalize(-lightingMainDirection);\n        float shadow = ",";\n        vec4 vPosView = view*vec4(vpos, 1.0);\n        vec4 final = vec4(getSeaColor(n, v, l, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);\n\n        // gamma correction\n        gl_FragColor = delinearizeGamma(final);\n        gl_FragColor = highlightSlice(gl_FragColor, vpos);\n        ","\n      }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",e.receiveShadows?Object(f.a)(o||(o=Object(p.a)(["1.0 - readShadowMap(vpos, linearDepth)"]))):"1.0",e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),2===e.output&&(t.include(S.a,e),t.include(x.a,e),t.include(m.a,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),t.vertex.code.add(Object(f.a)(s||(s=Object(p.a)(["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vuv = uv0;\n          vpos = position;\n\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])),f.a.float(j.c))),t.fragment.uniforms.add("timeElapsed","float"),t.fragment.code.add(Object(f.a)(c||(c=Object(p.a)(["\n        void main() {\n          discardBySlice(vpos);\n\n          // the created normal is in tangent space and foam\n          vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n          tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);\n\n          gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);\n        }\n    "]))))),5===e.output&&(t.varyings.add("vpos","vec3"),t.vertex.code.add(Object(f.a)(l||(l=Object(p.a)(["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vpos = position;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])),f.a.float(j.c))),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(Object(f.a)(u||(u=Object(p.a)(["\n        void main() {\n          gl_FragColor = waterColor;\n        }\n    "]))))),4===e.output&&(t.include(O.a),t.varyings.add("vpos","vec3"),t.vertex.code.add(Object(f.a)(h||(h=Object(p.a)(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vpos = position;\n        gl_Position = transformPosition(proj, view, vpos);\n      }\n    "])),f.a.float(j.c))),t.include(m.a,e),t.fragment.code.add(Object(f.a)(d||(d=Object(p.a)(["\n      void main() {\n        discardBySlice(vpos);\n        outputHighlight();\n      }\n    "]))))),t}var R=Object.freeze({__proto__:null,build:E})},1267:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return c}));var n,a=i(29),r=i(34),o=i(256),s=i(632);function c(){var e=new o.a;return e.include(s.a),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("color","vec4"),e.fragment.code.add(Object(r.a)(n||(n=Object(a.a)(["\n    void main() {\n      vec4 texColor = texture2D(tex, uv);\n      gl_FragColor = texColor * color;\n    }\n  "])))),e}var l=Object.freeze({__proto__:null,build:c})},1268:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var n,a,r=i(29),o=i(34);!function(e){e.builder=function(e,t){e.vertex.uniforms.add("camPos","vec3").add("perScreenPixelRatio","float").add("screenSize","float"),e.vertex.code.add(Object(o.a)(n||(n=Object(r.a)(["\n    float computeRenderPixelSizeAt( vec3 pWorld ){\n      vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);\n      float viewDirectionDistance = abs(dot(viewForward, pWorld - camPos));\n      return viewDirectionDistance*perScreenPixelRatio;\n    }\n\n    vec3 screenSizeScaling(vec3 position, vec3 anchor){\n      return position * screenSize * computeRenderPixelSizeAt(anchor) + anchor;\n    }\n  "]))))},e.bindPassUniforms=function(e,t,i){e.setUniform1f("perScreenPixelRatio",i.camera.perScreenPixelRatio),e.setUniform1f("screenSize",t.screenSize)}}(a||(a={}))},1269:function(e,t,i){"use strict";i.d(t,"a",(function(){return w})),i.d(t,"b",(function(){return _}));var n,a,r,o,s,c,l,u,h,d=i(29),p=i(34),f=i(602),v=i(256),g=i(378),b=i(217),m=i(317),y=i(263),O=i(316),j=i(1268);function _(e){var t=new v.a;return t.include(f.a,{linearDepth:!1}),t.include(j.a.builder,{}),t.include(b.a,e),t.fragment.include(g.a),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.fragment.uniforms.add("color","vec4"),t.attributes.add("position","vec3"),t.varyings.add("vWorldPosition","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),e.screenSizeEnabled&&t.attributes.add("offset","vec3"),e.shadingEnabled&&(t.vertex.uniforms.add("viewNormal","mat4"),t.fragment.uniforms.add("shadedColor","vec4").add("shadingDirection","vec3"),t.attributes.add("normal","vec3"),t.varyings.add("vViewNormal","vec3")),t.vertex.code.add(Object(p.a)(n||(n=Object(d.a)(["\n    void main(void) {\n      vWorldPosition = ",";\n  "])),e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position")),e.shadingEnabled&&t.vertex.code.add(Object(p.a)(a||(a=Object(d.a)(["\n      vec3 worldNormal = normal;\n      vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;\n    "])))),t.vertex.code.add(Object(p.a)(r||(r=Object(d.a)(["\n    ","\n    gl_Position = transformPosition(proj, view, vWorldPosition);\n  }\n  "])),e.multipassTerrainEnabled?"depth = (view * vec4(vWorldPosition, 1.0)).z;":"")),e.multipassTerrainEnabled&&(t.fragment.include(m.a),t.include(O.b,e)),t.fragment.code.add(Object(p.a)(o||(o=Object(d.a)(["\n    void main() {\n      discardBySlice(vWorldPosition);\n      ","\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"")),e.shadingEnabled?t.fragment.code.add(Object(p.a)(s||(s=Object(d.a)(["\n      vec3 viewNormalNorm = normalize(vViewNormal);\n      float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);\n      vec4 finalColor = mix(color, shadedColor, shadingFactor);\n    "])))):t.fragment.code.add(Object(p.a)(c||(c=Object(d.a)(["\n      vec4 finalColor = color;\n    "])))),t.fragment.code.add(Object(p.a)(l||(l=Object(d.a)(["\n      if (finalColor.a < ",") {\n        discard;\n      }\n      ","\n\n      ","\n    }\n    "])),p.a.float(y.c),7===e.output?Object(p.a)(u||(u=Object(d.a)(["gl_FragColor = vec4(finalColor.a);"]))):"",0===e.output?Object(p.a)(h||(h=Object(d.a)(["gl_FragColor = highlightSlice(finalColor, vWorldPosition); ",""])),e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""):"")),t}var w=Object.freeze({__proto__:null,build:_})},1270:function(e,t,i){"use strict";i.d(t,"a",(function(){return y})),i.d(t,"b",(function(){return m}));var n,a,r,o,s,c,l=i(29),u=i(34),h=i(602),d=i(256),p=i(217),f=i(267),v=i(263),g=i(631),b=i(607);function m(e){var t=new d.a;return t.include(h.a,{linearDepth:!1}),t.include(b.a,e),t.include(g.a,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),t.vertex.code.add(Object(u.a)(n||(n=Object(l.a)(["\n    void main(void) {\n      vpos = position;\n      forwardNormalizedVertexColor();\n      gl_Position = transformPosition(proj, view, vpos);\n  "])))),e.stippleEnabled&&(t.attributes.add("auxpos1","vec3"),t.vertex.uniforms.add("ndcToPixel","vec2"),t.vertex.code.add(Object(u.a)(a||(a=Object(l.a)(["\n    vec4 vpos2 = transformPosition(proj, view, auxpos1);\n    float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);\n\n    stipplePatternUv = lineSegmentPixelSize * stipplePatternPixelSizeInv;\n    ","\n\n    // Cancel out perspective correct interpolation because we want this length the really represent\n    // the screen distance\n    stipplePatternUv *= gl_Position.w;\n    "])),e.stippleIntegerRepeatsEnabled?"stipplePatternUv = floor(stipplePatternUv + 0.5);":""))),t.vertex.code.add(Object(u.a)(r||(r=Object(l.a)(["\n  }\n  "])))),4===e.output&&t.include(f.a),t.include(p.a,e),t.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float"),t.fragment.code.add(Object(u.a)(o||(o=Object(l.a)(["\n  void main() {\n    discardBySlice(vpos);\n\n    vec4 color = ",";\n\n    float stippleAlpha = getStippleAlpha();\n    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);\n\n    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);\n\n    if (finalColor.a < ",") {\n      discard;\n    }\n\n    ","\n    ","\n  }\n  "])),e.attributeColor?"vColor":"constantColor",u.a.float(v.c),0===e.output?Object(u.a)(s||(s=Object(l.a)(["gl_FragColor = highlightSlice(finalColor, vpos);"]))):"",4===e.output?Object(u.a)(c||(c=Object(l.a)(["outputHighlight();"]))):"")),t}var y=Object.freeze({__proto__:null,build:m})},1271:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return c}));var n,a,r=i(29),o=i(34),s=i(256);function c(){var e=new s.a;return e.extensions.add("GL_OES_standard_derivatives"),e.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.attributes.add("position","vec3"),e.attributes.add("uv0","vec2"),e.varyings.add("vUV","vec2"),e.vertex.code.add(Object(o.a)(n||(n=Object(r.a)(["\n    void main(void) {\n      vUV = uv0;\n      gl_Position = proj * view * vec4(position, 1.0);\n    }\n  "])))),e.fragment.uniforms.add("backgroundColor","vec4").add("gridColor","vec4").add("ratio","float").add("gridWidth","float"),e.fragment.code.add(Object(o.a)(a||(a=Object(r.a)(["\n    void main() {\n      const float LINE_WIDTH = 1.0;\n\n      vec2 uvScaled = vUV * gridWidth;\n      vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));\n      vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);\n\n      // mask aliasing along edges\n      grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);\n      grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);\n\n      float gridFade = max(grid.x, grid.y);\n\n      float gridAlpha = gridColor.a * gridFade;\n\n      // premultiply alpha in output\n      gl_FragColor =\n        vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +\n        vec4(gridColor.rgb, 1.0) * gridAlpha;\n    }\n  "])))),e}var l=Object.freeze({__proto__:null,build:c})},1272:function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return v}));var n,a,r,o=i(29),s=i(34),c=i(602),l=i(256),u=i(378),h=i(217),d=i(317),p=i(263),f=i(316);function v(e){var t=new l.a;return t.include(c.a,{linearDepth:!1}),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.uniforms.add("textureCoordinateScaleFactor","vec2"),t.vertex.code.add(Object(s.a)(n||(n=Object(o.a)(["\n    void main(void) {\n      vpos = position;\n      ","\n      vTexCoord = uv0 * textureCoordinateScaleFactor;\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  "])),e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"")),t.include(h.a,e),e.multipassTerrainEnabled&&(t.fragment.include(d.a),t.include(f.b,e)),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("opacity","float"),t.varyings.add("vTexCoord","vec2"),7===e.output?t.fragment.code.add(Object(s.a)(a||(a=Object(o.a)(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n\n      float alpha = texture2D(tex, vTexCoord).a * opacity;\n      if (alpha  < ",") {\n        discard;\n      }\n\n      gl_FragColor = vec4(alpha);\n    }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",s.a.float(p.b))):(t.fragment.include(u.a),t.fragment.code.add(Object(s.a)(r||(r=Object(o.a)(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      gl_FragColor = texture2D(tex, vTexCoord) * opacity;\n\n      if (gl_FragColor.a < ",") {\n        discard;\n      }\n\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      ","\n    }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",s.a.float(p.b),e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),t}var g=Object.freeze({__proto__:null,build:v})},1312:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return s}));var n,a,r=i(29),o=i(34);function s(e){e.fragment.code.add(Object(o.a)(n||(n=Object(r.a)(["\n    float normals2FoamIntensity(vec3 n, float waveStrength){\n      float normalizationFactor =  max(0.015, waveStrength);\n      return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n    }\n  "]))))}function c(e){e.fragment.code.add(Object(o.a)(a||(a=Object(r.a)(["\n    vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\n      return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n    }\n  "]))))}},1313:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var n,a,r,o,s=i(29),c=i(34);function l(e,t){1===t.viewingMode?e.vertex.code.add(Object(c.a)(n||(n=Object(s.a)(["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return normalize(pos + origin);\n      }\n    "])))):e.vertex.code.add(Object(c.a)(a||(a=Object(s.a)(["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\n      }\n    "])))),1===t.viewingMode?e.vertex.code.add(Object(c.a)(r||(r=Object(s.a)(["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));\n            vec3 b = normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "])))):e.vertex.code.add(Object(c.a)(o||(o=Object(s.a)(["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t = vec3(1.0, 0.0, 0.0);\n            vec3 b = normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "]))))}},1314:function(e,t,i){"use strict";i.r(t),i.d(t,"createCircle",(function(){return w})),i.d(t,"createEllipse",(function(){return x})),i.d(t,"createMultipoint",(function(){return m})),i.d(t,"createPoint",(function(){return b})),i.d(t,"createPolygon",(function(){return O})),i.d(t,"createPolyline",(function(){return y})),i.d(t,"createRectangle",(function(){return _})),i.d(t,"createSquare",(function(){return j})),i.d(t,"makeMapPoint",(function(){return g}));var n=i(22),a=i(4),r=i(132),o=i(59),s=i(43),c=i(259),l=i(156),u=i(118),h=i(108),d=(i(71),i(66)),p=i(657),f=i(1200),v=i(634);function g(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(a.k)(i)?[e,t,i]:[e,t]}function b(e,t){var i=new s.a({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(i.z=e[2]),i}function m(e,t){return new c.a({points:e,spatialReference:t})}function y(e,t,i){var n=new h.a({paths:e,spatialReference:t});return i&&Object(l.i)(n),n}function O(e,t,i){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=Object(n.a)(e);s.forEach((function(e){var t=e[0],i=e[e.length-1];Object(r.c)(t,i)&&1!==e.length||e.push(e[0])}));var c=new u.a({rings:s,spatialReference:t});return c.rings.forEach((function(e){Object(l.g)(e,!1,!1)||e.reverse()})),i&&Object(l.i)(c),a&&c.isSelfIntersecting&&Object(o.i)(t)&&(c=Object(f.simplify)(c)),c}function j(e,t,i){var n=t.mapToLocalMultiple(e),r=[],o={x:n[0].x,y:n[0].y},s=n[1].x,c=n[1].y,l=Math.round(s-o.x),u=Math.round(c-o.y),h=Math.max(Math.abs(l),Math.abs(u));if(i){var d={x:o.x+h,y:o.y+h},p={x:o.x-h,y:o.y-h};r.push(Object(v.b)(d.x,p.y),Object(v.b)(p.x,p.y),Object(v.b)(p.x,d.y),Object(v.b)(d.x,d.y))}else{var f={x:l>0?o.x+h:o.x-h,y:u>0?o.y+h:o.y-h};r.push(Object(v.b)(o.x,o.y),Object(v.b)(f.x,o.y),Object(v.b)(f.x,f.y),Object(v.b)(o.x,f.y))}return O([Object(a.g)(r.map((function(e){return t.localToMap(e)})))],t.spatialReference,t.doUnnormalization,!0)}function _(e,t,i){var n=t.mapToLocalMultiple(e);if(1===n.length){var r=48,o=n[0];n=[Object(v.b)(o.x-r,o.y+r),Object(v.b)(o.x+r,o.y-r),Object(v.b)(o.x+r,o.y-r),Object(v.b)(o.x-r,o.y+r)]}var s=[],c={x:n[0].x,y:n[0].y},l={x:n[1].x,y:n[1].y};if(i){var u=Math.round(l.x-c.x),h=Math.round(l.y-c.y);s.push(Object(v.b)(c.x-u,c.y-h),Object(v.b)(l.x,c.y-h),Object(v.b)(l.x,l.y),Object(v.b)(c.x-u,l.y))}else s.push(Object(v.b)(c.x,c.y),Object(v.b)(l.x,c.y),Object(v.b)(l.x,l.y),Object(v.b)(c.x,l.y));return O([Object(a.g)(s.map((function(e){return t.localToMap(e)})))],t.spatialReference,t.doUnnormalization,!0)}function w(e,t,i,n){var r=t.mapToLocalMultiple(e),s=null,c=null;if(i)s=r[0],c=r[1];else{var u=r[0],h=r[1],g=Math.round(h.x-u.x),m=Math.round(h.y-u.y),y=Math.max(Math.abs(g),Math.abs(m));s=Object(v.b)(g>0?u.x+y/2:u.x-y/2,m>0?u.y+y/2:u.y-y/2),c=Object(v.b)(Math.abs(g)>Math.abs(m)?s.x-y/2:s.x,Math.abs(g)>Math.abs(m)?s.y:s.y-y/2)}var j=t.localToMap(s),_=t.localToMap(c);if(Object(a.j)(j)||Object(a.j)(_))return null;t.doUnnormalization&&Object(l.j)([[j,_]],t.spatialReference);var w=b(j,t.spatialReference),x=b(_,t.spatialReference),M=Object(d.d)(t.spatialReference),S=0;if(Object(o.i)(t.spatialReference))S=M*Object(f.distance)(w,x,null);else{var k=s.x-c.x,E=s.y-c.y;S=M*Math.sqrt(k*k+E*E)*(n||1)}var R=new p.a({center:w,radius:S,radiusUnit:"meters",spatialReference:t.spatialReference});return O(R.rings,R.spatialReference,!1)}function x(e,t,i){for(var n=t.mapToLocalMultiple(e),r=n[0],o=n[1],s=Math.round(o.x-r.x),c=Math.round(o.y-r.y),l=Object(v.b)(i?r.x:r.x+s/2,i?r.y:r.y+c/2),u=i?s:s/2,h=i?c:c/2,d=[],p=2*Math.PI/60,f=0;f<60;f++){var g=Math.cos(f*p),b=Math.sin(f*p),m=Object(v.b)(u*g+l.x,h*b+l.y);d.push(m)}return d.push(d[0]),O([Object(a.g)(d.map((function(e){return t.localToMap(e)})))],t.spatialReference,t.doUnnormalization,!1)}},1336:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var n,a,r=i(29),o=i(34),s=i(317);function c(e){e.fragment.uniforms.add("lastFrameColorMap","sampler2D"),e.fragment.uniforms.add("reprojectionMat","mat4"),e.fragment.uniforms.add("rpProjectionMat","mat4"),e.fragment.code.add(Object(o.a)(n||(n=Object(r.a)(["\n  vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n  {\n    vec4 zw = rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\n    vec4 reprojectedCoord = reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\n    reprojectedCoord.xy /= reprojectedCoord.w;\n    return reprojectedCoord.xy*0.5 + 0.5;\n  }\n  "]))))}function l(e,t){e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("depthMapView","sampler2D"),e.fragment.uniforms.add("ssrViewMat","mat4"),e.fragment.uniforms.add("invResolutionHeight","float"),e.fragment.include(s.a),e.include(c),e.fragment.code.add(Object(o.a)(a||(a=Object(r.a)(["\n  const int maxSteps = ","\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /= projectedCoord.w;\n    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos = startPosition;\n    vec3 viewPosEnd = startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart = applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 = 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos += dir;\n\n    vec4 projectedCoordVanishingPoint = applyProjectionMat(rpProjectionMat, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd = applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 = 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength = length(projectedCoordDir);\n    float maxSt = float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P = projectedCoordStart.xy;\n    vec3 Q = Q0;\n    float k = k0;\n    float rayStartZ = -startPosition.z; // estimated ray start depth value\n    float rayEndZ = -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ = -startPosition.z;\n    float rayDiffZ = 0.0;\n    float dDepth;\n    float depth;\n    float rayDiffZOld = 0.0;\n\n    // early outs\n    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)\n      return vec3(P, 0.0);\n\n    for(int i = 0; i < maxSteps-1; i++)\n    {\n      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ = prevEstimateZ;\n      dDepth = -rayStartZ - depth;\n      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ = rayEndZ- rayStartZ;\n      prevEstimateZ = rayEndZ;\n\n      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)\n      {\n          return vec3(P, depth);\n      }\n\n      // continue with ray marching\n      P += dP;\n      Q.z += dQ.z;\n      k += dk;\n      rayDiffZOld = rayDiffZ;\n    }\n    return vec3(P, 0.0);\n  }\n  "])),t.highStepCount?"150;":"75;"))}(c||(c={})).bindUniforms=function(e,t,i){e.setUniform1i("lastFrameColorMap",i.lastFrameColorTextureUnit),t.bindTexture(i.lastFrameColorTexture,i.lastFrameColorTextureUnit),e.setUniformMatrix4fv("reprojectionMat",i.reprojectionMat),e.setUniformMatrix4fv("rpProjectionMat",i.camera.projectionMatrix)},(l||(l={})).bindUniforms=function(e,t,i){i.ssrEnabled&&(e.setUniform1i("depthMapView",i.linearDepthTextureUnit),t.bindTexture(i.linearDepthTexture,i.linearDepthTextureUnit),e.setUniform2fv("nearFar",i.camera.nearFar),e.setUniformMatrix4fv("ssrViewMat",i.camera.viewMatrix),e.setUniform1f("invResolutionHeight",1/i.camera.height),c.bindUniforms(e,t,i))}},1337:function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));var n,a=i(29),r=i(34),o=i(1336),s=i(1312);function c(e){e.fragment.code.add(Object(r.a)(n||(n=Object(a.a)(["\n    const float GAMMA = 2.2;\n    const float INV_GAMMA = 0.4545454545;\n\n    vec4 delinearizeGamma(vec4 color) {\n      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n    }\n\n    vec3 linearizeGamma(vec3 color) {\n      return pow(color, vec3(GAMMA));\n    }\n  "]))))}var l,u,h,d=i(1164);function p(e,t){e.include(d.a,t),e.include(c),e.include(s.a),t.ssrEnabled&&e.include(o.a,t),e.fragment.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.775).add("waterSeeColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]),e.fragment.code.add(Object(r.a)(l||(l=Object(a.a)(["\n    PBRShadingWater shadingInfo;\n\n    /*\n    *   This function is an approximation for the sky gradient reflected\n    *   the water surface and describes a combination of two fresnel terms.\n    *   @parameter: cosTheta = is the result of max(dot(n,v), 0.0)\n    *   @parameter: horizon = the dominant color of the sky horizon\n    *   @parameter: cosTheta = the dominant color of the sky zenit\n    */\n    vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\n      float exponent = pow((1.0 - cosTheta), fresnelSky[2]);\n      return mix(zenit, horizon, exponent);\n    }\n\n    /*\n    *   This function determines the water color per pixel.\n    *   @parameter: n = normal facing away from the surface\n    *   @parameter: v = view direction facing away from the surface.\n    *   @parameter: l = light direction facing away from the surface\n    *   @parameter: lightIntensity = light intensity, currently between 0...PI\n    *   @parameter: localUp = a normal for the general direction of the surface\n    *   @parameter: shadow = the amount of shadow at this pixel (0 = no shadow)\n    */\n    vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {\n\n      float reflectionHit = 0.;\n      vec3 seaWaterColor = linearizeGamma(color);\n      // using half vector to determine the specular light\n      vec3 h = normalize(l + v);\n      shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);\n      shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);\n      shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);\n      shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);\n      shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);\n      shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);\n\n      // angle between vertex normal and view direction\n      float upDotV = max(dot(localUp,v), 0.0);\n      // reflected sky color: the reflected sky color consists of two main colors, the\n      // reflected color at the horizon and the reflected color of the zenit.\n      // the reflected sky color is then an approximation based on the fresnel term.\n      vec3 skyHorizon = linearizeGamma(skyColor);\n      vec3 skyZenit = linearizeGamma(skyZenitColor);\n      vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );\n\n      // we use the upDotL to smoothen out the\n      // reflected color of the water\n      float upDotL = max(dot(localUp,l),0.0);\n\n      // The approximated sky color is adjusted according to the sun position.\n      // This is done as approximation for e.g. night views.\n      float daytimeMod = 0.1 + upDotL * 0.9;\n      skyColor *= daytimeMod;\n\n      // If a water surface is in shadow we just use a slight darkening of the\n      // water surface expressed with this shadowModifier.\n      float shadowModifier = clamp(shadow, 0.8, 1.0);\n\n      // The reflected sky color consists of the fresnel reflection multiplied with the approximated sky color.\n      // The shadow is influencing the frensel term to keep the shadow impression for really near views. As long\n      // as reflection are absent there is a need to have a slight shadow for depth perception.\n      vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\n      vec3 reflSky = fresnelModifier * skyColor * shadowModifier;\n\n      // The reflected sea color is the input water color combined with the reflected sky color.\n      // The reflected sky color is modified by the incoming light.\n      vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\n\n      vec3 specular = vec3(0.0);\n      // This prevents the specular light to be rendered when:\n      // - sun is behind a polygon (e.g. sundown for elevated polygons where nDotL might be still ok)\n      // - viewer is under water (for this localUp is better than n)\n      if(upDotV > 0.0 && upDotL > 0.0) {\n        // calculate the cook torrance BRDF but with simplified occlusion\n        vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\n\n        // Normalize light intensity to be between 0...1. Shadow cancels out specular light here\n        vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;\n\n        specular = shadingInfo.NdotL * incidentLight * specularSun;\n      }\n\n      vec3 foam = vec3(0.0);\n      if(upDotV > 0.0) {\n        foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n      }\n      "])))),t.ssrEnabled?e.fragment.code.add(Object(r.a)(u||(u=Object(a.a)(["\n      // Convert the world position to view position\n      vec4 viewPosition = vec4(positionView.xyz, 1.0);\n      vec3 viewDir = normalize(viewPosition.xyz);\n      vec4 viewNormalVectorCoordinate = ssrViewMat *vec4(n, 0.0);\n      vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);\n      vec4 viewUp = ssrViewMat *vec4(localUp, 0.0);\n\n      // at steeper viewing angles we use more of a vertex normal (in this case up) then the wave normal\n      // this removes some artifacts of normal mapping\n      float correctionViewingFactor = pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);\n      vec3 viewNormalCorrected = mix(viewUp.xyz, viewNormal, correctionViewingFactor);\n\n      vec3 reflected = normalize(reflect(viewDir, viewNormalCorrected));\n\n      // perform screen space reflection to detect hit\n      vec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);\n      vec3 reflectedColor = vec3(0.0);\n\n      // if there is a hit with ssr find reflected color from the reprojeted frame\n      if (hitCoordinate.z > 0.0)\n      {\n        vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);\n\n        // fade out if there if the hit is near end of Y axis\n        vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\n        float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);\n        reflectionHit = waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;\n\n        reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;\n      }\n      float seeColorMod =  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);\n      // combining reflected sky, reflected sea, specular highlight and SSR reflections.\n      return tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);\n    }\n  "])))):e.fragment.code.add(Object(r.a)(h||(h=Object(a.a)(["\n      // combining reflected sky, reflected sea, specular highlight and SSR reflections.\n      return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);\n    }\n  "]))))}},1435:function(e,t,i){"use strict";i.r(t),i.d(t,"DrawOperation",(function(){return n.a})),i.d(t,"DrawGraphicTool",(function(){return En})),i.d(t,"GraphicMoveTool",(function(){return ur})),i.d(t,"GraphicReshapeTool",(function(){return _r})),i.d(t,"GraphicTransformTool",(function(){return Tr})),i.d(t,"ExtentTransformTool",(function(){return cs}));var n=i(638),a=i(10),r=i(2),o=i(3),s=i(5),c=i(6),l=i(0),u=i(16),h=i(4),d=i(13),p=i(17),f=i(1),v=i(8),g=(i(12),i(19),i(20),i(78)),b=i(74),m=i(25),y=i(91),O=i(221),j=i(163),_=i(588),w=i(613),x=i(634),M=i(37),S=i(39),k=i(199),E=i(97),R=i(14),P=(i(315),i(560),i(105)),T=i(376),D=function(){function e(){Object(r.a)(this,e),this.cache=new Map}return Object(o.a)(e,[{key:"dispose",value:function(){this.cache.forEach((function(e){Object(h.k)(e.texture)&&(e.texture.dispose(),e.texture=null)})),this.cache.clear()}},{key:"acquire",value:function(e){if(Object(h.j)(e))return null;var t=this.patternId(e),i=this.cache.get(t);if(i)return i.refCount++,i.bind;var n=this.patternToTextureData(e,2),a=n.length/2,r={refCount:1,texture:null,bind:function(e,t){return Object(h.j)(r.texture)&&(r.texture=new P.a(e,{width:n.length,height:1,internalFormat:6406,pixelFormat:6406,dataType:5121,wrapMode:33071},n)),e.bindTexture(r.texture,t),a}};return this.cache.set(t,r),r.bind}},{key:"release",value:function(e){if(!Object(h.j)(e)){var t=this.patternId(e),i=this.cache.get(t);i&&(i.refCount--,0===i.refCount&&(Object(h.k)(i.texture)&&i.texture.dispose(),this.cache.delete(t)))}}},{key:"swap",value:function(e,t){var i=this.acquire(t);return this.release(e),i}},{key:"patternId",value:function(e){return e.join(",")}},{key:"patternToTextureData",value:function(e,t){var i,n=e.reduce((function(e,t){return e+t}))*t,a=new Uint8Array(n),r=!0,o=0,s=Object(R.a)(e);try{for(s.s();!(i=s.n()).done;){for(var c=i.value,l=0;l<c*t;l++)a[o++]=r?255:0;r=!r}}catch(u){s.e(u)}finally{s.f()}return a}}]),e}();function A(e){return Object(h.j)(e)?e:e.slice()}var C={main:new S.a([255,127,0]),selected:new S.a([255,255,255]),staged:new S.a([12,207,255]),outline:new S.a([0,0,0,.5]),selectedOutline:new S.a([255,255,255])},I=.3;function G(e,t){var i=e.clone();return i.a*=t,i}function z(e,t){var i=e.clone(),n=Object(k.b)(i);n.s*=t;var a=Object(k.e)(n);return i.r=a.r,i.g=a.g,i.b=a.b,i}function L(e,t){if(t)for(var i in t)e[i]=t[i]}var V=function e(t){Object(r.a)(this,e),this.color=C.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=16,L(this,t)},H=function(){function e(t){Object(r.a)(this,e),this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=C.main,this.outlineColor=C.outline,this.renderOccluded=16,this.hoverOutlineColor=C.selectedOutline,L(this,t)}return Object(o.a)(e,[{key:"apply",value:function(e,t){var i=this[e];t.setParameterValues({color:X(i),transparent:"color"!==e||i.a<1,renderOccluded:this.renderOccluded})}}]),e}(),F=function e(t){Object(r.a)(this,e),this.vertex=new H({color:C.main,outlineColor:C.outline}),this.edge=new H({color:z(G(C.main,2/3),.5),outlineColor:G(C.outline,.5),size:8,collisionPadding:8}),this.selected=new H({color:C.selected,outlineColor:C.outline}),L(this,t)},U=function(){function e(t){Object(r.a)(this,e),this.color=C.selected,this.width=1.5,this.stipplePattern=A([5,5]),this.stippleOffColor=C.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=C.selected,this.renderOccluded=4,L(this,t)}return Object(o.a)(e,[{key:"apply",value:function(e){e.color=X(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=X(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=X(this.innerColor),e.renderOccluded=this.renderOccluded}}]),e}(),N=function(){function e(t){Object(r.a)(this,e),this.color=C.selected,this.size=4,this.outlineSize=1,this.outlineColor=C.outline,this.shape="square",L(this,t)}return Object(o.a)(e,[{key:"apply",value:function(e){e.color=X(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=X(this.outlineColor),e.primitive=this.shape}}]),e}(),B=function(){function e(t){Object(r.a)(this,e),this.innerColor=C.selected,this.innerWidth=1,this.glowColor=C.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=I,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=C.main,L(this,t)}return Object(o.a)(e,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i={glowColor:S.a.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:S.a.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=i:e.laserlineStyle=i}}]),e}(),q=function e(t){Object(r.a)(this,e),this.outline=new U({color:C.outline,renderOccluded:8,stippleOffColor:C.selected,stipplePattern:A([5,5]),width:1.5,innerWidth:0}),this.staged=new U({color:C.selected,renderOccluded:8,innerColor:C.staged,stippleOffColor:C.outline,stipplePattern:A([5,5]),width:1.5}),this.shadowStyle=new B({globalAlpha:I,glowColor:C.main,glowFalloff:8,glowWidth:8,innerColor:C.selected,innerWidth:1}),L(this,t)},W=function e(t){Object(r.a)(this,e),this.outline=new N({color:C.selected,outlineColor:C.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new B({globalAlpha:I,glowColor:C.main,glowFalloff:1.5,glowWidth:6,innerColor:C.selected,innerWidth:1,radius:2}),L(this,t)},Z=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this)).extensionType=2,L(Object(M.a)(n),e),n}return i}(U),Y=function e(t){Object(r.a)(this,e),this.lineGraphics=new q,this.pointGraphics=new W,this.heightPlane=new B({globalAlpha:I,glowColor:C.main,glowFalloff:8,glowWidth:8,innerColor:C.selected,innerWidth:1}),this.heightBox=new B({globalAlpha:I,glowColor:C.main,glowFalloff:8,glowWidth:8,innerColor:C.selected,innerWidth:0,heightFillColor:C.main}),this.zVerticalLine=new Z({color:G(C.main,.5),falloff:2,innerColor:G(C.selected,0),renderOccluded:4,stipplePattern:null,width:5,extensionType:2}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,L(this,t)};function X(e){return Object(E.g)(S.a.toUnitRGBA(e))}var Q=new(function(){function e(t){Object(r.a)(this,e),this.visualElements=new Y,this.reshapeManipulators=new F,this.zManipulator=new V,L(this,t)}return Object(o.a)(e,[{key:"colorToVec4",value:function(e){return X(e)}}]),e}()),J=i(27),K=i(11),$=i(141),ee=i(89),te=i(175),ie=i(237),ne=i(186),ae=i(241),re=i(623),oe=i(389),se=i(272),ce=i(88),le=i(119),ue=i(587),he=i(242),de=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,c=arguments.length>6?arguments[6]:void 0,l=arguments.length>7?arguments[7]:void 0,u=arguments.length>8?arguments[8]:void 0;Object(r.a)(this,e),this.data=t,this.material=i,this.layerUid=n,this.graphicUid=a,this.boundingSphere=Object(E.c)(),this.instanceParameters={highlights:null,occludees:null,visible:!0},this.shaderTransformationDirty=!0,this.boundingInfo=o,this.material=i,this.origin=null,this.transformation=null,this.calculateShaderTransformation=c,s&&this.updateTransformation(s,l),this.castShadow=u}return Object(o.a)(e,[{key:"updateTransformation",value:function(e,t){this.transformation=e,this.shaderTransformationDirty=!0,this.computeBoundingSphere(e,t,this.boundingSphere)}},{key:"shaderTransformationChanged",value:function(){this.shaderTransformationDirty=!0}},{key:"computeBoundingSphere",value:function(e,t,i){Object(h.j)(this.boundingInfo)||(t=t||Object(se.e)(e),Object(K.l)(i,this.boundingInfo.getCenter(),e),i[3]=this.boundingInfo.getBSRadius()*t)}},{key:"hasShaderTransformation",get:function(){return Object(h.k)(this.calculateShaderTransformation)}},{key:"primitiveType",get:function(){return this.data.primitiveType}},{key:"getShaderTransformation",value:function(){return Object(h.j)(this.calculateShaderTransformation)?Object(h.r)(this.transformation,le.a):(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=Object(le.b)()),Object(ce.c)(this.shaderTransformation,this.calculateShaderTransformation(Object(h.r)(this.transformation,le.a))),this.shaderTransformationDirty=!1),this.shaderTransformation)}},{key:"computeAttachmentOrigin",value:function(e){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,e)&&(Object(h.k)(this.transformation)&&Object(K.l)(e,e,this.transformation),!0);var t=this.indices.get("position"),i=this.vertexAttributes.get("position");return!!Object(ae.c)(i,t,e)&&(Object(h.k)(this.transformation)&&Object(K.l)(e,e,this.transformation),!0)}},{key:"indices",get:function(){return this.data.indices}},{key:"vertexAttributes",get:function(){return this.data.vertexAttributes}},{key:"addHighlight",value:function(){var e=new ue.a(0),t=this.instanceParameters;return t.highlights=Object(he.b)(t.highlights,e),e}},{key:"removeHighlight",value:function(e){var t=this.instanceParameters;t.highlights=Object(he.f)(t.highlights,e)}}]),e}(),pe=i(107),fe=i(45),ve=i(156);i(1117),i(1256);function ge(e,t,i){for(var n=e.length,a=new Array(n),r=new Array(n),o=new Array(n),s=0,c=0,l=0,u=0,h=0;h<n;++h)u+=e[h].length;for(var d=new Float64Array(3*u),p=0,f=n-1;f>=0;f--){var v=e[f],g=1===i&&me(v);if(g&&1!==n)a[s++]=v;else{for(var b=v.length,m=0;m<s;++m)b+=a[m].length;var y={index:p,pathLengths:new Array(s+1),count:b,holeIndices:new Array(s)};y.pathLengths[0]=v.length,v.length>0&&(o[l++]={index:p,count:v.length}),p=g?be(v,v.length-1,-1,d,p,v.length,t):be(v,0,1,d,p,v.length,t);for(var O=0;O<s;++O){var j=a[O];y.holeIndices[O]=p,y.pathLengths[O+1]=j.length,j.length>0&&(o[l++]={index:p,count:j.length}),p=be(j,0,1,d,p,j.length,t)}s=0,y.count>0&&(r[c++]=y)}}for(var _=0;_<s;++_){var w=a[_];w.length>0&&(o[l++]={index:p,count:w.length}),p=be(w,0,1,d,p,w.length,t)}return c<n&&(r.length=c),l<n&&(o.length=l),{position:d,polygons:r,outlines:o}}function be(e,t,i,n,a,r,o){a*=3;for(var s=0;s<r;++s){var c=e[t];n[a++]=c[0],n[a++]=c[1],n[a++]=o?c[2]:0,t+=i}return a/3}function me(e){return!Object(ve.g)(e,!1,!1)}var ye=i(169),Oe=i(620),je=i(31),_e=i(7),we=i.n(_e),xe=i(15),Me=i(139),Se=i(36),ke=i(240),Ee=i(51),Re=i(282),Pe=i(273),Te=i(60),De=i(352),Ae=i(517),Ce=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(J.e)(),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(J.g)(.57735,.57735,.57735),n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];Object(r.a)(this,e),this.intensity=t,this.direction=i,this.castShadows=n},Ie=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(J.e)(),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(J.g)(.57735,.57735,.57735);Object(r.a)(this,e),this.intensity=Object(J.e)(),this.direction=Object(J.e)(),this.intensity=t,this.direction=i},Ge=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(J.e)();Object(r.a)(this,e),this.intensity=t},ze=function e(){Object(r.a)(this,e),this.sh={r:[0],g:[0],b:[0]}},Le=i(1181),Ve=i(38),He=i(33),Fe=i(246),Ue=i(57),Ne=i(86),Be=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Object(r.a)(this,e),this._viewUp=Object(J.e)(),this._viewForward=Object(J.e)(),this._viewRight=Object(J.e)(),this._ray=Ue.f.createWrapper(),this._viewport=Object(E.d)(0,0,1,1),this._padding=Object(E.d)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Object(Te.e)(1,1e3),this._viewDirty=!0,this._viewMatrix=Object(le.b)(),this._projectionDirty=!0,this._projectionMatrix=Object(le.b)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Object(le.b)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Object(le.b)(),this._frustumDirty=!0,this._frustum=Ue.c.create(),this._fullViewport=Object(E.c)(),this.pixelRatio=1,this.relativeElevation=0,this._eye=Object(h.k)(t)?Object(J.d)(t):Object(J.e)(),this._center=Object(h.k)(i)?Object(J.d)(i):Object(J.e)(),this._up=Object(h.k)(n)?Object(J.d)(n):Object(J.g)(0,0,1)}return Object(o.a)(e,[{key:"eye",get:function(){return this._eye},set:function(e){this._compareAndSetView(e,this._eye)}},{key:"center",get:function(){return this._center},set:function(e){this._compareAndSetView(e,this._center)}},{key:"ray",get:function(){return this._ray.origin=this.eye,this._ray.direction||(this._ray.direction=Object(J.e)()),Object(K.i)(this._ray.direction,this.center,this.eye),this._ray}},{key:"up",get:function(){return this._up},set:function(e){this._compareAndSetView(e,this._up)}},{key:"viewMatrix",get:function(){return this._ensureViewClean(),this._viewMatrix},set:function(e){Object(ce.c)(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"viewForward",get:function(){return this._ensureViewClean(),this._viewForward}},{key:"viewUp",get:function(){return this._ensureViewClean(),this._viewUp}},{key:"viewRight",get:function(){return this._ensureViewClean(),this._viewRight}},{key:"nearFar",get:function(){return this._nearFar}},{key:"near",get:function(){return this._nearFar[0]},set:function(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"far",get:function(){return this._nearFar[1]},set:function(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"viewport",get:function(){return this._viewport},set:function(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}},{key:"x",get:function(){return this._viewport[0]},set:function(e){e+=this._padding[3],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"y",get:function(){return this._viewport[1]},set:function(e){e+=this._padding[2],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"width",get:function(){return this._viewport[2]},set:function(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"height",get:function(){return this._viewport[3]},set:function(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"fullWidth",get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(e){this.width=e-(this._padding[1]+this._padding[3])}},{key:"fullHeight",get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(e){this.height=e-(this._padding[0]+this._padding[2])}},{key:"fullViewport",get:function(){return this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}},{key:"aspect",get:function(){return this.width/this.height}},{key:"padding",get:function(){return this._padding},set:function(e){this._padding[0]===e[0]&&this._padding[1]===e[1]&&this._padding[2]===e[2]&&this._padding[3]===e[3]||(this._viewport[0]+=e[3]-this._padding[3],this._viewport[1]+=e[2]-this._padding[2],this._viewport[2]-=e[1]+e[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=e[0]+e[2]-(this._padding[0]+this._padding[2]),Object(ee.c)(this._padding,e),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"viewProjectionMatrix",get:function(){return this._viewProjectionDirty&&(Object(ce.l)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}},{key:"projectionMatrix",get:function(){if(this._projectionDirty){var e=this.width,t=this.height,i=this.near*Math.tan(this.fovY/2),n=i*this.aspect;Object(ce.h)(this._projectionMatrix,-n*(1+2*this._padding[3]/e),n*(1+2*this._padding[1]/e),-i*(1+2*this._padding[2]/t),i*(1+2*this._padding[0]/t),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix},set:function(e){Object(ce.c)(this._projectionMatrix,e),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"fov",get:function(){return this._fov},set:function(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"fovX",get:function(){return Object(Ne.b)(this._fov,this.width,this.height)},set:function(e){this._fov=Object(Ne.d)(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"fovY",get:function(){return Object(Ne.c)(this._fov,this.width,this.height)},set:function(e){this._fov=Object(Ne.e)(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"distance",get:function(){return Object(K.n)(this._center,this._eye)}},{key:"frustum",get:function(){return this._recomputeFrustum(),this._frustum}},{key:"viewInverseTransposeMatrix",get:function(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Object(ce.a)(this._viewInverseTransposeMatrix,this.viewMatrix),Object(ce.b)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}},{key:"depthNDCToWorld",value:function(e){var t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}},{key:"perRenderPixelRatio",get:function(){return Math.tan(this.fovX/2)/(this.width/2)}},{key:"perScreenPixelRatio",get:function(){return this.perRenderPixelRatio*this.pixelRatio}},{key:"aboveGround",get:function(){return this.relativeElevation&&this.relativeElevation>=0}},{key:"copyFrom",value:function(e){var t=e;return Object(K.j)(this._eye,t._eye),Object(K.j)(this._center,t._center),Object(K.j)(this._up,t._up),Object(ee.c)(this._viewport,t._viewport),Object(ee.c)(this._padding,t._padding),Object(He.c)(this._nearFar,t._nearFar),this._fov=t._fov,this.relativeElevation=e.relativeElevation,this._viewDirty=t._viewDirty,this._viewDirty||(Object(ce.c)(this._viewMatrix,t._viewMatrix),Object(K.j)(this._viewRight,t._viewRight),Object(K.j)(this._viewUp,t._viewUp),Object(K.j)(this._viewForward,t._viewForward)),t._projectionDirty?this._projectionDirty=!0:(Object(ce.c)(this._projectionMatrix,t._projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||(Ue.c.copy(t._frustum,this._frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Object(ce.c)(this._viewInverseTransposeMatrix,t._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Object(ee.c)(this._fullViewport,t._fullViewport),this.pixelRatio=e.pixelRatio,this}},{key:"copyViewFrom",value:function(e){this.eye=e.eye,this.center=e.center,this.up=e.up}},{key:"clone",value:function(){return(new e).copyFrom(this)}},{key:"equals",value:function(e){return Object(K.p)(this._eye,e._eye)&&Object(K.p)(this._center,e._center)&&Object(K.p)(this._up,e._up)&&Object(ee.g)(this._viewport,e._viewport)&&Object(ee.g)(this._padding,e._padding)&&Object(He.k)(this._nearFar,e._nearFar)&&this._fov===e._fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation}},{key:"almostEquals",value:function(e){if(this.pixelRatio!==e.pixelRatio||Math.abs(e.fov-this._fov)>=.001)return!1;var t=5e-4;Object(K.u)(Ze,e.eye,e.center),Object(K.u)(Ye,this._eye,this._center);var i=Object(K.g)(Ze,Ye),n=Object(K.x)(Ze),a=Object(K.x)(Ye);return i*i>=(1-1e-10)*n*a&&Object(K.y)(e.eye,this._eye)<Math.max(n,a)*t*t&&Object(ee.i)(e.padding,this._padding)<.5&&Object(ee.i)(e.viewport,this._viewport)<.5}},{key:"markViewDirty",value:function(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}},{key:"computeRenderPixelSizeAt",value:function(e){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(e))}},{key:"computeRenderPixelSizeAtDist",value:function(e){return e*this.perRenderPixelRatio}},{key:"computeScreenPixelSizeAt",value:function(e){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(e))}},{key:"viewDirectionDistance",value:function(e){return Math.abs(Object(Fe.c)(this.viewForward,Object(K.i)(Ze,e,this._eye)))}},{key:"computeScreenPixelSizeAtDist",value:function(e){return e*this.perScreenPixelRatio}},{key:"computeDistanceFromRadius",value:function(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}},{key:"getScreenCenter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(Ve.f)();return e[0]=(this.padding[3]+this.width/2)/this.pixelRatio,e[1]=(this.padding[0]+this.height/2)/this.pixelRatio,e}},{key:"getRenderCenter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return e||(e=Object(Ve.d)()),e[0]=this.padding[3]+this.width*t,e[1]=this.padding[2]+this.height*i,e.length>2&&(e[2]=.5),e}},{key:"setGLViewport",value:function(e){var t=this.viewport,i=this.padding;e.setViewport(t[0]-i[3],t[1]-i[2],t[2]+i[1]+i[3],t[3]+i[0]+i[2])}},{key:"applyProjection",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e!==qe&&Object(K.j)(qe,e),qe[3]=1,i&&(t[2]=-qe[2]),Object(ee.m)(qe,qe,this.projectionMatrix),Object(K.d)(qe,qe,1/Math.abs(qe[3]));var n=this.fullViewport;return t[0]=Object(fe.l)(0,n[0]+n[2],.5+.5*qe[0]),t[1]=Object(fe.l)(0,n[1]+n[3],.5+.5*qe[1]),i||(t[2]=.5*(qe[2]+1)),t}},{key:"projectToScreen",value:function(e,t){return this.projectToRenderScreen(e,Xe),this.renderToScreen(Xe,t)}},{key:"projectToRenderScreen",value:function(e,t){if(qe[0]=e[0],qe[1]=e[1],qe[2]=e[2],qe[3]=1,Object(ee.m)(qe,qe,this.viewProjectionMatrix),0===qe[3])return null;Object(K.d)(qe,qe,1/Math.abs(qe[3]));var i=this.fullViewport;return"x"in t?(t.x=Object(fe.l)(0,i[0]+i[2],.5+.5*qe[0]),t.y=Object(fe.l)(0,i[1]+i[3],.5+.5*qe[1])):(t[0]=Object(fe.l)(0,i[0]+i[2],.5+.5*qe[0]),t[1]=Object(fe.l)(0,i[1]+i[3],.5+.5*qe[1]),t.length>2&&(t[2]=.5*(qe[2]+1))),t}},{key:"unprojectFromScreen",value:function(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,Xe),t)}},{key:"unprojectFromRenderScreen",value:function(e,t){if(Object(ce.l)(We,this.projectionMatrix,this.viewMatrix),!Object(ce.a)(We,We))return null;var i=this.fullViewport;return qe[0]=2*(e[0]-i[0])/i[2]-1,qe[1]=2*(e[1]-i[1])/i[3]-1,qe[2]=2*e[2]-1,qe[3]=1,Object(ee.m)(qe,qe,We),0===qe[3]?null:(t[0]=qe[0]/qe[3],t[1]=qe[1]/qe[3],t[2]=qe[2]/qe[3],t)}},{key:"constrainWindowSize",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=e*this.pixelRatio,r=t*this.pixelRatio,o=Math.max(a-i*n/2,0),s=Math.max(this.fullHeight-r-i/2,0),c=-Math.min(a-i*n/2,0),l=-Math.min(this.fullHeight-r-i/2,0);return[o,s,i*n-c- -Math.min(this.fullWidth-a-i*n/2,0),i-l- -Math.min(r-i/2,0)]}},{key:"computeUp",value:function(e){1===e?this.computeUpGlobal():this.computeUpLocal()}},{key:"screenToRender",value:function(e,t){var i=e[0]*this.pixelRatio,n=this.fullHeight-e[1]*this.pixelRatio;return t[0]=i,t[1]=n,t}},{key:"renderToScreen",value:function(e,t){var i=e[0]/this.pixelRatio,n=(this.fullHeight-e[1])/this.pixelRatio;return t[0]=i,t[1]=n,t}},{key:"computeUpGlobal",value:function(){Object(K.i)(Ze,this.center,this.eye);var e=Object(K.o)(this.center);e<1?(Object(K.v)(this.up,0,0,1),this.markViewDirty()):Math.abs(Object(K.g)(Ze,this.center))>.9999*Object(K.o)(Ze)*e||(Object(K.f)(this.up,Ze,this.center),Object(K.f)(this.up,this.up,Ze),Object(K.q)(this.up,this.up),this.markViewDirty())}},{key:"computeUpLocal",value:function(){Object(se.d)(Ze,this.eye,this.center),Math.abs(Ze[2])<=.9999&&(Object(K.d)(Ze,Ze,Ze[2]),Object(K.v)(this.up,-Ze[0],-Ze[1],1-Ze[2]),Object(K.q)(this.up,this.up),this.markViewDirty())}},{key:"_compareAndSetView",value:function(e,t){Object(K.p)(e,t)||(Object(K.j)(t,e),this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0)}},{key:"_recomputeFrustum",value:function(){this._frustumDirty&&(Ue.c.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}},{key:"_ensureViewClean",value:function(){this._viewDirty&&(Object(ce.k)(this._viewMatrix,this._eye,this._center,this._up),Object(K.v)(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),Object(K.v)(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),Object(K.v)(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}]),e}(),qe=Object(E.c)(),We=Object(le.b)(),Ze=Object(J.e)(),Ye=Object(J.e)(),Xe=Object(Ve.d)(),Qe=Be,Je=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(){var e;return Object(r.a)(this,i),(e=t.apply(this,arguments)).SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,e.SCENEVIEW_LOCKING_LOG=!1,e.HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED=!0,e.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,e.DECONFLICTOR_SHOW_VISIBLE=!1,e.DECONFLICTOR_SHOW_INVISIBLE=!1,e.DECONFLICTOR_SHOW_GRID=!1,e.LABELS_SHOW_BORDER=!1,e.OVERLAY_DRAW_DEBUG_TEXTURE=!1,e.OVERLAY_SHOW_CENTER=!1,e.SHOW_POI=!1,e.TESTS_DISABLE_UPDATE_THRESHOLDS=!1,e.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1,e.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1,e.DRAW_MESH_GEOMETRY_NORMALS=!1,e.FEATURE_TILE_FETCH_SHOW_TILES=!1,e.FEATURE_TILE_TREE_SHOW_TILES=!1,e.TERRAIN_TILE_TREE_SHOW_TILES=!1,e.I3S_TREE_SHOW_TILES=!1,e.I3S_SHOW_MODIFICATIONS=!1,e.ENABLE_PROFILE_DEPTH_RANGE=!1,e.DISABLE_FAST_UPDATES=!1,e.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,e.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,e.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,e}return i}(Se.a);Object(l.a)([Object(f.b)()],Je.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),Object(l.a)([Object(f.b)()],Je.prototype,"SCENEVIEW_LOCKING_LOG",void 0),Object(l.a)([Object(f.b)()],Je.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED",void 0),Object(l.a)([Object(f.b)()],Je.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),Object(l.a)([Object(f.b)()],Je.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),Object(l.a)([Object(f.b)()],Je.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),Object(l.a)([Object(f.b)()],Je.prototype,"DECONFLICTOR_SHOW_GRID",void 0),Object(l.a)([Object(f.b)()],Je.prototype,"LABELS_SHOW_BORDER",void 0),Object(l.a)([Object(f.b)()],Je.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),Object(l.a)([Object(f.b)()],Je.prototype,"OVERLAY_SHOW_CENTER",void 0),Object(l.a)([Object(f.b)()],Je.prototype,"SHOW_POI",void 0),Object(l.a)([Object(f.b)()],Je.prototype,"TESTS_DISABLE_UPDATE_THRESHOLDS",void 0),Object(l.a)([Object(f.b)()],Je.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0),Object(l.a)([Object(f.b)()],Je.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0),Object(l.a)([Object(f.b)()],Je.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),Object(l.a)([Object(f.b)()],Je.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),Object(l.a)([Object(f.b)()],Je.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),Object(l.a)([Object(f.b)()],Je.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),Object(l.a)([Object(f.b)()],Je.prototype,"I3S_TREE_SHOW_TILES",void 0),Object(l.a)([Object(f.b)()],Je.prototype,"I3S_SHOW_MODIFICATIONS",void 0),Object(l.a)([Object(f.b)()],Je.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0),Object(l.a)([Object(f.b)()],Je.prototype,"DISABLE_FAST_UPDATES",void 0),Object(l.a)([Object(f.b)()],Je.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),Object(l.a)([Object(f.b)()],Je.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),Object(l.a)([Object(f.b)()],Je.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0);var Ke=new(Je=Object(l.a)([Object(v.a)("esri.views.3d.support.DebugFlags")],Je)),$e=i(650),et=function(){function e(t,i){Object(r.a)(this,e),this.id=Object(ke.a)(),this._renderTarget=null,this._renderTarget=new T.a(t,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:i,maxAnisotropy:8,width:0,height:0})}return Object(o.a)(e,[{key:"dispose",value:function(){this._renderTarget=Object(h.f)(this._renderTarget)}},{key:"getTexture",value:function(){return this._renderTarget?this._renderTarget.colorTexture:null}},{key:"isValid",value:function(){return null!==this._renderTarget}},{key:"resize",value:function(e,t){this._renderTarget.resize(e,t)}},{key:"bind",value:function(e){e.bindFramebuffer(this._renderTarget)}},{key:"generateMipMap",value:function(){this._renderTarget.colorTexture.descriptor.hasMipmap&&this._renderTarget.colorTexture.generateMipmap()}},{key:"disposeRenderTargetMemory",value:function(){this._renderTarget&&this._renderTarget.resize(0,0)}},{key:"getGpuMemoryUsage",value:function(){var e=0;return this._renderTarget&&(e+=Object(De.c)(this._renderTarget)),e}}]),e}(),tt=i(114),it=function e(t,i){Object(r.a)(this,e),this.vec3=t,this.id=i};function nt(e,t,i,n){return new it(Object(J.g)(e,t,i),n)}var at=function(){function e(t){Object(r.a)(this,e),this.extent=Object(tt.i)(),this.resolution=0,this.renderLocalOrigin=nt(0,0,0,"O"),this.pixelRatio=1,this.renderTargets={color:{fbo:new et(t,!0),valid:!1,lastUsed:1/0},colorWithoutRasterImage:{fbo:new et(t,!0),valid:!1,lastUsed:1/0},highlight:{fbo:new et(t,!1),valid:!1,lastUsed:1/0},water:{fbo:new et(t,!0),valid:!1,lastUsed:1/0},occluded:{fbo:new et(t,!0),valid:!1,lastUsed:1/0}}}return Object(o.a)(e,[{key:"dispose",value:function(){this.renderTargets.color.fbo.dispose(),this.renderTargets.colorWithoutRasterImage.fbo.dispose(),this.renderTargets.highlight.fbo.dispose(),this.renderTargets.water.fbo.dispose(),this.renderTargets.occluded.fbo.dispose()}},{key:"drawRenderTargets",value:function(e,t,i){var n=this.renderTargets;n.color.valid=e.drawPass(0,n.color.fbo,t),n.highlight.valid=e.drawPass(5,n.highlight.fbo,t),n.water.valid=e.drawPass(3,n.water.fbo,t),n.occluded.valid=e.drawPass(0,n.occluded.fbo,t,1),n.colorWithoutRasterImage.valid=i&&e.drawPass(0,n.colorWithoutRasterImage.fbo,t,2)}},{key:"computeRenderTargetValidityBitfield",value:function(){var e=this.renderTargets;return+e.color.valid|+e.colorWithoutRasterImage.valid<<1|+e.highlight.valid<<2|+e.water.valid<<3|+e.occluded.valid<<4}},{key:"validateUsage",value:function(e,t){if(e.valid)e.lastUsed=t;else if(t-e.lastUsed>rt)e.fbo.disposeRenderTargetMemory(),e.lastUsed=1/0;else if(e.lastUsed<1/0)return!0;return!1}},{key:"collectUnusedMemory",value:function(e){var t=!1;return t=this.validateUsage(this.renderTargets.color,e)||t,t=this.validateUsage(this.renderTargets.colorWithoutRasterImage,e)||t,t=this.validateUsage(this.renderTargets.highlight,e)||t,t=this.validateUsage(this.renderTargets.occluded,e)||t,t=this.validateUsage(this.renderTargets.water,e)||t}},{key:"getGpuMemoryUsage",value:function(){return this.renderTargets.color.fbo.getGpuMemoryUsage()+this.renderTargets.colorWithoutRasterImage.fbo.getGpuMemoryUsage()+this.renderTargets.highlight.fbo.getGpuMemoryUsage()+this.renderTargets.water.fbo.getGpuMemoryUsage()+this.renderTargets.occluded.fbo.getGpuMemoryUsage()}}]),e}(),rt=1e3,ot=i(132),st=function(){function e(){Object(r.a)(this,e),this._uniforms={proj:[],uShadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}return Object(o.a)(e,[{key:"dispose",value:function(){this._uniforms=null}},{key:"getPrograms",value:function(e){return this._uniforms[e]||[]}},{key:"subscribeProgram",value:function(e){for(var t in this._uniforms)e.hasUniform(t)&&this._uniforms[t].push(e)}},{key:"unsubscribeProgram",value:function(e){for(var t in this._uniforms)Object(ot.j)(this._uniforms[t],e)}}]),e}(),ct=function e(t){Object(r.a)(this,e),this.technique=t,this.refCount=0,this.refZeroFrame=0},lt=function(){function e(t){Object(r.a)(this,e),this._context=t,this._perConstructorInstances=new Map,this._frameCounter=0,this._keepAliveFrameCount=1200}return Object(o.a)(e,[{key:"viewingMode",get:function(){return this._context.viewingMode}},{key:"constructionContext",get:function(){return this._context}},{key:"dispose",value:function(){this._perConstructorInstances.forEach((function(e){return e.forEach((function(e){return e.technique.dispose()}))})),this._perConstructorInstances.clear()}},{key:"acquire",value:function(e,t){var i=t.key,n=this._perConstructorInstances.get(e);n||(n=new Map,this._perConstructorInstances.set(e,n));var a=n.get(i);return void 0===a&&(a=new ct(new e(this._context,t)),n.set(i,a)),++a.refCount,a.technique}},{key:"acquireAndReleaseExisting",value:function(e,t,i){return Object(h.j)(i)?this.acquire(e,t):t.key===i.key&&i instanceof e?i:(this.release(i),this.acquire(e,t))}},{key:"release",value:function(e){if(!Object(h.j)(e)){var t=this._perConstructorInstances.get(e.constructor).get(e.key);t.refCount-=1,0===t.refCount&&(t.refZeroFrame=this._frameCounter)}}},{key:"frameUpdate",value:function(){var e=this;this._frameCounter++,this._perConstructorInstances.forEach((function(t,i){t.forEach((function(i,n){0===i.refCount&&i.refZeroFrame+e._keepAliveFrameCount<e._frameCounter&&(i.technique.dispose(),t.delete(n))})),0===t.size&&e._perConstructorInstances.delete(i)}))}},{key:"getProgramsUsingUniform",value:function(e){return this._context.commonUniformStore.getPrograms(e)}},{key:"hotReload",value:function(){var e=Object(xe.a)(we.a.mark((function e(){var t,i=this;return we.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Array,this._perConstructorInstances.forEach((function(e,n){var a=function(){var e=Object(xe.a)(we.a.mark((function e(t,n){var a;return we.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.shader,e.t0=a,!e.t0){e.next=6;break}return e.next=5,a.reload();case 5:t.forEach((function(e){e.technique.reload(i._context)}));case 6:case"end":return e.stop()}}),e)})));return function(t,i){return e.apply(this,arguments)}}();t.push(a(e,n))})),e.next=4,Promise.all(t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),ut=[{output:0,name:"color"},{output:1,name:"depth"},{output:2,name:"normal"},{output:3,name:"depthShadowMap"},{output:4,name:"highlight"},{output:5,name:"draped"},{output:6,name:"occlusion"},{output:7,name:"alpha"}];function ht(e,t){return e+"_"+ut.find((function(e){return e.output===t})).name}var dt=d.a.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRep"),pt=function(){function e(t){Object(r.a)(this,e),this.refCnt=0,this.glMaterial=t}return Object(o.a)(e,[{key:"incRefCnt",value:function(){++this.refCnt}},{key:"decRefCnt",value:function(){--this.refCnt,Object(Ne.a)(this.refCnt>=0)}},{key:"getRefCnt",value:function(){return this.refCnt}},{key:"getGLMaterial",value:function(){return this.glMaterial}}]),e}(),ft=function(){function e(t,i,n){Object(r.a)(this,e),this._textureRep=t,this._techniqueRep=i,this.onMaterialChanged=n,this._id2glMaterialRef=new Map}return Object(o.a)(e,[{key:"dispose",value:function(){this._textureRep.dispose()}},{key:"acquire",value:function(e,t){this.ownMaterial(e);var i=ht(e.id,t),n=this._id2glMaterialRef.get(i);if(null==n){var a=e.getGLMaterial({material:e,techniqueRep:this._techniqueRep,textureRep:this._textureRep,output:t});return(n=new pt(a)).incRefCnt(),this._id2glMaterialRef.set(i,n),a}return n.incRefCnt(),n.getGLMaterial()}},{key:"release",value:function(e,t){var i=ht(e.id,t),n=this._id2glMaterialRef.get(i);if(n.decRefCnt(),0===n.getRefCnt()){var a=n.getGLMaterial();a&&a.dispose(),this._id2glMaterialRef.delete(i)}}},{key:"materialChanged",value:function(e){var t,i=Object(R.a)(ut);try{for(i.s();!(t=i.n()).done;){var n=t.value;if(5!==n.output&&6!==n.output){var a=this._id2glMaterialRef.get(ht(e.id,n.output));if(a&&a.getGLMaterial()){var r=a.getGLMaterial();r.updateParameters&&r.updateParameters()}}}}catch(o){i.e(o)}finally{i.f()}this.onMaterialChanged&&this.onMaterialChanged(e)}},{key:"ownMaterial",value:function(e){Object(h.k)(e.materialRepository)&&e.materialRepository!==this&&dt.error("Material is already owned by a different material repository"),e.materialRepository=this}}]),e}(),vt=i(44),gt=i(480),bt=i(488),mt=0,yt=function(){function e(){Object(r.a)(this,e),this.ROOT_ORIGIN_ID="rg_root_"+mt++,this._origins=new Map,this._gridSize=42e5}return Object(o.a)(e,[{key:"getOrigin",value:function(t){var i=this._origins.get(this.ROOT_ORIGIN_ID);if(null==i){if(Object(h.k)(e.testOrigin)){var n=e.testOrigin;return this._origins.set(this.ROOT_ORIGIN_ID,nt(n[0],n[1],n[2],this.ROOT_ORIGIN_ID)),this.getOrigin(t)}var a=nt(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);return this._origins.set(this.ROOT_ORIGIN_ID,a),a}Object(K.i)(Ot,t,i.vec3),Ot[0]=Math.abs(Ot[0]),Ot[1]=Math.abs(Ot[1]),Ot[2]=Math.abs(Ot[2]);var r=this._gridSize;if(Ot[0]<r&&Ot[1]<r&&Ot[2]<r)return i;var o=Math.round(t[0]/r),s=Math.round(t[1]/r),c=Math.round(t[2]/r),l="".concat("rg_").concat(o,"/").concat(s,"/").concat(c),u=this._origins.get(l);return u||(u=nt(o*r,s*r,c*r,l),this._origins.set(l,u)),u}},{key:"_drawOriginBox",value:function(e){var t=window.view,i=t._stage;if(null==this._object){this._material=new oe.a({width:2,color:[0,1,0,1]}),i.add(this._material);var n=new bt.a({isPickable:!1});this._object=new gt.a({castShadow:!1}),i.add(this._object),n.add(this._object),i.add(n)}for(var a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],r=a.length,o=new Array(3*r),s=new Uint16Array(2*(r-1)),c=.5*this._gridSize,l=0;l<r;l++)o[3*l+0]=e[0]+(1&a[l]?c:-c),o[3*l+1]=e[1]+(2&a[l]?c:-c),o[3*l+2]=e[2]+(4&a[l]?c:-c),l>0&&(s[2*l+0]=l-1,s[2*l+1]=l);Object($.k)(o,vt.a.WebMercator,0,o,t.spatialReference,0,r);var u=new ye.a([["position",{size:3,data:o,exclusive:!0}]],[["position",s]],2);i.add(u),this._object.addGeometry(u,this._material,le.a),console.log(this._origins.size,e)}}]),e}(),Ot=Object(J.e)();(yt||(yt={})).testOrigin=null;var jt=yt,_t=function(){function e(t,i,n,a,o,s){Object(r.a)(this,e),this.rctx=t,this.offscreenRenderingHelper=i,this.scenelightingData=n,this.shadowMap=a,this.ssaoHelper=o,this.sliceHelper=s,this.camera=null,this.lastFrameCamera=new Qe,this.pass=0,this.slot=0,this.highlightDepthTexture=null,this.renderOccludedMask=wt,this.hasOccludees=!1}return Object(o.a)(e,[{key:"resetRenderOccludedMask",value:function(){this.renderOccludedMask=wt}},{key:"isHighlightPass",get:function(){return 5===this.pass}}]),e}(),wt=13,xt=_t,Mt=i(301),St=function(){function e(){Object(r.a)(this,e),this.adds=new Me.a,this.removes=new Me.a,this.updates=new Me.a({allocator:function(e){return e||new kt},deallocator:function(e){return e.renderGeometry=null,e}})}return Object(o.a)(e,[{key:"clear",value:function(){this.adds.clear(),this.removes.clear(),this.updates.clear()}},{key:"prune",value:function(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}]),e}(),kt=function e(){Object(r.a)(this,e)},Et=function e(){Object(r.a)(this,e),this.adds=new Array,this.removes=new Array,this.updates=new Array};function Rt(e){return e.data.indexCount>=1}var Pt=i(35),Tt=i(633),Dt=i(151),At=i(235),Ct=function(){function e(t){Object(r.a)(this,e),null==t?t=16:t<65536&&(t=Object(fe.n)(t)),this._array=new Float32Array(t),this._size=0}return Object(o.a)(e,[{key:"resize",value:function(e,t){if(this._size=e,this._size>this._array.length){for(var i=this._array.length||1;i<this._size;)i*=2;var n=new Float32Array(i);return t&&n.set(this._array),this._array=n,!0}var a=2*this._size;if(a<=this._array.length){for(var r=this._array.length;r>=a;)r=Math.floor(r/2);var o=new Float32Array(r);return t&&o.set(this._array.subarray(0,r)),this._array=o,!0}return!1}},{key:"append",value:function(e){var t=this._size;this.resize(this._size+e.length,!0),this._array.set(e,t)}},{key:"erase",value:function(e,t){for(var i=e;i<t;++i)this._array[i]=0}},{key:"array",get:function(){return this._array}},{key:"size",get:function(){return this._size}}]),e}(),It=i(387),Gt=i(268),zt=i(270),Lt=i(69),Vt=i(269),Ht=i(261),Ft=i(117),Ut=i(238),Nt=i(254),Bt=i(217),qt=i(267),Wt=i(168),Zt=i(316),Yt=i(1138),Xt=i(1336),Qt=i(1265),Jt=i(1266),Kt=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e,n){var a;return Object(r.a)(this,i),(a=t.call(this,e,n)).waterTextureRepository=e.waterTextureRepository,a}return Object(o.a)(i,[{key:"initializeProgram",value:function(e){var t=i.shader.get(),n=this.configuration,a=t.build({OITEnabled:0===n.transparencyPassType,output:n.output,viewingMode:e.viewingMode,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:n.receiveShadows,pbrMode:3,useCustomDTRExponentForWater:!0,ssrEnabled:n.useSSR,highStepCount:!0,multipassTerrainEnabled:n.multipassTerrainEnabled,cullAboveGround:n.cullAboveGround});return new Ht.a(e.rctx,a.generateSource("vertex"),a.generateSource("fragment"),Vt.a)}},{key:"ensureResource",value:function(e){return this.waterTextureRepository.ready||this.waterTextureRepository.updating||this.waterTextureRepository.loadTextures(e),this.waterTextureRepository.ready?2:1}},{key:"bindPass",value:function(e,t,i){Ut.a.bindProjectionMatrix(this.program,i.camera.projectionMatrix),i.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",i.camera.nearFar),this.program.setUniform2fv("inverseViewport",i.inverseViewport),Object(Zt.a)(this.program,e,i)),0===this.configuration.output&&(i.lighting.setUniforms(this.program,!1),Xt.a.bindUniforms(this.program,e,i)),0!==this.configuration.output&&2!==this.configuration.output||(Qt.a.bindUniforms(this.program,t),this.waterTextureRepository.bindRepo(e)),this.program.setUniform4fv("waterColor",t.color),4===this.configuration.output&&qt.a.bindOutputHighlight(e,this.program,i)}},{key:"bindDraw",value:function(e){Ut.a.bindView(this.program,e),0!==this.configuration.output&&7!==this.configuration.output||Ut.a.bindCamPosition(this.program,e.origin,e.camera.viewInverseTransposeMatrix),0===this.configuration.output&&Yt.a.bindUniforms(this.program,e,Nt.a.SHADOW_MAP),0!==this.configuration.output&&7!==this.configuration.output&&4!==this.configuration.output||Bt.a.bindUniformsWithOrigin(this.program,this.configuration,e)}},{key:"setPipelineState",value:function(e){var t=this.configuration,i=3===e,n=2===e;return Object(Ft.d)({blending:2!==t.output&&4!==t.output&&t.transparent?i?Wt.f:Object(Wt.a)(e):null,depthTest:{func:Object(Wt.b)(e)},depthWrite:i?t.writeDepth&&Ft.c:Object(Wt.c)(e),colorWrite:Ft.b,polygonOffset:i||n?null:Object(Wt.g)(t.enableOffset)})}},{key:"initializePipeline",value:function(){return this.setPipelineState(this.configuration.transparencyPassType)}}]),i}(zt.a);Kt.shader=new Gt.a(Jt.a,(function(){return i.e(233).then(i.bind(null,1427))}));var $t=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(){var e;return Object(r.a)(this,i),(e=t.apply(this,arguments)).output=0,e.receiveShadows=!1,e.slicePlaneEnabled=!1,e.transparent=!1,e.enableOffset=!0,e.writeDepth=!1,e.useSSR=!1,e.isDraped=!1,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!0,e}return i}(Lt.a);Object(l.a)([Object(Lt.b)({count:8})],$t.prototype,"output",void 0),Object(l.a)([Object(Lt.b)()],$t.prototype,"receiveShadows",void 0),Object(l.a)([Object(Lt.b)()],$t.prototype,"slicePlaneEnabled",void 0),Object(l.a)([Object(Lt.b)()],$t.prototype,"transparent",void 0),Object(l.a)([Object(Lt.b)()],$t.prototype,"enableOffset",void 0),Object(l.a)([Object(Lt.b)()],$t.prototype,"writeDepth",void 0),Object(l.a)([Object(Lt.b)()],$t.prototype,"useSSR",void 0),Object(l.a)([Object(Lt.b)()],$t.prototype,"isDraped",void 0),Object(l.a)([Object(Lt.b)({count:4})],$t.prototype,"transparencyPassType",void 0),Object(l.a)([Object(Lt.b)()],$t.prototype,"multipassTerrainEnabled",void 0),Object(l.a)([Object(Lt.b)()],$t.prototype,"cullAboveGround",void 0);var ei=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e)).updateParameters(),n}return Object(o.a)(i,[{key:"updateParameters",value:function(e){this.technique=this.techniqueRep.acquireAndReleaseExisting(Kt,this.material.getTechniqueConfig(this.output,e),this.technique)}},{key:"beginSlot",value:function(e){if(2===this.output)return 22===e;if(5===this.output)return null==e;if(4===this.output)return 3===e;var t=3;return this.material.params.transparent&&(t=this.material.params.writeDepth?5:8),e===t}},{key:"setElapsedTimeUniform",value:function(e){var t=.001*this.material.animation.time;e.setUniform1f("timeElapsed",t*this.material.params.animationSpeed)}},{key:"_updateShadowState",value:function(e){e.shadowMappingEnabled!==this.material.params.receiveShadows&&this.material.setParameterValues({receiveShadows:e.shadowMappingEnabled})}},{key:"_updateSSRState",value:function(e){e.ssrEnabled!==this.material.params.ssrEnabled&&this.material.setParameterValues({ssrEnabled:e.ssrEnabled})}},{key:"ensureResources",value:function(e){return this.technique.ensureResource(e)}},{key:"ensureParameters",value:function(e){0===this.output&&(this._updateShadowState(e),this._updateSSRState(e)),this.updateParameters(e)}},{key:"bind",value:function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.params,t),2!==this.output&&0!==this.output||this.setElapsedTimeUniform(this.technique.program)}}]),i}(It.a),ti=function e(t,i,n,a,o,s){Object(r.a)(this,e),this.from=t,this.to=i,this.isVisible=n,this.hasHighlights=a,this.hasOccludees=o,this.transformation=s,null!=s&&(this.transformationNormal=Object(le.c)(s),Object(ce.a)(this.transformationNormal,this.transformationNormal),Object(ce.b)(this.transformationNormal,this.transformationNormal))};function ii(e,t){var i=function(e){return{first:e.from,count:e.to-e.from}};if(0!==e.length){var n=e[e.length-1];if(function(e,t){return e.first+e.count>=t.from}(n,t)){var a=t.from-n.first+t.to-t.from;n.count=a}else e.push(i(t))}else e.push(i(t))}var ni=i(90),ai=i(412);function ri(e,t,i){Object(h.k)(i)&&(i.drawCalls+=e,i.triangles+=t)}ai.a;var oi=function(){function e(t,i,n){Object(r.a)(this,e),this.type="MergedRenderer",this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._rctx=t,this._material=n,this._materialRep=i,this._glMaterials=Object(he.a)(this._material,this._materialRep),this._bufferWriter=n.createBufferWriter()}return Object(o.a)(e,[{key:"dispose",value:function(){Object(he.e)(this._material,this._materialRep),this._dataByOrigin&&(this._dataByOrigin.forEach((function(e){e.vao.dispose(!0),e.vao=null})),this._dataByOrigin.clear(),this._dataByOrigin=null),this._glMaterials&&(this._glMaterials.forEach((function(e){e&&e.dispose()})),this._glMaterials.clear(),this._glMaterials=null)}},{key:"isEmpty",get:function(){return 0===this._dataByOrigin.size}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasOccludees",get:function(){return this._hasOccludees}},{key:"hasWater",get:function(){return!this.isEmpty&&Object(Pe.a)(this._glMaterials,(function(e){return e instanceof ei}))}},{key:"rendersOccluded",get:function(){return!this.isEmpty&&1!==this._material.renderOccluded}},{key:"modify",value:function(e){this.updateGeometries(e.updates),this.addAndRemoveGeometries(e.adds,e.removes),this.updateRenderCommands()}},{key:"addAndRemoveGeometries",value:function(e,t){var i=this,n=this._bufferWriter,a=n.vertexBufferLayout,r=a.stride/4,o=this._dataByOrigin,s=function(e,t,i,n){var a,r=new Map,o=t.vertexBufferLayout.stride/4,s=function(i,n){var a=i.origin,s=e.get(a.id),c=r.get(a.id);null==c&&(c={optimalCount:null==s?0:s.optimalCount,sparseCount:null==s?0:s.buffer.size,toAdd:[],toRemove:[],origin:a.vec3},r.set(a.id,c));var l=t.elementCount(i.data)*o;n?(c.optimalCount+=l,c.sparseCount+=l,c.toAdd.push(i)):(c.optimalCount-=l,c.toRemove.push(i))},c=Object(R.a)(i);try{for(c.s();!(a=c.n()).done;){s(a.value,!0)}}catch(h){c.e(h)}finally{c.f()}var l,u=Object(R.a)(n);try{for(u.s();!(l=u.n()).done;){s(l.value,!1)}}catch(h){u.e(h)}finally{u.f()}return r}(o,n,e,t);s.forEach((function(e,t){s.delete(t);var n=e.optimalCount,c=e.sparseCount,l=o.get(t);if(null==l)Object(Ne.a)(n>0),l=i.createData(a,n,e.origin),o.set(t,l);else if(0===n)return l.vao.dispose(!0),l.vao=null,void o.delete(t);var u=n<e.sparseCount/2,h=u?n:c,d=ci,p=l.buffer.size,f=l.buffer.array,v=l.buffer.resize(h,!1);u||v?i.removeAndRebuild(l,e.toRemove,r,f,d):e.toRemove.length>0?(i.removeByErasing(l,e.toRemove,r,d),e.toAdd.length>0&&(d.end=p)):(d.begin=p,d.end=p);var g=li;Object(Ne.j)(g,-e.origin[0],-e.origin[1],-e.origin[2]),i.append(l,e.toAdd,r,g,d);var b=l.vao.vertexBuffers.geometry;if(b.byteSize!==l.buffer.array.buffer.byteLength)b.setData(l.buffer.array);else{var m=d.begin,y=d.end;if(m<y){var O=l.buffer.array,j=4*m,_=4*y;b.setSubData(O,j,j,_)}}l.drawCommandsDirty=!0}))}},{key:"updateGeometries",value:function(e){var t,i=this._bufferWriter,n=i.vertexBufferLayout.stride/4,a=Object(R.a)(e);try{for(a.s();!(t=a.n()).done;){var r=t.value,o=r.updateType,s=r.renderGeometry,c=this._dataByOrigin.get(s.origin.id),l=c&&c.instances.get(s.id);if(!l)return;if(1&o&&(l.isVisible=s.instanceParameters.visible),9&o){var u=s.instanceParameters.visible;l.hasHighlights=!!s.instanceParameters.highlights&&u}if(16&o&&(l.hasOccludees=!!s.instanceParameters.occludees),6&o){var h=c.buffer.array,d=c.vao;Object(he.c)(s,ui,hi),i.write({transformation:ui,invTranspTransformation:hi},s.data,i.vertexBufferLayout.createView(h.buffer),l.from),Object(Ne.a)(l.from+i.elementCount(s.data)===l.to,"material VBO layout has changed"),d.vertexBuffers.geometry.setSubData(h,l.from*n*4,l.from*n*4,l.to*n*4)}c.drawCommandsDirty=!0}}catch(p){a.e(p)}finally{a.f()}}},{key:"updateRenderCommands",value:function(){var e=this;this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((function(t){t.hasHiddenInstances=!1,t.hasHighlights=!1,t.hasOccludees=!1,Object(Pe.a)(t.instances,(function(i){return i.isVisible?(i.hasHighlights&&(e._hasHighlights=!0,t.hasHighlights=!0),i.hasOccludees&&(e._hasOccludees=!0,t.hasOccludees=!0)):t.hasHiddenInstances=!0,t.hasHiddenInstances&&t.hasHighlights&&t.hasOccludees}))}));this._dataByOrigin.forEach((function(e){e.drawCommandsDirty&&(function(e){if(e.drawCommandsDefault=null,e.drawCommandsHighlight=null,e.drawCommandsOccludees=null,e.drawCommandsShadowHighlightRest=null,e.stats={default:0,highlight:0,occludees:0,shadowHighlightRest:0},0!==e.instances.size){if(!si(e)){var t=4*e.buffer.size/Object(De.d)(e.vao.layout.geometry);return e.drawCommandsDefault=[{first:0,count:t}],void(e.stats={default:t,highlight:0,occludees:0,shadowHighlightRest:0})}var i=function(e){return e.sort((function(e,t){return e.from===t.from?e.to>t.to?1:e.to<t.to?-1:0:e.from>t.from?1:e.from<t.from?-1:0}))}(Object(Pt.a)(e.instances.values()));e.drawCommandsDefault=[],e.drawCommandsHighlight=[],e.drawCommandsOccludees=[],e.drawCommandsShadowHighlightRest=[];var n,a=Object(R.a)(i);try{for(a.s();!(n=a.n()).done;){var r=n.value;r.isVisible&&(r.hasOccludees?ii(e.drawCommandsOccludees,r):ii(e.drawCommandsDefault,r),r.hasHighlights?ii(e.drawCommandsHighlight,r):ii(e.drawCommandsShadowHighlightRest,r))}}catch(s){a.e(s)}finally{a.f()}var o=function(e){var t,i=0,n=Object(R.a)(e);try{for(n.s();!(t=n.n()).done;)i+=t.value.count}catch(s){n.e(s)}finally{n.f()}return i/3};e.stats={default:o(e.drawCommandsDefault),highlight:o(e.drawCommandsHighlight),occludees:o(e.drawCommandsOccludees),shadowHighlightRest:o(e.drawCommandsShadowHighlightRest)}}}(e),e.drawCommandsDirty=!1)}))}},{key:"updateLogic",value:function(e){return this._material.update(e)}},{key:"render",value:function(e,t,i,n){var a=this,r=this._rctx,o=this._glMaterials.get(t.pass),s=5===t.pass||7===t.pass,c=6===t.pass,l=!(s||c),u=e;if(3===t.pass&&null===u&&(u=22),!o||2!==o.ensureResources(r)||null!=u&&!o.beginSlot(u)||s&&!this._hasHighlights)return!1;o.ensureParameters(i);var d=o.getTechnique(),p=o.getPipelineState(u,!1);r.setPipelineState(p),o.bind(r,i);var f=!1;return this._dataByOrigin.forEach((function(e){if(!(Object(h.j)(e.drawCommandsDefault)&&Object(h.j)(e.drawCommandsHighlight)&&Object(h.j)(e.drawCommandsOccludees)&&Object(h.j)(e.drawCommandsShadowHighlightRest))&&(!s||e.hasHighlights)){i.origin=e.origin,d.bindDraw(i),d.ensureAttributeLocations(e.vao),r.bindVAO(e.vao);var t=d.primitiveType,v=s?e.drawCommandsHighlight:c&&si(e)?e.drawCommandsShadowHighlightRest:e.drawCommandsDefault,g=s?e.stats.highlight:c&&si(e)?e.stats.shadowHighlightRest:e.stats.default;if(Object(h.k)(v)&&(a.renderCommands(r,t,v),ri(v.length,g,n),f=!0),l&&(v=e.drawCommandsOccludees,Object(h.k)(v))){var b=o.getPipelineState(u,!0);r.setPipelineState(b),a.renderCommands(r,t,v),r.setPipelineState(p),ri(v.length,e.stats.occludees,n),f=!0}}})),f}},{key:"renderCommands",value:function(e,t,i){for(var n=0;n<i.length;n++)e.drawArrays(t,i[n].first,i[n].count)}},{key:"createData",value:function(e,t,i){return{instances:new Map,vao:new At.a(this._rctx,this._material.vertexAttributeLocations,{geometry:Object(Tt.a)(e)},{geometry:Dt.a.createVertex(this._rctx,35044)}),buffer:new Ct(t),optimalCount:0,origin:i,hasHiddenInstances:!1,hasHighlights:!1,hasOccludees:!1,drawCommandsDirty:!1,drawCommandsDefault:null,drawCommandsOccludees:null,drawCommandsHighlight:null,drawCommandsShadowHighlightRest:null,stats:{default:0,highlight:0,occludees:0,shadowHighlightRest:0}}}},{key:"removeAndRebuild",value:function(e,t,i,n,a){var r,o=Object(R.a)(t);try{for(o.s();!(r=o.n()).done;){var s=r.value.id,c=e.instances.get(s);e.optimalCount-=(c.to-c.from)*i,e.instances.delete(s)}}catch(f){o.e(f)}finally{o.f()}var l=0,u=e.buffer.array;a.begin=0,a.end=0;var h=-1,d=-1,p=0;e.instances.forEach((function(e){var t=e.from*i,a=e.to*i,r=a-t;h!==d&&d!==t?(u.set(n.subarray(h,d),p),p+=d-h,h=t):-1===h&&(h=t),d=a,e.from=l/i,l+=r,e.to=l/i})),h!==d&&u.set(n.subarray(h,d),p),a.end=l}},{key:"removeByErasing",value:function(e,t,i,n){n.begin=1/0,n.end=-1/0;var a,r=-1,o=-1,s=Object(R.a)(t);try{for(s.s();!(a=s.n()).done;){var c=a.value.id,l=e.instances.get(c),u=l.from*i,h=l.to*i;r!==o&&o!==u?(e.buffer.erase(r,o),r=u):-1===r&&(r=u),o=h,e.instances.delete(c),e.optimalCount-=h-u,u<n.begin&&(n.begin=u),h>n.end&&(n.end=h)}}catch(d){s.e(d)}finally{s.f()}r!==o&&e.buffer.erase(r,o)}},{key:"append",value:function(e,t,i,n,a){var r,o=this._bufferWriter,s=Object(R.a)(t);try{for(s.s();!(r=s.n()).done;){var c=r.value,l=Object(h.k)(c.transformation)?Object(ce.l)(ui,n,c.transformation):n;Object(ce.a)(hi,l),Object(ce.b)(hi,hi);var u=a.end;o.write({transformation:l,invTranspTransformation:hi},c.data,o.vertexBufferLayout.createView(e.buffer.array.buffer),a.end/i);var d=o.elementCount(c.data)*i,p=u+d;Object(Ne.a)(null==e.instances.get(c.id));var f=c.instanceParameters.visible,v=!!c.instanceParameters.highlights&&f,g=!!c.instanceParameters.occludees,b=new ti(u/i,p/i,f,v,g);e.instances.set(c.id,b),e.optimalCount+=d,a.end+=d}}catch(m){s.e(m)}finally{s.f()}}},{key:"test",get:function(){return{material:this._material,glMaterials:this._glMaterials}}}]),e}();function si(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}var ci={begin:0,end:0},li=Object(le.b)(),ui=Object(le.b)(),hi=Object(le.b)(),di=oi,pi=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(){var e;return Object(r.a)(this,i),(e=t.apply(this,arguments))._pendingAddsRemoves=new Map,e._changes=new St,e._materialRenderers=new Map,e._sortedMaterialRenderers=new Me.a,e._hasHighlights=!1,e._hasWater=!1,e}return Object(o.a)(i,[{key:"dispose",value:function(){this._changes.prune(),this._materialRenderers&&(this._materialRenderers.forEach((function(e){return e.dispose()})),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear())}},{key:"updating",get:function(){return this._pendingAddsRemoves.size>0||this._changes.updates.length>0}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return Object(Pe.a)(this._materialRenderers,(function(e){return e.rendersOccluded}))}},{key:"stopAnimationsAtTime",value:function(e){this._sortedMaterialRenderers.forAll((function(t){return Object(h.c)(t.material.animation,(function(t){return t.stopAtTime(e)}))}))}},{key:"isEmpty",get:function(){return!this.updating&&0===this._materialRenderers.size}},{key:"commitChanges",value:function(){var e=this,t=!1;if(!this.updating)return!1;this.updateAddsRemoves();var i=function(e){var t=new Map,i=function(e){var i=t.get(e);return i||(i=new Et,t.set(e,i)),i};return e.adds.forAll((function(e){Rt(e)&&i(e.material).adds.push(e)})),e.removes.forAll((function(e){Rt(e)&&i(e.material).removes.push(e)})),e.updates.forAll((function(e){Rt(e.renderGeometry)&&i(e.renderGeometry.material).updates.push(e)})),t}(this._changes),n=!1,a=!1;return i.forEach((function(i,r){var o=e._materialRenderers.get(r);if(!o&&i.adds.length>0&&(o=new di(e.rctx,e.materialRepository,r),e._materialRenderers.set(r,o),t=!0,n=!0,a=!0),o){var s=n||o.hasHighlights,c=a||o.hasWater;o.modify(i),n=n||s!==o.hasHighlights,a=a||c!==o.hasWater,o.isEmpty&&(e._materialRenderers.delete(r),o.dispose(),t=!0)}})),this._changes.clear(),this._pendingAddsRemoves.clear(),t&&this.updateSortedMaterialRenderers(),n&&(this._hasHighlights=Object(Pe.a)(this._materialRenderers,(function(e){return e.hasHighlights}))),a&&(this._hasWater=Object(Pe.a)(this._materialRenderers,(function(e){return e.hasWater}))),this.notifyChange("updating"),!0}},{key:"add",value:function(e){if(0!==e.length){var t,i=0===this._pendingAddsRemoves.size,n=Object(R.a)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;this._pendingAddsRemoves.set(a,0)}}catch(r){n.e(r)}finally{n.f()}i&&this.notifyChange("updating")}}},{key:"remove",value:function(e){var t,i=0===this._pendingAddsRemoves.size,n=Object(R.a)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value,r=this._pendingAddsRemoves.get(a);0===r?this._pendingAddsRemoves.set(a,2):2!==r&&this._pendingAddsRemoves.set(a,1)}}catch(o){n.e(o)}finally{n.f()}i&&this._pendingAddsRemoves.size>0&&this.notifyChange("updating")}},{key:"modify",value:function(e,t){var i,n=0===this._changes.updates.length,a=Object(R.a)(e);try{for(a.s();!(i=a.n()).done;){var r=i.value,o=this._changes.updates.pushNew();o.renderGeometry=r,o.updateType=t}}catch(s){a.e(s)}finally{a.f()}n&&this._changes.updates.length>0&&this.notifyChange("updating")}},{key:"updateLogic",value:function(e){var t=!1;return this._sortedMaterialRenderers.forAll((function(i){var n=i.materialRenderer;n.updateLogic&&n.updateLogic(e)&&(t=!0)})),t}},{key:"draw",value:function(e,t){for(var i=0;i<this._sortedMaterialRenderers.length;i++){var n=this._sortedMaterialRenderers.data[i];Object(Mt.c)(n.material,e)&&n.materialRenderer.render(null,e,t,null)}}},{key:"updateSortedMaterialRenderers",value:function(){var e=this;this._sortedMaterialRenderers.clear();var t=0;this._materialRenderers.forEach((function(i,n){n.insertOrder=t++,e._sortedMaterialRenderers.push({material:n,materialRenderer:i})})),this._sortedMaterialRenderers.sort((function(e,t){var i=t.material.renderPriority-e.material.renderPriority;return 0!==i?i:e.material.insertOrder-t.material.insertOrder}))}},{key:"updateAddsRemoves",value:function(){var e=this;this._changes.adds.clear(),this._changes.removes.clear(),this._pendingAddsRemoves.forEach((function(t,i){switch(t){case 0:e._changes.adds.push(i);break;case 1:e._changes.removes.push(i)}}));for(var t=0;t<this._changes.updates.length;){var i=this._changes.updates.data[t].renderGeometry;this._pendingAddsRemoves.has(i)?this._changes.updates.removeUnorderedIndex(t):t++}}},{key:"test",get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}}]),i}(Se.a);Object(l.a)([Object(f.b)()],pi.prototype,"rctx",void 0),Object(l.a)([Object(f.b)()],pi.prototype,"materialRepository",void 0),Object(l.a)([Object(f.b)()],pi.prototype,"updating",null),pi=Object(l.a)([Object(v.a)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],pi);var fi=i(1267),vi=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(){return Object(r.a)(this,i),t.apply(this,arguments)}return Object(o.a)(i,[{key:"initializeProgram",value:function(e){var t=i.shader.get().build();return new Ht.a(e.rctx,t.generateSource("vertex"),t.generateSource("fragment"),Vt.a)}},{key:"initializePipeline",value:function(){return this.configuration.hasAlpha?Object(Ft.d)({blending:Object(Ft.e)(770,1,771,771),colorWrite:Ft.b}):Object(Ft.d)({colorWrite:Ft.b})}}]),i}(zt.a);vi.shader=new Gt.a(fi.a,(function(){return i.e(222).then(i.bind(null,1428))}));var gi=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(){var e;return Object(r.a)(this,i),(e=t.apply(this,arguments)).hasAlpha=!1,e}return i}(Lt.a);function bi(e,t,i){(i=i||e).length=e.length;for(var n=0;n<e.length;n++)i[n]=e[n]*t[n];return i}function mi(e,t,i){(i=i||e).length=e.length;for(var n=0;n<e.length;n++)i[n]=e[n]*t;return i}function yi(e,t,i){(i=i||e).length=e.length;for(var n=0;n<e.length;n++)i[n]=e[n]+t[n];return i}function Oi(e){return(e+1)*(e+1)}function ji(e,t,i){var n=e[0],a=e[1],r=e[2],o=i||[];return o.length=Oi(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*n,o[2]=.4886025119*r,o[3]=.4886025119*a),t>=2&&(o[4]=1.09254843059*n*a,o[5]=1.09254843059*a*r,o[6]=.31539156525*(3*r*r-1),o[7]=1.09254843059*n*r,o[8]=.54627421529*(n*n-a*a)),o}function _i(e,t){var i,n=function(e){return Object(fe.d)(Math.floor(Math.sqrt(e)-1),0,2)}(t.r.length),a=Object(R.a)(e);try{for(a.s();!(i=a.n()).done;){var r=i.value;Object(K.s)(Ri,r.direction),ji(Ri,n,ki),bi(ki,Pi),mi(ki,r.intensity[0],Ei),yi(t.r,Ei),mi(ki,r.intensity[1],Ei),yi(t.g,Ei),mi(ki,r.intensity[2],Ei),yi(t.b,Ei)}}catch(o){a.e(o)}finally{a.f()}return t}function wi(e,t,i){(function(e,t){var i=Oi(e),n=t||{r:[],g:[],b:[]};n.r.length=n.g.length=n.b.length=i;for(var a=0;a<i;a++)n.r[a]=n.g[a]=n.b[a]=0})(t,i.sphericalHarmonics.sh),Object(K.v)(i.main.intensity,0,0,0);var n=!1,a=xi,r=Mi,o=Si;a.length=0,r.length=0,o.length=0;var s,c=Object(R.a)(e);try{for(c.s();!(s=c.n()).done;){var l=s.value;l instanceof Ce&&!n?(Object(K.j)(i.main.direction,l.direction),i.main.intensity[0]=l.intensity[0],i.main.intensity[1]=l.intensity[1],i.main.intensity[2]=l.intensity[2],i.main.castShadows=l.castShadows,n=!0):l instanceof Ce||l instanceof Ie?a.push(l):l instanceof Ge?r.push(l):l instanceof ze&&o.push(l)}}catch(p){c.e(p)}finally{c.f()}_i(a,i.sphericalHarmonics.sh),function(e,t){ji(Ri,0,ki);var i,n=Object(R.a)(e);try{for(n.s();!(i=n.n()).done;){var a=i.value;t.r[0]+=ki[0]*Pi[0]*a.intensity[0]*4*Math.PI,t.g[0]+=ki[0]*Pi[0]*a.intensity[1]*4*Math.PI,t.b[0]+=ki[0]*Pi[0]*a.intensity[2]*4*Math.PI}}catch(p){n.e(p)}finally{n.f()}}(r,i.sphericalHarmonics.sh);var u,h=Object(R.a)(o);try{for(h.s();!(u=h.n()).done;){var d=u.value;yi(i.sphericalHarmonics.sh.r,d.sh.r),yi(i.sphericalHarmonics.sh.g,d.sh.g),yi(i.sphericalHarmonics.sh.b,d.sh.b)}}catch(p){h.e(p)}finally{h.f()}}Object(l.a)([Object(Lt.b)()],gi.prototype,"hasAlpha",void 0);var xi=[],Mi=[],Si=[],ki=[0],Ei=[0],Ri=Object(J.e)(),Pi=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398],Ti=Object(J.e)(),Di=function(){function e(){Object(r.a)(this,e),this._renderLighting={main:{intensity:Object(J.e)(),direction:Object(J.g)(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}},this._shOrder=2,this._oldSunlight={direction:Object(J.e)(),ambient:{color:Object(J.e)(),intensity:0},diffuse:{color:Object(J.e)(),intensity:0}}}return Object(o.a)(e,[{key:"setLightDirectionUniform",value:function(e){e.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction)}},{key:"setUniforms",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t){var i=(1-this._info.groundLightingFactor)*(1-this._info.globalFactor);e.setUniform1f("lightingFixedFactor",i)}else e.setUniform1f("lightingFixedFactor",0);e.setUniform1f("lightingGlobalFactor",this._info.globalFactor),this.setLightDirectionUniform(e),e.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity),e.setUniform1f("ambientBoostFactor",.4);var n=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",n.r[0],n.g[0],n.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",n.r[0],n.r[1],n.r[2],n.r[3]),e.setUniform4f("lightingAmbientSH_G",n.g[0],n.g[1],n.g[2],n.g[3]),e.setUniform4f("lightingAmbientSH_B",n.b[0],n.b[1],n.b[2],n.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",n.r[0],n.g[0],n.b[0]),e.setUniform4f("lightingAmbientSH_R1",n.r[1],n.r[2],n.r[3],n.r[4]),e.setUniform4f("lightingAmbientSH_G1",n.g[1],n.g[2],n.g[3],n.g[4]),e.setUniform4f("lightingAmbientSH_B1",n.b[1],n.b[2],n.b[3],n.b[4]),e.setUniform4f("lightingAmbientSH_R2",n.r[5],n.r[6],n.r[7],n.r[8]),e.setUniform4f("lightingAmbientSH_G2",n.g[5],n.g[6],n.g[7],n.g[8]),e.setUniform4f("lightingAmbientSH_B2",n.b[5],n.b[6],n.b[7],n.b[8]))}},{key:"set",value:function(e){this._info=e,wi(e.lights,this._shOrder,this._renderLighting),Object(K.s)(this._oldSunlight.direction,this._renderLighting.main.direction);var t=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*t,this._oldSunlight.ambient.color[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*t,this._oldSunlight.ambient.color[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*t,this._oldSunlight.ambient.intensity=1,this._oldSunlight.diffuse.color[0]=this._renderLighting.main.intensity[0]*t,this._oldSunlight.diffuse.color[1]=this._renderLighting.main.intensity[1]*t,this._oldSunlight.diffuse.color[2]=this._renderLighting.main.intensity[2]*t,this._oldSunlight.diffuse.intensity=1;var i=Object(K.j)(Ti,this._oldSunlight.diffuse.color);Object(K.d)(i,i,.4*this._info.globalFactor),Object(K.e)(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,i)}},{key:"globalFactor",get:function(){return this._info.globalFactor}},{key:"old",get:function(){return this._oldSunlight}}]),e}(),Ai=d.a.getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer"),Ci=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e))._overlays=null,n._hasHighlights=!1,n._rendersOccluded=!1,n._hasWater=!1,n._lighting=new Di,n._localOrigins=new jt,n._handles=new Ee.a,n._layerRenderers=new Map,n._sortedLayerRenderersDirty=!1,n._sortedLayerRenderers=new Me.a,n._geometries=new Map,n.globalUnitScale=1,n.longitudeCyclical=null,n}return Object(o.a)(i,[{key:"initialize",value:function(){var e=this;this._rctx=this.renderView.renderingContext,this._renderContext=new xt(this._rctx,null,null,null,null,null),this._stippleTextureRepository=new D,this.waterTextureRepository=this.renderView.waterTextureRepository,this._shaderTechniqueRepository=new lt({rctx:this._rctx,viewingMode:2,commonUniformStore:new st,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),Object(m.a)(this.waterTextureRepository,"loadingState",(function(){return e.emitContentChanged()})),this._materialRepository=new ft(this.renderView.textureRepository,this._shaderTechniqueRepository),this._materialRepository.onMaterialChanged=function(t){(t.renderOccluded&Hi)>0!==e._rendersOccluded&&e.updateRendersOccluded(),e.emitContentChanged(),e.notifyChange("updating")},this._compositingHelper=this.renderView.compositingHelper,this._lighting.set({lights:[new Ge(Object(J.g)(1,1,1))],groundLightingFactor:1,globalFactor:0}),this._bindParameters={slot:null,highlightDepthTexture:Object(Ae.a)(this._rctx),camera:zi,inverseViewport:Object(Te.a)(),origin:null,screenToWorldRatio:null,screenToWorldRatioGlobalWM:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,hasOccludees:!1,linearDepthTexture:null,linearDepthTextureUnit:0,lastFrameColorTexture:null,lastFrameColorTextureUnit:0,reprojectionMat:null,ssrEnabled:!1,lighting:this._lighting,transparencyPassType:3,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,cullAboveGround:!0,multipassGeometryEnabled:!1},this._handles.add(this.scheduler.registerTask(Re.b.STAGE,(function(){return e.commitChanges()}),(function(){return e.updating})))}},{key:"dispose",value:function(){this._handles.destroy(),this._layerRenderers.forEach((function(e){return e.dispose()})),this._layerRenderers.clear(),this._bindParameters.highlightDepthTexture=Object(h.f)(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Object(h.f)(this._shaderTechniqueRepository),this._temporaryRenderTarget=Object(h.f)(this._temporaryRenderTarget),this._debugPatternTexture=Object(h.f)(this._debugPatternTexture),this._quadVAO=Object(h.f)(this._quadVAO)}},{key:"updating",get:function(){return this._sortedLayerRenderersDirty||Object(Pe.a)(this._layerRenderers,(function(e){return e.updating}))||this.waterTextureRepository.updating}},{key:"hasOverlays",get:function(){return Object(h.k)(this._overlays)}},{key:"gpuMemoryUsage",get:function(){return Object(h.k)(this._overlays)?this._overlays[0].getGpuMemoryUsage()+this._overlays[1].getGpuMemoryUsage():0}},{key:"overlays",get:function(){return this._overlays}},{key:"forEachOverlay",value:function(e){Object(h.k)(this._overlays)&&(e(this._overlays[0],0),e(this._overlays[1],1))}},{key:"ensureOverlays",value:function(){if(Object(h.j)(this._overlays)){var e=this.renderView.renderingContext;this._overlays=[new at(e),new at(e)]}}},{key:"disposeOverlays",value:function(){Object(h.k)(this._overlays)&&(this._overlays.forEach((function(e){return e.dispose()})),this._overlays=null)}},{key:"commitChanges",value:function(){var e=this,t=!1;this._layerRenderers.forEach((function(i,n){i.commitChanges()&&(t=!0),i.isEmpty&&(e._layerRenderers.delete(n),e._sortedLayerRenderersDirty=!0,e._handles.remove(n))})),this._sortedLayerRenderersDirty&&(this.updateSortedLayerRenderers(),t=!0),t&&(this.notifyChange("updating"),this.emitContentChanged(),this.updateHasHighlights(),this.updateRendersOccluded(),this.updateHasWater())}},{key:"addGeometries",value:function(e,t,i){var n,a=Object(R.a)(e);try{for(a.s();!(n=a.n()).done;){var r=n.value;null==r.origin&&(r.origin=this._localOrigins.getOrigin(r.boundingSphere)),Object(h.j)(r.id)&&(r.id=Object(ke.a)()),this._geometries.set(r.id,r)}}catch(o){a.e(o)}finally{a.f()}this.ensureLayerRenderer(t).add(e),2===i&&this.notifyGraphicGeometryChanged(e,t)}},{key:"removeGeometries",value:function(e,t,i){var n,a=Object(R.a)(e);try{for(a.s();!(n=a.n()).done;){var r=n.value;this._geometries.delete(Object(h.q)(r.id))}}catch(s){a.e(s)}finally{a.f()}var o=this._layerRenderers.get(t);o&&(o.remove(e),2===i&&this.notifyGraphicGeometryChanged(e,t))}},{key:"updateGeometries",value:function(e,t,i){var n=this._layerRenderers.get(t);if(n)switch(n.modify(e,i),i){case 4:case 2:return this.notifyGraphicGeometryChanged(e,t);case 1:return this.notifyGraphicVisibilityChanged(e,t)}else Ai.warn("Attempted to update geometry for nonexistent layer")}},{key:"notifyGraphicGeometryChanged",value:function(e,t){if(!Object(h.j)(t.notifyGraphicGeometryChanged)){var i,n,a=Object(R.a)(e);try{for(a.s();!(n=a.n()).done;){var r=n.value.graphicUid;r!==i&&(t.notifyGraphicGeometryChanged(r),i=r)}}catch(o){a.e(o)}finally{a.f()}}}},{key:"notifyGraphicVisibilityChanged",value:function(e,t){if(!Object(h.j)(t.notifyGraphicVisibilityChanged)){var i,n,a=Object(R.a)(e);try{for(a.s();!(n=a.n()).done;){var r=n.value.graphicUid;r!==i&&(t.notifyGraphicVisibilityChanged(r),i=r)}}catch(o){a.e(o)}finally{a.f()}}}},{key:"updateHighlights",value:function(e,t){var i=this._layerRenderers.get(t);i?i.modify(e,8):Ai.warn("Attempted to update highlights for nonexistent layer")}},{key:"isEmpty",value:function(){return 0===this._geometries.size&&!Ke.OVERLAY_DRAW_DEBUG_TEXTURE}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return this._rendersOccluded}},{key:"updateLogic",value:function(e){var t=!1;return this._layerRenderers.forEach((function(i){i.updateLogic(e)&&(t=!0)})),t}},{key:"updateLayerOrder",value:function(){this._sortedLayerRenderersDirty=!0}},{key:"drawPass",value:function(e,t,i){var n=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(0===i.numViews)return!1;if(this._screenToWorldRatio=i.pixelRatio*Math.abs(i.views[0].extent[2]-i.views[0].extent[0])/Math.abs(i.views[0].viewport[2]-i.views[0].viewport[0]),this.isEmpty()||5===e&&!this.hasHighlights||3===e&&!this.hasWater)return!1;if(!this.hasNonZeroSizedView(i))return!1;var r=i.width,o=i.height;if(!t.isValid())return!1;t.resize(r,o);var s=this._rctx;if(zi.pixelRatio=i.pixelRatio||1,this._renderContext.pass=e,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToWorldRatioGlobalWM=this._screenToWorldRatio*this.globalUnitScale,t.bind(s),s.setClearColor(0,0,0,0),s.clearSafe(16384),1===a&&(this._renderContext.renderOccludedMask=Hi),Ke.OVERLAY_DRAW_DEBUG_TEXTURE&&1!==a)for(var c=0;c<i.numViews;c++)this.setViewParameters(i.views[c],zi),this.drawDebugTexture(r,o,Gi[i.index%Gi.length]);return this._layerRenderers.size>0&&this._sortedLayerRenderers.forAll((function(c){var l=c.layerView,u=c.renderer;if(2!==a||!Object(h.k)(l)||0!==l.drapeSourceType){var d=Object(h.k)(l)&&Object(h.k)(l.fullOpacity)&&l.fullOpacity<1&&0===e;d&&(n.bindTemporaryFramebuffer(n._rctx,r,o),s.clearSafe(16384));for(var p=0;p<i.numViews;p++)n.setViewParameters(i.views[p],zi),u.draw(n._renderContext,n._bindParameters);d&&Object(h.k)(n._temporaryRenderTarget)&&(t.bind(s),n._compositingHelper.composite(n._temporaryRenderTarget.getTexture(),2,Object(h.q)(Object(h.q)(l).fullOpacity)))}})),s.bindFramebuffer(null),t.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}},{key:"bindTemporaryFramebuffer",value:function(e,t,i){Object(h.j)(this._temporaryRenderTarget)&&(this._temporaryRenderTarget=new et(e,!1)),this._temporaryRenderTarget.resize(t,i),this._temporaryRenderTarget.bind(e)}},{key:"reloadShaders",value:function(){var e=Object(xe.a)(we.a.mark((function e(){return we.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._shaderTechniqueRepository.hotReload();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"intersect",value:function(e,t,i){var n=this,a=0;this._geometries.forEach((function(r){if(!i||i(r)){n.intersectRenderGeometry(r,t,0,e,a);var o=n.longitudeCyclical;o&&(r.boundingSphere[0]-r.boundingSphere[3]<o.min&&n.intersectRenderGeometry(r,t,o.range,e,a),r.boundingSphere[0]+r.boundingSphere[3]>o.max&&n.intersectRenderGeometry(r,t,-o.range,e,a)),a++}}))}},{key:"intersectRenderGeometry",value:function(e,t,i,n,a){var r=this;if(e.instanceParameters.visible){var o=0;Object(h.k)(e.transformation)&&(i+=e.transformation[12],o=e.transformation[13]),Li[0]=t[0]-i,Li[1]=t[1]-o,Li[2]=1,Vi[0]=t[0]-i,Vi[1]=t[1]-o,Vi[2]=0,e.screenToWorldRatio=this._screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),n,Li,Vi,(function(t,i,o){r.addIntersectionResult(o,e.material.renderPriority,a,n,e.layerUid,e.graphicUid)}),e.calculateShaderTransformation,!0)}}},{key:"addIntersectionResult",value:function(e,t,i,n,a,r){var o={type:"external",metadata:{layerUid:a,graphicUid:r}},s=function(a){a.set(o,null,n.results.ground.dist,n.results.ground.normal,n.results.ground.transformation,t,null,null,e,i),a.intersector="OverlayRenderer"};if((null==n.results.min.drapedLayerOrder||t>=n.results.min.drapedLayerOrder)&&(null==n.results.min.dist||n.results.ground.dist<=n.results.min.dist)&&s(n.results.min),0!==n.options.store&&(null==n.results.max.drapedLayerOrder||t<n.results.max.drapedLayerOrder)&&(null==n.results.max.dist||n.results.ground.dist>n.results.max.dist)&&s(n.results.max),2===n.options.store){var c=new Le.b(n.ray);s(c),n.results.all.push(c)}}},{key:"stopAnimationsAtTime",value:function(e){this._sortedLayerRenderers.forAll((function(t){return t.renderer.stopAnimationsAtTime(e)}))}},{key:"ensureLayerRenderer",value:function(e){var t=this,i=this._layerRenderers.get(e);return i||(i=new pi({rctx:this._rctx,materialRepository:this._materialRepository}),this._layerRenderers.set(e,i),this._sortedLayerRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(e.watch("fullOpacity",(function(){return t.emitContentChanged()})),e),this._handles.add(Object(m.a)(i,"updating",(function(){return t.notifyChange("updating")})),e)),i}},{key:"updateSortedLayerRenderers",value:function(){var e=this;if(this._sortedLayerRenderersDirty&&(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),0!==this._layerRenderers.size)){var t=this._layerRenderers.keys(),i=Object(je.a)(t,1)[0].view.allLayerViews,n=new Set(this._layerRenderers.values());i.forEach((function(t){var i=t,a=e._layerRenderers.get(i);a&&(e._sortedLayerRenderers.push(new Ii(i,a)),n.delete(a))})),n.forEach((function(t){e._sortedLayerRenderers.push(new Ii(null,t))}))}}},{key:"setViewParameters",value:function(e,t){t.viewport=e.viewport;var i=e.extent;Object(ce.m)(t.projectionMatrix,0,i[2]-i[0],0,i[3]-i[1],t.near,t.far),Object(ce.i)(t.viewMatrix),Object(ce.r)(t.viewMatrix,t.viewMatrix,[-e.extent[0],-e.extent[1],0]),t.setGLViewport(this._rctx),this._renderContext.camera=t,this._bindParameters.camera=t,this._bindParameters.inverseViewport[0]=1/t.fullViewport[2],this._bindParameters.inverseViewport[1]=1/t.fullViewport[3]}},{key:"hasNonZeroSizedView",value:function(e){for(var t=0;t<e.numViews;t++){var i=e.views[t];if(i.extent[0]!==i.extent[2]&&i.extent[1]!==i.extent[3])return!0}return!1}},{key:"emitContentChanged",value:function(){this.onContentChanged&&this.onContentChanged()}},{key:"updateHasWater",value:function(){var e=Object(Pe.a)(this._layerRenderers,(function(e){return e.hasWater}));e!==this._hasWater&&(this._hasWater=e)}},{key:"updateHasHighlights",value:function(){var e=Object(Pe.a)(this._layerRenderers,(function(e){return e.hasHighlights}));e!==this._hasHighlights&&(this._hasHighlights=e,this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this._hasHighlights))}},{key:"updateRendersOccluded",value:function(){var e=Object(Pe.a)(this._layerRenderers,(function(e){return e.rendersOccluded}));e!==this._rendersOccluded&&(this._rendersOccluded=e,this.onRendersOccludedChanged&&this.onRendersOccludedChanged(this.rendersOccluded))}},{key:"drawDebugTexture",value:function(e,t,i){var n=this._rctx;this.ensureDebugPatternResources(e,t);var a=this._debugTextureTechnique.program;n.bindProgram(a),n.setPipelineState(this._debugTextureTechnique.pipeline),a.setUniform4f("color",i[0],i[1],i[2],1),a.setUniform1i("tex",0),n.bindTexture(this._debugPatternTexture,0),n.bindVAO(this._quadVAO),n.drawArrays(5,0,Object(De.f)(this._quadVAO,"geometry"))}},{key:"ensureDebugPatternResources",value:function(e,t){if(!this._debugPatternTexture){for(var i=new Uint8Array(e*t*4),n=0,a=0;a<t;a++)for(var r=0;r<e;r++){var o=Math.floor(r/10),s=Math.floor(a/10);o<2||s<2||10*o>e-20||10*s>t-20?(i[n++]=255,i[n++]=255,i[n++]=255,i[n++]=255):(i[n++]=255,i[n++]=255,i[n++]=255,i[n++]=1&o&&1&s?1&r^1&a?0:255:1&o^1&s?0:128)}this._debugPatternTexture=new P.a(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:t},i);var c=new gi;c.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquireAndReleaseExisting(vi,c,this._debugTextureTechnique),this._quadVAO=Object(Ae.b)(this._rctx)}}},{key:"test",get:function(){return{layerRenderers:this._layerRenderers}}}]),i}(Object($e.b)(Se.a));Object(l.a)([Object($e.c)()],Ci.prototype,"_shaderTechniqueRepository",void 0),Object(l.a)([Object($e.c)()],Ci.prototype,"_stippleTextureRepository",void 0),Object(l.a)([Object(f.b)(),Object($e.c)()],Ci.prototype,"waterTextureRepository",void 0),Object(l.a)([Object(f.b)({constructOnly:!0})],Ci.prototype,"renderView",void 0),Object(l.a)([Object(f.b)({constructOnly:!0})],Ci.prototype,"scheduler",void 0),Object(l.a)([Object(f.b)()],Ci.prototype,"globalUnitScale",void 0),Object(l.a)([Object(f.b)({type:Boolean,readOnly:!0})],Ci.prototype,"updating",null),Ci=Object(l.a)([Object(v.a)("esri.views.3d.terrain.OverlayRenderer")],Ci);var Ii=function e(t,i){Object(r.a)(this,e),this.layerView=t,this.renderer=i},Gi=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],zi=new Qe;zi.near=1,zi.far=1e4,zi.relativeElevation=null;var Li=Object(J.e)(),Vi=Object(J.e)(),Hi=4,Fi=(E.b,E.a);function Ui(e){var t=[],i=[];!function(e,t,i){for(var n=e.attributeData.position,a=e.removeDuplicateStartEnd,r=function(e){var t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}(n)&&1===a,o=n.length/3-(r?1:0),s=new Uint32Array(2*(o-1)),c=r?Object(pe.m)(n,0,n.length-3):n,l=0,u=0;u<o-1;u++)s[l++]=u,s[l++]=u+1;t.push(["position",{size:3,data:c,exclusive:r}]),i.push(["position",s])}(e,i,t);var n=i[0][1].data,a=t[0][1].length,r=new Uint16Array(a);return function(e,t,i){var n=e.attributeData.mapPosition;Object(h.j)(n)||(i.push(["mapPos",i[0][1]]),t.push(["mapPos",{size:3,data:n}]))}(e,i,t),function(e,t,i,n){if(Object(h.k)(e.attributeData.colorFeature))return;var a=e.attributeData.color;t.push(["color",{size:4,data:Object(h.r)(a,Fi)}]),i.push(["color",n])}(e,i,t,r),function(e,t,i,n){if(Object(h.k)(e.attributeData.sizeFeature))return;var a=e.attributeData.size;t.push(["size",{size:1,data:[Object(h.r)(a,1)]}]),i.push(["size",n])}(e,i,t,r),function(e,t,i,n){var a=e.attributeData.colorFeature;Object(h.j)(a)||(t.push(["colorFeatureAttribute",{size:1,data:new Float32Array([a])}]),i.push(["color",n]))}(e,i,t,r),function(e,t,i,n){var a=e.attributeData.sizeFeature;Object(h.j)(a)||(t.push(["sizeFeatureAttribute",{size:1,data:new Float32Array([a])}]),i.push(["sizeFeatureAttribute",n]))}(e,i,t,r),function(e,t,i,n){var a=e.attributeData.opacityFeature;Object(h.j)(a)||(t.push(["opacityFeatureAttribute",{size:1,data:new Float32Array([a])}]),i.push(["opacityFeatureAttribute",n]))}(e,i,t,r),function(e,t,i,n){if("round"!==e.join)return;var a=n.length/3,r=new Float32Array(a),o=qi,s=Wi;Object(K.v)(o,0,0,0);for(var c=Object(h.r)(e.uniformSize,1),l=-1;l<a;++l){var u=l<0?a+l:l,d=(l+1)%a;if(Object(K.v)(s,n[3*d+0]-n[3*u+0],n[3*d+1]-n[3*u+1],n[3*d+2]-n[3*u+2]),Object(K.q)(s,s),l>=0){var p=(Math.PI-Object(fe.b)(Object(K.g)(o,s)))*Zi*1*Bi(c);r[l]=Math.max(Math.floor(p),0)}Object(K.d)(o,s,-1)}t.push(["subdivisions",{size:1,data:r}]),i.push(["subdivisions",i[0][1]])}(e,i,t,n),new ye.a(i,t,2)}function Ni(e,t,i){var n,a=new Array,r=Object(R.a)(e);try{for(r.s();!(n=r.n()).done;){var o=n.value,s=o.index,c=o.count;if(!(c<=1)){var l=3*s,u=l+3*c;a.push({position:t.subarray(l,u),mapPosition:i?i.subarray(l,u):void 0})}}}catch(h){r.e(h)}finally{r.f()}return a}function Bi(e){return 1.863798+-2.0062872/Math.pow(1+e/18.2313,.8856294)}var qi=Object(J.e)(),Wi=Object(J.e)(),Zi=4/Math.PI,Yi=i(636),Xi=i(760),Qi=i(192),Ji=function(){function e(t){Object(r.a)(this,e),this.resourceFactory=t,this._resources=null,this._visible=!0,this._attached=!1}return Object(o.a)(e,[{key:"destroy",value:function(){this._destroyResources()}},{key:"resources",get:function(){return Object(h.k)(this._resources)?this._resources.external:null}},{key:"visible",get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}},{key:"attached",get:function(){return this._attached},set:function(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}},{key:"recreate",value:function(){this.attached&&this._createResources()}},{key:"recreateGeometry",value:function(){this.resourceFactory.recreateGeometry?Object(h.j)(this._resources)||(this.ensureRenderGeometriesRemoved(),this.resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}},{key:"_createOrDestroyResources",value:function(){this._attached?Object(h.j)(this._resources)&&this._createResources():this._destroyResources()}},{key:"_createResources",value:function(){var e;this._destroyResources();var t=this.resourceFactory.createResources();this._resources={layerView:new Ki({view:this.resourceFactory.view}),external:t,geometriesAdded:!1},this._syncGeometriesToRenderer();var i=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;i&&i.registerDrapeSource(this._resources.layerView)}},{key:"_destroyResources",value:function(){var e;if(!Object(h.j)(this._resources)){this.ensureRenderGeometriesRemoved();var t=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resources=null}}},{key:"_syncGeometriesToRenderer",value:function(){this._visible?this.ensureRenderGeometriesAdded():this.ensureRenderGeometriesRemoved()}},{key:"ensureRenderGeometriesRemoved",value:function(){var e;!Object(h.j)(this._resources)&&null!=(e=this.resourceFactory.view)&&e.basemapTerrain&&this._resources.geometriesAdded&&(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.removeGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!1)}},{key:"ensureRenderGeometriesAdded",value:function(){Object(h.j)(this._resources)||this._resources.geometriesAdded||(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.addGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!0)}}]),e}(),Ki=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e)).drapeSourceType=1,n}return i}(Object(Qi.a)(Se.a));Object(l.a)([Object(f.b)({constructOnly:!0})],Ki.prototype,"view",void 0),Object(l.a)([Object(f.b)({readOnly:!0})],Ki.prototype,"drapeSourceType",void 0),Ki=Object(l.a)([Object(v.a)("DrapedVisualElementLayerView")],Ki);var $i=function(){function e(t){var i=this;Object(r.a)(this,e),this.view=null,this._attachmentOrigin=Object(ne.d)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new g.a,this._isDraped=!1,this._geometry=null,this._width=1,this._color=Object(ie.c)(1,0,1,1),this._innerWidth=0,this._innerColor=Object(ie.c)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=8,this.resources=new Xi.a({view:t.view,createResources:function(e){return i.createResources(e)},recreateGeometry:function(e,t){return e.geometries.length=0,i.recreateGeometry(t,e.material,e.geometries),e.geometries}}),this._attachmentOrigin.spatialReference=t.view.spatialReference,this.drapedResources=new Ji({view:t.view,createResources:function(){return i.createDrapedResources()},recreateGeometry:function(e){e.geometries=i.createRenderGeometriesDraped(e.material),i.attachmentOriginChanged()}});var n=!0;for(var a in this._laserline=new Yi.a({view:t.view}),t)a in this?"attached"===a?n=t[a]:this[a]=t[a]:console.error("Cannot set unknown property",a);this.attached=n}return Object(o.a)(e,[{key:"destroy",value:function(){this.resources.destroy(),this.drapedResources.destroy(),this._laserline.destroy()}},{key:"isDraped",get:function(){return this._isDraped},set:function(e){e!==this._isDraped&&(this._isDraped=e,this.updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)}},{key:"laserlineAttached",get:function(){return this.attached&&this.visible&&Object(h.k)(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}},{key:"visible",get:function(){return this.resources.visible},set:function(e){this.resources.visible=e,this.drapedResources.visible=e,this._laserline.attached=this.laserlineAttached}},{key:"attached",get:function(){return this.resources.attached||this.drapedResources.attached},set:function(e){this.updateAttached(e)}},{key:"updateAttached",value:function(e){this.resources.attached=!this.isDraped&&e,this.drapedResources.attached=this.isDraped&&e,this._laserline.attached=this.laserlineAttached,this.attached&&this.attachmentOriginChanged()}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this.updateMaterial())}},{key:"color",get:function(){return this._color},set:function(e){Object(ee.g)(e,this._color)||(Object(ee.c)(this._color,e),this.updateMaterial())}},{key:"innerWidth",get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())}},{key:"innerColor",get:function(){return this._innerColor},set:function(e){Object(ee.g)(e,this._innerColor)||(Object(ee.c)(this._innerColor,e),this.updateMaterial())}},{key:"stipplePattern",get:function(){return this._stipplePattern},set:function(e){var t=Object(h.k)(e)!==Object(h.k)(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this.updateMaterial()}},{key:"stippleOffColor",get:function(){return this._stippleOffColor},set:function(e){e&&this._stippleOffColor&&Object(ee.g)(e,this._stippleOffColor)||(this._stippleOffColor=e?Object(ie.a)(e):null,this.updateMaterial())}},{key:"falloff",get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.resources.recreateGeometry()}},{key:"laserlineStyle",get:function(){return this._laserlineStyle},set:function(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,Object(h.k)(e)&&(this._laserline.style=e)}},{key:"laserlineEnabled",get:function(){return this._laserlineEnabled},set:function(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}},{key:"attachmentOrigin",get:function(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;var e=Object(h.k)(this.resources.resources)?this.resources.resources.geometries:null;if(!e||0===e.length)return null;Object(K.v)(nn,0,0,0);var t,i=0,n=Object(R.a)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value,r=a.vertexAttributes.get("position"),o=a.indices.get("position"),s=Object(h.q)(this.resources.resources).material.isClosed(r.data,o);Object(ae.a)(r,o,s,tn)&&(Object(K.e)(nn,nn,tn),i++)}}catch(c){n.e(c)}finally{n.f()}return 0===i?null:(Object(K.d)(nn,nn,1/i),this.view.renderCoordsHelper.fromRenderCoords(nn,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}},{key:"updateMaterial",value:function(){Object(h.k)(this.resources.resources)&&this.resources.resources.material.setParameterValues(this.materialParameters),Object(h.k)(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameterValues(this.materialParameters)}},{key:"isClosed",get:function(){return Object(h.k)(this.geometry)&&"polygon"===this.geometry.type}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",stippleIntegerRepeats:!0,polygonOffset:!0,renderOccluded:this.normalizedRenderOccluded}}},{key:"normalizedRenderOccluded",get:function(){return this.isDraped&&8===this._renderOccluded?4:this._renderOccluded}},{key:"recreateGeometry",value:function(e,t,i){var n,a=this.createRenderGeometries(),r=Object(R.a)(a);try{for(r.s();!(n=r.n()).done;){var o=n.value;e.addGeometry(o,t),i.push(o)}}catch(s){r.e(s)}finally{r.f()}this.attachmentOriginChanged()}},{key:"attachmentOriginChanged",value:function(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}},{key:"createResources",value:function(e){var t=new oe.a(this.materialParameters),i=[];return this.recreateGeometry(e,t,i),{material:t,geometries:i,forEach:function(e){e(t),i.forEach(e)}}}},{key:"createDrapedResources",value:function(){var e=new oe.a(this.materialParameters);return{material:e,geometries:this.createRenderGeometriesDraped(e)}}},{key:"createRenderGeometriesDraped",value:function(e){var t=this.geometry;if(Object(h.j)(t))return[];var i,n=function(e,t){for(var i="polygon"===e.type?1:0,n=ge("polygon"===e.type?e.rings:e.paths,!1,i),a=n.position,r=n.outlines,o=Object($.k)(a,e.spatialReference,0,a,t,0,a.length/3),s=2;s<a.length;s+=3)a[s]=-2;return{lines:o?Ni(r,a):[],projectionSuccess:o}}(t,this.view.basemapTerrain.spatialReference),a=[],r=Object(R.a)(n.lines);try{for(r.s();!(i=r.n()).done;){var o=i.value.position,s={attributeData:{position:o},removeDuplicateStartEnd:this.isClosed?1:0},c=new de(Ui(s),e),l=Object(te.e)(en);Object(te.h)(l,o),Object(ee.l)(c.boundingSphere,.5*(l[0]+l[3]),.5*(l[1]+l[4]),0,.5*Math.sqrt((l[3]-l[0])*(l[3]-l[0])+(l[4]-l[1])*(l[4]-l[1]))),a.push(c)}}catch(u){r.e(u)}finally{r.f()}return a}},{key:"calculateMapBounds",value:function(e){if(Object(h.j)(this.resources.resources))return!1;var t,i=this.view.renderCoordsHelper,n=Object(R.a)(this.resources.resources.geometries);try{for(n.s();!(t=n.n()).done;){var a=t.value.vertexAttributes.get("position"),r=new Float64Array(a.data.length);Object($.k)(a.data,i.spatialReference,0,r,this.view.spatialReference,0,a.data.length/3),Object(te.h)(e,r)}}catch(o){n.e(o)}finally{n.f()}return!0}},{key:"createRenderGeometries",value:function(){var e=this.geometry;if(Object(h.j)(e))return[];var t,i=function(e,t,i,n){var a="polygon"===e.type?1:0,r=ge("polygon"===e.type?e.rings:e.paths,e.hasZ,a),o=r.position,s=r.outlines,c=new Float64Array(o.length),l=Object(Oe.b)(o,e.spatialReference,0,c,0,o,0,o.length/3,t,i,n),u=null!=l;return{lines:u?Ni(s,o,c):[],projectionSuccess:u,sampledElevation:l}}(e,this.view.elevationProvider,this.view.renderCoordsHelper,re.a.fromElevationInfo(this.elevationInfo)),n=[],a=[],r=Object(R.a)(i.lines);try{for(r.s();!(t=r.n()).done;){var o=t.value,s=o.position,c={attributeData:{position:s,mapPosition:o.mapPosition},removeDuplicateStartEnd:this.isClosed?1:0};n.push(Ui(c)),a.push(s)}}catch(l){r.e(l)}finally{r.f()}return this._laserline.pathVerticalPlane=a,n}}]),e}(),en=Object(te.d)(),tn=Object(J.e)(),nn=Object(J.e)(),an=i(296),rn=i(654);Object(J.e)();var on=i(394),sn=i(122),cn=i(274),ln=i(208),un=i(327),hn=i(1268),dn=i(1269),pn=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(){return Object(r.a)(this,i),t.apply(this,arguments)}return Object(o.a)(i,[{key:"initializeProgram",value:function(e){var t=i.shader.get(),n=this.configuration,a=t.build({output:n.output,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,screenSizeEnabled:n.screenSizeEnabled,shadingEnabled:n.shadingEnabled,OITEnabled:0===n.transparencyPassType,multipassTerrainEnabled:n.multipassTerrainEnabled,cullAboveGround:n.cullAboveGround});return new Ht.a(e.rctx,a.generateSource("vertex"),a.generateSource("fragment"),vn)}},{key:"bindPass",value:function(e,t,i){var n=this.configuration,a=n.screenSizeEnabled,r=n.shadingEnabled,o=t.color,s=t.shadingTint,c=t.shadingDirection;Ut.a.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform4fv("color",o),i.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",i.camera.nearFar),this.program.setUniform2fv("inverseViewport",i.inverseViewport),Object(Zt.a)(this.program,e,i)),r&&(this.program.setUniform4fv("shadedColor",this.blendColor(gn,s,o)),this.program.setUniform3fv("shadingDirection",c),this.program.setUniformMatrix4fv("viewNormal",i.camera.viewInverseTransposeMatrix)),a&&hn.a.bindPassUniforms(this.program,t,i)}},{key:"blendColor",value:function(e,t,i){var n=1-t[3],a=t[3]+i[3]*n;return 0===a?(e[3]=a,e):(e[0]=(t[0]*t[3]+i[0]*i[3]*n)/a,e[1]=(t[1]*t[3]+i[1]*i[3]*n)/a,e[2]=(t[2]*t[3]+i[2]*i[3]*n)/a,e[3]=i[3],e)}},{key:"bindDraw",value:function(e){Ut.a.bindView(this.program,e),Ut.a.bindCamPosition(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Bt.a.bindUniformsWithOrigin(this.program,this.configuration,e)}},{key:"setPipelineState",value:function(e){var t=this.configuration,i=3===e,n=2===e;return Object(Ft.d)({blending:0!==t.output&&7!==t.output||!t.transparent?null:i?Wt.f:Object(Wt.a)(e),culling:function(e){return 0!==e&&{face:1===e?1028:1029,mode:2305}}(t.cullFace),depthTest:{func:n?513:t.shadingEnabled?515:513},depthWrite:i?t.writeDepth&&Ft.c:Object(Wt.c)(e),colorWrite:Ft.b,polygonOffset:i||n?null:Wt.d})}},{key:"initializePipeline",value:function(){return this.setPipelineState(this.configuration.transparencyPassType)}}]),i}(zt.a);pn.shader=new Gt.a(dn.a,(function(){return i.e(231).then(i.bind(null,1429))}));var fn=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(){var e;return Object(r.a)(this,i),(e=t.apply(this,arguments)).output=0,e.cullFace=0,e.slicePlaneEnabled=!1,e.transparent=!1,e.writeDepth=!0,e.screenSizeEnabled=!0,e.shadingEnabled=!0,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!0,e}return i}(Lt.a);Object(l.a)([Object(Lt.b)({count:8})],fn.prototype,"output",void 0),Object(l.a)([Object(Lt.b)({count:3})],fn.prototype,"cullFace",void 0),Object(l.a)([Object(Lt.b)()],fn.prototype,"slicePlaneEnabled",void 0),Object(l.a)([Object(Lt.b)()],fn.prototype,"transparent",void 0),Object(l.a)([Object(Lt.b)()],fn.prototype,"writeDepth",void 0),Object(l.a)([Object(Lt.b)()],fn.prototype,"screenSizeEnabled",void 0),Object(l.a)([Object(Lt.b)()],fn.prototype,"shadingEnabled",void 0),Object(l.a)([Object(Lt.b)({count:4})],fn.prototype,"transparencyPassType",void 0),Object(l.a)([Object(Lt.b)()],fn.prototype,"multipassTerrainEnabled",void 0),Object(l.a)([Object(Lt.b)()],fn.prototype,"cullAboveGround",void 0);var vn={position:0,normal:1,offset:2},gn=Object(E.c)(),bn=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e,yn)).supportsEdges=!0,n.techniqueConfig=new fn,n._vertexAttributeLocations=vn,n}return Object(o.a)(i,[{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.screenSizeEnabled=this.params.screenSizeEnabled,this.techniqueConfig.shadingEnabled=this.params.shadingEnabled,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!t||t.cullAboveGround,this.techniqueConfig}},{key:"getPassParameters",value:function(){return this.params}},{key:"intersect",value:function(e,t,i,n,a,r,o){var s=this;if(this.params.screenSizeEnabled){var c=e.vertexAttributes.get("offset"),l={applyToVertex:function(e,t,i,a){var r=Object(K.v)(jn,c.data[3*a+0],c.data[3*a+1],c.data[3*a+2]),o=Object(K.v)(_n,e,t,i);return Object(K.d)(r,r,s.params.screenSize*n.camera.computeRenderPixelSizeAt(r)),Object(K.e)(o,o,r),[o[0],o[1],o[2]]},applyToAabb:function(e){var t=Object(te.b)(e,jn);return Object(te.p)(e,s.params.screenSize*n.camera.computeRenderPixelSizeAt(t))}};Object(ln.e)(e,t,n,a,r,l,o)}else Object(ln.e)(e,t,n,a,r,void 0,o)}},{key:"getGLMaterial",value:function(e){return 0===e.output||7===e.output||4===e.output?new mn(e):void 0}},{key:"createBufferWriter",value:function(){return new On(this.params.screenSizeEnabled)}}]),i}(Mt.a),mn=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e)).updateParameters(),n}return Object(o.a)(i,[{key:"updateParameters",value:function(e){this.technique=this.techniqueRep.acquireAndReleaseExisting(pn,this.material.getTechniqueConfig(this.output,e),this.technique)}},{key:"beginSlot",value:function(e){if(4===this.output)return 3===e;var t=3;return this.technique.configuration.transparent&&(t=this.technique.configuration.writeDepth?5:8),e===t}},{key:"ensureParameters",value:function(e){this.updateParameters(e)}},{key:"bind",value:function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)}}]),i}(It.a),yn=Object(a.a)({color:[1,1,1,1],shadingTint:[0,0,0,.25],shadingDirection:Object(K.q)(Object(J.e)(),[.5,-.5,-.5]),transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,screenSizeEnabled:!1,screenSize:14,shadingEnabled:!0},Mt.b),On=function(){function e(t){Object(r.a)(this,e),this.screenSizeEnabled=t;var i=Object(cn.a)().vec3f("position").vec3f("normal");this.screenSizeEnabled&&i.vec3f("offset"),this.vertexBufferLayout=i}return Object(o.a)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get("position").length}},{key:"write",value:function(e,t,i,n){if(Object(un.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,n),this.screenSizeEnabled){if(!t.vertexAttributes.has("offset"))throw new Error("offset vertex attribute required for screenSizeEnabled ShadedColorMaterial");var a=t.vertexAttributes.get("offset"),r=t.indices.get("offset");Object(Ne.a)(3===a.size);var o=i.getField("offset",sn.u);if(!o)throw new Error("unable to acquire view for offset");Object(un.e)(r,a.data,e.invTranspTransformation,o,n)}}}]),e}(),jn=Object(J.e)(),_n=Object(J.e)(),wn=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e)).view=null,n._renderOccluded=4,n._vertices=null,n._spatialReference=null,n._color=Q.colorToVec4(Q.reshapeManipulators.vertex.color),n._size=Q.reshapeManipulators.vertex.size,n._outlineColor=Q.colorToVec4(Q.reshapeManipulators.vertex.outlineColor),n._outlineSize=Q.reshapeManipulators.vertex.outlineSize,n._elevationInfo=null,n.applyProps(e),n}return Object(o.a)(i,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial(),this.updateOutlineMaterial())}},{key:"vertices",get:function(){return this._vertices},set:function(e){this._vertices=e,this.recreateGeometry()}},{key:"spatialReference",get:function(){return this._spatialReference},set:function(e){this._spatialReference=e,this.recreateGeometry()}},{key:"color",get:function(){return this._color},set:function(e){Object(ee.g)(e,this._color)||(Object(ee.c)(this._color,e),this.updateMaterial())}},{key:"size",get:function(){return this._size},set:function(e){e!==this._size&&(this._size=e,this.updateMaterial())}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){Object(ee.g)(e,this._outlineColor)||(Object(ee.c)(this._outlineColor,e),this.updateOutlineMaterial())}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateOutlineMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.recreateGeometry()}},{key:"vertexMaterialParameters",get:function(){return{color:this._color,transparent:this._color[3]<1,screenSize:this.size,renderOccluded:this._renderOccluded}}},{key:"vertexOutlineMaterialParameters",get:function(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSize:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}},{key:"updateMaterial",value:function(){this.attached&&this.vertexMaterial.setParameterValues(this.vertexMaterialParameters)}},{key:"updateOutlineMaterial",value:function(){this.attached&&this.vertexOutlineMaterial.setParameterValues(this.vertexOutlineMaterialParameters)}},{key:"createRenderGeometries",value:function(){var e=this.vertices;if(Object(h.j)(e)||0===e.length)return[];for(var t=function(e,t,i,n,a){var r=new Float64Array(3*e.length),o=new Float64Array(r.length);e.forEach((function(e,t){r[3*t+0]=e[0],r[3*t+1]=e[1],r[3*t+2]=e.length>2?e[2]:0}));var s=Object(Oe.b)(r,t,0,o,0,r,0,r.length/3,i,n,a),c=null!=s;return{numVertices:e.length,position:r,mapPosition:o,projectionSuccess:c,sampledElevation:s}}(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,re.a.fromElevationInfo(this.elevationInfo)),i=[],n=t.numVertices,a=t.position,r=0;r<n;++r){var o=Object(K.v)(xn,a[3*r+0],a[3*r+1],a[3*r+2]),s=Mn(.5,o),c=Mn(.5,o);i.push({vertexGeometry:s,vertexOutlineGeometry:c})}return i}},{key:"createGeometries",value:function(e){var t,i=this.createRenderGeometries(),n=Object(R.a)(i);try{for(n.s();!(t=n.n()).done;){var a=t.value,r=a.vertexGeometry,o=a.vertexOutlineGeometry;e.addGeometry(r,this.vertexMaterial),e.addGeometry(o,this.vertexOutlineMaterial)}}catch(s){n.e(s)}finally{n.f()}}},{key:"createExternalResources",value:function(){this.vertexMaterial=new bn(Object(a.a)(Object(a.a)({},this.vertexMaterialParameters),{},{writeDepth:!0,cullFace:2,screenSizeEnabled:!0})),this.vertexOutlineMaterial=new bn(Object(a.a)(Object(a.a)({},this.vertexOutlineMaterialParameters),{},{transparent:!0,writeDepth:!0,cullFace:1,screenSizeEnabled:!0,shadingEnabled:!1}))}},{key:"destroyExternalResources",value:function(){this.vertexMaterial=null,this.vertexOutlineMaterial=null}},{key:"forEachExternalMaterial",value:function(e){e(this.vertexMaterial),e(this.vertexOutlineMaterial)}}]),i}(on.a),xn=Object(J.e)();function Mn(e,t){return an.a.createSphereGeometry(e,16,16,{offset:t})}var Sn=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e)).tracking=!1,n.displaying=!1,n.isDraped=!1,n}return i}(g.a.EventedAccessor);Object(l.a)([Object(f.b)({constructOnly:!0})],Sn.prototype,"graphic",void 0),Object(l.a)([Object(f.b)()],Sn.prototype,"tracking",void 0),Object(l.a)([Object(f.b)()],Sn.prototype,"displaying",void 0),Object(l.a)([Object(f.b)()],Sn.prototype,"isDraped",void 0),Sn=Object(l.a)([Object(v.a)("esri.views.3d.layers.graphics.GraphicState")],Sn);var kn=i(1314),En=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e)).drawOperation=null,n._createGraphic=null,n._createGraphicState=null,n._outlineVisualElement=null,n._verticesVisualElement=null,n._stagedVerticesVisualElement=null,n.hasZ=!0,n.defaultZ=0,n.elevationInfo=null,n.snapToScene=!1,n.snappingManager=null,n.mode=null,n.geometryType=null,n.type="draw-3d",n}return Object(o.a)(i,[{key:"initialize",value:function(){var e=this,t=Object(h.r)(this.elevationInfo,{mode:this.hasZ?"absolute-height":"on-the-ground",offset:0});this._internalGraphicsLayer=new O.a({elevationInfo:t,listMode:"hide",internal:!0}),this.view.map.layers.add(this._internalGraphicsLayer),this.drawOperation=new n.a({view:this.view,manipulators:this.manipulators,geometryType:Rn(this.geometryType),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,snappingDrawSurface:new _.b(this.view,t,[this._internalGraphicsLayer]),elevationDrawSurface:new _.a(t,this.defaultZ,this.view,this._internalGraphicsLayer),hasM:!1,elevationInfo:t,snappingManager:this.snappingManager}),this.drawOperation.on("vertex-add",(function(t){return e.onVertexAdd(t)})),this.drawOperation.on("vertex-remove",(function(t){return e.onVertexRemove(t)})),this.drawOperation.on("vertex-update",(function(t){return e.onVertexUpdate(t)})),this.drawOperation.on("cursor-update",(function(t){return e.onCursorUpdate(t)})),this.drawOperation.on("complete",(function(t){return e.onComplete(t)}))}},{key:"destroy",value:function(){this.drawOperation.destroy(),this.drawOperation=null,this._destroyAllVisualisations(),this.view.map.remove(this._internalGraphicsLayer),this._set("view",null)}},{key:"onInputEvent",value:function(e){this.drawOperation.onInputEvent(e)}},{key:"_getCreateGeometry",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null==this.drawOperation)return null;var i=Object(h.k)(e)?e:this.drawOperation.hasStagedVertex?this.drawOperation.numVertices-1:null,n=this.drawOperation.vertices;if(0===n.length)return null;var a=this.drawOperation.spatialReference,r=n,o=r.slice(),s=[];Object(h.k)(i)&&(o.splice(i,1),s.push(r[i]));var c={regularVertices:null,stagedVertices:null,full:null,outline:null},l="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":c.regularVertices=o,c.stagedVertices=s,c.full=this.drawOperation.coordinateHelper.createPointFromArray(n[0]);break;case"polyline":c.regularVertices=o,c.stagedVertices=s,r.length>0&&(c.full=Object(kn.createPolyline)([r],a,l));break;case"polygon":c.regularVertices=o,c.stagedVertices=s,r.length>0&&(c.full=Object(kn.createPolygon)([r],a,l,!0));break;case"circle":if(r.length>0){var u=Object(x.a)(this.view,n[0]);if(1===r.length&&t){var d=r[0],p=u.makeMapPoint(d[0]+Pn*this.view.resolution,d[1]);c.full=Object(kn.createCircle)([d,p],u,!0)}else 2===r.length&&(c.full=this.forceUniformSize?Object(kn.createCircle)(n,u,this.centered):Object(kn.createEllipse)(n,u,this.centered))}break;case"rectangle":if(r.length>0){var f=Object(x.a)(this.view,n[0]);if(1===r.length&&t){var v=r[0],g=f.makeMapPoint(v[0]+Pn*this.view.resolution,v[1]);c.full=Object(kn.createSquare)([v,g],f,!0)}else 2===r.length&&(c.full=this.forceUniformSize?Object(kn.createSquare)(n,f,this.centered):Object(kn.createRectangle)(n,f,this.centered))}break;default:return null}switch(this.geometryType){case"point":break;case"polyline":r.length>1&&(c.outline=Object(kn.createPolyline)([r],a,l));break;case"polygon":r.length>1&&(c.outline=Object(kn.createPolygon)([r],a,l));break;case"circle":case"rectangle":Object(h.k)(c.full)&&"polygon"===c.full.type&&(c.outline=Object(kn.createPolygon)(c.full.rings,a,l))}return c}},{key:"_destroyAllVisualisations",value:function(){this._destroyCreateGraphic(),this._destroyOutlineVisualElement(),this._destroyVerticesVisualElement(),this._destroyStagedVerticesVisualElement()}},{key:"_destroyCreateGraphic",value:function(){Object(h.k)(this._createGraphic)&&(this._internalGraphicsLayer.remove(this._createGraphic),this._createGraphic.destroy(),this._createGraphic=null),this._createGraphicState=null,this.handles.remove(Tn)}},{key:"_destroyOutlineVisualElement",value:function(){Object(h.k)(this._outlineVisualElement)&&(this._outlineVisualElement.destroy(),this._outlineVisualElement=null)}},{key:"_destroyVerticesVisualElement",value:function(){Object(h.k)(this._verticesVisualElement)&&(this._verticesVisualElement.destroy(),this._verticesVisualElement=null)}},{key:"_destroyStagedVerticesVisualElement",value:function(){Object(h.k)(this._stagedVerticesVisualElement)&&(this._stagedVerticesVisualElement.destroy(),this._stagedVerticesVisualElement=null)}},{key:"_updateCreateGraphic",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=this._getCreateGeometry(t);if(Object(h.j)(i))this._destroyAllVisualisations();else{var n=this._internalGraphicsLayer.elevationInfo;Object(h.k)(i.outline)?Object(h.j)(this._outlineVisualElement)?(this._outlineVisualElement=new $i({view:this.view,geometry:i.outline,elevationInfo:Object(h.q)(n),isDraped:Object(h.k)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===Object(j.c)(this.hasZ,n),attached:!1}),Q.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),Q.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0):this._outlineVisualElement.geometry=i.outline:this._destroyOutlineVisualElement(),Object(h.k)(i.regularVertices)?Object(h.j)(this._verticesVisualElement)?(this._verticesVisualElement=new wn({view:this.view,spatialReference:this.view.spatialReference,vertices:i.regularVertices,elevationInfo:Object(h.q)(this._internalGraphicsLayer.elevationInfo),renderOccluded:Q.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0):this._verticesVisualElement.vertices=i.regularVertices:this._destroyVerticesVisualElement(),Object(h.k)(i.stagedVertices)?Object(h.j)(this._stagedVerticesVisualElement)?(this._stagedVerticesVisualElement=new wn({view:this.view,spatialReference:this.view.spatialReference,vertices:i.stagedVertices,elevationInfo:Object(h.q)(this._internalGraphicsLayer.elevationInfo),renderOccluded:Q.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._stagedVerticesVisualElement.color=Q.colorToVec4(Q.reshapeManipulators.selected.color),this._stagedVerticesVisualElement.attached=!0):this._stagedVerticesVisualElement.vertices=i.stagedVertices:this._destroyStagedVerticesVisualElement(),Object(h.k)(i.full)?Object(h.j)(this._createGraphic)?(this._createGraphic=new b.a({geometry:i.full,symbol:this.createGraphicSymbol}),this._internalGraphicsLayer.add(this._createGraphic),this.view.maskOccludee(this._createGraphic),this._createGraphicState=new Sn({graphic:this._createGraphic}),this.handles.add([this.view.trackGraphicState(this._createGraphicState),Object(m.a)(this._createGraphicState,"isDraped",(function(t){Object(h.k)(e._outlineVisualElement)&&(e._outlineVisualElement.isDraped=t)}))],Tn),this.notifyChange("createGraphic")):this._createGraphic.geometry=i.full:this._destroyCreateGraphic()}}},{key:"createGraphic",get:function(){return this._createGraphic}},{key:"enabled",set:function(e){this.drawOperation.interactive=e,this._set("enabled",e)}},{key:"centered",set:function(e){this._set("centered",e),this._updateCreateGraphic()}},{key:"forceUniformSize",set:function(e){this._set("forceUniformSize",e),this._updateCreateGraphic()}},{key:"reset",value:function(){}},{key:"canRedo",get:function(){return this.drawOperation.canRedo}},{key:"redo",value:function(){this.drawOperation.redo()}},{key:"canUndo",get:function(){return this.drawOperation.canUndo}},{key:"undo",value:function(){this.drawOperation.undo()}},{key:"completeCreateOperation",value:function(){this.drawOperation.complete()}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){this.drawOperation.isCompleted||this.drawOperation.cancel()}},{key:"getVertexCoords",value:function(){return this.drawOperation.vertices}},{key:"onVertexAdd",value:function(e){this._updateCreateGraphic(),this.emit("vertex-add",e)}},{key:"onVertexRemove",value:function(e){this._updateCreateGraphic(),this.emit("vertex-remove",e)}},{key:"onVertexUpdate",value:function(e){this._updateCreateGraphic(),this.emit("vertex-update",e)}},{key:"onCursorUpdate",value:function(e){this._updateCreateGraphic(1===e.vertices.length?e.vertices[0].vertexIndex:null),this.emit("cursor-update",e)}},{key:"onComplete",value:function(e){this._updateCreateGraphic();var t=null;if(this.drawOperation.isCompleted){var i=this._getCreateGeometry(null,!0);Object(h.k)(i)&&(t=new b.a({geometry:i.full,symbol:this.createGraphicSymbol}))}this.emit("complete",Object(a.a)({graphic:t},e))}}]),i}(Object(y.b)(g.a.EventedMixin(w.a)));function Rn(e){switch(e){case"point":case"polyline":case"polygon":return e;case"circle":case"rectangle":return"segment";default:return null}}Object(l.a)([Object(f.b)({constructOnly:!0,nonNullable:!0})],En.prototype,"view",void 0),Object(l.a)([Object(f.b)()],En.prototype,"createGraphicSymbol",void 0),Object(l.a)([Object(f.b)()],En.prototype,"createGraphic",null),Object(l.a)([Object(f.b)({value:!0})],En.prototype,"enabled",null),Object(l.a)([Object(f.b)({value:!0})],En.prototype,"centered",null),Object(l.a)([Object(f.b)({value:!0})],En.prototype,"forceUniformSize",null),Object(l.a)([Object(f.b)({constructOnly:!0})],En.prototype,"hasZ",void 0),Object(l.a)([Object(f.b)({nonNullable:!0})],En.prototype,"defaultZ",void 0),Object(l.a)([Object(f.b)({constructOnly:!0})],En.prototype,"elevationInfo",void 0),Object(l.a)([Object(f.b)()],En.prototype,"snapToScene",void 0),Object(l.a)([Object(f.b)()],En.prototype,"snappingManager",void 0),Object(l.a)([Object(f.b)({constructOnly:!0})],En.prototype,"mode",void 0),Object(l.a)([Object(f.b)({constructOnly:!0})],En.prototype,"geometryType",void 0),Object(l.a)([Object(f.b)({readOnly:!0})],En.prototype,"type",void 0),En=Object(l.a)([Object(v.a)("esri.views.3d.interactive.editingTools.draw3D.DrawTool")],En);var Pn=48,Tn="create-graphic",Dn=i(136),An=i(40),Cn=i(134),In=i(388),Gn=i(351),zn=i(348),Ln=i(630),Vn=i(566),Hn=i(55),Fn=i(443),Un=i(614),Nn=i(195),Bn=i(43),qn=(i(71),i(245)),Wn=i(298),Zn=i(158),Yn=i(428),Xn=function(){function e(t){for(var i in Object(r.a)(this,e),this.idHint=0,this.camera=new Qe,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=Object(le.b)(),this._worldFrame=null,this._renderLocation=Object(J.e)(),this._renderLocationDirty=!0,this._location=new Bn.a({x:0,y:0,z:0}),this._elevationAlignedLocation=new Bn.a,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=0,this._focused=!1,this.events=new g.a.EventEmitter,this._screenLocation={screenPointArray:Object(Ve.f)(),renderScreenPointArray:Object(Ve.d)(),pixelSize:0},this._screenLocationDirty=!0,this._applyObjectTransform=null,this._engineResourcesAddedToStage=!1,this._engineResources=null,this._attached=!1,this._engineLayer=null,this._materialIdReferences=null,this._location.spatialReference=t.view.spatialReference,t)this[i]=t[i];this.view.state&&this.view.state.camera&&this.camera.copyFrom(this.view.state.camera)}return Object(o.a)(e,[{key:"destroy",value:function(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this.camera=null}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}},{key:"renderObjects",get:function(){return this._renderObjects},set:function(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}},{key:"available",get:function(){return this._available},set:function(e){e!==this._available&&(this._available=e,this._updateEngineObject())}},{key:"disableDisplay",value:function(){var e=this;return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),{remove:Object(ni.d)((function(){e._noDisplayCount--,0===e._noDisplayCount&&e._updateEngineObject()}))}}},{key:"radius",get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}},{key:"worldSized",get:function(){return this._worldSized},set:function(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}},{key:"modelTransform",get:function(){return this._modelTransform},set:function(e){Qn(e)&&(this._screenLocationDirty=!0),Object(ce.c)(this._modelTransform,e),this._updateEngineObject()}},{key:"renderLocation",get:function(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=Object(le.b)()),function(e,t,i){switch(e.viewingMode){case"local":return Object(ce.i)(i),!0;case"global":var n=Object(qn.e)(e.renderCoordsHelper.spatialReference);Object($.q)(t,0,aa,0,n.radius),Object($.c)(Object(fe.f)(aa[1]),Object(fe.f)(aa[0]),i)}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation},set:function(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}},{key:"location",get:function(){return this._location},set:function(e){Object(Fn.a)(e,this._location),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}},{key:"elevationAlignedLocation",get:function(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation},set:function(e){Object(Fn.a)(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}},{key:"_updateElevationAlignedLocation",value:function(){this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y;var e=Object(h.k)(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=this.location.spatialReference,this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}},{key:"grabbableForEvent",value:function(){return!0}},{key:"grabbing",get:function(){return this._grabbing},set:function(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}},{key:"hovering",get:function(){return this._hovering},set:function(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}},{key:"selected",get:function(){return this._selected},set:function(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}},{key:"state",get:function(){return this._state},set:function(e){e!==this._state&&(this._state=e,this._updateEngineObject())}},{key:"updateStateEnabled",value:function(e,t){t?this.state|=e:this.state&=~e}},{key:"_setFocused",value:function(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}))}},{key:"focused",get:function(){return this._focused}},{key:"screenLocation",get:function(){return this.ensureScreenLocation(),this._screenLocation}},{key:"ensureScreenLocation",value:function(){if(this._screenLocationDirty){var e;if(this._screenLocation.pixelSize=this.camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,Qn(this._modelTransform)){var t=this._calculateModelTransformOffset(la);e=Object(K.e)(t,t,this.renderLocation)}else e=this.renderLocation;this.camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this.camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}}},{key:"applyObjectTransform",get:function(){return this._applyObjectTransform},set:function(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}},{key:"intersectionDistance",value:function(e,t){if(!this.available)return null;var i=Object(Ve.i)(e,Jn),n=this._getCollisionRadius(t),a=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if(Object(He.j)(this.screenLocation.screenPointArray,i)<n*n)return this.screenLocation.renderScreenPointArray[2]+a;break;case"line":var r=this.collisionType.paths,o=this._getWorldToScreenObjectScale(),s=this._calculateObjectTransform(o,ia),c=n*this.screenLocation.pixelSize,l=Ue.f.fromScreen(this.camera,i,$n);if(Object(h.j)(l))return null;var u,d=Object(R.a)(r);try{for(d.s();!(u=d.n()).done;){var p=u.value;if(0!==p.length)for(var f=Object(K.l)(aa,p[0],s),v=1;v<p.length;v++){var g=Object(K.l)(ra,p[v],s),b=Ue.d.closestRayDistance2(Ue.d.fromPoints(f,g,Kn),l);if(null!=b&&b<c*c){var m=Object(K.e)(Hn.d.get(),f,g);Object(K.d)(m,m,.5);var y=Object(Ve.a)(Hn.d.get());return this.camera.projectToRenderScreen(m,y),y[2]+a}Object(K.j)(f,g)}}}catch(ee){d.e(ee)}finally{d.f()}break;case"disc":var O,j=this.collisionType.direction,_=null!=(O=this.collisionType.offset)?O:J.b,w=this._getWorldToScreenObjectScale(),x=this._calculateObjectTransform(w,ia),M=n*this.screenLocation.pixelSize,S=Ue.f.fromScreen(this.camera,i,$n);if(Object(h.j)(S))return null;var k=Object(Zn.d)(ea,x),E=Object(K.w)(sa,j,k),P=Object(K.l)(ca,_,x);Ue.e.fromPositionAndNormal(P,E,na);var T=oa;if(Ue.e.intersectRay(na,S,T)&&Object(K.k)(T,P)<M*M)return this.screenLocation.renderScreenPointArray[2]+a;break;case"ribbon":var D=this.collisionType,A=D.paths,C=D.direction,I=this._getWorldToScreenObjectScale(),G=this._calculateObjectTransform(I,ia),z=n*this.camera.computeScreenPixelSizeAt(this.renderLocation),L=Ue.f.fromScreen(this.camera,i,$n);if(Object(h.j)(L))return null;var V=Object(Zn.d)(ea,G),H=Object(K.w)(sa,C,V),F=this._calculateModelTransformPosition(ca);Ue.e.fromPositionAndNormal(F,H,na);var U=oa;if(!Ue.e.intersectRay(na,L,U))break;var N,B=Object(R.a)(A);try{for(B.s();!(N=B.n()).done;){var q=N.value;if(0!==q.length)for(var W=Object(K.l)(aa,q[0],G),Z=1;Z<q.length;Z++){var Y=Object(K.l)(ra,q[Z],G),X=Ue.d.distance2(Ue.d.fromPoints(W,Y,Kn),U);if(null!=X&&X<z*z){var Q=Object(K.e)(Hn.d.get(),W,Y);Object(K.d)(Q,Q,.5);var $=Object(Ve.a)(Hn.d.get());return this.camera.projectToRenderScreen(Q,$),$[2]+a}Object(K.j)(W,Y)}}}catch(ee){B.e(ee)}finally{B.f()}break;default:Object(Nn.a)(this.collisionType)}return null}},{key:"attach",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{manipulator3D:{}};if(this.view._stage){var i=t.manipulator3D;if(Object(h.j)(i.engineLayerId)){var n=new bt.a({isPickable:!1});this.view._stage.add(n),i.engineLayerId=n.id,this._engineLayer=n}else null!=(e=this.view._stage)&&e.getObject&&(this._engineLayer=this.view._stage.getObject(i.engineLayerId));i.engineLayerReferences=(i.engineLayerReferences||0)+1,this._materialIdReferences=i.materialIdReferences,Object(h.j)(this._materialIdReferences)&&(this._materialIdReferences=new Map,i.materialIdReferences=this._materialIdReferences),this.camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),Object($.b)(this._location.spatialReference,this.view.spatialReference)||(this.location=new Bn.a({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}}},{key:"detach",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{manipulator3D:{}},t=e.manipulator3D;t.engineLayerReferences--;var i=0===t.engineLayerReferences;i&&(t.engineLayerId=null),this._removeResourcesFromStage(i),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}},{key:"onViewChange",value:function(){this.camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}},{key:"onElevationChange",value:function(e){Object($.m)(this.location,ua,e.spatialReference),Object(tt.f)(e.extent,ua)&&(this.location=this._location)}},{key:"_evaluateElevationAlignment",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.location;if(Object(h.j)(this.elevationInfo))return!1;var t=null,i=0,n=Object(h.r)(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":t=Object(h.r)(Object(Yn.a)(this.view.elevationProvider,e,"ground"),0);break;case"relative-to-ground":i=Object(h.r)(Object(Yn.a)(this.view.elevationProvider,e,"ground"),0)+n;break;case"relative-to-scene":i=Object(h.r)(Object(Yn.a)(this.view.elevationProvider,e,"scene"),0)+n;break;case"absolute-height":i=n}return(i!==this._elevation.offset||t!==this._elevation.override)&&(this._elevation.offset=i,this._elevation.override=t,!0)}},{key:"_updateEngineObject",value:function(){if(this._attached)if(this.available){var e=this._getWorldToScreenObjectScale(),t=ia;if(!0===this.autoScaleRenderObjects){var i=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(i,t)}else this._calculateObjectTransform(e,t);var n,a=this._ensureEngineResources().objectsByState,r=(this.focused?2:1)|(this.selected?8:4),o=this._noDisplayCount>0,s=Object(R.a)(a);try{for(s.s();!(n=s.n()).done;){var c=n.value,l=c.stateMask,u=c.objects;if(o){var d,p=Object(R.a)(u);try{for(p.s();!(d=p.n()).done;){d.value.setVisible(!1)}}catch(j){p.e(j)}finally{p.f()}}else{var f=!(0!=(15&l))||(r&l)==(15&l),v=!(0!=(65520&l))||(this.state&l)==(65520&l);if(f&&v){var g,b=Object(R.a)(u);try{for(b.s();!(g=b.n()).done;){var m=g.value;m.setVisible(!0),m.transformation=t}}catch(j){b.e(j)}finally{b.f()}}else{var y,O=Object(R.a)(u);try{for(O.s();!(y=O.n()).done;){y.value.setVisible(!1)}}catch(j){O.e(j)}finally{O.f()}}}}}catch(j){s.e(j)}finally{s.f()}Object(h.k)(this._engineLayer)&&this._engineLayer.commit()}else this._removeResourcesFromStage()}},{key:"_ensureEngineResources",value:function(){if(Object(h.j)(this._engineResources)){var e=Object(h.q)(this._engineLayer),t=[],i=new Set;this.renderObjects.forEach((function(e){var n=e.material;i.has(n)||(t.push(n),i.add(n))}));var n=new Map;this._renderObjects.forEach((function(e){var t=new gt.a({castShadow:!1});!function(e,t){var i=t.geometry,n=t.material,a=t.transform;Array.isArray(i)?i.forEach((function(t){return e.addGeometry(t,n,a)})):e.addGeometry(i,n,a)}(t,e);var i=e.stateMask||0,a=n.get(i)||[];a.push(t),n.set(i,a)}));var a=[];n.forEach((function(e,t){return a.push({stateMask:t,objects:e})})),this._engineResources={objectsByState:a,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}},{key:"_addResourcesToStage",value:function(){var e=this;if(!this._engineResourcesAddedToStage&&!Object(h.j)(this._engineResources)){var t=this._engineResources,i=t.objectsByState,n=t.layer;t.materials.forEach((function(t){var i=Object(h.q)(e._materialIdReferences),n=i.get(t.id)||0;0===n&&e.view._stage.add(t),i.set(t.id,n+1)})),i.forEach((function(t){return t.objects.forEach((function(t){n.add(t),e.view._stage.add(t)}))})),this._engineResourcesAddedToStage=!0}}},{key:"_removeResourcesFromStage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._engineResourcesAddedToStage&&!Object(h.j)(this._engineResources)){var i=this._engineResources,n=i.objectsByState,a=i.layer,r=i.materials;n.forEach((function(t){var i=t.objects;a.removeMany(i),e.view._stage.removeMany(i)})),r.forEach((function(t){var i=Object(h.q)(e._materialIdReferences),n=i.get(t.id);1===n?(e.view._stage.remove(t),i.delete(t.id)):i.set(t.id,n-1)})),t&&this.view._stage.remove(a),this._engineResourcesAddedToStage=!1}}},{key:"_getCollisionRadius",value:function(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)}},{key:"_getFocusedSize",value:function(e,t){return e*(t?this.focusMultiplier:1)}},{key:"_getWorldToScreenObjectScale",value:function(){return this._worldSized?1:this.screenLocation.pixelSize}},{key:"_calculateModelTransformPosition",value:function(e){var t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,ta);return Object(K.v)(e,i[12],i[13],i[14])}},{key:"_calculateModelTransformOffset",value:function(e){var t=this._calculateModelTransformPosition(e);return Object(K.i)(e,t,this.renderLocation)}},{key:"_calculateObjectTransform",value:function(e,t){return Object(ce.d)(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&Object(ce.l)(t,t,this._worldFrame),Object(ce.l)(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,Object(h.k)(this._applyObjectTransform)&&this._applyObjectTransform(t),t}},{key:"test",get:function(){var e=!1;if(Object(h.k)(this._engineResources))for(var t in this._engineResources.objectsByState){var i,n=this._engineResources.objectsByState[t],a=Object(R.a)(n.objects);try{for(a.s();!(i=a.n()).done;){if(i.value.isVisible){e=!0;break}}}catch(r){a.e(r)}finally{a.f()}if(e)break}return{areAnyResourcesVisible:e}}}]),e}();function Qn(e){return 0!==e[12]||0!==e[13]||0!==e[14]}var Jn=Object(Ve.f)(),Kn=Ue.d.create(),$n=Ue.f.create(),ea=Object(Wn.a)(),ta=Object(le.b)(),ia=Object(le.b)(),na=Ue.e.create(),aa=Object(J.e)(),ra=Object(J.e)(),oa=Object(J.e)(),sa=Object(J.e)(),ca=Object(J.e)(),la=Object(J.e)(),ua=new Bn.a({x:0,y:0,z:0,spatialReference:null});function ha(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,i=Object(E.d)(e[0],e[1],e[2],e.length>3?e[3]:1),n=e[3]<1;return new bn({color:i,transparent:n,writeDepth:!0,cullFace:2,renderOccluded:t})}function da(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,i=Object(E.d)(e[0],e[1],e[2],4===e.length?e[3]:1);return new Un.a({color:i,transparent:!0,writeDepth:!0,cullFace:1,renderOccluded:t})}function pa(e,t,i,n){var a=Object(K.i)(Hn.d.get(),e,i),r=fa(a,Object(K.f)(Hn.d.get(),n,a),i,Hn.a.get());Object(ce.a)(r,r);var o=Object(K.l)(Hn.d.get(),t,r);return Math.atan2(o[1],o[0])}function fa(e,t,i,n){var a=Object(K.q)(Hn.d.get(),e),r=Object(K.q)(Hn.d.get(),t),o=Object(K.f)(Hn.d.get(),a,r);return n[0]=a[0],n[1]=a[1],n[2]=a[2],n[3]=0,n[4]=r[0],n[5]=r[1],n[6]=r[2],n[7]=0,n[8]=o[0],n[9]=o[1],n[10]=o[2],n[11]=0,n[12]=i[0],n[13]=i[1],n[14]=i[2],n[15]=1,n}function va(e,t){var i=e.getViewForGraphic(t);return Object(h.k)(i)&&"computeAttachmentOrigin"in i?i.computeAttachmentOrigin(t,e.spatialReference):null}function ga(e,t,i){var n=va(e,i);Object(h.k)(n)?t.elevationAlignedLocation=n:function(e,t){if(Object(h.j)(t))return;var i=Object(rn.a)(t);Object(h.j)(i)||(e.location=Object(Fn.b)(i))}(t,i.geometry)}var ba=i(761);function ma(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(j.d)(e);return"on-the-ground"!==t.mode&&!(Object(h.j)(e.geometry)||!e.geometry.hasZ)}var ya=i(646),Oa=function(){function e(){Object(r.a)(this,e),this.grabbingState=0,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}return Object(o.a)(e,[{key:"update",value:function(e){var t=this;this.grabbingState=0,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator((function(e,i){if(0===i&&(t.zManipulator=e),e instanceof Xn&&(e.selected&&(0===t.numSelected&&(t.firstSelected=e),t.numSelected++),Object(h.j)(t.firstGrabbedXY)&&e.grabbing&&1===i&&(t.firstGrabbedXY=e)),e.grabbing)switch(t.grabbingState|=1,i){case 0:t.grabbingState|=2;break;case 1:t.grabbingState|=4}}))}}]),e}();function ja(e){var t=e.view,i=e.graphic,n=new Sn({graphic:i}),a=function(e,t){var i=e.view,n=e.graphic,a=new $i({view:i,geometry:wa(n)?n.geometry:null,elevationInfo:Object(j.d)(n),attached:!1});Q.visualElements.lineGraphics.shadowStyle.apply(a);var r=function(){a.attached=t.displaying};Q.visualElements.lineGraphics.outline.apply(a);var o=[t.watch("displaying",r),t.watch("isDraped",(function(e){return a.isDraped=e})),t.on("changed",(function(){return a.geometry=wa(n)?n.geometry:null})),Object(Dn.a)(a)];return r(),{visualElement:a,remove:function(){return Object(Dn.b)(o).remove()}}}(e,n),r=[a,_a(e,a.visualElement,n),t.maskOccludee(i),t.trackGraphicState(n)];return{visualElement:a.visualElement,remove:function(){return Object(Dn.b)(r).remove()}}}function _a(e,t,i){var n=e.graphic,a=e.view,r=[],o=Object(j.d)(n),s="on-the-ground"===o.mode||!o.offset&&"absolute-height"!==o.mode,c=new Oa,l=new ya.a({view:a,extensionType:Q.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});Q.visualElements.pointGraphics.shadowStyle.apply(l);var u=Object(fe.f)(Q.visualElements.heightPlaneAngleCutoff),d=new Yi.a({view:a,attached:!1,angleCutoff:u});Q.visualElements.heightPlane.apply(d);var p=1,f=1,v=function(){if(c.update(e),!i.displaying||s&&(i.isDraped||!wa(n)||!n.geometry.hasZ))return t.laserlineEnabled=!1,l.attached=!1,void(d.attached=!1);t.laserlineEnabled=!0;var a=4&c.grabbingState?Q.visualElements.laserlineAlphaMultiplier:1;a!==p&&(p=a,Q.visualElements.lineGraphics.shadowStyle.apply(t,a),Q.visualElements.pointGraphics.shadowStyle.apply(l,a));var r=2&c.grabbingState?Q.visualElements.laserlineAlphaMultiplier:1;r!==f&&(f=r,Q.visualElements.heightPlane.apply(d,r)),function(e,t){var i=1===t.numSelected?t.firstSelected:t.numSelected>1&&Object(h.k)(t.firstGrabbedXY)?t.firstGrabbedXY:null;Object(h.k)(i)?(e.setStartEndFromWorldDownAtLocation(i.renderLocation),e.attached=!0):e.attached=!1}(l,c),function(e,t,i,n){if(n.numSelected>0){Object(K.v)(xa,0,0,0);var a=0;e.forEachManipulator((function(e,t){1===t&&e.selected&&e instanceof Xn&&(Object(K.e)(xa,xa,e.renderLocation),a++)})),a>0?(i.heightManifoldTarget=Object(K.d)(xa,xa,1/a),i.attached=!0):i.attached=!1}else{var r=t.attachmentOrigin;Object(h.k)(r)&&e.view.renderCoordsHelper.toRenderCoords(r,xa)?(i.heightManifoldTarget=xa,i.attached=!0):i.attached=!1}}(e,t,d,c)};Q.visualElements.zVerticalLine.apply(l),r.push(i.on("changed",v),i.watch("displaying",v),t.events.on("attachment-origin-changed",v),Object(Dn.a)(l),Object(Dn.a)(d));var g=[],b=function(){Object(Dn.b)(g).remove(),g.length=0,e.forEachManipulator((function(e){return g.push(e.events.on("grab-changed",v))})),e.forEachManipulator((function(e){return g.push(e.events.on("select-changed",v))})),v()};return b(),r.push(e.onManipulatorsChanged(b),Object(Dn.d)((function(){return Object(Dn.b)(g)}))),Object(Dn.b)(r)}function wa(e){return Object(h.k)(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}var xa=Object(J.e)(),Ma=i(590);function Sa(e){var t=e.view,i=e.graphic,n=new Sn({graphic:i}),a=[],r=function(e,t,i){var n=e.view,a=e.graphic,r=new Ma.a({view:n,geometry:ka(a)?a.geometry:null,elevationInfo:Object(j.d)(a),attached:!1});return function(e,t,i,n){var a=function(){return t.attached=i.displaying};(function(e,t,i,n){var a=e.view,r=e.graphic,o=null,s=function(){Object(h.k)(o)&&(o.remove(),o=null),i.isDraped&&ka(r)&&(o=function(e,t,i){var n=e.elevationProvider.spatialReference;Object($.n)(t,Ea,n);var a=Ea[0],r=Ea[1];return e.elevationProvider.on("elevation-change",(function(e){Object(tt.h)(e.extent,a,r)&&i()}))}(a,r.geometry,(function(){t.geometry=r.geometry})))},c=function(){s(),t.geometry=ka(r)?r.geometry:null};n.push(i.on("changed",c),Object(Dn.d)((function(){return o}))),c()})(e,t,i,n),Q.visualElements.pointGraphics.outline.apply(t),n.push(Object(m.a)(i,"displaying",a))}(e,r,t,i),i.push(Object(Dn.a)(r)),r}(e,n,a);return function(e,t,i,n){var a=e.view,r=e.graphic,o=new ya.a({view:a,extensionType:Q.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});Q.visualElements.zVerticalLine.apply(o);var s=new Yi.a({view:a,intersectsLineInfinite:!0,attached:!1});Q.visualElements.pointGraphics.shadowStyle.apply(s);var c=Object(fe.f)(Q.visualElements.heightPlaneAngleCutoff),l=new Yi.a({view:a,attached:!1,angleCutoff:c});Q.visualElements.heightPlane.apply(l);var u=Object(j.d)(e.graphic),h=re.a.fromElevationInfo(u),d="on-the-ground"===u.mode||!u.offset&&"absolute-height"!==u.mode,p=new Oa,f=1,v=1,g=function(){p.update(e);var i=d&&(t.isDraped||!ka(r)||!r.geometry.hasZ),c=!0;if(!i&&ka(r)){var u=r.geometry,g=Object(Oe.c)(r.geometry,a.elevationProvider,h,a.renderCoordsHelper);Object(K.v)(Ea,u.x,u.y,g),Object($.p)(Ea,u.spatialReference,Ea,a.renderCoordsHelper.spatialReference),o.setStartEndFromWorldDownAtLocation(Ea),s.intersectsWorldUpAtLocation=Ea}else c=!1;var b=2&p.grabbingState?Q.visualElements.laserlineAlphaMultiplier:1;b!==f&&(f=b,Q.visualElements.heightPlane.apply(l,b));var m=Object(te.e)(Ra);!i&&t.displaying&&n.calculateMapBounds(m)&&Object($.p)(Object(te.m)(m,Ea),a.spatialReference,Ea,a.renderCoordsHelper.spatialReference)?(l.heightManifoldTarget=Ea,l.attached=!0):l.attached=!1;var y=4&p.grabbingState?Q.visualElements.laserlineAlphaMultiplier:1;y!==v&&(v=y,Q.visualElements.pointGraphics.shadowStyle.apply(s,y));var O=c&&t.displaying&&!i;s.attached=O,o.attached=O};i.push(t.watch(["displaying","isDraped"],g),t.on("changed",g)),e.forEachManipulator((function(e){i.push(e.events.on("grab-changed",g))})),i.push(Object(Dn.a)(s)),i.push(Object(Dn.a)(o)),i.push(Object(Dn.a)(l)),g()}(e,n,a,r),a.push(t.trackGraphicState(n)),{visualElement:r,remove:function(){Object(Dn.b)(a).remove()}}}function ka(e){return Object(h.k)(e.geometry)&&"point"===e.geometry.type}var Ea=Object(J.e)(),Ra=Object(te.d)();function Pa(e){switch(Object(h.q)(e.graphic.geometry).type){case"point":return Sa(e);case"polygon":case"polyline":return ja(e);default:return null}}var Ta=[1,.5,0],Da=70,Aa=Math.ceil(Da/3*2),Ca=160,Ia=5*Math.PI/12,Ga=1*Math.PI/3;function za(e,t,i){var n=e.graphic,a=function(e,i){return t({action:e,graphic:n,dxScreen:i.screenDeltaX,dyScreen:i.screenDeltaY})};return i((function(e,t,i){var r=t.next((function(e){return"start"===e.action&&a("start",e),e})).next(Object(zn.g)(n)).next((function(e){switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&a("update",e);break;case"end":a("end",e)}return e}));return i.next(Object(zn.i)(n)).next((function(){a("end",{screenDeltaX:0,screenDeltaY:0})})),r}))}function La(e){if(Object(h.j)(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;var t=("polyline"===e.type?e.paths:e.rings)[0];if(!t||t.length<2)return 0;var i=t[0],n=t[1];return Math.atan2(n[1]-i[1],n[0]-i[0])}var Va=function(){function e(){Object(r.a)(this,e),this._available=!0}return Object(o.a)(e,[{key:"location",set:function(e){this.forEachManipulator3D((function(t){return t.location=e}))}},{key:"elevationAlignedLocation",set:function(e){this.forEachManipulator3D((function(t){return t.elevationAlignedLocation=e}))}},{key:"elevationInfo",set:function(e){this.forEachManipulator3D((function(t){return t.elevationInfo=e}))}},{key:"available",get:function(){return this._available},set:function(e){this._available=e,this.forEachManipulator3D((function(t){return t.available=e}))}},{key:"grabbing",get:function(){return this.someManipulator((function(e){return e.grabbing}))}},{key:"dragging",get:function(){return this.someManipulator((function(e){return e.dragging}))}},{key:"hasManipulator",value:function(e){return this.someManipulator((function(t){return t===e}))}},{key:"someManipulator",value:function(e){var t=!1;return this.forEachManipulator((function(i){!t&&e(i)&&(t=!0)})),t}},{key:"forEachManipulator3D",value:function(e){this.forEachManipulator((function(t,i){t instanceof Xn&&e(t,i)}))}}]),e}(),Ha=1e-5,Fa=function(){function e(t){Object(r.a)(this,e),this.options=new Le.a,this.results=new Le.c,this.transform=new Le.d,this.performanceInfo={queryDuration:0,numObjectsTested:0},this.tolerance=Ha,this.verticalOffset=null,this._ray={origin:Object(J.e)(),direction:Object(J.e)()},this._rayEndPoint=Object(J.e)(),this._rayStartPointTransformed=Object(J.e)(),this._rayEndPointTransformed=Object(J.e)(),this.viewingMode=null==t?1:t}return Object(o.a)(e,[{key:"ray",get:function(){return this._ray}},{key:"rayBeginPoint",get:function(){return this._ray.origin}},{key:"rayEndPoint",get:function(){return this._rayEndPoint}},{key:"reset",value:function(e,t){this.resetWithRay(Ue.f.fromPoints(e,t,this._ray))}},{key:"resetWithRay",value:function(e){e!==this._ray&&Ue.f.copy(e,this._ray),0!==this.options.verticalOffset?2===this.viewingMode?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,Object(K.e)(this._rayEndPoint,this._ray.origin,this._ray.direction),this._numObjectsTested=0,this.results.init(this._ray)}},{key:"intersect",value:function(e,t,i,n,a,r){var o=this;this.point=t,this.camera=i,this.filterPredicate=a,this.tolerance=null==n?Ha:n;var s=Object(Le.f)(this.verticalOffset),c=r?function(e){r(e)&&o.intersectObject(e)}:function(e){o.intersectObject(e)};if(e&&e.length>0){var l,u=Object(R.a)(e);try{for(u.s();!(l=u.n()).done;){var d=l.value,p=d.getSpatialQueryAccelerator&&d.getSpatialQueryAccelerator();Object(h.k)(p)?(Object(h.k)(s)?p.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,c,s):p.forEachAlongRay(this._ray.origin,this._ray.direction,c),this.options.selectionMode&&this.options.hud&&p.forEachDegenerateObject(c)):d.getObjects().forAll((function(e){return c(e)}))}}catch(f){u.e(f)}finally{u.f()}}this.sortResults()}},{key:"intersectObject",value:function(e){var t=this;this._numObjectsTested++;var i=e.geometryRecords;if(i){var n,a,r=e.id,o=e.transformation,s=Object(Le.f)(this.verticalOffset),c=Object(R.a)(i);try{var l=function(){var i=a.value,c=i.geometry,l=i.material,u=i.instanceParameters;if(Object(he.d)(u))return"continue";n=c.id,t.transform.setAndInvalidateLazyTransforms(o,i.getShaderTransformation()),Object(K.l)(t._rayStartPointTransformed,t._ray.origin,t.transform.inverse),Object(K.l)(t._rayEndPointTransformed,t._rayEndPoint,t.transform.inverse);var d=t.transform.transform;Object(h.k)(s)&&(s.objectTransform=t.transform),l.intersect(c,u,t.transform.transform,t,t._rayStartPointTransformed,t._rayEndPointTransformed,(function(i,a,o,s,c,l){if(i>=0){if(Object(h.k)(t.filterPredicate)&&!t.filterPredicate(t._ray.origin,t._rayEndPoint,i))return;var u="Object3D ".concat(r);if(c)return void((null==t.results.hud.dist||i<t.results.hud.dist)&&t.results.hud.set(e,u,i,a,le.a,s,l,n,o));var p=function(t){return t.set(e,u,i,a,d,s,null,n,o)};if((null==t.results.min.drapedLayerOrder||s>=t.results.min.drapedLayerOrder)&&(null==t.results.min.dist||i<t.results.min.dist)&&p(t.results.min),0!==t.options.store&&(null==t.results.max.drapedLayerOrder||s<t.results.max.drapedLayerOrder)&&(null==t.results.max.dist||i>t.results.max.dist)&&p(t.results.max),2===t.options.store){var f=new Le.b(t._ray);p(f),t.results.all.push(f)}}}),i.shaderTransformation)};for(c.s();!(a=c.n()).done;)l()}catch(u){c.e(u)}finally{c.f()}}}},{key:"sortResults",value:function(){this.results.all.sort((function(e,t){return e.dist!==t.dist?e.dist-t.dist:e.drapedLayerOrder!==t.drapedLayerOrder?(void 0!==e.drapedLayerOrder?e.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==t.drapedLayerOrder?t.drapedLayerOrder:Number.MAX_VALUE):(void 0!==t.drapedLayerGraphicOrder?t.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==e.drapedLayerGraphicOrder?e.drapedLayerGraphicOrder:Number.MIN_VALUE)}))}}]),e}();function Ua(e,t){var i=Object(J.e)(),n=Object(J.e)(),r=!1;return function(o){if("start"===o.action){var s=Object(Ve.i)(o.screenStart,Object(Ve.c)(Hn.c.get())),c=Ue.f.fromScreen(e.state.camera,s,Xa);Object(h.k)(c)&&(r=Ue.e.intersectRay(t,c,i))}if(!r)return null;var l=Object(Ve.i)(o.screenEnd,Object(Ve.c)(Hn.c.get())),u=Ue.f.fromScreen(e.state.camera,l,Xa);return Object(h.j)(u)?null:Ue.e.intersectRay(t,u,n)?Object(a.a)(Object(a.a)({},o),{},{renderStart:i,renderEnd:n,plane:t,ray:u}):null}}function Na(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=null;return function(s){if("start"===s.action&&(o=e.sceneIntersectionHelper.intersectElevationFromScreen(Object(Ve.f)(s.screenStart.x,s.screenStart.y),t,i,r),Object(h.k)(o)&&Object(h.k)(n)&&!Object($.m)(o,o,n)))return null;if(Object(h.j)(o))return null;var c=e.sceneIntersectionHelper.intersectElevationFromScreen(Object(Ve.f)(s.screenEnd.x,s.screenEnd.y),t,i,r);return Object(h.k)(c)?Object(h.k)(n)&&!Object($.m)(c,c,n)?null:Object(a.a)(Object(a.a)({},s),{},{mapStart:o,mapEnd:c}):null}}function Ba(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return Na(e,i,Object(j.f)(t,e,i),n,a)}function qa(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return Ba(e,i,Object(j.d)(t),n,a)}function Wa(e,t,i){var n=null,r=new zn.a;return r.next(Ua(e,function(e,t){var i=Za,n=Ya,a=Ue.e.create();e.renderCoordsHelper.worldUpAtPosition(t,i);var r=Object(K.f)(a,i,Object(K.i)(n,t,e.state.camera.eye));return Object(K.f)(r,r,i),Ue.e.fromPositionAndNormal(t,r,a)}(e,t))).next(function(e,t){var i=Object(J.e)(),n=Object(K.o)(t);e.renderCoordsHelper.worldUpAtPosition(t,i);var a=Object(J.e)(),r=Object(J.e)(),o=function(a){return Object(K.i)(a,a,t),Ue.h.projectPoint(i,a,a),"global"===e.viewingMode&&Object(K.o)(a)*Object(fe.q)(Object(K.g)(i,a))<.001-n&&Object(K.i)(a,Object(K.d)(a,i,.001),t),Object(K.e)(a,a,t),a};return function(e){return e.renderStart=o(Object(K.j)(a,e.renderStart)),e.renderEnd=o(Object(K.j)(r,e.renderEnd)),e}}(e,t)).next(function(e,t){var i=e.renderCoordsHelper;return function(e){var n=i.fromRenderCoords(e.renderStart,t),r=i.fromRenderCoords(e.renderEnd,t);return Object(h.k)(n)&&Object(h.k)(r)?Object(a.a)(Object(a.a)({},e),{},{mapStart:n,mapEnd:r}):null}}(e,i)).next((function(e){e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,n=e})),function(e){return n=null,r.execute(e),n}}Fa.DEFAULT_TOLERANCE=Ha;var Za=Object(J.e)(),Ya=Object(J.e)(),Xa=Ue.f.create(),Qa=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this))._handles=new Ee.a,n._arrowManipulatorInfos=new Array,n._opaqueMaterial=n.createMaterial(),n._transparentMaterial=n.createMaterial(.5),n._angle=0,n._scale=1,n._radius=Da,n._updateAfterDrag=!1,n.events=new g.a,n._tool=e.tool,n._view=e.view,null!=e.radius&&(n._radius=e.radius),n._createManipulators(),n.forEachManipulator((function(e){return n._tool.manipulators.add(e)})),n}return Object(o.a)(i,[{key:"orthogonalAvailable",set:function(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e}},{key:"destroy",value:function(){var e=this;this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._handles.removeAll(),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}},{key:"forEachManipulator",value:function(e){this._arrowManipulatorInfos.map((function(t){var i=t.manipulator;return e(i,1)}))}},{key:"createGraphicDragPipeline",value:function(e,t,i){var n=this,a=t.graphic,r=Object(j.d)(a),o=Object(h.q)(a.geometry).spatialReference;return za(t,i,(function(t){return n.createDragPipeline((function(i,n,a,r,o){return t(i,e(i,n,a,r,o),a)}),r,o,a)}))}},{key:"createDragPipeline",value:function(e,t,i,n){var r=this;return Object(Dn.b)(this._arrowManipulatorInfos.map((function(o,s){var c=o.manipulator;return Object(zn.e)(c,(function(o,c,l,u,h){var d=c.next((function(e){return Object(a.a)(Object(a.a)({},e),{},{manipulatorType:1})})).next(Object(zn.f)(r._view,o.elevationAlignedLocation)).next(Ba(r._view,o.elevationAlignedLocation,t,i,n)).next(Object(zn.d)(o.location,r.angle+(s+1)*Math.PI*.5)).next(Object(zn.c)());e(o,d,l,u,h)}))})))}},{key:"angle",get:function(){return this._angle},set:function(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}},{key:"displayScale",get:function(){return this._scale},set:function(e){this._scale=e,this._updateManipulatorTransform()}},{key:"radius",get:function(){return this._radius},set:function(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}},{key:"_updateManipulators",value:function(){for(var e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}},{key:"_updateArrowManipulator",value:function(e,t){var i=e.manipulator,n=e.transform,a=this._radius/Da,r=54*a,o=Math.sqrt(r*r*3/4),s=an.a.createExtrudedTriangle(o,r/2,r/2,.02);an.a.transformInPlace(s,Object(ce.s)(Hn.a.get(),Object(K.v)(Hn.d.get(),0,-o/3,0))),i.renderObjects=[{geometry:s,material:this._opaqueMaterial,stateMask:2},{geometry:s,material:this._transparentMaterial,stateMask:1}],i.radius=o/3*2*1.2;var c=Object(ce.i)(Hn.a.get());Object(ce.t)(c,t*Math.PI/2);var l=Object(ce.i)(Hn.a.get());Object(ce.s)(l,Object(K.v)(Hn.d.get(),0,100*a,0)),Object(ce.l)(n,c,l)}},{key:"_createManipulators",value:function(){for(var e=0;e<4;e++){var t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}},{key:"_updateManipulatorTransform",value:function(){var e=this.angle,t=Object(ce.i)(Hn.a.get());Object(ce.p)(t,t,e,Object(J.g)(0,0,1));var i=Object(ce.n)(Hn.a.get(),Object(K.v)(Hn.d.get(),this.displayScale,this.displayScale,this.displayScale)),n=Object(ce.i)(Hn.a.get());Object(ce.l)(n,i,t);var a,r=Object(R.a)(this._arrowManipulatorInfos);try{for(r.s();!(a=r.n()).done;){var o=a.value,s=Object(ce.l)(Hn.a.get(),n,o.transform);o.manipulator.modelTransform=s}}catch(c){r.e(c)}finally{r.f()}}},{key:"_createArrowManipulator",value:function(e){var t=this,i=new Xn({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:Object(J.g)(0,0,1)}}),n={manipulator:i,transform:Object(le.b)()};return this._updateArrowManipulator(n,e),this._handles.add(i.events.on("drag",(function(e){t._updateAfterDrag&&"end"===e.action&&!t.dragging&&(t._updateManipulatorTransform(),t._updateAfterDrag=!1)}))),n}},{key:"createMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=S.a.toUnitRGBA(C.main);return t[3]*=e,new Un.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}},{key:"test",get:function(){return{arrowManipulators:this._arrowManipulatorInfos.map((function(e){return e.manipulator}))}}}]),i}(Va),Ja=function(){function e(){Object(r.a)(this,e),this.view=null,this.elevationInfo=null,this.lastDragEvent=null,this.next=new zn.a,this._enabled=!1}return Object(o.a)(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&Object(h.k)(this.lastDragEvent)){var t=this.lastDragEvent.mapEnd,i=this.snap(this.lastDragEvent.screenEnd);if(Object(h.k)(i)){var n={action:"update",mapStart:this.lastDragEvent.mapStart,mapEnd:!0===e?i:t,screenStart:this.lastDragEvent.screenEnd,screenEnd:this.lastDragEvent.screenEnd};this.next.execute(n)}}this._enabled=e}},{key:"snap",value:function(e){var t=Object(h.k)(this.view)?this.view.toMap(e,{exclude:[]}):null;return Object(h.k)(t)&&Object(h.k)(this.view)&&(t.z=Object(j.f)(t,this.view,this.elevationInfo)),t}},{key:"createDragEventPipelineStep",value:function(e,t){var i=this;return this.view=e,this.elevationInfo=t,this.lastDragEvent=null,function(e){if(i.lastDragEvent="end"!==e.action?Object(a.a)({},e):null,i._enabled){var t=i.snap(e.screenEnd);return Object(h.k)(t)?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}}}]),e}(),Ka=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this))._handles=new Ee.a,n._snapToScene=new Ja,n._discMaterial=n._createMaterial(),n._discMaterialTransparent=n._createMaterial(.5),n._scale=1,n._radius=Da,n._view=e.view,n._tool=e.tool,null!=e.snapToScene&&(n.snapToScene=e.snapToScene),null!=e.radius&&(n._radius=e.radius),n._createManipulator(),n.forEachManipulator((function(e){return n._tool.manipulators.add(e)})),n}return Object(o.a)(i,[{key:"destroy",value:function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null}},{key:"forEachManipulator",value:function(e){e(this._manipulator,1)}},{key:"displayScale",get:function(){return this._scale},set:function(e){this._scale=e,this._updateManipulatorTransform()}},{key:"snapToScene",get:function(){return this._snapToScene.enabled},set:function(e){this._snapToScene.enabled=e}},{key:"radius",get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}},{key:"createGraphicDragPipeline",value:function(e,t,i){var n=this,a=t.graphic,r=Object(j.d)(a),o=Object(h.q)(a.geometry).spatialReference;return za(t,i,(function(t){return n.createDragPipeline((function(i,n,a,r,o){return t(i,e(i,n,a,r,o),a)}),r,o,a)}))}},{key:"createDragPipeline",value:function(e,t,i,n){var r=this,o=this._view;return Object(zn.e)(this._manipulator,(function(s,c,l,u,h){var d=c.next(Object(zn.f)(o,s.elevationAlignedLocation)).next(Ba(o,s.elevationAlignedLocation,t,i,n)).next(r._snapToScene.createDragEventPipelineStep(o,t),r._snapToScene.next).next((function(e){return Object(a.a)(Object(a.a)({},e),{},{manipulatorType:1})})).next(Object(zn.c)());e(s,d,l,u,h)}))}},{key:"_updateManipulatorTransform",value:function(){var e=Object(ce.n)(Hn.a.get(),Object(K.v)(Hn.d.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}},{key:"_createManipulator",value:function(){var e=this._view;this._manipulator=new Xn({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:Object(J.g)(0,0,1)},worldOriented:!0}),this._updateManipulator()}},{key:"_updateManipulator",value:function(){var e=an.a.createCylinderGeometry(.02,1,128,Object(J.g)(0,0,1),Object(J.g)(0,0,0)),t=Object(ce.n)(Object(le.b)(),Object(J.g)(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:e,material:this._discMaterial,transform:t,stateMask:2},{geometry:e,material:this._discMaterialTransparent,transform:t,stateMask:1}],this._manipulator.radius=this._radius/Da*80}},{key:"_createMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=S.a.toUnitRGBA(C.main);return t[3]*=e,new Un.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}},{key:"test",get:function(){return{discManipulator:this._manipulator}}}]),i}(Va),$a=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this))._handles=new Ee.a,n._radius=Da,n.events=new g.a,n._tool=e.tool,n._view=e.view,null!=e.radius&&(n._radius=e.radius),n.createManipulator(),n.forEachManipulator((function(e){return n._tool.manipulators.add(e)})),n}return Object(o.a)(i,[{key:"destroy",value:function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()}))}},{key:"forEachManipulator",value:function(e){e(this._manipulator,0)}},{key:"createGraphicDragPipeline",value:function(e,t,i){var n=this,a=Object(h.q)(t.graphic.geometry).spatialReference;return za(t,i,(function(t){return n.createDragPipeline((function(i,n,a,r,o){return t(i,e(i,n,a,r,o),a)}),a)}))}},{key:"createDragPipeline",value:function(e,t){var i=this._view;return Object(zn.e)(this._manipulator,(function(n,r,o,s,c){var l=r.next((function(e){return Object(a.a)(Object(a.a)({},e),{},{manipulatorType:0})})).next(Wa(i,n.renderLocation,t)).next(Object(zn.c)());e(n,l,o,s,c)}))}},{key:"radius",get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this.updateManipulator())}},{key:"updateManipulator",value:function(){var e=this._radius/Da,t=Q.zManipulator.height*e,i=Q.zManipulator.coneHeight*e,n=Q.zManipulator.coneWidth*e,a=Q.zManipulator.width*e,r=[Object(J.g)(0,0,0),Object(J.g)(0,0,t)],o=an.a.createTubeGeometry(r,a/2,16,!1),s=an.a.createConeGeometry(i,n/2,16,!1),c=[Object(J.g)(0,0,0),Object(J.g)(0,0,t+i)],l=function(e){var i=Object(le.b)();return Object(ce.r)(i,i,[0,0,t]),Object(ce.e)(i,i,Math.PI/2),i}(),u=function(e,t){var i=Object(k.a)(Q.zManipulator.color,t);return[i.r/255,i.g/255,i.b/255,Q.zManipulator.color.a*e]},h=ha(u(1,.25),1),d=ha(u(1,0),1),p=ha(u(.7,0),Q.zManipulator.renderOccluded),f=ha(u(.85,0),Q.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:s,transform:l,material:h,stateMask:1},{geometry:o,material:h,stateMask:1},{geometry:s,transform:l,material:d,stateMask:2},{geometry:o,material:d,stateMask:2},{geometry:s,transform:l,material:p,stateMask:1},{geometry:o,material:p,stateMask:1},{geometry:s,transform:l,material:f,stateMask:2},{geometry:o,material:f,stateMask:2}],this._manipulator.radius=a/2+2,this._manipulator.collisionType={type:"line",paths:[c]}}},{key:"createManipulator",value:function(){var e=this,t=new Xn({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=function(t){var i=e._view.state.camera,n=er;e._view.renderCoordsHelper.toRenderCoords(e._manipulator.elevationAlignedLocation,n);var a=Object(K.z)(i.eye,n),r=i.computeRenderPixelSizeAtDist(a),o=Object(K.i)(tr,n,i.eye);Object(K.q)(o,o);var s=ir;e._view.renderCoordsHelper.worldUpAtPosition(er,s);var c=Math.abs(Object(K.g)(o,s)),l=Object(K.f)(tr,o,s),u=Object(K.f)(tr,l,s),h=Object(fe.d)(c,.01,1),d=1-Math.sqrt(1-h*h)/h/i.fullWidth,p=e._radius/Da,f=Q.zManipulator.width*p;Object(K.d)(u,Object(K.q)(u,u),(1/d-1)*a+r*f),t[12]-=tr[0],t[13]-=tr[1],t[14]-=tr[2]},this._manipulator=t,this.updateManipulator()}}]),i}(Va),er=Object(J.e)(),tr=Object(J.e)(),ir=Object(J.e)(),nr=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e){var n;Object(r.a)(this,i),(n=t.call(this))._handles=new Ee.a,n._angleDeferred=null,n._interactive=!0;var a=e.tool,o=e.view,s=e.snapToScene,c=e.radius;return n._view=o,n.xyManipulation=new Ka({tool:a,view:o,snapToScene:s,radius:c}),n.xyAxisManipulation=new Qa({tool:a,view:o,radius:c}),n.zManipulation=new $a({tool:a,view:o,radius:c}),n.xyManipulation.available=e.xyAvailable,n.xyAxisManipulation.available=e.xyAxisAvailable,n.zManipulation.available=e.zAvailable,n.autoHideXYAxis(),n.forEachManipulator((function(e){n._handles.add(e.events.on("grab-changed",(function(){return n.updateManipulatorInteractivity()})))})),n}return Object(o.a)(i,[{key:"destroy",value:function(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}},{key:"createGraphicDragPipeline",value:function(e,t,i){return Object(Dn.b)([this.xyManipulation.createGraphicDragPipeline((function(t,i,n,a,r){return e(0,t,i,n,a,r)}),t,i),this.xyAxisManipulation.createGraphicDragPipeline((function(t,i,n,a,r){return e(1,t,i,n,a,r)}),t,i),this.zManipulation.createGraphicDragPipeline((function(t,i,n,a,r){return e(2,t,i,n,a,r)}),t,i)])}},{key:"createDragPipeline",value:function(e,t,i,n){return Object(Dn.b)([this.xyManipulation.createDragPipeline((function(t,i,n,a,r){return e(0,t,i,n,a,r)}),t,i,n),this.xyAxisManipulation.createDragPipeline((function(t,i,n,a,r){return e(1,t,i,n,a,r)}),t,i,n),this.zManipulation.createDragPipeline((function(t,i,n,a,r){return e(2,t,i,n,a,r)}),i)])}},{key:"snapToScene",set:function(e){this.xyManipulation.snapToScene=e}},{key:"angle",set:function(e){this._angleDeferred=null,this.xyAxisManipulation.angle=e}},{key:"angleDeferred",set:function(e){this.xyAxisVisible?this.angle=e():this._angleDeferred=e}},{key:"interactive",set:function(e){this._interactive!==e&&(this._interactive=e,this.updateManipulatorInteractivity())}},{key:"radius",set:function(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}},{key:"displayScale",set:function(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}},{key:"forEachManipulator",value:function(e){this.xyManipulation.forEachManipulator((function(t){return e(t,1)})),this.xyAxisManipulation.forEachManipulator((function(t){return e(t,1)})),this.zManipulation.forEachManipulator((function(t){return e(t,0)}))}},{key:"xyAxisVisible",get:function(){var e=this.xyManipulation.someManipulator((function(e){return e.focused}))||this.xyAxisManipulation.someManipulator((function(e){return e.focused}));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}},{key:"autoHideXYAxis",value:function(){var e=this,t=this.xyAxisManipulation,i=this.xyManipulation;if(!Object(u.a)("esri-mobile")){var n=[];i.forEachManipulator((function(e){return n.push(e)})),t.forEachManipulator((function(e){return n.push(e)}));for(var a=function(){var i=[];e.xyAxisVisible?Object(h.k)(e._angleDeferred)&&(e.angle=e._angleDeferred()):t.forEachManipulator((function(e){return i.push(e.disableDisplay())})),e._handles.remove(ar),e._handles.add(i,ar)},r=0,o=n;r<o.length;r++){var s=o[r];this._handles.add(s.events.on("focus-changed",a))}this._view.inputManager&&this._handles.add(this._view.inputManager.watch("latestPointerType",a)),a()}}},{key:"updateManipulatorInteractivity",value:function(){var e=this,t=this.grabbing;this.forEachManipulator((function(i){i.interactive=!t&&e._interactive||i.grabbing}))}}],[{key:"radiusForSymbol",value:function(e){var t=Object(h.k)(e)&&"point-3d"===e.type&&e.symbolLayers;return t&&t.length>0&&t.some((function(e){return"icon"===e.type}))?Aa:Da}}]),i}(Va),ar="disable-xy-axis-display",rr=i(1160),or=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this))._handles=new Ee.a,n._view=e.view,n._tool=e.tool,n._graphicState=e.graphicState,n._createManipulator(),n.forEachManipulator((function(e){return n._tool.manipulators.add(e)})),n}return Object(o.a)(i,[{key:"destroy",value:function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}},{key:"forEachManipulator",value:function(e){e(this._manipulator,1)}},{key:"createGraphicDragPipeline",value:function(e){var t=this;return za(this._graphicState,e,(function(e){return t.createDragPipeline(e)}))}},{key:"createDragPipeline",value:function(e){var t=this._view,i=this._graphicState.graphic,n=Object(h.k)(i.geometry)?i.geometry.spatialReference:null;return Object(zn.e)(this._manipulator,(function(a,r,o,s,c){var l=r.next(function(e,t,i,n){var a=t.toMap(e.screenStart,{include:[i]});return Object(h.k)(a)?qa(t,i,a,n):null}(c,t,i,n)).next(Object(zn.b)()).next(Object(zn.c)());e(a,l,o,s,c)}))}},{key:"_createManipulator",value:function(){var e=this._view,t=this._graphicState.graphic;this._manipulator=new rr.a({graphic:t,view:e,selectable:!0,cursor:"move"})}}]),i}(Va),sr=function e(t){Object(r.a)(this,e),this.allGraphics=t,this.type="graphic-move-start"},cr=function e(t,i,n){Object(r.a)(this,e),this.dx=t,this.dy=i,this.allGraphics=n,this.type="graphic-move"},lr=function e(t){Object(r.a)(this,e),this.allGraphics=t,this.type="graphic-move-stop"},ur=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e)).graphics=new An.a,n.enableZ=!0,n.type="move-3d",n._toolHandles=new Ee.a,n._handles=new Ee.a,n.snappingPipeline=new Ln.a,n}return Object(o.a)(i,[{key:"initialize",value:function(){var e=this;this._toolHandles.add([this.graphics.on("change",(function(){return e._refreshManipulators()}))]),this._refreshManipulators()}},{key:"destroy",value:function(){this._handles.destroy(),this._handles=null,this._toolHandles.destroy(),this._toolHandles=null,this.graphics.removeAll(),this._set("view",null)}},{key:"reset",value:function(){}},{key:"_refreshManipulators",value:function(){var e=this;this._handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();var t=this.graphics.toArray().filter((function(e){return 0===Object(ba.a)(e)})).map((function(e){return new hr(e)}));t.length&&(this.createManipulators(t),this.createVisualElements(t),this._handles.add(t.map((function(t){return e.view.trackGraphicState(t.state)}))),this.updateMoveManipulation(t))}},{key:"createManipulators",value:function(e){var t,i=this,n=Object(R.a)(e);try{var r=function(){var n=t.value,r=n.state;n.manipulationXY=new or({tool:i,view:i.view,graphicState:r}),n.manipulationXY.forEachManipulator((function(e){return i._handles.add(e.events.on("immediate-click",(function(e){i.emit("immediate-click",Object(a.a)(Object(a.a)({},e),{},{graphic:r.graphic})),e.stopPropagation()})))})),i._handles.add(n.manipulationXY.createDragPipeline((function(t,n,a,r){return i.buildDragEventPipeline(e,0,t,n,a,r)})))};for(n.s();!(t=n.n()).done;)r()}catch(o){n.e(o)}finally{n.f()}this.createMoveManipulation(e)}},{key:"createMoveManipulation",value:function(e){var t=this,i=new nr({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?nr.radiusForSymbol(e[0].graphic.symbol):Da});this._moveManipulation=i,i.elevationInfo={mode:"absolute-height",offset:0},i.forEachManipulator((function(e){t._handles.add(e.events.on("immediate-click",(function(n){i.zManipulation.hasManipulator(e)||1!==t.graphics.length||t.emit("immediate-click",Object(a.a)(Object(a.a)({},n),{},{graphic:t.graphics.getItemAt(0)})),n.stopPropagation()})))}));var n,r=function(){return t.updateMoveManipulation(e)},o=Object(R.a)(e);try{for(o.s();!(n=o.n()).done;){var s=n.value;this._handles.add([s.state.on("changed",r),s.state.watch("displaying",r)])}}catch(l){o.e(l)}finally{o.f()}var c=e[e.length-1];this._handles.add(c.state.on("changed",(function(){return t.updateMoveManipulationAngle(c)}))),this._handles.add(i.createDragPipeline((function(i,n,a,r,o){return t.buildDragEventPipeline(e,i,n,a,r,o)}),Object(j.d)(c.graphic),Object(h.q)(c.graphic.geometry).spatialReference,c.graphic)),this.updateMoveManipulationAngle(c)}},{key:"createVisualElements",value:function(e){var t,i=this,n=Object(R.a)(e);try{var a=function(){var n=t.value,a=n.graphic,r=Pa({view:i.view,graphic:a,forEachManipulator:function(e){n.manipulationXY.forEachManipulator(e),i._moveManipulation.forEachManipulator(e)},onManipulatorsChanged:function(){return Object(Dn.c)()}});n.geometryRepresentation=r.visualElement,n.geometryRepresentation instanceof $i&&i._handles.add([n.geometryRepresentation.events.on("attachment-origin-changed",(function(){n.state.isDraped||i.updateMoveManipulation(e)})),n.state.watch("isDraped",(function(){return i.updateMoveManipulation(e)}))]),i._handles.add(r)};for(n.s();!(t=n.n()).done;)a()}catch(r){n.e(r)}finally{n.f()}}},{key:"updateMoveManipulationAngle",value:function(e){this._moveManipulation.angleDeferred=function(){return La(e.graphic.geometry)}}},{key:"updateMoveManipulation",value:function(e){var t,i=Object(ne.d)(0,0,0,this.view.spatialReference),n=0,a=!1,r=this._moveManipulation,o=Object(R.a)(e);try{for(o.s();!(t=o.n()).done;){var s=t.value;if(s.state.displaying){var c=s.state.graphic;this.enableZ&&ma(c)&&(a=!0);var l=s.geometryRepresentation instanceof $i&&!s.state.isDraped?s.geometryRepresentation.attachmentOrigin:va(this.view,c);Object(h.k)(l)&&(i.x+=l.x,i.y+=l.y,i.z+=l.z,n++)}}}catch(u){o.e(u)}finally{o.f()}n>0?(i.x/=n,i.y/=n,i.z/=n,r.location=i,r.xyManipulation.available=!0,r.xyAxisManipulation.available=!0,r.zManipulation.available=a):r.available=!1}},{key:"buildDragEventPipeline",value:function(e,t,i,n,a,r){var o=this,s=[],c=[],l=null,u=null,h=function(){var e,t=Object(R.a)(s);try{for(t.s();!(e=t.n()).done;){e.value.dragging=!1}}catch(i){t.e(i)}finally{t.f()}s.length=0,c.length=0,l=null,u=null,o._moveManipulation.interactive=!0};if(1===e.length&&0===t){var d=e[0].graphic;n=this.buildSnappingPipelineSteps(d,Object(j.d)(d),n,a,r)}var p=n.next((function(t){if("start"===t.action){s.length=0,c.length=0;var n,a=Object(R.a)(e);try{for(a.s();!(n=a.n()).done;){var r=n.value;r.dragging||!r.manipulationXY.hasManipulator(i)&&r.manipulationXY.grabbing||(s.push(r),c.push(r.graphic),r.dragging=!0)}}catch(h){a.e(h)}finally{a.f()}if(0!==c.length&&(o._moveManipulation.interactive=!1,l=Object(zn.h)(c),u=Object(zn.j)(c),o.emit("graphic-move-start",new sr(c)),o.destroyed))return null}return 0!==c.length?t:null})).next((function(e){return l(e)})).next((function(e){switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){var t=o.view.toScreen(e.mapStart),i=o.view.toScreen(e.mapEnd),n=i.x-t.x,a=i.y-t.y;if(o.emit("graphic-move",new cr(n,a,c)),o.destroyed)return null}break;case"end":if(o.emit("graphic-move-stop",new lr(c)),o.destroyed)return null;h()}}));return a.next((function(e){return u(e)})).next((function(){if(o.emit("graphic-move-stop",new lr(c)),o.destroyed)return null;h()})),p}},{key:"buildSnappingPipelineSteps",value:function(e,t,i,n,r){var o=this,s=e.geometry;if(Object(h.j)(s)||"point"!==s.type)return i;var c=new Gn.a({elevationInfo:t,pointer:r,geometry:new In.a(Cn.c.fromGeometry(s,this.view.viewingMode),"point"),visualizer:new Vn.a,excludeFeature:e}),l=this.snappingManager;return i.next((function(t){var i=s.clone();return i.z=Object(j.a)(o.view,i,Object(j.d)(e),{mode:"absolute-height",offset:0}),Object(a.a)(Object(a.a)({},t),{},{snapOrigin:c.coordinateHelper.fromPoint(i)})})).next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:c,snappingManager:l,cancel:n}),this.snappingPipeline.next)}}]),i}(g.a.EventedMixin(w.a));Object(l.a)([Object(f.b)({constructOnly:!0,nonNullable:!0})],ur.prototype,"view",void 0),Object(l.a)([Object(f.b)({readOnly:!0})],ur.prototype,"graphics",void 0),Object(l.a)([Object(f.b)({constructOnly:!0,nonNullable:!0})],ur.prototype,"enableZ",void 0),Object(l.a)([Object(f.b)({constructOnly:!0})],ur.prototype,"snappingManager",void 0),Object(l.a)([Object(f.b)({readOnly:!0})],ur.prototype,"type",void 0),ur=Object(l.a)([Object(v.a)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],ur);var hr=function(){function e(t){Object(r.a)(this,e),this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new Sn({graphic:t})}return Object(o.a)(e,[{key:"graphic",get:function(){return this.state.graphic}}]),e}(),dr=i(551),pr=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e))._vertexManipulatorMaterial=ha(Q.colorToVec4(Q.reshapeManipulators.vertex.color),Q.reshapeManipulators.vertex.renderOccluded),n._vertexManipulatorOutlineMaterial=da(Q.colorToVec4(Q.reshapeManipulators.vertex.outlineColor),Q.reshapeManipulators.vertex.renderOccluded),n._vertexManipulatorHoverOutlineMaterial=da(Q.colorToVec4(Q.reshapeManipulators.vertex.hoverOutlineColor),Q.reshapeManipulators.vertex.renderOccluded),n._edgeManipulatorMaterial=ha(Q.colorToVec4(Q.reshapeManipulators.edge.color),Q.reshapeManipulators.edge.renderOccluded),n._edgeManipulatorOutlineMaterial=da(Q.colorToVec4(Q.reshapeManipulators.edge.outlineColor),Q.reshapeManipulators.edge.renderOccluded),n._selectedManipulatorMaterial=ha(Q.colorToVec4(Q.reshapeManipulators.selected.color),Q.reshapeManipulators.selected.renderOccluded),n._selectedManipulatorOutlineMaterial=da(Q.colorToVec4(Q.reshapeManipulators.selected.outlineColor),Q.reshapeManipulators.selected.renderOccluded),n._selectedManipulatorHoverOutlineMaterial=da(Q.colorToVec4(Q.reshapeManipulators.selected.hoverOutlineColor),Q.reshapeManipulators.selected.renderOccluded),n._selectedIndex=0,n._vertexManipulatorGeometry=null,n._vertexManipulatorOutlineGeometry=null,n._edgeManipulatorGeometry=null,n._edgeManipulatorOutlineGeometry=null,n._handles=new Ee.a,n._manipulatorHandles=new Ee.a,n._manipulatorInfos=[],n._reshapeHelper=null,n._graphicMoveManipulation=null,n._moveManipulation=null,n._numGrabbing=0,n._numDragging=0,n._reshapeEventState=0,n._outlineVisualElement=null,n.tool=null,n.outputGeometry=null,n._snappingPipeline=new Ln.a,n._snappingPipelineHandle=new Ln.a,n._vertexLaserLineVisualElement=null,n}return Object(o.a)(i,[{key:"initialize",value:function(){var e=this,t=new Sn({graphic:this.graphic});this._graphicState=t,this._handles.add([t.watch("displaying",(function(t){var i,n=Object(R.a)(e._manipulatorInfos);try{for(n.s();!(i=n.n()).done;){i.value.manipulator.available=t}}catch(a){n.e(a)}finally{n.f()}})),this.view.trackGraphicState(t)])}},{key:"destroy",value:function(){this._clear(),this._handles.destroy()}},{key:"inputGeometry",get:function(){return Object(h.k)(this._reshapeHelper)?this._reshapeHelper.geometry:null},set:function(e){this._recreateManipulators(e)}},{key:"manipulators",get:function(){return this.tool.manipulators}},{key:"view",get:function(){return this.tool.view}},{key:"graphic",get:function(){return this.tool.graphic}},{key:"enableZ",get:function(){return this.tool.enableZ}},{key:"enableMoveGraphic",get:function(){return this.tool.enableMoveGraphic}},{key:"removeSelectedVertices",value:function(){var e=this._manipulatorInfos.filter((function(e){return e.manipulator.selected&&"vertex"===e.handle.type}));this._removeVertices(e)}},{key:"manipulatorSelectionChanged",value:function(){this.emit("manipulators-changed")}},{key:"_clear",value:function(){this._moveManipulation=Object(h.e)(this._moveManipulation),this._graphicMoveManipulation=Object(h.e)(this._graphicMoveManipulation),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[],this._reshapeHelper=Object(h.e)(this._reshapeHelper),this._numGrabbing=0,this._numDragging=0}},{key:"_recreateManipulators",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.inputGeometry;if(this._clear(),!Object(h.j)(e)){Object(h.e)(this._reshapeHelper),this._reshapeHelper=new jr(Cn.c.fromGeometry(e,this.view.viewingMode),e.type);var t,i=Object(j.d)(this.graphic),n=Object(R.a)(this._reshapeHelper.editGeometry.components);try{for(n.s();!(t=n.n()).done;){var a,r=t.value,o=Object(R.a)(r.vertices);try{for(o.s();!(a=o.n()).done;){var s=a.value;this._createPerVertexManipulator(s,i)}}catch(d){o.e(d)}finally{o.f()}var c,l=Object(R.a)(r.edges);try{for(l.s();!(c=l.n()).done;){var u=c.value;this._createPerVertexManipulator(u,i)}}catch(d){l.e(d)}finally{l.f()}}}catch(d){n.e(d)}finally{n.f()}this._createGraphicMoveManipulators(i)}}},{key:"_perGraphicManipulatorDragAction",value:function(e,t){if("end"!==t.action){var i,n=[],a=this._manipulatorInfos.some((function(e){return"vertex"===e.handle.type&&e.manipulator.selected})),r=1===e&&a,o=Object(h.q)(this._reshapeHelper),s=Object(R.a)(this._manipulatorInfos);try{for(s.s();!(i=s.n()).done;){var c=i.value;"vertex"===c.handle.type&&(c.manipulator.grabbing||r&&!c.manipulator.selected||(Object(h.q)(o).moveVertices([c.handle],t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ),n.push(c.handle.pos),this._updateManipulatorPosition(c)))}}catch(p){s.e(p)}finally{s.f()}if(0!==n.length){var l,u=0,d=Object(R.a)(this._manipulatorInfos);try{for(d.s();!(l=d.n()).done;){"vertex"===l.value.handle.type&&u++}}catch(p){d.e(p)}finally{d.f()}if(this.outputGeometry=o.geometry,n.length===u){if(this._updateEventState(1),this.destroyed)return;if(this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic}),this.destroyed)return}else{if(this._updateEventState(2),this.destroyed)return;if(this.emit("reshape",{type:"reshape",mover:this.graphic}),this.destroyed)return}}}}},{key:"isMultiVertexSelection",value:function(){var e,t=0,i=Object(R.a)(this._manipulatorInfos);try{for(i.s();!(e=i.n()).done;){var n=e.value;vr(n)&&n.manipulator.selected&&t++}}catch(a){i.e(a)}finally{i.f()}return t>1}},{key:"_perVertexManipulatorDragAction",value:function(e){if(this._updateEventState(2),!this.destroyed){var t=e.mapDeltaX,i=e.mapDeltaY,n=e.mapDeltaZ;if(t||i||n){var a,r=[],o=Object(R.a)(this._manipulatorInfos);try{for(o.s();!(a=o.n()).done;){var s=a.value;vr(s)&&(s.manipulator.selected&&!s.manipulator.grabbing||s===e.info)&&r.push(s)}}catch(g){o.e(g)}finally{o.f()}for(var c=Object(h.q)(this._reshapeHelper),l=0,u=r;l<u.length;l++){var d=u[l];c.moveVertices([d.handle],t,i,n)}this.outputGeometry=c.geometry;for(var p=0,f=r;p<f.length;p++){var v=f[p];this._updateManipulatorPosition(v)}this.emit("reshape",{type:"reshape",mover:this.graphic})}}}},{key:"_updateEventState",value:function(e){if(e===this._reshapeEventState)return!1;switch(e){case 0:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case 1:switch(this._reshapeEventState){case 0:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case 2:switch(this._reshapeEventState){case 0:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;var t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}},{key:"_createGraphicMoveManipulators",value:function(e){var t=this;this._graphicMoveManipulation=new or({tool:this.tool,view:this.view,graphicState:this._graphicState}),this.enableMoveGraphic?this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((function(e,i,n){i.next((function(e){return t._trackNumDragging(e)})).next((function(e){t._perGraphicManipulatorDragAction(0,e)})),n.next(t._cancelDragOperation())}))):this._graphicMoveManipulation.forEachManipulator((function(e){e.grabbable=!1,e.cursor=null})),this._graphicMoveManipulation.forEachManipulator((function(e){return t._manipulatorHandles.add([t._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(function(e){t._manipulatorInfos.some((function(e){return e.manipulator.selected}))?t._clearSelection():t.emit("immediate-click",Object(a.a)(Object(a.a)({},e),{},{graphic:t.graphic})),e.stopPropagation()}))])})),this._moveManipulation=new nr({tool:this.tool,view:this.view,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&ma(this.graphic),snapToScene:!1,radius:nr.radiusForSymbol(this.graphic.symbol)}),this._moveManipulation.forEachManipulator((function(e){t._handles.add([t._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(function(i){t._moveManipulation.zManipulation.hasManipulator(e)||t._manipulatorInfos.some((function(e){return e.manipulator.selected}))||t.emit("immediate-click",Object(a.a)(Object(a.a)({},i),{},{graphic:t.graphic})),i.stopPropagation()}))])})),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};var i=Object(h.q)(this.graphic.geometry).spatialReference;this._handles.add([this._moveManipulation.createDragPipeline((function(i,n,r,o,s){var c=r.next((function(e){return t._trackNumDragging(e)})).next((function(e){var i=t._manipulatorInfos.filter((function(e){return vr(e)&&e.manipulator.selected}));return 1===e.manipulatorType&&1===i.length?Object(a.a)(Object(a.a)({},e),{},{info:i[0],snapOrigin:i[0].handle.pos}):Object(a.a)(Object(a.a)({},e),{},{info:null})})).next(t._snappingPipelineHandle.createSnapDragEventPipelineStep({predicate:function(e){return!!e.info},cancel:o,snappingManager:t.tool.snappingManager,snappingContext:new Gn.a({geometry:Object(h.q)(t._reshapeHelper),elevationInfo:e,pointer:s,excludeFeature:t.graphic,visualizer:new Vn.a})}),t._snappingPipelineHandle.next).next(Object(zn.b)()).next((function(e){return t._perGraphicManipulatorDragAction(1,e),e}));return o.next(t._cancelDragOperation()),c}),e,i,this.graphic),Object(m.a)(this._graphicState,"displaying",(function(){t._updateMoveManipulationPosition()})),this._graphicState.on("changed",(function(){return t._updateMoveManipulationPosition()})),Object(m.a)(this._graphicState,"isDraped",(function(){var e="align-move-manipulation";t._graphicState.isDraped?t._handles.add(t.view.elevationProvider.on("elevation-change",(function(){return t._updateMoveManipulationPosition()})),e):t._handles.remove(e)}))]),this._updateMoveManipulationPosition();var n=Pa({view:this.view,graphic:this.graphic,forEachManipulator:function(e){if(!t.destroyed){Object(h.k)(t._graphicMoveManipulation)&&t._graphicMoveManipulation.forEachManipulator(e);var i,n=Object(R.a)(t._manipulatorInfos);try{for(n.s();!(i=n.n()).done;){e(i.value.manipulator,1)}}catch(a){n.e(a)}finally{n.f()}t._moveManipulation.forEachManipulator(e)}},onManipulatorsChanged:function(e){return t.on("manipulators-changed",e)}});this._outlineVisualElement=n.visualElement instanceof $i?n.visualElement:null,Object(h.k)(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",(function(){t._graphicState.isDraped||t._updateMoveManipulationPosition()})),this._graphicState.watch("isDraped",(function(){return t._updateMoveManipulationPosition()}))]),this._manipulatorHandles.add(n)}},{key:"_createPerVertexManipulator",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(j.d)(this.graphic);if(Object(h.j)(this._vertexManipulatorGeometry)||Object(h.j)(this._vertexManipulatorOutlineGeometry)){var n=Q.reshapeManipulators.vertex,r=n.size/2,o=r+n.collisionPadding,s=r/o;this._vertexManipulatorGeometry=an.a.createSphereGeometry(s,16,16);var c=(r+n.outlineSize)/o;this._vertexManipulatorOutlineGeometry=an.a.createSphereGeometry(c,16,16)}if(Object(h.j)(this._edgeManipulatorGeometry)||Object(h.j)(this._edgeManipulatorOutlineGeometry)){var l=Q.reshapeManipulators.edge,u=l.size/2,d=u+l.collisionPadding,p=u/d;this._edgeManipulatorGeometry=an.a.createSphereGeometry(p,16,16);var f=(u+l.outlineSize)/d;this._edgeManipulatorOutlineGeometry=an.a.createSphereGeometry(f,16,16)}var v=new Xn({view:this.view,renderObjects:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:4|br.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:5|br.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|br.Vertex},{geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:6|br.Edge},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|br.Edge},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:5|br.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:5|br.Edge},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:9},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:10}],elevationInfo:i,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(v,e,i);var g="edge"===e.type?{manipulator:v,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:v,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(g),this.manipulators.add(v),this._updateManipulatorPosition(g),"edge"===g.type){var b=this._getManipulatorInfoFromHandle(g.handle.left).manipulator.events.on("location-update",(function(){return t._updateManipulatorPosition(g)})),m=this._getManipulatorInfoFromHandle(g.handle.right).manipulator.events.on("location-update",(function(){return t._updateManipulatorPosition(g)}));g.locationUpdateHandle=Object(Dn.b)([b,m]),this._manipulatorHandles.add(g.locationUpdateHandle,v)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(v,!0),v);var y=Object(zn.e)(v,(function(e,n,r,o){n.next((function(e){return t._trackNumDragging(e)})).next((function(e){if(gr(g)){var i=t._splitEdgeManipulator(g);return Object(a.a)(Object(a.a)({},e),{},{info:i,snapOrigin:i.handle.pos})}return Object(a.a)(Object(a.a)({},e),{},{info:g,snapOrigin:g.handle.pos})})).next(Object(zn.f)(t.view,e.elevationAlignedLocation)).next(qa(t.view,t.graphic,e.elevationAlignedLocation,e.location.spatialReference,t.graphic)).next(t._snappingPipeline.createSnapDragEventPipelineStep({predicate:function(){return!t.isMultiVertexSelection()},cancel:r,snappingManager:t.tool.snappingManager,snappingContext:new Gn.a({geometry:Object(h.q)(t._reshapeHelper),elevationInfo:i,pointer:o,excludeFeature:t.graphic,visualizer:new Vn.a})}),t._snappingPipeline.next).next(Object(zn.b)()).next((function(e){t._perVertexManipulatorDragAction(e)})),r.next(t._cancelDragOperation())}));return this._manipulatorHandles.add(y,v),this._manipulatorHandles.add([v.events.on("immediate-click",(function(e){return t._manipulatorClickCallback(e,g)})),v.events.on("select-changed",(function(){g.selectedIndex=++t._selectedIndex,t._updateMoveManipulationPosition()}))]),this.emit("manipulators-changed"),v}},{key:"_trackNumDragging",value:function(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}},{key:"_cancelDragOperation",value:function(){var e=this,t=Object(h.k)(this._reshapeHelper)?this._reshapeHelper.geometry.clone():null;return function(){switch(e._numDragging--,e.inputGeometry=t,e.outputGeometry=t,Object(h.k)(e.tool.snappingManager)&&e.tool.snappingManager.doneSnapping(),e._reshapeEventState){case 0:break;case 1:e.emit("move",{type:"move",dx:0,dy:0,mover:e.graphic});break;case 2:e.emit("reshape",{type:"reshape",mover:e.graphic})}e.destroyed||e._updateEventState(0)}}},{key:"_setTypeSpecificManipulatorSettings",value:function(e,t,i){switch(t.type){case"vertex":e.state=br.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=Q.reshapeManipulators.vertex.size/2+Q.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=i;break;case"edge":e.state=br.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=Q.reshapeManipulators.edge.size/2+Q.reshapeManipulators.edge.collisionPadding,e.elevationInfo="on-the-ground"===i.mode?i:{mode:"absolute-height",offset:0}}}},{key:"_watchAndUpdateGrabState",value:function(e,t){var i=this;return e.events.on("grab-changed",(function(n){if("start"===n.action)t&&i._updateSelection(e),i._numGrabbing++;else if(i._numGrabbing--,i._updateEventState(0),i.destroyed)return;i._moveManipulation.interactive=!i._numGrabbing}))}},{key:"_clearSelection",value:function(){var e,t=Object(R.a)(this._manipulatorInfos);try{for(t.s();!(e=t.n()).done;){var i=e.value;i.manipulator.grabbing||(i.manipulator.selected=!1)}}catch(n){t.e(n)}finally{t.f()}}},{key:"_updateSelection",value:function(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}},{key:"_removeManipulator",value:function(e){e&&(this._manipulatorHandles.remove(e.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(e),1),this.manipulators.remove(e.manipulator),this.emit("manipulators-changed"))}},{key:"_getManipulatorInfoFromHandle",value:function(e){if(e){var t,i=Object(R.a)(this._manipulatorInfos);try{for(i.s();!(t=i.n()).done;){var n=t.value;if(e===n.handle)return n}}catch(a){i.e(a)}finally{i.f()}}return null}},{key:"_updateManipulatorPosition",value:function(e){if(e){var t=Object(h.q)(this._reshapeHelper);if("vertex"===e.handle.type)e.manipulator.location=t.editGeometry.coordinateHelper.toPoint(e.handle.pos,yr),e.manipulator.grabbing&&Object(h.k)(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.handle.type){var i=this._getManipulatorInfoFromHandle(e.handle.left).manipulator,n=this._getManipulatorInfoFromHandle(e.handle.right).manipulator;if(Object(h.k)(e.manipulator.elevationInfo)&&"on-the-ground"===e.manipulator.elevationInfo.mode){var a=i.location,r=n.location,o=a.x+.5*(r.x-a.x),s=a.y+.5*(r.y-a.y),c=a.hasZ&&r.hasZ?0:void 0;e.manipulator.location=Object(ne.d)(o,s,c,t.geometry.spatialReference)}else Object(K.h)(Or,i.renderLocation,n.renderLocation,.5),e.manipulator.renderLocation=Or}}}},{key:"_splitEdgeManipulator",value:function(e){var t=Object(h.q)(this._reshapeHelper),i=Object(h.q)(t.splitEdge(e.handle,.5).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;var n=e;n.handle=i,n.type="vertex";var a=Object(j.d)(this.graphic);this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,a),i.left&&this._createPerVertexManipulator(i.left),i.right&&this._createPerVertexManipulator(i.right),this.outputGeometry=t.geometry,this._updateManipulatorPosition(n),this._updateSelection(e.manipulator);var r=this._updateEventState(2),o=t.editGeometry.coordinateHelper.toArray(n.handle.pos),s=t.editGeometry.components.indexOf(i.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:o,componentIndex:s,vertexIndex:Object(h.q)(i.index)}],added:o}),r&&this._updateEventState(0),n}},{key:"_updateMoveManipulationPosition",value:function(){var e=this,t=Hn.d.get();Object(K.v)(t,0,0,0);var i,n=0,a=!1,r=null,o=null,s=Object(R.a)(this._manipulatorInfos);try{for(s.s();!(i=s.n()).done;){var c=i.value;vr(c)&&(c.manipulator.selected?(n++,Object(K.e)(t,t,c.manipulator.renderLocation),Object(h.j)(r)||c.selectedIndex>r.selectedIndex?(o=r,r=c):(Object(h.j)(o)||c.selectedIndex>o.selectedIndex)&&(o=c)):a=!0)}}catch(g){s.e(g)}finally{s.f()}if(0!==n){var l=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=l,this._moveManipulation.xyAxisManipulation.available=l,this._moveManipulation.zManipulation.available=l&&this.enableZ&&ma(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=l&&1!==n}else{var u=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=u,this._moveManipulation.xyAxisManipulation.available=u,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=u,this._moveManipulation.zManipulation.available=u&&this.enableZ&&ma(this.graphic)}if(0!==n){var d=0;if(Object(h.k)(r)){var p=r.handle.pos,f=Object(h.k)(o)?o.handle.pos:r.handle.left&&r.handle.left.left?r.handle.left.left.pos:null,v=!Object(h.k)(o)&&r.handle.right&&r.handle.right.right?r.handle.right.right.pos:null;f&&v?this._moveManipulation.xyAxisManipulation.available=!1:f?d=fr(f,p):v&&(d=fr(p,v))}this._moveManipulation.angle=d,this._moveManipulation.radius=Aa}else this._moveManipulation.angleDeferred=function(){return La(Object(h.q)(e.graphic.geometry))},this._moveManipulation.radius=nr.radiusForSymbol(this.graphic.symbol);0!==n&&a?(Object(K.d)(t,t,1/n),yr.spatialReference=Object(h.q)(this._reshapeHelper).geometry.spatialReference,yr.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(t,yr),this._moveManipulation.elevationAlignedLocation=yr):Object(h.k)(this._outlineVisualElement)&&!this._graphicState.isDraped&&Object(h.k)(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:ga(this.view,this._moveManipulation,this.graphic)}},{key:"_removeVertices",value:function(e){var t,i=[],n=Object(h.q)(this._reshapeHelper),a=Object(R.a)(e);try{for(a.s();!(t=a.n()).done;){var r=t.value;if("vertex"===r.handle.type&&n.canRemoveVertex()){i.push(r.handle),this._removeManipulator(r),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.left)),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.right));var o=Object(h.q)(n.removeVertices([r.handle]).removedVertices[0].createdEdge);o&&this._createPerVertexManipulator(o)}}}catch(l){a.e(l)}finally{a.f()}if(i.length>0){var s=i.map((function(e){var t=n.editGeometry.components.indexOf(e.component);return{coordinates:n.editGeometry.coordinateHelper.toArray(e.pos),componentIndex:t,vertexIndex:Object(h.q)(e.index)}}));this.outputGeometry=n.geometry;var c=this._updateEventState(2);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:s.map((function(e){return e.coordinates})),vertices:s}),this.destroyed)return;if(c&&(this._updateEventState(0),this.destroyed))return;this._updateMoveManipulationPosition()}}},{key:"_manipulatorClickCallback",value:function(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.handle.type&&(t.manipulator.selected=!t.manipulator.selected),"vertex"===t.handle.type&&2===e.button&&this._removeVertices([t]),gr(t)&&0===e.button&&this._splitEdgeManipulator(t),e.stopPropagation()}}]),i}(g.a.EventedAccessor);function fr(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function vr(e){return"vertex"===e.handle.type}function gr(e){return"edge"===e.handle.type}Object(l.a)([Object(f.b)({constructOnly:!0})],pr.prototype,"tool",void 0),Object(l.a)([Object(f.b)()],pr.prototype,"inputGeometry",null),Object(l.a)([Object(f.b)()],pr.prototype,"outputGeometry",void 0),pr=Object(l.a)([Object(v.a)("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],pr);var br,mr,yr=Object(ne.d)(0,0,null,null),Or=Object(J.e)();(mr=br||(br={})).Vertex=16,mr.Edge=32;var jr=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e,n){var a;return Object(r.a)(this,i),(a=t.call(this,e,n)).type=n,a._geometry=null,a}return Object(o.a)(i,[{key:"geometry",get:function(){if(this._dirty){switch(this.type){case"polyline":this._geometry=this.editGeometry.toPolyline();break;case"polygon":this._geometry=this.editGeometry.toPolygon()}this._dirty=!1}return this._geometry}}]),i}(In.a),_r=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e))._handles=new Ee.a,n._reshapeOperation=null,n._internalGeometryUpdate=!1,n.enableZ=!0,n.enableMoveGraphic=!0,n.type="reshape-3d",n.snappingManager=null,n}return Object(o.a)(i,[{key:"destroy",value:function(){this._handles.removeAll(),this._reshapeOperation=Object(h.e)(this._reshapeOperation),this._set("view",null),this._set("graphic",null)}},{key:"selectionManagementDisabled",get:function(){return!0}},{key:"_updateGeometry",value:function(){var e=this.graphic.geometry;0!==Object(dr.a)(this.graphic)||!Object(h.k)(e)||"polygon"!==e.type&&"polyline"!==e.type?this._reshapeOperation.inputGeometry=null:this._reshapeOperation.inputGeometry=e.clone()}},{key:"_updateGraphic",value:function(){var e=this;if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),0===Object(dr.a)(this.graphic)){var t=this.watch("graphic.geometry",(function(){!1===e._internalGeometryUpdate&&e._updateGeometry()}),!0);this._handles.add(t,"onGraphicGeometryChange")}}},{key:"manipulatorSelectionChanged",value:function(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()}},{key:"_onReshapeGeometryChanged",value:function(){Object(h.j)(this.graphic)||(this._internalGeometryUpdate=!0,this.graphic.geometry=this._reshapeOperation.outputGeometry.clone(),this._internalGeometryUpdate=!1)}},{key:"initialize",value:function(){var e=this;this._reshapeOperation=new pr({tool:this}),this._handles.add([this._reshapeOperation.on("reshape",(function(t){"reshape"===t.type&&e._onReshapeGeometryChanged(),e.emit("reshape",t)})),this._reshapeOperation.on("move",(function(t){"move"===t.type&&e._onReshapeGeometryChanged(),e.emit("move",t)})),this._reshapeOperation.on("vertex-add",(function(t){e._onReshapeGeometryChanged(),e.emit("vertex-add",t)})),this._reshapeOperation.on("vertex-remove",(function(t){e._onReshapeGeometryChanged(),e.emit("vertex-remove",t)})),this._reshapeOperation.on("immediate-click",(function(t){return e.emit("immediate-click",t)})),Object(m.a)(this,"graphic",(function(){e._updateGraphic()}),!0)])}},{key:"beforeUndo",value:function(){Object(h.k)(this.snappingManager)&&this.snappingManager.doneSnapping()}},{key:"onInputEvent",value:function(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}},{key:"reset",value:function(){}},{key:"test",get:function(){return{snappingManager:this.snappingManager}}}]),i}(g.a.EventedMixin(w.a));Object(l.a)([Object(f.b)({constructOnly:!0,nonNullable:!0})],_r.prototype,"view",void 0),Object(l.a)([Object(f.b)({constructOnly:!0})],_r.prototype,"graphic",void 0),Object(l.a)([Object(f.b)({constructOnly:!0,nonNullable:!0})],_r.prototype,"enableZ",void 0),Object(l.a)([Object(f.b)({constructOnly:!0,nonNullable:!0})],_r.prototype,"enableMoveGraphic",void 0),Object(l.a)([Object(f.b)({readOnly:!0})],_r.prototype,"type",void 0),Object(l.a)([Object(f.b)({constructOnly:!0})],_r.prototype,"snappingManager",void 0),_r=Object(l.a)([Object(v.a)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],_r);var wr,xr=i(64),Mr=i(129);!function(e){e.ScaleIn=32,e.ScaleOut=64,e.RotateLeft=128,e.RotateRight=256,e.Unlocked=1024,e.DelayedFocused=2048,e.TouchInput=32768}(wr||(wr={}));var Sr=function(){function e(t){var i=this;Object(r.a)(this,e),this.mode=null,this._handles=new Ee.a,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new g.a,this.getFocused=function(){return i.ringManipulator.focused},this.getScale=function(){return Object(h.k)(i._scaleRotateDragData)&&"scale"===i._scaleRotateDragData.mode?i._scaleRotateDragData.scale:1},this.tool=t.tool,this.mode=t.mode,this.createManipulator(),this.updateDragState(),this.updateManipulatorTransform()}return Object(o.a)(e,[{key:"destroy",value:function(){Object(h.k)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles.removeAll(),this.tool.manipulators.remove(this.ringManipulator),this.ringManipulator=null}},{key:"startAnimation",value:function(e){var t=this;this.cancelActiveAnimation(),e.start();var i=Object(Mr.a)({update:function(i){var n=i.deltaTime;e.update(n)&&t.cancelActiveAnimation()}});this._activeAnimation=Object(a.a)(Object(a.a)({},e),{},{frameTask:i})}},{key:"cancelActiveAnimation",value:function(){Object(h.k)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation.destroy(),this._activeAnimation=null)}},{key:"forEachManipulator",value:function(e){e(this.ringManipulator,4)}},{key:"createManipulator",value:function(){var e=this;this.ringManipulator=this.createRingManipulator(),this.tool.manipulators.add(this.ringManipulator);var t=this.ringManipulator,i=this.tool.graphicState.graphic,n=Object(zn.e)(t,(function(t,n,a){e._scaleRotateDragData=null;var r=function(e,t){var i=e.allLayerViews.find((function(e){return e.layer===t.layer}));if(Object(h.j)(t.symbol))return null;var n=t.symbol;return{symbolLayers:n.symbolLayers.map((function(e){var t=null;return"object"===e.type&&(t=e.heading),{heading:t,size:i.getSymbolLayerSize(n,e)}})).toArray()}}(e.tool.view,i);if(Object(h.j)(r))return e.updateDragState(),null;var o={mode:"none",origin:Object(J.d)(t.renderLocation),angle:0,startAngle:e.tool.symbolRotationAngle,angleDir:0,scale:1,scaleDir:0,startSymbolData:r};e._scaleRotateDragData=o,e.updateDragState();var s=Hn.d.get();e.tool.view.renderCoordsHelper.worldUpAtPosition(t.renderLocation,s),n.next(Ua(e.tool.view,Ue.e.fromPositionAndNormal(t.renderLocation,s))).next((function(t){var n=Ue.e.normal(t.plane),a=pa(t.renderStart,t.renderEnd,o.origin,n),r=se.c.shortestSignedDiff(o.angle,a);o.angleDir=Object(fe.d)(o.angleDir+r,-.3,.3),o.angle=a;var s=function(e,t){var i=Object(K.i)(Hn.d.get(),t.renderStart,e.origin),n=Object(K.i)(Hn.d.get(),t.renderEnd,e.origin),a=Object(K.o)(i),r=Object(K.o)(n);return 0===a?0:r/a}(o,t),c=s-o.scale;if(o.scaleDir=Object(fe.d)(o.scaleDir+c,-.2,.2),o.scale=s,e.onScaleChanged(),"none"===o.mode){var l=e.mode||function(e,t,i,n){var a=e.renderStart,r=e.renderEnd,o=kr(a,n,Hn.d.get()),s=kr(r,n,Hn.d.get());if(Object(K.k)(o,s)<100)return null;var c=Object(K.i)(Hn.d.get(),a,i),l=Object(K.f)(Hn.d.get(),c,t),u=a,h=Object(K.e)(Hn.d.get(),u,l),d=kr(i,n,Hn.d.get()),p=o,f=kr(h,n,Hn.d.get()),v=Object(K.i)(Hn.d.get(),f,p),g=Object(K.i)(Hn.d.get(),o,d),b=Ue.f.wrap(p,v),m=Ue.f.wrap(d,g);return Ue.f.distance2(b,s)<Ue.f.distance2(m,s)?"rotate":"scale"}(t,t.plane,o.origin,e.tool.view.state.camera);if(Object(h.k)(l)){switch(l){case"rotate":e.tool.emit("graphic-rotate-start",{graphic:i,angle:Object(fe.p)(o.angle)});break;case"scale":e.tool.emit("graphic-scale-start",{graphic:i,xScale:o.scale,yScale:o.scale})}o.mode=l}}if(e.updateDragState(),Object(h.k)(i.symbol)){var u=i.symbol.clone(),d=0,p=1;switch(o.mode){default:case"none":break;case"scale":p=o.scale;break;case"rotate":d=o.angle}e.applySymbolData(u,o.startSymbolData,d,p),i.symbol=u,e.updateManipulatorTransform()}switch(t.action){case"start":case"update":switch(o.mode){case"rotate":e.tool.emit("graphic-rotate",{graphic:i,angle:Object(fe.p)(o.angle)});break;case"scale":e.tool.emit("graphic-scale",{graphic:i,xScale:o.scale,yScale:o.scale})}break;case"end":switch(o.mode){case"rotate":e.tool.emit("graphic-rotate-stop",{graphic:i,angle:Object(fe.p)(o.angle)});break;case"scale":e.tool.emit("graphic-scale-stop",{graphic:i,xScale:o.scale,yScale:o.scale});break;default:case"none":}}"end"===t.action&&(e.startAnimation(Er(e,(function(){return e.onScaleChanged()}))),e._scaleRotateDragData=null,e.updateDragState())})),a.next(Object(zn.k)(i)).next((function(){if(Object(h.k)(e._scaleRotateDragData)){switch(e._scaleRotateDragData.mode){case"none":break;case"rotate":e.tool.emit("graphic-rotate-stop",{graphic:i,angle:Object(fe.p)(e._scaleRotateDragData.startAngle)});break;case"scale":e.tool.emit("graphic-scale-stop",{graphic:i,xScale:1,yScale:1})}e.startAnimation(Er(e,(function(){return e.onScaleChanged()}))),e._scaleRotateDragData=null}}))}));this._handles.add(n),this._handles.add([this.ringManipulator.events.on("focus-changed",(function(t){"focus"===t.action?e.startAnimation(function(e,t){var i=0,n=null,a=function(){return!1};return{start:function(){n=e.getFocused,e.getFocused=a,i=0,t()},update:function(e){return i+=e,!n()||i>200?1:0},destroy:function(){e.getFocused=n,t()}}}(e,(function(){return e.updateDelayedFocusedState()}))):e.updateDelayedFocusedState()})),this.ringManipulator.events.on("immediate-click",(function(e){e.stopPropagation()})),Object(m.a)(this.tool.graphicState,"displaying",(function(t){return e.ringManipulator.available=t})),this.tool.graphicState.on("changed",(function(){return ga(e.tool.view,e.ringManipulator,i)}))]),ga(this.tool.view,this.ringManipulator,i)}},{key:"onScaleChanged",value:function(){this.events.emit("scale-changed"),this.updateManipulatorTransform()}},{key:"updateDelayedFocusedState",value:function(){this.ringManipulator.updateStateEnabled(wr.DelayedFocused,this.getFocused())}},{key:"updateDragState",value:function(){if(this.ringManipulator.updateStateEnabled(wr.Unlocked,!(Object(h.k)(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),Object(h.k)(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this.ringManipulator.updateStateEnabled(wr.ScaleIn|wr.ScaleOut,!1),this.ringManipulator.updateStateEnabled(wr.RotateLeft,this._scaleRotateDragData.angleDir<0),this.ringManipulator.updateStateEnabled(wr.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this.ringManipulator.updateStateEnabled(wr.RotateLeft|wr.RotateRight,!1),this.ringManipulator.updateStateEnabled(wr.ScaleIn,this._scaleRotateDragData.scaleDir<0),this.ringManipulator.updateStateEnabled(wr.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this.ringManipulator.updateStateEnabled(wr.ScaleIn|wr.ScaleOut|wr.RotateLeft|wr.RotateRight,!1)}},{key:"updateManipulatorTransform",value:function(){var e=Object(ce.i)(Hn.a.get()),t=this.tool.symbolRotationAngle;Object(ce.p)(e,e,t,Object(J.g)(0,0,1));var i=this.getScale(),n=Object(ce.n)(Hn.a.get(),Object(K.v)(Hn.d.get(),i,i,i)),a=Object(ce.i)(Hn.a.get());Object(ce.l)(a,n,e),this.ringManipulator.modelTransform=a}},{key:"createRingManipulator",value:function(){for(var e=function(e,t,i){for(var n=[],a=Math.ceil(128*(t-e)/(2*Math.PI)),r=0;r<a+1;r++){var o=e+r*(t-e)/a;n.push(Object(J.g)(i*Math.cos(o),i*Math.sin(o),0))}return n},t=function(t){return e(0,2*Math.PI,t)},i=function(e,t){return an.a.createPathExtrusionGeometry(function(e){return[[-e/2,0],[e/2,0],[e/2,.25],[-e/2,.25]]}(t),e,[],[],!1)},n=t(Ca),a=i(n,24),r={left:[],right:[]},o=[],s=0;s<2;s++){var c=s*Math.PI-Math.PI/4,l=Math.PI/2-Ia,u=c+l,h=c+Math.PI/2-l,d=e(u,h,190),p=i(d,9);o.push(d),o.push(e(u,h,201)),r.left.push(p),r.right.push(p);for(var f=0;f<2;f++){var v=0===f,g=Object(le.b)();if(v){Object(ce.q)(g,g,[1,-1,1]),Object(ce.p)(g,g,-u,[0,0,1]);var b=Math.round(.2*(d.length-1));g[12]=d[b][0],g[13]=d[b][1],g[14]=d[b][2]}else{Object(ce.p)(g,g,h,[0,0,1]);var m=Math.round(.8*(d.length-1));g[12]=d[m][0],g[13]=d[m][1],g[14]=d[m][2]}var y=an.a.createExtrudedTriangle(60,0,23,.5);an.a.transformInPlace(y,g),(v?r.left:r.right).push(y)}}for(var O=[],_=0;_<2;_++){var w=_*Math.PI-Math.PI/4,x=Math.PI/2-Ga,M=w+x,S=w+Math.PI/2-x,k=e(M,S,213);O.push(i(k,9))}var E=t(190),R=t(213),P=i(E,9),T=i(R,9),D=t(130),A=t(107),C=i(D,9),I=i(A,9),G=this.createMaterial(),z=this.createMaterial(.66),L=this.createMaterial(.5),V=this.createMaterial(.33),H=[{geometry:a,material:G,stateMask:wr.DelayedFocused},{geometry:a,material:L,stateMask:0}];this.mode&&"scale"!==this.mode||(H=H.concat([{geometry:O,material:G,stateMask:wr.DelayedFocused|wr.Unlocked},{geometry:P,material:z,stateMask:wr.DelayedFocused|wr.ScaleIn},{geometry:T,material:V,stateMask:wr.DelayedFocused|wr.ScaleIn},{geometry:C,material:z,stateMask:wr.DelayedFocused|wr.ScaleOut},{geometry:I,material:V,stateMask:wr.DelayedFocused|wr.ScaleOut}])),this.mode&&"rotate"!==this.mode||(H=H.concat([{geometry:r.right,material:G,stateMask:wr.DelayedFocused|wr.Unlocked},{geometry:r.left,material:G,stateMask:wr.DelayedFocused|wr.RotateLeft},{geometry:r.right,material:G,stateMask:wr.DelayedFocused|wr.RotateRight}]));var F=[n].concat(o);return new Xn({view:this.tool.view,renderObjects:H,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:Object(j.d)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:F,direction:Object(J.g)(0,0,1)}})}},{key:"createMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=[].concat(Object(Pt.a)(Ta),[e]);return new Un.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}},{key:"applySymbolData",value:function(e,t,i,n){var a=this;e.symbolLayers.forEach((function(e,r){var o=t.symbolLayers[r],s=o.heading,c=o.size;"object"===e.type&&(e.heading=(Object(h.k)(s)?s:0)-Object(xr.c)(i),Object(h.k)(c)&&"width"in c&&(c.width=a.enforceNonZeroSize(c.width),c.height=a.enforceNonZeroSize(c.height),c.depth=a.enforceNonZeroSize(c.depth),e.width=c.width*n,e.depth=c.depth*n,e.height=c.height*n))}))}},{key:"enforceNonZeroSize",value:function(e){return e||this.tool.view.state.camera.computeRenderPixelSizeAt(this.ringManipulator.renderLocation)}},{key:"test",get:function(){return{ringManipulator:this.ringManipulator}}}]),e}();function kr(e,t,i){var n=t.projectToRenderScreen(e,Object(Ve.a)(Rr)),a=t.renderToScreen(n,Pr);return Object(K.v)(i,a[0],a[1],0)}function Er(e,t){var i=null,n=1,a=function(){return n};return{start:function(){n=e.getScale(),i=e.getScale,e.getScale=a,t()},update:function(e){return n+=((n+1)/2-n)*Math.min(3*e,1),t(),Math.abs(n-1)<.01?1:0},destroy:function(){e.getScale=i,t()}}}var Rr=Object(J.e)(),Pr=Object(Ve.f)(),Tr=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e)).enableZ=!0,n.enableRotation=!0,n.enableScaling=!0,n.type="transform-3d",n.handles=new Ee.a,n.scaleRotate=null,n.snappingPipeline=new Ln.a,n}return Object(o.a)(i,[{key:"initialize",value:function(){var e=this;this.graphicState=new Sn({graphic:this.graphic}),this.moveManipulation=new nr({tool:this,view:this.view,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&ma(this.graphic),radius:nr.radiusForSymbol(this.graphic.symbol)}),this.moveManipulation.forEachManipulator((function(t){return e.handles.add(t.events.on("immediate-click",(function(e){return e.stopPropagation()})))})),this.moveManipulation.elevationInfo=Object(j.d)(this.graphic);var t=this.graphic.geometry;if(this.moveManipulation.createGraphicDragPipeline((function(i,n,a,r,o){return Object(h.k)(t)&&"point"===t.type&&0===i&&(a=a.next(e.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new Gn.a({elevationInfo:Object(j.d)(e.graphic),pointer:o,geometry:new In.a(Cn.c.fromGeometry(t,e.view.viewingMode),"point"),visualizer:new Vn.a,excludeFeature:e.graphic}),snappingManager:e.snappingManager,cancel:r}),e.snappingPipeline.next)),a}),this.graphicState,(function(t){var i=t.action,n={graphic:t.graphic,dxScreen:t.dxScreen,dyScreen:t.dyScreen};switch(i){case"start":e.emit("graphic-translate-start",n);break;case"update":e.emit("graphic-translate",n);break;case"end":e.emit("graphic-translate-stop",n)}})),this.moveManipulation.angle=this.symbolRotationAngle,this.enableScaling||this.enableRotation){var i=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this.scaleRotate=new Sr({tool:this,mode:i}),this.handles.add(this.scaleRotate.events.on("scale-changed",(function(){return e.onScaleChanged()})))}this.handles.add([Pa({view:this.view,graphic:this.graphic,forEachManipulator:function(t){return e.forEachManipulator(t)},onManipulatorsChanged:function(){return Object(Dn.c)()}}),this.graphic.watch("symbol",(function(){return e.updateMoveAngle()})),this.graphicState.on("changed",(function(){return e.onGeometryChanged()})),this.hideManipulatorsForGraphicState(),this.view.watch("scale",(function(){return e.updateMoveAngle()}))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this.onGeometryChanged()}},{key:"forEachManipulator",value:function(e){this.moveManipulation.forEachManipulator(e),Object(h.k)(this.scaleRotate)&&this.scaleRotate.forEachManipulator(e)}},{key:"hideManipulatorsForGraphicState",value:function(){var e=this;return this.graphicState.watch("displaying",(function(t){e.forEachManipulator((function(e){return e.available=t})),e.moveManipulation.zManipulation.available=t&&e.enableZ&&ma(e.graphic)}))}},{key:"destroy",value:function(){this.handles.destroy(),this.moveManipulation.destroy(),this.scaleRotate=Object(h.e)(this.scaleRotate),this._set("view",null),this._set("graphic",null)}},{key:"snapToScene",set:function(e){this.moveManipulation&&(this.moveManipulation.snapToScene=e),this._set("snapToScene",e)}},{key:"symbolRotationAngle",get:function(){var e=this.graphic.symbol;if(e){var t=e.symbolLayers.find((function(e){return"object"===e.type})),i=t&&t.heading||0;return Object(xr.d)(-i)}return 0}},{key:"reset",value:function(){}},{key:"onDetach",value:function(){Object(h.k)(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}},{key:"onHide",value:function(){Object(h.k)(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}},{key:"onScaleChanged",value:function(){if(!Object(h.j)(this.scaleRotate)){var e=this.scaleRotate.getScale();this.moveManipulation.displayScale=e}}},{key:"updateMoveAngle",value:function(){"local"===this.view.viewingMode||this.view.scale<1e6?this.moveManipulation.angle=this.symbolRotationAngle:this.moveManipulation.angle=0}},{key:"onGeometryChanged",value:function(){ga(this.view,this.moveManipulation,this.graphic)}},{key:"test",get:function(){return{discManipulator:this.moveManipulation.xyManipulation.test.discManipulator,ringManipulator:Object(h.k)(this.scaleRotate)?this.scaleRotate.test.ringManipulator:null,arrowManipulators:this.moveManipulation.xyAxisManipulation.test.arrowManipulators}}}]),i}(g.a.EventedMixin(w.a));Object(l.a)([Object(f.b)({constructOnly:!0,nonNullable:!0})],Tr.prototype,"view",void 0),Object(l.a)([Object(f.b)({constructOnly:!0,nonNullable:!0})],Tr.prototype,"graphic",void 0),Object(l.a)([Object(f.b)({constructOnly:!0,nonNullable:!0})],Tr.prototype,"enableZ",void 0),Object(l.a)([Object(f.b)()],Tr.prototype,"enableRotation",void 0),Object(l.a)([Object(f.b)()],Tr.prototype,"enableScaling",void 0),Object(l.a)([Object(f.b)({value:!1})],Tr.prototype,"snapToScene",null),Object(l.a)([Object(f.b)({constructOnly:!0})],Tr.prototype,"snappingManager",void 0),Object(l.a)([Object(f.b)({readOnly:!0})],Tr.prototype,"type",void 0),Tr=Object(l.a)([Object(v.a)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],Tr);var Dr=i(66),Ar=i(637),Cr=i(563),Ir=i(565),Gr=i(53),zr=i(50),Lr=i(183),Vr=i(1270),Hr=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e,n){var a;return Object(r.a)(this,i),(a=t.call(this,e,n)).stipplePattern=null,a.stippleTextureBind=null,a.stippleTextureRepository=e.stippleTextureRepository,a}return Object(o.a)(i,[{key:"initializeProgram",value:function(e){var t=i.shader.get(),n=this.configuration,a=t.build({output:n.output,attributeColor:n.vertexColors,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,stippleEnabled:n.stippleEnabled,stippleOffColorEnabled:n.stippleOffColorEnabled,stippleUVMaxEnabled:!1,stippleIntegerRepeatsEnabled:n.stippleIntegerRepeatsEnabled});return new Ht.a(e.rctx,a.generateSource("vertex"),a.generateSource("fragment"),Vt.a)}},{key:"dispose",value:function(){Object(Gr.a)(Object(zr.a)(i.prototype),"dispose",this).call(this),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}},{key:"bindPass",value:function(e,t,i){if(Ut.a.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.stipplePattern!==t.stipplePattern){var n=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,n),this.stipplePattern=n}if(this.configuration.stippleEnabled){var a=Object(h.k)(this.stippleTextureBind)?this.stippleTextureBind(e,0)*i.camera.pixelRatio:1;this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/a),this.program.setUniform2f("ndcToPixel",i.camera.fullViewport[2]/2,i.camera.fullViewport[3]/2)}if(this.program.setUniform4fv("constantColor",t.color),this.program.setUniform1f("alphaCoverage",Math.min(1,t.width*i.camera.pixelRatio)),this.configuration.stippleOffColorEnabled){var r=Object(h.q)(t.stippleOffColor);this.program.setUniform4f("stippleOffColor",r[0],r[1],r[2],r.length>3?r[3]:1)}4===this.configuration.output&&qt.a.bindOutputHighlight(e,this.program,i)}},{key:"bindDraw",value:function(e){Ut.a.bindView(this.program,e),Bt.a.bindUniformsWithOrigin(this.program,this.configuration,e)}},{key:"initializePipeline",value:function(){var e=this.configuration,t=Object(Ft.e)(770,1,771,771),i=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(Ft.d)({blending:i,depthTest:Lr.b,depthWrite:n,colorWrite:Ft.b,stencilWrite:e.sceneHasOcludees?Lr.h:null,stencilTest:e.sceneHasOcludees?t?Lr.d:Lr.c:null})};return 0===e.output?(this._occludeePipelineState=i(!0,e.transparent||e.stippleEnabled?t:null,Ft.c),i(!1,e.transparent||e.stippleEnabled?t:null,Ft.c)):i(!1)}},{key:"primitiveType",get:function(){return 1}},{key:"getPipelineState",value:function(e){return e?this._occludeePipelineState:this.pipeline}}]),i}(zt.a);Hr.shader=new Gt.a(Vr.a,(function(){return i.e(229).then(i.bind(null,1430))}));var Fr=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(){var e;return Object(r.a)(this,i),(e=t.apply(this,arguments)).output=0,e.slicePlaneEnabled=!1,e.vertexColors=!1,e.transparent=!1,e.stippleEnabled=!1,e.stippleOffColorEnabled=!1,e.stippleIntegerRepeatsEnabled=!1,e.sceneHasOcludees=!1,e}return i}(Lt.a);Object(l.a)([Object(Lt.b)({count:8})],Fr.prototype,"output",void 0),Object(l.a)([Object(Lt.b)()],Fr.prototype,"slicePlaneEnabled",void 0),Object(l.a)([Object(Lt.b)()],Fr.prototype,"vertexColors",void 0),Object(l.a)([Object(Lt.b)()],Fr.prototype,"transparent",void 0),Object(l.a)([Object(Lt.b)()],Fr.prototype,"stippleEnabled",void 0),Object(l.a)([Object(Lt.b)()],Fr.prototype,"stippleOffColorEnabled",void 0),Object(l.a)([Object(Lt.b)()],Fr.prototype,"stippleIntegerRepeatsEnabled",void 0),Object(l.a)([Object(Lt.b)()],Fr.prototype,"sceneHasOcludees",void 0);var Ur=d.a.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial"),Nr=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e,Wr)).techniqueConfig=new Fr,n}return Object(o.a)(i,[{key:"getTechniqueConfig",value:function(e){this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.transparent=this.params.color[3]<1||this.params.width<1;var t=Object(h.k)(this.params.stipplePattern);return this.techniqueConfig.stippleEnabled=t,this.techniqueConfig.stippleOffColorEnabled=t&&Object(h.k)(this.params.stippleOffColor),this.techniqueConfig.stippleIntegerRepeatsEnabled=t&&this.params.stippleIntegerRepeats,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig}},{key:"getPassParameters",value:function(){return this.params}},{key:"intersect",value:function(e,t,i,n,a,r,o,s,c){c?Object(ln.d)(e,n,r,1,o):this.intersectLineGeometry(e,t,i,n,o)}},{key:"intersectLineGeometry",value:function(e,t,i,n,a){if(n.options.selectionMode&&!Object(he.d)(t))if(Object(Ne.g)(i)){var r=e.vertexAttributes.get("position").data,o=n.camera,s=no;Object(He.c)(s,n.point);Object(K.v)(ao[0],s[0]-2,s[1]+2,0),Object(K.v)(ao[1],s[0]+2,s[1]+2,0),Object(K.v)(ao[2],s[0]+2,s[1]-2,0),Object(K.v)(ao[3],s[0]-2,s[1]-2,0);for(var c=0;c<4;c++)if(!o.unprojectFromRenderScreen(ao[c],ro[c]))return;Ue.e.fromPoints(o.eye,ro[0],ro[1],oo),Ue.e.fromPoints(o.eye,ro[1],ro[2],so),Ue.e.fromPoints(o.eye,ro[2],ro[3],co),Ue.e.fromPoints(o.eye,ro[3],ro[0],lo);for(var l=Number.MAX_VALUE,u=0;u<r.length-5;u+=3)if(Zr[0]=r[u]+i[12],Zr[1]=r[u+1]+i[13],Zr[2]=r[u+2]+i[14],Yr[0]=r[u+3]+i[12],Yr[1]=r[u+4]+i[13],Yr[2]=r[u+5]+i[14],!(Ue.e.signedDistance(oo,Zr)<0&&Ue.e.signedDistance(oo,Yr)<0||Ue.e.signedDistance(so,Zr)<0&&Ue.e.signedDistance(so,Yr)<0||Ue.e.signedDistance(co,Zr)<0&&Ue.e.signedDistance(co,Yr)<0||Ue.e.signedDistance(lo,Zr)<0&&Ue.e.signedDistance(lo,Yr)<0)){if(o.projectToRenderScreen(Zr,Jr),o.projectToRenderScreen(Yr,Kr),Jr[2]<0&&Kr[2]>0){Object(K.i)(Xr,Zr,Yr);var h=o.frustum,d=-Ue.e.signedDistance(h[4],Zr)/Object(K.g)(Xr,Ue.e.normal(h[4]));Object(K.d)(Xr,Xr,d),Object(K.e)(Zr,Zr,Xr),o.projectToRenderScreen(Zr,Jr)}else if(Jr[2]>0&&Kr[2]<0){Object(K.i)(Xr,Yr,Zr);var p=o.frustum,f=-Ue.e.signedDistance(p[4],Yr)/Object(K.g)(Xr,Ue.e.normal(p[4]));Object(K.d)(Xr,Xr,f),Object(K.e)(Yr,Yr,Xr),o.projectToRenderScreen(Yr,Kr)}else if(Jr[2]<0&&Kr[2]<0)continue;Jr[2]=0,Kr[2]=0;var v=Ue.d.distance2(Ue.d.fromPoints(Jr,Kr,to),s);v<l&&(l=v,Object(K.j)($r,Zr),Object(K.j)(eo,Yr))}var g=n.rayBeginPoint,b=n.rayEndPoint;if(l<4){var m=Number.MAX_VALUE;if(Ue.d.closestLineSegmentPoint(Ue.d.fromPoints($r,eo,to),Ue.d.fromPoints(g,b,io),Qr)){Object(K.i)(Qr,Qr,g);var y=Object(K.o)(Qr);Object(K.d)(Qr,Qr,1/y),m=y/Object(K.n)(g,b)}a(m,Qr)}}else Ur.error("intersection assumes a translation-only matrix")}},{key:"computeAttachmentOrigin",value:function(e,t){var i=e.vertexAttributes;if(!i)return!1;var n=i.get("position");return Object(ae.a)(n,null,!1,t)}},{key:"createBufferWriter",value:function(){var e=this.params.vertexColors?Ir.b:Ir.c;return Object(h.j)(this.params.stipplePattern)?new Ir.a(e):new qr(e.clone().vec3f("auxpos1"))}},{key:"getGLMaterial",value:function(e){return 0===e.output||4===e.output?new Br(e):void 0}}]),i}(Mt.a),Br=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e)).updateParameters(),n}return Object(o.a)(i,[{key:"updateParameters",value:function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(Hr,this.material.getTechniqueConfig(this.output),this.technique)}},{key:"beginSlot",value:function(e){return 3===e}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this.material.params.sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters())}},{key:"ensureParameters",value:function(e){0===this.output&&this._updateOccludeeState(e)}},{key:"bind",value:function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)}},{key:"getPipelineState",value:function(e,t){return this.technique.getPipelineState(t)}}]),i}(It.a),qr=function(){function e(t){Object(r.a)(this,e),this.vertexBufferLayout=t}return Object(o.a)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get("position").length}},{key:"write",value:function(e,t,i,n){Object(un.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,n),this.writeAuxpos1(e,t,i,n)}},{key:"writeAuxpos1",value:function(e,t,i,n){var a=i.getField("auxpos1",sn.u),r=t.indices.get("position"),o=t.vertexAttributes.get("position").data,s=e.transformation,c=a.typedBufferStride,l=a.typedBuffer;n*=c;for(var u=0;u<r.length;u+=2)for(var h=3*r[u],d=o[h],p=o[h+1],f=o[h+2],v=s[0]*d+s[4]*p+s[8]*f+s[12],g=s[1]*d+s[5]*p+s[9]*f+s[13],b=s[2]*d+s[6]*p+s[10]*f+s[14],m=0;m<2;++m)l[n]=v,l[n+1]=g,l[n+2]=b,n+=c}}]),e}(),Wr=Object(a.a)({color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,sceneHasOcludees:!1},Mt.b),Zr=Object(J.e)(),Yr=Object(J.e)(),Xr=Object(J.e)(),Qr=Object(J.e)(),Jr=Object(Ve.d)(),Kr=Object(Ve.d)(),$r=Object(J.e)(),eo=Object(J.e)(),to=Ue.d.create(),io=Ue.d.create(),no=Object(J.e)(),ao=[Object(Ve.d)(),Object(Ve.d)(),Object(Ve.d)(),Object(Ve.d)()],ro=[Object(J.e)(),Object(J.e)(),Object(J.e)(),Object(J.e)()],oo=Ue.e.create(),so=Ue.e.create(),co=Ue.e.create(),lo=Ue.e.create(),uo=(on.a,Object(le.b)()),ho=(Object(u.a)("mac"),Math.cos(Object(fe.f)(45)),Math.cos(Object(fe.f)(5)),[1,.5,0]),po=([].concat(ho,[.7]),[].concat(ho,[.5]),[].concat(ho,[1])),fo=[1,1,1,1],vo=[1,.8,.6,1],go=[1,.93,.86,1],bo=[].concat(ho,[1]),mo=[].concat(ho,[1]),yo=40,Oo=i(1271),jo=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(){return Object(r.a)(this,i),t.apply(this,arguments)}return Object(o.a)(i,[{key:"initializeProgram",value:function(e){var t=i.shader.get().build();return new Ht.a(e.rctx,t.generateSource("vertex"),t.generateSource("fragment"),Vt.a)}},{key:"bindPass",value:function(e,t,i){Ut.a.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform4fv("backgroundColor",t.backgroundColor),this.program.setUniform4fv("gridColor",t.gridColor),this.program.setUniform1f("gridWidth",t.gridWidth)}},{key:"bindDraw",value:function(e){Ut.a.bindView(this.program,e)}},{key:"initializePipeline",value:function(){return Object(Ft.d)({blending:Object(Ft.e)(1,1,771,771),depthTest:{func:513},colorWrite:Ft.b})}}]),i}(zt.a);jo.shader=new Gt.a(Oo.a,(function(){return i.e(232).then(i.bind(null,1431))}));var _o=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e){return Object(r.a)(this,i),t.call(this,e,xo)}return Object(o.a)(i,[{key:"intersect",value:function(e,t,i,n,a,r,o){return Object(ln.e)(e,t,n,a,r,void 0,o)}},{key:"createBufferWriter",value:function(){return new Ir.a(Ir.d)}},{key:"getGLMaterial",value:function(e){return 0===e.output?new wo(e):void 0}}]),i}(Mt.a),wo=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e)).technique=new jo(n.techniqueRep.constructionContext,null),n.updateParameters(),n}return Object(o.a)(i,[{key:"updateParameters",value:function(){}},{key:"beginSlot",value:function(e){return 8===e}},{key:"bind",value:function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.params,t)}}]),i}(It.a);Object(l.a)([Object($e.c)()],wo.prototype,"technique",void 0);var xo=Object(a.a)({backgroundColor:[1,0,0,.5],gridColor:[0,1,0,.5],gridWidth:4},Mt.b),Mo=(on.a,i(653)),So=i(1272),ko=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(){return Object(r.a)(this,i),t.apply(this,arguments)}return Object(o.a)(i,[{key:"initializeProgram",value:function(e){var t=i.shader.get(),n=this.configuration,a=t.build({output:n.output,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,OITEnabled:0===n.transparencyPassType,multipassTerrainEnabled:n.multipassTerrainEnabled,cullAboveGround:n.cullAboveGround});return new Ht.a(e.rctx,a.generateSource("vertex"),a.generateSource("fragment"),Vt.a)}},{key:"bindPass",value:function(e,t,i){Ut.a.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform1f("opacity",t.opacity),i.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",i.camera.nearFar),this.program.setUniform2fv("inverseViewport",i.inverseViewport),Object(Zt.a)(this.program,e,i))}},{key:"bindDraw",value:function(e){Ut.a.bindView(this.program,e),Bt.a.bindUniformsWithOrigin(this.program,this.configuration,e)}},{key:"setPipelineState",value:function(e,t){var i=this.configuration,n=3===e,a=2===e;return Object(Ft.d)({blending:0!==i.output&&7!==i.output||!i.transparent?null:n?Eo:Object(Wt.a)(e),culling:function(e){return 0!==e&&{face:1===e?1028:1029,mode:2305}}(i.cullFace),depthTest:{func:Object(Wt.b)(e)},depthWrite:n?i.writeDepth&&Ft.c:Object(Wt.c)(e),colorWrite:Ft.b,stencilWrite:i.sceneHasOcludees?Lr.h:null,stencilTest:i.sceneHasOcludees?t?Lr.d:Lr.c:null,polygonOffset:n||a?null:Object(Wt.g)(i.enableOffset)})}},{key:"initializePipeline",value:function(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}},{key:"getPipelineState",value:function(e){return e?this._occludeePipelineState:this.pipeline}}]),i}(zt.a);ko.shader=new Gt.a(So.a,(function(){return i.e(226).then(i.bind(null,1432))}));var Eo=Object(Ft.f)(1,771),Ro=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(){var e;return Object(r.a)(this,i),(e=t.apply(this,arguments)).output=0,e.cullFace=0,e.slicePlaneEnabled=!1,e.transparent=!1,e.enableOffset=!0,e.writeDepth=!0,e.sceneHasOcludees=!1,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!0,e}return i}(Lt.a);Object(l.a)([Object(Lt.b)({count:8})],Ro.prototype,"output",void 0),Object(l.a)([Object(Lt.b)({count:3})],Ro.prototype,"cullFace",void 0),Object(l.a)([Object(Lt.b)()],Ro.prototype,"slicePlaneEnabled",void 0),Object(l.a)([Object(Lt.b)()],Ro.prototype,"transparent",void 0),Object(l.a)([Object(Lt.b)()],Ro.prototype,"enableOffset",void 0),Object(l.a)([Object(Lt.b)()],Ro.prototype,"writeDepth",void 0),Object(l.a)([Object(Lt.b)()],Ro.prototype,"sceneHasOcludees",void 0),Object(l.a)([Object(Lt.b)({count:4})],Ro.prototype,"transparencyPassType",void 0),Object(l.a)([Object(Lt.b)()],Ro.prototype,"multipassTerrainEnabled",void 0),Object(l.a)([Object(Lt.b)()],Ro.prototype,"cullAboveGround",void 0);var Po,To=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e,Ao)).supportsEdges=!0,n.techniqueConfig=new Ro,n}return Object(o.a)(i,[{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<Wt.e,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!t||t.cullAboveGround,this.techniqueConfig}},{key:"intersect",value:function(e,t,i,n,a,r,o){Object(ln.e)(e,t,n,a,r,void 0,o)}},{key:"getGLMaterial",value:function(e){return 0===e.output||7===e.output||4===e.output?new Do(e):void 0}},{key:"createBufferWriter",value:function(){return new Ir.a(Ir.d)}}]),i}(Mt.a),Do=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,Object(a.a)(Object(a.a)({},e),e.material.params))).updateParameters(),n}return Object(o.a)(i,[{key:"updateParameters",value:function(e){var t=this.material.params;this.updateTexture(t.textureId),this.technique=this.techniqueRep.acquireAndReleaseExisting(ko,this.material.getTechniqueConfig(this.output,e),this.technique)}},{key:"beginSlot",value:function(e){return 4===this.output?3===e:e===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?5:8:3)}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this.material.params.sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters(e))}},{key:"ensureParameters",value:function(e){0!==this.output&&7!==this.output||this._updateOccludeeState(e),this.updateParameters(e)}},{key:"bind",value:function(e,t){e.bindProgram(this.technique.program),this.bindTexture(e,this.technique.program),this.bindTextureScale(e,this.technique.program),this.technique.bindPass(e,this.material.params,t)}},{key:"getPipelineState",value:function(e,t){return this.technique.getPipelineState(t)}}]),i}(Mo.a),Ao=Object(a.a)({transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0},Mt.b),Co=i(22),Io=i(58),Go=i(1201),zo=i(28),Lo=Po=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e)).type="plane",n.position=null,n.heading=0,n.tilt=0,n.width=10,n.height=10,n}return Object(o.a)(i,[{key:"clone",value:function(){return new Po({position:Object(Co.a)(this.position),heading:this.heading,tilt:this.tilt,width:this.width,height:this.height})}},{key:"equals",value:function(e){return this.heading===e.heading&&this.tilt===e.tilt&&Object(h.k)(this.position)&&Object(h.k)(e.position)&&this.position.equals(e.position)&&this.width===e.width&&this.height===e.height}}]),i}(zo.a);Object(l.a)([Object(f.b)({readOnly:!0,json:{read:!1,write:!0}})],Lo.prototype,"type",void 0),Object(l.a)([Object(f.b)({type:Bn.a}),Object(Go.a)()],Lo.prototype,"position",void 0),Object(l.a)([Object(f.b)({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(Go.a)(),Object(Io.a)((function(e){return se.b.normalize(Object(p.i)(e),0,!0)}))],Lo.prototype,"heading",void 0),Object(l.a)([Object(f.b)({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(Go.a)(),Object(Io.a)((function(e){return se.b.normalize(Object(p.i)(e),0,!0)}))],Lo.prototype,"tilt",void 0),Object(l.a)([Object(f.b)({type:Number,nonNullable:!0}),Object(Go.a)()],Lo.prototype,"width",void 0),Object(l.a)([Object(f.b)({type:Number,nonNullable:!0}),Object(Go.a)()],Lo.prototype,"height",void 0);Lo=Po=Object(l.a)([Object(v.a)("esri.widgets.Slice.SlicePlane")],Lo),d.a.getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");function Vo(e,t){switch(t){case 0:return{basis:e.basis1,direction:1,position:Object(K.e)(Hn.d.get(),e.origin,e.basis1),edge:t};case 1:return{basis:e.basis2,direction:1,position:Object(K.e)(Hn.d.get(),e.origin,e.basis2),edge:t};case 2:return{basis:e.basis1,direction:-1,position:Object(K.i)(Hn.d.get(),e.origin,e.basis1),edge:t};case 3:return{basis:e.basis2,direction:-1,position:Object(K.i)(Hn.d.get(),e.origin,e.basis2),edge:t}}}function Ho(e){var t=Object(K.o)(e.basis1),i=Object(K.o)(e.basis2);return.3*Math.min(t,i)}function Fo(e){return Ho(e)}function Uo(e){return 0!==e.direction[0]&&0!==e.direction[1]}function No(e,t){var i=Uo(t),n=i?[Object(J.g)(1,0,0),Object(J.g)(0,0,0),Object(J.g)(0,1,0)]:[Object(J.g)(1,0,0),Object(J.g)(-1,0,0)],a=an.a.createPolylineGeometry(n),r=[].concat(Object(Pt.a)(ho),[1]),o=i?4:1,s=2*o,c=function(e){return e>1?function(e){return new oe.a({color:r,width:e,renderOccluded:4})}(e):new Nr({color:r,renderOccluded:4})},l=[{geometry:a,material:c(o),stateMask:1|Jo},{geometry:a,material:c(s),stateMask:2|Jo},{geometry:a,material:c(1),stateMask:Ko}],u=new Xn({view:e,renderObjects:l,collisionType:{type:"line",paths:[n]},autoScaleRenderObjects:!1,worldSized:!0,radius:i?6:4,idHint:i?1:2});return u.state=Jo,u}function Bo(e,t,i){var n=function(n){var a=(n?t:e).slice(0),r=Object(K.i)(Hn.d.get(),a[0],a[1]);Object(K.q)(r,r);var o=Object(K.i)(Hn.d.get(),a[a.length-1],a[a.length-2]);if(Object(K.q)(o,o),i.padding>0){var s=Object(K.d)(Object(J.e)(),o,-i.padding);if(a[a.length-1]=Object(K.e)(s,s,a[a.length-1]),i.bothEnds){var c=Object(K.d)(Object(J.e)(),r,-i.padding);a[0]=Object(K.e)(c,c,a[0])}}var l=n?i.tipFocusMultiplier:1,u=i.tipLength*(i.focusTipLength?l:1),d=i.tipRadius*l,p=Object(ce.i)(Hn.a.get());if(i.padding>0){var f=u/4,v=Object(K.v)(Hn.d.get(),0,f,0),g=1+i.padding/f;Object(ce.r)(p,p,v),Object(ce.q)(p,p,Object(K.v)(Hn.d.get(),g,g,g)),Object(ce.r)(p,p,Object(K.d)(v,v,-1/g))}var b=Object(ce.i)(Object(le.b)()),m=Object(J.g)(0,1,0),y=Object(ce.o)(Object(le.b)(),Object(Cr.d)(Hn.b.get(),m,o));y[12]=a[a.length-1][0],y[13]=a[a.length-1][1],y[14]=a[a.length-1][2],Object(ce.l)(y,y,p);var O,j,_=[{part:"tube",geometry:qo(i.tubeRadius*(n?i.tubeFocusMultiplier:1)+i.padding,i.flat,a),transform:b}];if(Object(h.k)(i.flat)?O=an.a.createExtrudedTriangle(u,d,d,i.flat.thickness):(O=an.a.createConeGeometry(u,d,24,!1,!1,!0),j=an.a.createConeGeometry(u,d,24,!1,!0,!1)),_.push({part:"tip",geometry:O,transform:y}),j&&_.push({part:"cap",geometry:j,transform:y}),i.bothEnds){var w=Object(ce.o)(Object(le.b)(),Object(Cr.d)(Hn.b.get(),m,r));w[12]=a[0][0],w[13]=a[0][1],w[14]=a[0][2],Object(ce.l)(w,w,p),_.push({part:"tip",geometry:O,transform:w}),j&&_.push({part:"cap",geometry:j,transform:w})}return _};return{normal:n(!1),focused:n(!0)}}function qo(e,t,i){var n=[];if(Object(h.k)(t))n.push([e,t.thickness/2],[-e,t.thickness/2],[-e,-t.thickness/2],[e,-t.thickness/2]);else for(var a=0;a<12;a++){var r=a/12*2*Math.PI;n.push([Math.cos(r)*e,Math.sin(r)*e])}return an.a.createPathExtrusionGeometry(n,i,[],[],!1)}function Wo(e,t){var i=Object(K.i)(Object(J.e)(),e[e.length-1],e[e.length-2]);if(Object(K.q)(i,i),Object(K.d)(i,i,12),Object(K.e)(i,i,e[e.length-1]),t){var n=Object(K.i)(Object(J.e)(),e[0],e[1]);return Object(K.q)(n,n),Object(K.d)(n,n,12),Object(K.e)(n,n,e[0]),[n].concat(Object(Pt.a)(e),[i])}return[].concat(Object(Pt.a)(e),[i])}function Zo(e,t){return Object(Fe.b)(t,e.basis2,e.basis1)+Qo}var Yo=16,Xo=32,Qo=(Ue.f.create(),Math.PI/2),Jo=16,Ko=32,$o=function(){function e(){Object(r.a)(this,e),this.lastDragEvent=null,this.next=new zn.a,this._enabled=!1}return Object(o.a)(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&Object(h.k)(this.lastDragEvent)){var t=Object(a.a)(Object(a.a)({},this.lastDragEvent),{},{action:"update"});e&&this.adjustScaleFactors(t),this.next.execute(t)}this._enabled=e}},{key:"createDragEventPipelineStep",value:function(){var e=this;return this.lastDragEvent=null,function(t){return e.lastDragEvent="end"!==t.action?Object(a.a)({},t):null,e._enabled&&e.adjustScaleFactors(t),t}}},{key:"adjustScaleFactors",value:function(e){var t=Uo(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.handle.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}},{key:"test",get:function(){var e=this;return{adjustScaleFactors:function(t){return e.adjustScaleFactors(t)}}}}]),e}(),es=i(325),ts=i(754),is=i(755),ns=i(756);function as(e,t){return os(e,t,!1)}function rs(e,t){return os(e,t,!0)}function os(e,t,i){if(e instanceof es.b){if(e.operation instanceof ts.a)return function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?-1:1,n=Object(J.g)(i*e.dx,i*e.dy,i*e.dz);Object(K.e)(t.origin,t.origin,n)}(e.operation,t,i),!0;if(e.operation instanceof is.a)return function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?-e.angle:e.angle;Object(K.c)(t.basis1,t.basis1,J.b,i),Object(K.c)(t.basis2,t.basis2,J.b,i)}(e.operation,t,i),!0;if(e.operation instanceof ns.a)return function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=i?1/e.factor1:e.factor1,a=i?1/e.factor2:e.factor2;Object(K.d)(t.basis1,t.basis1,n),Object(K.d)(t.basis2,t.basis2,a),ss(t.origin,e.origin,e.axis1,n),ss(t.origin,e.origin,e.axis2,a)}(e.operation,t,i),!0}return!1}function ss(e,t,i,n){var a=Hn.c.get(),r=Object(He.d)(a,e,t),o=Object(He.a)(a,i,Object(He.g)(i,r));Object(He.o)(e,e,o,n-1)}var cs=function(e){Object(s.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e)).enableZ=!0,n.enableRotation=!0,n.enableScaling=!0,n._preserveAspectRatio=new $o,n.grabbing=!1,n.inputState=null,n.type="transform-3d",n.handles=new Ee.a,n.moveZManipulator=null,n.resizeManipulators=null,n.rotateManipulator=null,n.attachmentOrigin=null,n.outlineVisualElement=null,n.mapBounds=Ue.a.create(),n.mapBoundsStart=Ue.a.create(),n.displayBounds=Ue.a.create(),n.displayBoundsStart=Ue.a.create(),n.displayBoundsMarginStart=0,n.resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],n}return Object(o.a)(i,[{key:"initialize",value:function(){var e=this;this.graphicState=new Sn({graphic:this.graphic});var t=this.graphic.geometry;this.reshapeHelper=new jr(Cn.c.fromGeometry(t,this.view.viewingMode),t.type),this.graphicMoveManipulation=new or({tool:this,view:this.view,graphicState:this.graphicState}),this.handles.add(this._createMoveXYGraphicDragPipeline()),this.moveZManipulator=function(e){var t=0===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)?yo:0,i=[Object(J.g)(t,0,-24),Object(J.g)(t,0,24)],n=Wo(i,!0),a=function(e,t){return Bo(i,i,{tubeRadius:3,tipRadius:11,tipLength:22.5,tubeFocusMultiplier:1.15,tipFocusMultiplier:1.15,padding:e,bothEnds:!0,flat:null,focusTipLength:!0,addCap:t})},r=a(0,!1),o=a(2.25,!0),s=new Un.a({color:fo,cullFace:2,renderOccluded:16}),c=new Un.a({color:vo,cullFace:2,renderOccluded:16}),l=new Un.a({color:go,cullFace:2,renderOccluded:16}),u=new Un.a({color:mo,transparent:!0,writeDepth:!1,cullFace:1,renderOccluded:2}),h=an.a.createPolylineGeometry([[t,0,0],[t-yo,0,0]]),d=an.a.createPolylineGeometry([[t,0,0],[t-yo,0,0]]),p=new Nr({color:bo,renderOccluded:4});return new Xn({view:e,renderObjects:[].concat(Object(Pt.a)(r.normal.map((function(e){var t=e.part,i=e.geometry,n=e.transform;return{geometry:i,material:"tip"===t?s:"cap"===t?c:l,transform:n,stateMask:1|Yo}}))),Object(Pt.a)(o.normal.map((function(e){var t=e.geometry,i=e.transform;return{geometry:t,material:u,transform:i,stateMask:1|Yo}}))),[{geometry:h,material:p,stateMask:1|Yo|Xo}],Object(Pt.a)(r.focused.map((function(e){var t=e.part,i=e.geometry,n=e.transform;return{geometry:i,material:"tip"===t?s:"cap"===t?c:l,transform:n,stateMask:2|Yo}}))),Object(Pt.a)(o.focused.map((function(e){var t=e.geometry,i=e.transform;return{geometry:t,material:u,transform:i,stateMask:2|Yo}}))),[{geometry:d,material:p,stateMask:2|Yo|Xo}]),autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[n]},collisionPriority:1,radius:11,state:Yo})}(this.view,0),this.moveZManipulator.state|=Xo,this.handles.add(this.watch("enableZ",(function(){return e.updateManipulatorAvailability(e.moveZManipulator,0)}))),this.handles.add(this._createMoveZDragPipeline()),this.manipulators.add(this.moveZManipulator),this.resizeManipulators=this.resizeHandles.map((function(t){var i=No(e.view,t);return e.handles.add(e.watch("enableScaling",(function(){return e.updateManipulatorAvailability(i,2)}))),i.events.on("grab-changed",(function(t){return e._onResizeGrab(t)})),e.handles.add(e._createResizeDragPipeline(i,t)),i})),this.manipulators.addMany(this.resizeManipulators),this.rotateManipulatorTexture=new Ar.a("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAK4UExURUdwTP9+AP9tAP9+AP99AP9VAP99AP99AP9+AP9+AP99AP99AP98AP8AAP99AP/9/P+ABf9/Af/Jlf////9/AP9/AP99AP9xAP9/AP94AP9+AP9+AP/16//38f9/AP97AP99AP99AP99AP9zAP9+AP9/AP/o0v/w4v+IE//PoP/59f+DCf99AP98AP+EC/+eQP/kyf/27//at/+VLf/59f+WL//8+/+LHP9+AP9/AP99AP/38P/nz//48/+dPv/7+P/NnP+HEf/8+v/9/f/8+//ewf+SKv/WsP+MHv98AP/27//17P/hxf++f//27v9+AP99AP+1bP98AP9+AP/o0/9+AP+BB/97AP/QpP98AP+uYP9/AP+AA/+QJP+rWP/q1v/Fjf+fQf/hx//Onv/fwP/9/P99AP/ev/+kTP+KGP+vYv/s2v9/AP+oU/+1b/98AP98AP96AP97AP9+AP9/AP9/AP96AP9/AP99AP/Ztf+rW/+mUP98AP+1b//48v/38f98AP+cO//38P99AP/nz//Pov99AP/HkP+fQ/+tX/99AP/69//v4P+6eP/DiP/z6P+TK/+JFv+EDf/s2//lzP+8ev96AP+8ff+YNP9/AP/Tqv+iSf96AP+tXv9/AP/Lm/98AP/lzP/Uq/+tXf/9/P/06f/Hk/+9fv/u3f/Klv/Spf+oVv+za/+jSv/Lmf/q1f/Gjv+1bf/69//Sp/+bOv/PoP+3c//z5/9/AP/Ikv/r1/+hRv/FjP/Mmv+ZN//06v/59P/69f/q1v/x5P9/AP+PI/+3cf/9+//8+v+gRP/16//o0//Ztf+nUv/17P/Hkf/ixv/s2v/59P/48//Di/+lT//ky//hxf/Wrv+oVf/u3f/w4//Wrf+5dv/gxP/7+f/z6P/dvP+6d//u3v+aOP/r2f/r2f///9a+uZsAAADndFJOUwB9B29qA1OAd38/RykBeP6BgLX+KhJ2CQgRdWHt8zpGOUVmC2sK2uaFu/aCQS+DktPwyIz3jfyHZz5o8tf1kvq4hPz+/c6LxIhi8e/RqvBjfKJaedtbgki8K54GgYqb3bGT0rnN/XDNloae30CZpFJUG0BlGhgZUjPHnJgto/PyUJHxUdi8dLKTnU/55aev64yGg+DWqDipjizAlTCdArgx1cCc/Ou0quG1vZqilrfcsaP4vpC6peoos96UsLeP7PX33OcyiaT8+5Tu2saY7rPR4Pb0sJfV0MKZ4ufBptD66sun4pDf3qyDniQAAAO+SURBVFjDpVf1WxRBGF7gYO64A+5OJKU7lFRaSlLARlBpsEVFwu7u7u7u7u7ubt1/w7vZPXZmd/bYffx+geed731vZme+oigR83NsGBNvpbSwUFrF29g6+lGybKxaoQKYqRTqRqlsS09/QDR/T0sJdOdwJRA15Ujntvgd3YBZU661M0dv3wO0aXntxfkaeyDB+mwQodv1BxJNTTyGtQ2QbDbWBH4/02qMBIXeQoVZrYt/h0vZA/8U3PmHtvs0SIKCF84v5Vbe0XQl/GfTgejAoKDFgY/nDSUpTMbun7u/zl1o+lUc6BrdneasQ06EQMDeFRFA3s97I2FIpAONm0OBQMKd49/m0OCXRvfd92iB1W3U8hQ2t8aPEwfq2T3TBFu1Hhdwc2EFwjlMt4d1vsH8meYR245TyO+KK9iy8Y/E70+TrwdN/wp5km6AVpSXBJnQpCo8NJn84IlAI1p/7UU5Au+6yaJP4zAFbyig4IBR3HZjyzDXwlgG3oHnKJj/EOA58sl+4OeNiGLgSgxtNgioAfaIuJt/gyucZhQ8gvkPGjlBVU30249R3ViFEbxrP8TIz0GxREP+V/FfmG75hy/6z18rvtfzFkKgQEoxmu0DKEfpaaQTEx53UUxDjZQuAPZCgQL8LY2RIZCbAT8jCrVQvjIEQF+4hWwEGUcNliOwEwpMQRArSilHoBAKXEYQJ8pCjsAJKKBHkJ7yBIZDgRpMQNYR1kCBC9gRZH3EK1DgLPYRZV1jNRQ4gl2jjIoIdFON/NSVCDSaasB9hr3+s0VUoBfcQCAKJWDBpK2v/kbTyaICFVDgKB5MaDj/rjM6ZA4wu4GMGDyc0YQCIqHLtXQif1gRXK1FsXg8pYFRTBFYrSXww5hIynyAgj4GgUYUqGWyWVaxMJswu6MnYGgTL62DuJmM28U7PH72frbmBQvSOlZYwGE2paYcR7sMrT6Uge8vIBQWSywclppq4cOQqyw042CRKdWvI5U2tLgaLI2rpvnJQ3KyZidxpeIZsbhSznh7uy+VJtuiJTh/rqm8U9vxhUnniPxbl3gftiPXouTxrjztpIAeqteKtzhok8VY2Rm8R1m2Lddsk0WoT7oBp44xd3f9UclEnfBlavBGUU0uZp3nx4SRI8uH3+pOB7JM0OoizbYUIzTb1NaF0vmjrYkTh5dEuspHbOQ5L6lI9CkVH5pc3dvmu7v+39g3vq3B0cXWzDmcbF0kzK4DvRVkusJ7oNTxudkrkT98J/o0yRvgAzQJNr7M+O/bkqAJEPP7B6FvZpCHDcaFAAAAAElFTkSuQmCC",{width:64,height:64,mipmap:!0,preMultiplyAlpha:!0}),this.view._stage&&this.view._stage.add(this.rotateManipulatorTexture),this.rotateManipulator=function(e,t){var i=new To({transparent:!0,writeDepth:!1,textureId:t.id,renderOccluded:16}),n=40,a=27*1.1,r=function(e){var t=new Uint32Array([0,1,2,2,3,0]);return new ye.a([["position",{size:3,data:[n-e,-e,0,n+e,-e,0,n+e,e,0,n-e,e,0],exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1]}]],[["position",t],["uv0",t]])},o=an.a.createPolylineGeometry([[0,0,0],[13,0,0]]),s=an.a.createPolylineGeometry([[0,0,0],[n-a,0,0]]),c=new Nr({color:po,renderOccluded:4}),l=[{geometry:r(27),material:i,stateMask:1|Yo},{geometry:o,material:c,stateMask:1|Yo},{geometry:r(a),material:i,stateMask:2|Yo},{geometry:s,material:c,stateMask:2|Yo}];return new Xn({view:e,renderObjects:l,autoScaleRenderObjects:!1,collisionType:{type:"disc",direction:[0,0,1],offset:[n,0,0]},collisionPriority:1,radius:13.5,state:Yo})}(this.view,this.rotateManipulatorTexture),this.handles.add(this.watch("enableRotation",(function(){return e.updateManipulatorAvailability(e.rotateManipulator,3)}))),this.rotateManipulator.events.on("grab-changed",(function(t){e._onRotateGrab(t)})),this.handles.add(this._createRotateDragPipeline(this.rotateManipulator)),this.manipulators.add(this.rotateManipulator),this.calculateMapBounds(),this.updateDisplayBounds(this.mapBounds);var i=Pa({view:this.view,graphic:this.graphic,forEachManipulator:function(t){return e.forEachManipulator(t)},onManipulatorsChanged:function(){return Object(Dn.c)()}});this.outlineVisualElement=i.visualElement instanceof $i?i.visualElement:null,Object(h.k)(this.outlineVisualElement)&&this.handles.add(this.outlineVisualElement.events.on("attachment-origin-changed",(function(){return e.updateDisplayBounds(e.mapBounds)}))),this.handles.add(i),this.handles.add([this.graphicState.on("changed",(function(){return e.onGeometryChanged()})),this.graphicState.watch("displaying",(function(){return e.updateAllManipulatorAvailability()})),Object(m.a)(this.graphicState,"isDraped",(function(){return e.graphicDrapedChanged()})),this.view.trackGraphicState(this.graphicState)]);var n=this.view.pointsOfInterest;n&&this.handles.add(n.focus.watch("location",(function(){return e.updateDisplayBounds(e.mapBounds)})));var r=function(t){e.handles.add(t.events.on("grab-changed",(function(){e.grabbing=t.grabbing,e.updateAllManipulatorAvailability()})))};this.forEachManipulator(r),this.graphicMoveManipulation.forEachManipulator(r);var o=function(t,i){e.handles.add(t.events.on("immediate-click",(function(t){1===i&&e.emit("immediate-click",Object(a.a)(Object(a.a)({},t),{},{graphic:e.graphic})),t.stopPropagation()})))};this.forEachManipulator(o),this.graphicMoveManipulation.forEachManipulator(o),this.onGeometryChanged(),this.updateAllManipulatorAvailability()}},{key:"graphicDrapedChanged",value:function(){var e=this;this.handles.remove(ls),this.updateDisplayBounds(this.mapBounds),this.graphicState.isDraped&&this.handles.add(this.view.elevationProvider.on("elevation-change",(function(t){Object(h.k)(e.attachmentOrigin)&&Object(tt.h)(t.extent,e.attachmentOrigin.x,e.attachmentOrigin.y)&&e.updateDisplayBounds(e.mapBounds)})),ls)}},{key:"updateAllManipulatorAvailability",value:function(){var e=this;this.forEachManipulator((function(t,i){return e.updateManipulatorAvailability(t,i)}))}},{key:"updateManipulatorAvailability",value:function(e,t){var i=this.graphicState.displaying,n=this.grabbing&&!e.grabbing;e.interactive=!n;var a=this.enableZ&&ma(this.graphic);switch(t){case 3:e.available=i&&this.enableRotation;break;case 2:e.available=i&&(this.enableScaling||this.enableRotation||a),e.interactive=!n&&this.enableScaling,e.state=this.enableScaling?Jo:Ko;break;case 0:e.available=i&&a;break;default:e.available=i}}},{key:"forEachManipulator",value:function(e){this.resizeManipulators.forEach((function(t){return e(t,2)})),e(this.rotateManipulator,3),e(this.moveZManipulator,0)}},{key:"destroy",value:function(){this.view._stage&&this.view._stage.remove(this.rotateManipulatorTexture),this.handles.destroy(),this.graphicMoveManipulation.destroy(),this.reshapeHelper.destroy(),this._set("view",null),this._set("graphic",null)}},{key:"preserveAspectRatio",get:function(){return this._preserveAspectRatio.enabled},set:function(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}},{key:"reset",value:function(){}},{key:"onDetach",value:function(){this.mapBounds=null,this.displayBounds=null}},{key:"onGeometryChanged",value:function(){this.updateDisplayBounds(this.mapBounds)}},{key:"calculateMapBounds",value:function(){var e=this.graphic.geometry,t=this.reshapeHelper.editGeometry,i=t.components[0].edges[0],n=Object(He.d)(Hn.c.get(),i.left.pos,i.right.pos);Object(He.e)(n,n);var a=Object(h.r)(va(this.view,this.graphic),e.extent.center),r=hs*this.view.pixelSizeAt(a),o=this.view.spatialReference;o!==e.spatialReference&&(r*=Object(Dr.d)(o)/Object(Dr.d)(e.spatialReference)),function(e,t,i,n){n||(n=Ue.a.create());var a=Object(He.r)(Hn.c.get(),e[1],-e[0]),r=Object(He.r)(Hn.c.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),o=Object(He.r)(Hn.c.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),s=Hn.c.get();t.components.forEach((function(t){return t.vertices.forEach((function(t){var i=t.pos;Object(He.r)(s,Object(He.g)(e,i),Object(He.g)(a,i)),Object(He.t)(r,r,s),Object(He.u)(o,o,s)}))}));var c=1e-6,l=Object(He.r)(Hn.c.get(),o[0]-r[0]<c?i/2:0,o[1]-r[1]<c?i/2:0);Object(He.d)(r,r,l),Object(He.h)(o,o,l),Object(He.a)(n.basis1,e,(o[0]-r[0])/2),Object(He.a)(n.basis2,a,(o[1]-r[1])/2),Object(He.r)(n.origin,r[0]*e[0]+r[1]*a[0],r[0]*e[1]+r[1]*a[1]),Object(He.h)(n.origin,n.origin,n.basis1),Object(He.h)(n.origin,n.origin,n.basis2)}(n,t,r,this.mapBounds)}},{key:"updateDisplayBounds",value:function(e){var t=this.graphic.geometry,i=Object(h.k)(this.outlineVisualElement)&&!this.graphicState.isDraped&&Object(h.k)(this.outlineVisualElement.attachmentOrigin)?this.outlineVisualElement.attachmentOrigin:va(this.view,this.graphic);this.attachmentOrigin=Object(h.r)(i,t.extent.center);var n=Object(h.k)(i)?i.z:Object(Oe.c)(e.origin,this.view.elevationProvider,re.a.fromElevationInfo(Object(j.d)(this.graphic)),this.view.renderCoordsHelper),a=Ue.a.copy(e);Object(K.v)(a.origin,e.origin[0],e.origin[1],n),function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4?arguments[4]:void 0;a||(a=Ue.a.create()),t.toRenderCoords(e.origin,i,a.origin);var r=Hn.d.get();Object(K.e)(r,e.origin,e.basis1),Object(K.e)(r,r,e.basis2),t.toRenderCoords(r,i,r);var o=Hn.d.get();Object(K.e)(o,e.origin,e.basis1),Object(K.i)(o,o,e.basis2),t.toRenderCoords(o,i,o);var s=Hn.d.get();Object(K.i)(s,e.origin,e.basis1),Object(K.i)(s,s,e.basis2),t.toRenderCoords(s,i,s);var c=Hn.d.get();Object(K.i)(c,e.origin,e.basis1),Object(K.e)(c,c,e.basis2),t.toRenderCoords(c,i,c);var l=Object(K.h)(Hn.d.get(),r,o,.5);Object(K.i)(l,l,a.origin);var u=Object(K.h)(Hn.d.get(),s,c,.5);Object(K.i)(u,a.origin,u),Object(K.h)(a.basis1,l,u,.5);var h=Object(K.h)(Hn.d.get(),c,r,.5);Object(K.i)(h,h,a.origin);var d=Object(K.h)(Hn.d.get(),o,s,.5);Object(K.i)(d,a.origin,d),Object(K.h)(a.basis2,h,d,.5);var p=Object(K.f)(Hn.d.get(),a.basis1,a.basis2),f=Object(K.f)(p,p,a.basis1);Object(K.q)(f,f),Object(K.d)(a.basis2,f,Object(K.g)(a.basis2,f)),Object(K.d)(a.basis1,a.basis1,1+n/Object(K.o)(a.basis1)),Object(K.d)(a.basis2,a.basis2,1+n/Object(K.o)(a.basis2)),Ue.a.updateUnboundedPlane(a)}(a,this.view.renderCoordsHelper,t.spatialReference,this.displayBoundsMargin(),this.displayBounds),this.updateManipulators()}},{key:"displayBoundsMargin",value:function(){var e=this.view.pointsOfInterest,t=e?e.focus.location:this.reshapeHelper.geometry.extent.center;return us*this.view.pixelSizeAt(t)}},{key:"_createMoveXYGraphicDragPipeline",value:function(){var e=this;return this.graphicMoveManipulation.createDragPipeline((function(t,i,n){return e.applyGraphicMoveSteps(i,n)}))}},{key:"_createMoveZDragPipeline",value:function(){var e=this,t=this.view,i=this.reshapeHelper.geometry.spatialReference;return Object(zn.e)(this.moveZManipulator,(function(n,a,r){var o=Object(J.d)(n.renderLocation),s=a.next(Wa(t,o,i)).next(Object(zn.c)());e.applyGraphicMoveSteps(s,r)}))}},{key:"applyGraphicMoveSteps",value:function(e,t){var i=this,n=e.next((function(e){return"start"===e.action&&(i.inputState={type:"move"},Ue.a.copy(i.mapBounds,i.mapBoundsStart),i.emit("graphic-translate-start",{graphic:i.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e})).next(Object(zn.b)()).next(this._moveDragUpdateGeometry()).next((function(e){var t={graphic:i.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||e.mapEnd.z-e.mapStart.z)&&i.emit("graphic-translate",t);break;case"end":i.inputState=null,i.emit("graphic-translate-stop",t)}return e}));return t.next((function(){Object(h.k)(i.inputState)&&i.emit("graphic-translate-stop",{graphic:i.graphic,dxScreen:0,dyScreen:0}),i.cancel()})),n}},{key:"_moveDragUpdateGeometry",value:function(){var e=this;return function(t){if(Object(h.j)(e.inputState)||"move"!==e.inputState.type)return t;var i,n=[],a=Object(R.a)(e.reshapeHelper.editGeometry.components);try{for(a.s();!(i=a.n()).done;){var r=i.value;n.push.apply(n,Object(Pt.a)(r.vertices))}}catch(s){a.e(s)}finally{a.f()}var o="start"===t.action?0:1;return as(e.reshapeHelper.moveVertices(n,t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,o),e.mapBounds),e.graphic.geometry=e.reshapeHelper.geometry,t}}},{key:"_onResizeGrab",value:function(e){if("start"===e.action){var t=this._calculatePickRay(e.screenPoint);Ue.e.intersectRay(this.displayBounds.plane,t,Hn.d.get())&&(Ue.a.copy(this.displayBounds,this.displayBoundsStart),Ue.a.copy(this.mapBounds,this.mapBoundsStart),this.displayBoundsMarginStart=this.displayBoundsMargin(),this.inputState={type:"resize"})}}},{key:"_createResizeDragPipeline",value:function(e,t){var i=this;return Object(zn.e)(e,(function(e,n,r){Object(h.j)(i.inputState)||(n.next((function(e){return"start"===e.action&&i.emit("graphic-scale-start",{graphic:i.graphic,xScale:1,yScale:1}),e})).next(Ua(i.view,i.displayBoundsStart.plane)).next((function(e){return Object(a.a)(Object(a.a)({},e),{},{handle:t})})).next(i._resizeDragRenderPlaneToFactors()).next(i._preserveAspectRatio.createDragEventPipelineStep(),i._preserveAspectRatio.next).next(i._resizeDragUpdateGeometry()).next((function(e){var t={graphic:i.graphic,xScale:e.factor1,yScale:e.factor2};switch(e.action){case"start":case"update":i.emit("graphic-scale",t);break;case"end":i.inputState=null,i.emit("graphic-scale-stop",t)}return e})),r.next((function(){Object(h.k)(i.inputState)&&i.emit("graphic-scale-stop",{graphic:i.graphic,xScale:1,yScale:1}),i.cancel()})))}))}},{key:"_resizeDragRenderPlaneToFactors",value:function(){var e=this;return function(t){var i=e.displayBoundsStart,n=t.handle.direction,r=e.displayBoundsMargin(),o=e.displayBoundsMarginStart,s=Object(K.j)(Hn.d.get(),i.origin);Object(K.b)(s,s,i.basis1,-n[0]),Object(K.b)(s,s,i.basis2,-n[1]);var c=Object(K.i)(Hn.d.get(),t.renderEnd,s),l=Object(K.i)(Hn.d.get(),t.renderStart,s),u=Uo(t.handle),h=Fo(i),d=Fo(e.displayBounds)/h,p=function(e,t){if(0===e)return 1;var i=Object(K.o)(t),n=.5*e*Object(K.g)(t,c)/i,a=n<0?-1:1;u&&(n+=(i-.5*e*Object(K.g)(t,l)/i)*a*d);var s=i<1.5*o?1:ds;return i=Math.max(i-o,ds),a>0&&(n-=r),a*Math.max(a*(n/i),s)};return Object(a.a)(Object(a.a)({},t),{},{factor1:p(n[0],i.basis1),factor2:p(n[1],i.basis2)})}}},{key:"_resizeDragUpdateGeometry",value:function(){var e=this;return function(t){var i=Object(K.j)(Object(J.e)(),e.mapBoundsStart.origin);Object(K.b)(i,i,e.mapBoundsStart.basis1,-t.handle.direction[0]),Object(K.b)(i,i,e.mapBoundsStart.basis2,-t.handle.direction[1]);var n=Object(He.r)(Object(Te.a)(),e.mapBoundsStart.basis1[0],e.mapBoundsStart.basis1[1]);Object(He.e)(n,n);var a,r=[],o=Object(R.a)(e.reshapeHelper.editGeometry.components);try{for(o.s();!(a=o.n()).done;){var s=a.value;r.push.apply(r,Object(Pt.a)(s.vertices))}}catch(u){o.e(u)}finally{o.f()}var c="start"===t.action?0:1,l=e.reshapeHelper.scaleVertices(r,e.reshapeHelper.editGeometry.coordinateHelper.fromXYZ(i),n,t.factor1,t.factor2,c,1);return Ue.a.copy(e.mapBoundsStart,e.mapBounds),as(l,e.mapBounds),e.graphic.geometry=e.reshapeHelper.geometry,t}}},{key:"_onRotateGrab",value:function(e){if("start"===e.action){var t=function(e,t,i,n){var a=t.worldUpAtPosition(e.origin,Hn.d.get()),r=Hn.d.get();switch(i){case 1:Object(K.j)(r,a);break;case 2:Object(K.j)(r,e.basis1)}return Ue.e.fromPositionAndNormal(e.origin,r,n)}(this.displayBounds,this.view.renderCoordsHelper,1,Ue.e.create()),i=this._calculatePickRay(e.screenPoint);Ue.e.intersectRay(t,i,Hn.d.get())&&(Ue.a.copy(this.displayBounds,this.displayBoundsStart),Ue.a.copy(this.mapBounds,this.mapBoundsStart),this.inputState={type:"rotate",rotatePlane:t})}}},{key:"_createRotateDragPipeline",value:function(e){var t=this;return Object(zn.e)(e,(function(e,i,n){var a=t.inputState;Object(h.j)(a)||(i.next((function(e){return"start"===e.action&&t.emit("graphic-rotate-start",{graphic:t.graphic,angle:0}),e})).next(Ua(t.view,a.rotatePlane)).next(t._rotateDragRenderPlaneToRotate(a)).next(t._rotateDragUpdateGeometry()).next((function(e){var i={graphic:t.graphic,angle:Object(fe.p)(e.rotateAngle)};switch(e.action){case"start":case"update":t.emit("graphic-rotate",i);break;case"end":t.inputState=null,t.emit("graphic-rotate-stop",i)}return e})),n.next((function(){Object(h.k)(t.inputState)&&t.emit("graphic-rotate-stop",{graphic:t.graphic,angle:0}),t.cancel()})))}))}},{key:"_rotateDragRenderPlaneToRotate",value:function(e){var t=this;return function(i){var n=Ue.e.normal(e.rotatePlane),r=pa(i.renderStart,i.renderEnd,t.displayBounds.origin,n);return Object(a.a)(Object(a.a)({},i),{},{rotateAxis:n,rotateAngle:r})}}},{key:"_rotateDragUpdateGeometry",value:function(){var e=this;return function(t){var i,n=Object(K.j)(Object(J.e)(),e.mapBoundsStart.origin),a=[],r=Object(R.a)(e.reshapeHelper.editGeometry.components);try{for(r.s();!(i=r.n()).done;){var o=i.value;a.push.apply(a,Object(Pt.a)(o.vertices))}}catch(l){r.e(l)}finally{r.f()}var s="start"===t.action?0:1,c=e.reshapeHelper.rotateVertices(a,e.reshapeHelper.editGeometry.coordinateHelper.fromXYZ(n),t.rotateAngle,s,1);return Ue.a.copy(e.mapBoundsStart,e.mapBounds),as(c,e.mapBounds),e.graphic.geometry=e.reshapeHelper.geometry,t}}},{key:"_calculatePickRay",value:function(e){var t=Ue.f.create(),i=Object(Ve.i)(e);return Ue.f.fromScreen(this.view.state.camera,i,t),Object(K.q)(t.direction,t.direction),t}},{key:"updateManipulators",value:function(){var e=this;if(this.visible){var t=function(e,t){return fa(e.basis1,e.basis2,e.origin,t)}(this.displayBounds,Hn.a.get());(function(e,t,i,n){var a=n.worldUpAtPosition(i.origin,Hn.d.get()),r=Vo(i,0),o=Object(ce.i)(Hn.a.get());Object(ce.g)(o,o,r.edge*Math.PI/2),Object(ce.e)(o,o,-Zo(i,a)),Object(ce.l)(o,t,o),o[12]=0,o[13]=0,o[14]=0,e.modelTransform=o,e.renderLocation=r.position})(this.rotateManipulator,t,this.displayBounds,this.view.renderCoordsHelper),this.updateZMoveHandle(this.moveZManipulator,t),this.resizeManipulators.forEach((function(i,n){!function(e,t,i,n){var a=Object(K.o)(n.basis1),r=Object(K.o)(n.basis2),o=Ho(n),s=Fo(n),c=Object(K.v)(Hn.d.get(),0,0,0);Object(K.e)(c,Object(K.d)(Hn.d.get(),n.basis1,t.direction[0]),Object(K.d)(Hn.d.get(),n.basis2,t.direction[1])),Object(K.e)(c,n.origin,c);var l=0,u=1;if(Uo(t))1===t.direction[0]&&-1===t.direction[1]?l=Qo:1===t.direction[0]&&1===t.direction[1]?l=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(l=3*Math.PI/2),u=s;else{var h=0!==t.direction[0]?1:2;l=1===h?Qo:0,u=(1===h?r:a)-o}var d=Object(ce.i)(Hn.a.get());Object(ce.g)(d,d,l),Object(ce.q)(d,d,Object(K.v)(Hn.d.get(),u,u,u)),Object(ce.l)(d,i,d),d[12]=0,d[13]=0,d[14]=0,e.modelTransform=d,e.renderLocation=c}(i,e.resizeHandles[n],t,e.displayBounds)}))}}},{key:"updateZMoveHandle",value:function(e,t){var i=this.displayBounds,n={basis:i.basis1,direction:-1,position:Object(K.i)(Hn.d.get(),i.origin,i.basis1),edge:2},a=Hn.a.get();Object(ce.g)(a,t,n.edge*Math.PI/2),a[12]=0,a[13]=0,a[14]=0,e.modelTransform=a,e.renderLocation=n.position}},{key:"cancel",value:function(){var e=this.reshapeHelper.editGeometry.lastOperation;Object(h.j)(e)||(this.reshapeHelper.undo(),this.graphic.geometry=this.reshapeHelper.geometry,rs(e,this.mapBounds),this.updateDisplayBounds(this.mapBounds),this.inputState=null)}},{key:"canUndo",value:function(){return this.reshapeHelper.canUndo}},{key:"undo",value:function(){if(Object(h.k)(this.inputState))this.view.activeTool=null;else if(this.canUndo()){var e=this.reshapeHelper.undo();this.graphic.geometry=this.reshapeHelper.geometry,rs(Object(h.q)(e),this.mapBounds),this.updateDisplayBounds(this.mapBounds)}}},{key:"canRedo",value:function(){return this.reshapeHelper.canRedo}},{key:"redo",value:function(){if(this.canRedo()){var e=this.reshapeHelper.redo();this.graphic.geometry=this.reshapeHelper.geometry,as(Object(h.q)(e),this.mapBounds),this.updateDisplayBounds(this.mapBounds)}}}]),i}(g.a.EventedMixin(w.a));Object(l.a)([Object(f.b)({constructOnly:!0,nonNullable:!0})],cs.prototype,"view",void 0),Object(l.a)([Object(f.b)({constructOnly:!0,nonNullable:!0})],cs.prototype,"graphic",void 0),Object(l.a)([Object(f.b)({constructOnly:!0,nonNullable:!0})],cs.prototype,"enableZ",void 0),Object(l.a)([Object(f.b)()],cs.prototype,"enableRotation",void 0),Object(l.a)([Object(f.b)()],cs.prototype,"enableScaling",void 0),Object(l.a)([Object(f.b)()],cs.prototype,"preserveAspectRatio",null),Object(l.a)([Object(f.b)()],cs.prototype,"grabbing",void 0),Object(l.a)([Object(f.b)()],cs.prototype,"inputState",void 0),Object(l.a)([Object(f.b)({readOnly:!0})],cs.prototype,"type",void 0),cs=Object(l.a)([Object(v.a)("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],cs);var ls="draped-elevation-changes",us=10,hs=80,ds=1e-6}}]);
//# sourceMappingURL=8.adbfe7d9.chunk.js.map