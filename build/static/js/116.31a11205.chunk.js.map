{"version":3,"sources":["../node_modules/@arcgis/core/views/2d/layers/features/support/whereUtils.js","../node_modules/@arcgis/core/layers/graphics/data/FeatureFilter.js"],"names":["t","e","getLogger","a","getAttribute","r","field","s","n","o","WhereClause","create","isStandardized","error","readArcadeFeature","testFeature","warn","_","this","_geometryBounds","_idToVisibility","Map","_serviceInfo","_hash","_applyFilter","_resetAllHiddenIds","update","show","hide","forEach","set","i","Set","get","h","has","push","geometry","spatialRel","where","timeExtent","objectIds","fromJSON","JSON","stringify","_setGeometryFilter","_setIdFilter","_setAttributeFilter","_setTimeFilter","_clause","m","fieldsIndex","_idsToShow","_idsToHide","hiddenIds","_spatialQueryOperator","l","geometryType","hasZ","hasM","_timeOperator","timeInfo","d","_filterByGeometry","_filterById","_filterByTime","_filterByExpression","size","getObjectId","readHydratedGeometry"],"mappings":"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","file":"static/js/116.31a11205.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../core/Logger.js\";import r from\"../../../../../core/Error.js\";const t=e.getLogger(\"esri.views.2d.layers.features.support.whereUtils\"),a={getAttribute:(e,r)=>e.field(r)};async function s(e,s){const n=await import(\"../../../../../core/sql/WhereClause.js\");try{const o=n.WhereClause.create(e,s);if(!o.isStandardized){const e=new r(\"mapview - bad input\",\"Unable to apply filter's definition expression, as expression is not standardized.\",o);t.error(e)}return e=>{const r=e.readArcadeFeature();return o.testFeature(r,a)}}catch(r){return t.warn(\"mapview-bad-where-clause\",\"Encountered an error when evaluating where clause\",e),e=>!0}}export{s as createWhereClause};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../core/maybe.js\";import e from\"../../../core/Logger.js\";import i from\"../../../core/Error.js\";import{all as s}from\"../../../core/promiseUtils.js\";import{getBoundsXY as r}from\"../../../geometry/support/boundsUtils.js\";import{create as o}from\"../../../geometry/support/aaBoundingRect.js\";import h from\"../../../tasks/support/Query.js\";import{n as a,g as l}from\"../../../chunks/spatialQuerySupport.js\";import{getTimeOperator as n}from\"./timeSupport.js\";import{featureAdapter as d}from\"../../../views/2d/layers/features/FeatureStore2D.js\";import{createWhereClause as m}from\"../../../views/2d/layers/features/support/whereUtils.js\";const _=e.getLogger(\"esri.views.2d.layers.features.controllers.FeatureFilter\");export default class{constructor(t){this._geometryBounds=o(),this._idToVisibility=new Map,this._serviceInfo=t}get hash(){return this._hash}check(t){return this._applyFilter(t)}clear(){const t=this._resetAllHiddenIds();return this.update(),{show:t,hide:[]}}invalidate(){this._idToVisibility.forEach(((t,e)=>{this._idToVisibility.set(e,0)}))}setKnownIds(t){for(const e of t)this._idToVisibility.set(e,1)}setTrue(t){const e=[],i=[],s=new Set(t);return this._idToVisibility.forEach(((t,r)=>{const o=!!(1&this._idToVisibility.get(r)),h=s.has(r);!o&&h?e.push(r):o&&!h&&i.push(r),this._idToVisibility.set(r,h?3:0)})),{show:e,hide:i}}createQuery(){const{geometry:t,spatialRel:e,where:i,timeExtent:s,objectIds:r}=this;return h.fromJSON({geometry:t,spatialRel:e,where:i,timeExtent:s,objectIds:r})}async update(t,e){this._hash=JSON.stringify(t);const i=await a(t,null,e);await s([this._setGeometryFilter(i),this._setIdFilter(i),this._setAttributeFilter(i),this._setTimeFilter(i)])}async _setAttributeFilter(t){if(!t||!t.where)return this._clause=null,void(this.where=null);this._clause=await m(t.where,this._serviceInfo.fieldsIndex),this.where=t.where}_setIdFilter(t){this._idsToShow=t&&t.objectIds&&new Set(t.objectIds),this._idsToHide=t&&t.hiddenIds&&new Set(t.hiddenIds),this.objectIds=t&&t.objectIds}async _setGeometryFilter(t){if(!t||!t.geometry)return this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null);const e=t.geometry,i=t.spatialRel||\"esriSpatialRelIntersects\",s=await l(i,e,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);r(this._geometryBounds,e),this._spatialQueryOperator=s,this.geometry=e,this.spatialRel=i}_setTimeFilter(t){if(this.timeExtent=this._timeOperator=null,t&&t.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=t.timeExtent,this._timeOperator=n(this._serviceInfo.timeInfo,t.timeExtent,d);else{const e=new i(\"feature-layer-view:time-filter-not-available\",\"Unable to apply time filter, as layer doesn't have time metadata.\",t.timeExtent);_.error(e)}}_applyFilter(t){return this._filterByGeometry(t)&&this._filterById(t)&&this._filterByTime(t)&&this._filterByExpression(t)}_filterByExpression(t){return!this.where||this._clause(t)}_filterById(t){return(!this._idsToHide||!this._idsToHide.size||!this._idsToHide.has(t.getObjectId()))&&(!this._idsToShow||!this._idsToShow.size||this._idsToShow.has(t.getObjectId()))}_filterByGeometry(t){if(!this.geometry)return!0;const e=t.readHydratedGeometry();return!!e&&this._spatialQueryOperator(e)}_filterByTime(e){return!t(this._timeOperator)||this._timeOperator(e)}_resetAllHiddenIds(){const t=[];return this._idToVisibility.forEach(((e,i)=>{1&e||(this._idToVisibility.set(i,1),t.push(i))})),t}}\n"],"sourceRoot":""}